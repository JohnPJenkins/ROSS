<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>layer/ip-layer-extern.h File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.18 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="globals.html">Globals</a> &nbsp; </center>
<hr><h1>ip-layer-extern.h File Reference</h1>
<p>
<a href="layer_2ip-layer-extern_8h-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td nowrap align=right valign=top>void&nbsp;</td><td valign=bottom><a class="el" href="layer_2ip-layer-extern_8h.html#a1">ip_layer_init</a> (ip_layer_state *state, xmlNodePtr, tw_lp *lp)</td></tr>
<tr><td nowrap align=right valign=top>void&nbsp;</td><td valign=bottom><a class="el" href="layer_2ip-layer-extern_8h.html#a2">ip_layer_event_handler</a> (ip_layer_state *state, tw_bf *CV, rn_message *msg, tw_lp *lp)</td></tr>
<tr><td nowrap align=right valign=top>void&nbsp;</td><td valign=bottom><a class="el" href="layer_2ip-layer-extern_8h.html#a3">ip_layer_rc_event_handler</a> (ip_layer_state *state, tw_bf *CV, rn_message *msg, tw_lp *lp)</td></tr>
<tr><td nowrap align=right valign=top>void&nbsp;</td><td valign=bottom><a class="el" href="layer_2ip-layer-extern_8h.html#a4">ip_layer_final</a> (ip_layer_state *state, tw_lp *lp)</td></tr>
<tr><td nowrap align=right valign=top>void&nbsp;</td><td valign=bottom><a class="el" href="layer_2ip-layer-extern_8h.html#a5">ip_layer_xml</a> (tw_lp *lp, xmlNodePtr)</td></tr>
<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="layer_2ip-layer-extern_8h.html#a0">g_ip_header</a></td></tr>
</table>
<hr><h2>Function Documentation</h2>
<a name="a2" doxytag="layer/ip-layer-extern.h::ip_layer_event_handler"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void ip_layer_event_handler </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">ip_layer_state *&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>state</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>tw_bf *&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>CV</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>rn_message *&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>msg</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>tw_lp *&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>lp</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="layer_2ip-layer_8c-source.html#l00019">19</a> of file <a class="el" href="layer_2ip-layer_8c-source.html">layer/ip-layer.c</a>.
<p>
References <a class="el" href="rn-types_8h.html#a25a11">DOWNSTREAM</a>, <a class="el" href="rn-event_8c-source.html#l00145">rn_event_data()</a>, <a class="el" href="rn-event_8c-source.html#l00048">rn_event_new()</a>, <a class="el" href="rn-event_8c-source.html#l00151">rn_event_send()</a>, <a class="el" href="rn-message_8c-source.html#l00016">rn_message_data()</a>, and <a class="el" href="rn-types_8h.html#a25a13">UPSTREAM</a>.
<p>
<div class="fragment"><pre>00020 {
00021   tw_stime        ts = 0;
00022 
00023   ip_layer_message *ip_m;
00024   rn_message       *r;
00025   tw_event         *n_evt;
00026   rn_link          *link;
00027   
00028   <span class="keywordflow">switch</span> (msg-&gt;type)
00029     {
00030     <span class="keywordflow">case</span> <a class="code" href="rn-types_8h.html#a25a13">UPSTREAM</a>:
00031       msg-&gt;size -= g_ip_header;
00032       
00033       <span class="keywordflow">return</span>;
00034       
00035     <span class="keywordflow">case</span> <a class="code" href="rn-types_8h.html#a25a11">DOWNSTREAM</a>:
00036       link = state-&gt;host-&gt;link;
00037       <span class="comment">//ip_m = rn_message_data_correct(msg, lp);</span>
00038         ip_m = <a class="code" href="rn-message_8c.html#a2">rn_message_data</a>(msg);
00039 
00040       ip_m-&gt;rc_lastsent = state-&gt;lastsent;
00041 
00042       <span class="keywordflow">if</span> (tw_now(lp) &gt; state-&gt;lastsent)
00043         state-&gt;lastsent = tw_now(lp);
00044       <span class="keywordflow">else</span>
00045         ts = state-&gt;lastsent - tw_now(lp);
00046             
00047       <span class="comment">// should add frequency</span>
00048       <span class="comment">// get next_hop</span>
00049       
00050       msg-&gt;size += g_ip_header;
00051       ts += (msg-&gt;size * 8 / (double) link-&gt;bandwidth  + link-&gt;delay);
00052       state-&gt;lastsent += (msg-&gt;size * 8/ (double) link-&gt;bandwidth );
00053       
00054 
00055       <span class="comment">// look at rn-event.c  for the correct way.     </span>
00056       n_evt = <a class="code" href="rn-event_8c.html#a1">rn_event_new</a>(state-&gt;next_hop, ts, lp, <a class="code" href="rn-types_8h.html#a25a11">DOWNSTREAM</a>, msg-&gt;size);
00057      
00058       r = <a class="code" href="rn-event_8c.html#a2">rn_event_data</a>(n_evt);
00059         ip_m = <a class="code" href="rn-message_8c.html#a2">rn_message_data</a>(r);
00060       memcpy(ip_m, msg, msg-&gt;size);
00061       n_evt-&gt;dest_lp = tw_getlp(state-&gt;next_hop-&gt;id);
00062       <span class="keywordflow">if</span>(n_evt-&gt;dest_lp-&gt;id != state-&gt;next_hop-&gt;id)
00063         printf(<span class="stringliteral">"part of the problem is found\n"</span>);
00064       n_evt-&gt;message-&gt;dest_lp = state-&gt;next_hop-&gt;id;
00065       <a class="code" href="rn-event_8c.html#a3">rn_event_send</a>(n_evt);
00066       <span class="keywordflow">break</span>;
00067     <span class="keywordflow">default</span>:
00068       tw_error(TW_LOC, <span class="stringliteral">"IP-LAYER, ip_layer_event_handler, Unkown message type %d %f\n"</span>,
00069                msg-&gt;type, tw_now(lp));
00070     }
00071 }
</pre></div>    </td>
  </tr>
</table>
<a name="a4" doxytag="layer/ip-layer-extern.h::ip_layer_final"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void ip_layer_final </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">ip_layer_state *&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>state</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>tw_lp *&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>lp</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="layer_2ip-layer_8c-source.html#l00098">98</a> of file <a class="el" href="layer_2ip-layer_8c-source.html">layer/ip-layer.c</a>.
<p>
<div class="fragment"><pre>00099 {
00100 
00101 }
</pre></div>    </td>
  </tr>
</table>
<a name="a1" doxytag="layer/ip-layer-extern.h::ip_layer_init"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void ip_layer_init </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">ip_layer_state *&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>state</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>xmlNodePtr&nbsp;</td>
          <td class="mdname" nowrap>&nbsp;, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>tw_lp *&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>lp</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="layer_2ip-layer_8c-source.html#l00011">11</a> of file <a class="el" href="layer_2ip-layer_8c-source.html">layer/ip-layer.c</a>.
<p>
References <a class="el" href="rn-machine_8c-source.html#l00004">rn_getmachine()</a>.
<p>
<div class="fragment"><pre>00012 {
00013   state-&gt;host = <a class="code" href="rn-machine_8c.html#a0">rn_getmachine</a>(lp-&gt;id);
00014   state-&gt;next_hop = tw_getlp(state-&gt;host-&gt;link-&gt;addr);
00015 }
</pre></div>    </td>
  </tr>
</table>
<a name="a3" doxytag="layer/ip-layer-extern.h::ip_layer_rc_event_handler"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void ip_layer_rc_event_handler </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">ip_layer_state *&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>state</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>tw_bf *&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>CV</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>rn_message *&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>msg</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>tw_lp *&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>lp</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="layer_2ip-layer_8c-source.html#l00076">76</a> of file <a class="el" href="layer_2ip-layer_8c-source.html">layer/ip-layer.c</a>.
<p>
References <a class="el" href="rn-types_8h.html#a25a11">DOWNSTREAM</a>, <a class="el" href="rn-message_8c-source.html#l00016">rn_message_data()</a>, and <a class="el" href="rn-types_8h.html#a25a13">UPSTREAM</a>.
<p>
<div class="fragment"><pre>00077 {
00078   ip_layer_message *ip_m;
00079   
00080   <span class="keywordflow">switch</span> (msg-&gt;type)
00081     {
00082     <span class="keywordflow">case</span> <a class="code" href="rn-types_8h.html#a25a13">UPSTREAM</a>:
00083       msg-&gt;size += g_ip_header;
00084       <span class="keywordflow">return</span>;
00085       
00086     <span class="keywordflow">case</span> <a class="code" href="rn-types_8h.html#a25a11">DOWNSTREAM</a>:
00087       ip_m = <a class="code" href="rn-message_8c.html#a2">rn_message_data</a>(msg);
00088       state-&gt;lastsent = ip_m-&gt;rc_lastsent;
00089       <span class="keywordflow">break</span>;
00090 
00091     <span class="keywordflow">default</span>:
00092       tw_error(TW_LOC, <span class="stringliteral">"IP-LAYER, ip_layer_event_handler, Unkown message type %d\n"</span>,
00093                msg-&gt;type);
00094     }
00095 }
</pre></div>    </td>
  </tr>
</table>
<a name="a5" doxytag="layer/ip-layer-extern.h::ip_layer_xml"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void ip_layer_xml </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">tw_lp *&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>lp</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>xmlNodePtr&nbsp;</td>
          <td class="mdname" nowrap>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="layer_2ip-layer_8c-source.html#l00104">104</a> of file <a class="el" href="layer_2ip-layer_8c-source.html">layer/ip-layer.c</a>.
<p>
References <a class="el" href="xml-libxml_8c-source.html#l00202">xml_getprop()</a>.
<p>
<div class="fragment"><pre>00105 {
00106         xmlNodePtr              layer;
00107         
00108         <span class="keywordflow">for</span>(layer = node; layer; layer = layer-&gt;next)
00109         {
00110                 <span class="keywordflow">if</span>(0 != strcmp(layer-&gt;name, <span class="stringliteral">"layer"</span>))
00111                         <span class="keywordflow">continue</span>;
00112 
00113                 <span class="keywordflow">if</span>(strcmp(<a class="code" href="xml-libxml_8c.html#a7">xml_getprop</a>(layer, <span class="stringliteral">"name"</span>), <span class="stringliteral">"ip"</span>) == 0)
00114                 {
00115                         tw_lp_settype(lp, IP_LAYER_LP_TYPE);
00116                         printf(<span class="stringliteral">"Setting LP %d to IP! \n"</span>, lp-&gt;id);
00117 
00118                         <span class="keywordflow">break</span>;
00119                 }
00120         }
00121 }
</pre></div>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a name="a0" doxytag="layer/ip-layer-extern.h::g_ip_header"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int g_ip_header
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="layer_2ip-layer-extern_8h-source.html#l00019">19</a> of file <a class="el" href="layer_2ip-layer-extern_8h-source.html">layer/ip-layer-extern.h</a>.    </td>
  </tr>
</table>
<hr><address style="align: right;"><small>Generated on Tue Apr 12 17:46:15 2005 for ROSS.Net by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.18 </small></address>
</body>
</html>
