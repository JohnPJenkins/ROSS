<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>ROSS.Net: bgp-extern.h File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.5 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>bgp-extern.h File Reference</h1>
<p>

<p>
<a href="bgp-extern_8h-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp-extern_8h.html#6b22cf4d43b6cb597d3c4b3d0ad97f9d">bgp_open_send</a> (bgp_state *, bgp_nbr *n, tw_lp *lp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp-extern_8h.html#037961ede688c23e798d7f8c0e995001">bgp_open</a> (bgp_state *, tw_bf *, bgp_message *, int, tw_lp *)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp-extern_8h.html#ca24ca9ccbbf6efaa21b4303110d9a5a">bgp_decision</a> (bgp_state *, bgp_route *r1, bgp_route *r2, tw_lp *)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp-extern_8h.html#100bf7ef1e9abdd8f9e35beeeaca77a6">bgp_route_inpath</a> (bgp_state *state, bgp_route *r_in, tw_lp *lp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp-extern_8h.html#611a185745683484cadfa6518e1a0446">bgp_route_aspath_print</a> (bgp_state *state, bgp_route *r)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp-extern_8h.html#8c7954f03a848dbd36bdf2e0ebbb7fa4">bgp_route_free</a> (bgp_state *state, tw_memory *route, tw_lp *lp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">tw_memory *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp-extern_8h.html#9567531e9114b58a8b0a461d09dcbc8b">bgp_getroute</a> (bgp_state *state, bgp_route *find)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp-extern_8h.html#1a40f199f8cdc9503b572859ee63ba77">bgp_route_add</a> (bgp_state *state, tw_memory *b)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp-extern_8h.html#c3940d75bca1133bfd81eee76261dda2">bgp_route_withdraw</a> (bgp_state *state, bgp_route *r)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">tw_memory *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp-extern_8h.html#525d4b98ef30f04b282a1f272f7fba3a">bgp_route_new</a> (bgp_state *, tw_lp *, tw_lp *, tw_lp *)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp-extern_8h.html#5b6d4dabf1b791dd477d545cd58bf324">bgp_route_equals</a> (bgp_route *, bgp_route *)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">tw_memory *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp-extern_8h.html#5309f3f3a56a7548ef5c28bc9205f2c6">bgp_route_copy</a> (bgp_state *, bgp_route *, bgp_nbr *, bgp_update_type, tw_lp *)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp-extern_8h.html#2b77b435184207db72886c00a74dfd21">bgp_rib_print</a> (bgp_state *state, tw_lp *lp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp-extern_8h.html#14a9a4b8da17993c0c3b37f43ecd0644">bgp_route_print</a> (bgp_state *state, bgp_route *r)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp-extern_8h.html#39bc7fd789695e7d60f7d2fc8b053f1d">bgp_rt_file</a> (int *read)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp-extern_8h.html#33804f6cc2a28b68a7e0322bd298bdf4">bgp_main</a> (int argc, char **argv, char **env)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp-extern_8h.html#5d608721bb1a0a5006ff3e3b0ee610a6">bgp_md_final</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">tw_event *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp-extern_8h.html#f1b737c47cf480cc11a8714a8426d02a">bgp_timer_start</a> (tw_lp *, tw_event *, tw_stime, bgp_message_type)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp-extern_8h.html#0706d3bdabe2633440ec54e5379a2dad">bgp_init</a> (bgp_state *, tw_lp *)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp-extern_8h.html#7234acaf8c420de90f05cfdd14f90b9b">bgp_event_handler</a> (bgp_state *, tw_bf *, rn_message *, tw_lp *)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp-extern_8h.html#be38660a391e5fe149403e94cefa9150">bgp_r_event_handler</a> (bgp_state *, tw_bf *, rn_message *, tw_lp *)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp-extern_8h.html#9ea418760c3216a70a0788b65ac60201">bgp_final</a> (bgp_state *, tw_lp *)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp-extern_8h.html#191ebe1a28b02a64501a5a85081f7e22">bgp_xml</a> (bgp_state *state, const xmlNodePtr node, tw_lp *)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp-extern_8h.html#4fa53b04dce94d8076cde40e189b63a4">bgp_notify_send</a> (bgp_state *, bgp_nbr *n, tw_lp *lp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp-extern_8h.html#c147f8b7fd06df22000d2276209b20b7">bgp_notify</a> (bgp_state *state, tw_bf *bf, int src, tw_lp *lp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">bgp_nbr *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp-extern_8h.html#5ed527027df1ef2895f4a8b3642dc991">bgp_getnbr</a> (bgp_state *state, int id)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp-extern_8h.html#a1e689502a42cd1f8dc2e3e48ca2fd85">bgp_connect</a> (bgp_state *state, bgp_nbr *n, tw_lp *lp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp-extern_8h.html#9f09a0dfb45964426db4e112b31ed33d">bgp_ospf_init</a> (bgp_state *bs, bgp_route *r, tw_lp *lp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp-extern_8h.html#d5ded4c2c6117ea800399d494e17307e">bgp_ospf_flush</a> (bgp_state *, rn_as *, bgp_route *, int, tw_lp *)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp-extern_8h.html#25cf78022511c7500c4fba258fe99071">bgp_ospf_update</a> (bgp_state *, rn_as *, bgp_route *, int, tw_lp *)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp-extern_8h.html#da4aa0f47640a7070edb5cff82efef4e">bgp_mrai_tmr</a> (bgp_state *state, tw_lp *lp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp-extern_8h.html#59f8330e587f1072e4a8c3b27cac40a3">bgp_mrai_timer</a> (bgp_state *, tw_bf *, bgp_message *, tw_lp *)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp-extern_8h.html#856060ffa6068321237ce35960f8a676">bgp_update_all</a> (bgp_state *, bgp_message *, int, bgp_route *, tw_lp *)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp-extern_8h.html#496b5be995649aa5e3a0da073a317755">bgp_update_send</a> (bgp_state *, bgp_nbr *, bgp_route *, bgp_message *, int, tw_lp *)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp-extern_8h.html#c1feb49d9f7df249a5f66c813d284082">bgp_update</a> (bgp_state *, tw_bf *, bgp_message *, int, tw_lp *)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp-extern_8h.html#9d19cdedf4a4cd318ed16a83eecf2843">bgp_keepalive_tmr</a> (bgp_state *state, tw_lp *lp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp-extern_8h.html#f63d4cef317dafd93bdbd8d8558a4237">bgp_keepalive_send</a> (bgp_nbr *n, tw_lp *lp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp-extern_8h.html#73e6cce223930f12a8132dc39259b480">bgp_keepalive</a> (bgp_state *state, int, int, tw_lp *)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp-extern_8h.html#4558ddaaf24c01e0a8fad172ceb4ca98">bgp_keepalive_timer</a> (bgp_state *, tw_bf *, bgp_message *, tw_lp *)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp-extern_8h.html#08efb2d86f752aeffd7d5631960ad79e">deal_with_timed_out_routers</a> (bgp_state *state, tw_bf *bf, bgp_message *msg, tw_lp *lp)</td></tr>

<tr><td colspan="2"><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">tw_fd&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp-extern_8h.html#0c0827f912b6c5550b6dfaa922b3fdc9">g_bgp_fd</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">tw_fd&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp-extern_8h.html#7603addb7e529a1f5639178c389a5500">g_bgp_fd_rtes</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">tw_fd&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp-extern_8h.html#ae8e41b9fd5752112bd1e1f06aa00843">g_bgp_fd_asp</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">FILE *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp-extern_8h.html#f18fc4fa7c4a304602705fa8b8c0983a">g_bgp_rt_fd</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">bgp_stats&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">bgp_state *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp-extern_8h.html#c272d2ccc839a484a3bc7b4b0e3eb706">g_bgp_state</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">bgp_as *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp-extern_8h.html#5c7a53c0af93ddd5e897fe79643be44d">g_bgp_as</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp-extern_8h.html#9831e3cdf81522cd09b8691b0a8fe89f">g_bgp_init_file</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">xmlXPathObjectPtr *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp-extern_8h.html#37246d0bc0a86a0894140f428db491ed">g_bgp_ases</a></td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a1e689502a42cd1f8dc2e3e48ca2fd85"></a><!-- doxytag: member="bgp-extern.h::bgp_connect" ref="a1e689502a42cd1f8dc2e3e48ca2fd85" args="(bgp_state *state, bgp_nbr *n, tw_lp *lp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bgp_connect           </td>
          <td>(</td>
          <td class="paramtype">bgp_state *&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bgp_nbr *&nbsp;</td>
          <td class="paramname"> <em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Send a BGP CONNECT message to complete the connection established process.<p>
BGP needs CONNECT message from transport layer.. upon receiving ANY msg from another BGP router, the OPEN msg is created and sent to that neighbor. Do not use these for anything other than during the init phase. I have changed the process somewhat so that each peer on either side of a connection do not need to send the CONNECT. 
<p>Definition at line <a class="el" href="bgp-connect_8c-source.html#l00013">13</a> of file <a class="el" href="bgp-connect_8c-source.html">bgp-connect.c</a>.</p>

<p>References <a class="el" href="bgp-types_8h-source.html#l00012">BGP_CONNECT</a>, <a class="el" href="rn-types_8h-source.html#l00055">DOWNSTREAM</a>, <a class="el" href="bgp-global_8c-source.html#l00010">g_bgp_fd</a>, <a class="el" href="rn-event_8c-source.html#l00058">rn_event_new()</a>, <a class="el" href="rn-event_8c-source.html#l00173">rn_event_send()</a>, <a class="el" href="rn-link_8c-source.html#l00017">rn_getlink()</a>, and <a class="el" href="rn-routing_8c-source.html#l00007">rn_route()</a>.</p>

<p>Referenced by <a class="el" href="bgp-init_8c-source.html#l00070">bgp_init()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00014"></a>00014 {
<a name="l00015"></a>00015         tw_event        *e;
<a name="l00016"></a>00016         tw_memory       *hdr;
<a name="l00017"></a>00017         tw_stime         ts = 0.0;
<a name="l00018"></a>00018 
<a name="l00019"></a>00019         bgp_message     *m;
<a name="l00020"></a>00020 
<a name="l00021"></a>00021 <span class="preprocessor">#if 1</span>
<a name="l00022"></a>00022 <span class="preprocessor"></span>        <span class="keywordflow">if</span>(lp-&gt;id &lt; n-&gt;id)
<a name="l00023"></a>00023                 ts = 0.0;
<a name="l00024"></a>00024         <span class="keywordflow">else</span>
<a name="l00025"></a>00025                 <span class="keywordflow">return</span>;
<a name="l00026"></a>00026 <span class="preprocessor">#endif</span>
<a name="l00027"></a>00027 <span class="preprocessor"></span>
<a name="l00028"></a>00028 <span class="preprocessor">#if VERIFY_BGP</span>
<a name="l00029"></a>00029 <span class="preprocessor"></span>        printf(<span class="stringliteral">"%ld: BGP router coming online, connecting to %d: %lf \n"</span>, 
<a name="l00030"></a>00030                 lp-&gt;id, n-&gt;id, ts);
<a name="l00031"></a>00031 <span class="preprocessor">#endif</span>
<a name="l00032"></a>00032 <span class="preprocessor"></span>
<a name="l00033"></a>00033         state-&gt;stats-&gt;s_nconnects++;
<a name="l00034"></a>00034         e = <a class="code" href="rn-event_8c.html#5508bcf53c1fbeb71e6055021634a726">rn_event_new</a>(n-&gt;id, ts, lp, <a class="code" href="rn-types_8h.html#3fc738f2924cae2b2d04a9a133c3ef02193085e792a05c4538ec2bc24c845652">DOWNSTREAM</a>, <a class="code" href="bgp-types_8h.html#eb7e42361408128a97040f1b9e75b305">BGP_CONNECT</a>);
<a name="l00035"></a>00035 
<a name="l00036"></a>00036         <span class="comment">// Create the BGP message header</span>
<a name="l00037"></a>00037         hdr = tw_memory_alloc(lp, <a class="code" href="bgp-extern_8h.html#0c0827f912b6c5550b6dfaa922b3fdc9">g_bgp_fd</a>);
<a name="l00038"></a>00038         m = tw_memory_data(hdr);
<a name="l00039"></a>00039 
<a name="l00040"></a>00040         m-&gt;b.type = CONNECT;
<a name="l00041"></a>00041         m-&gt;b.cause_bgp = 1;
<a name="l00042"></a>00042         m-&gt;b.cause_ospf = 0;
<a name="l00043"></a>00043 
<a name="l00044"></a>00044         tw_event_memory_set(e, hdr, <a class="code" href="bgp-extern_8h.html#0c0827f912b6c5550b6dfaa922b3fdc9">g_bgp_fd</a>);
<a name="l00045"></a>00045         <a class="code" href="rn-event_8c.html#8c3496e774b118a7e411ea5bcd23d49a">rn_event_send</a>(e);
<a name="l00046"></a>00046 
<a name="l00047"></a>00047         <span class="keywordflow">if</span>(e == lp-&gt;pe-&gt;abort_event)
<a name="l00048"></a>00048         {
<a name="l00049"></a>00049                 state-&gt;stats-&gt;s_nconnects_dropped++;
<a name="l00050"></a>00050         } <span class="keywordflow">else</span>
<a name="l00051"></a>00051         {
<a name="l00052"></a>00052                 <span class="keywordflow">if</span>(NULL == <a class="code" href="rn-extern_8h.html#d7173e076af48912ba761e8ef0cc1b22">rn_getlink</a>(state-&gt;m, n-&gt;id))
<a name="l00053"></a>00053                         <span class="keywordflow">if</span>(-1 == <a class="code" href="rn-extern_8h.html#8890679c55545bd36e770b118a920b57">rn_route</a>(state-&gt;m, n-&gt;id))
<a name="l00054"></a>00054                                 state-&gt;stats-&gt;s_nconnects_dropped++;
<a name="l00055"></a>00055         }
<a name="l00056"></a>00056 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="ca24ca9ccbbf6efaa21b4303110d9a5a"></a><!-- doxytag: member="bgp-extern.h::bgp_decision" ref="ca24ca9ccbbf6efaa21b4303110d9a5a" args="(bgp_state *, bgp_route *r1, bgp_route *r2, tw_lp *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int bgp_decision           </td>
          <td>(</td>
          <td class="paramtype">bgp_state *&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bgp_route *&nbsp;</td>
          <td class="paramname"> <em>new</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bgp_route *&nbsp;</td>
          <td class="paramname"> <em>exist</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function models the BGP decision process.<p>
Resolve ties in the following order: <ol>
<li>
lowest local_pref (not implemented outside of XML) </li>
<li>
shortest AS PATH </li>
<li>
lowest origin, one of: <ul>
<li>
iBGP (1) </li>
<li>
eBGP (2) </li>
<li>
Incomplete (3) </li>
</ul>
</li>
<li>
lowest MED (if next_hops equal) </li>
<li>
Hot Potato Routing (lowest hop count) </li>
<li>
lowest next hop </li>
<li>
DEFAULT: Keep existing route </li>
</ol>

<p>Definition at line <a class="el" href="bgp-decision_8c-source.html#l00035">35</a> of file <a class="el" href="bgp-decision_8c-source.html">bgp-decision.c</a>.</p>

<p>References <a class="el" href="bgp-nbr_8c-source.html#l00007">bgp_getnbr()</a>, <a class="el" href="bgp-global_8c-source.html#l00024">g_bgp_as</a>, <a class="el" href="bgp-global_8c-source.html#l00025">g_bgp_state</a>, <a class="el" href="bgp-global_8c-source.html#l00023">g_bgp_stats</a>, <a class="el" href="rn-machine_8c-source.html#l00028">rn_getas()</a>, and <a class="el" href="rn-machine_8c-source.html#l00004">rn_getmachine()</a>.</p>

<p>Referenced by <a class="el" href="bgp-update_8c-source.html#l00135">update_add()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00036"></a>00036 {
<a name="l00037"></a>00037         rn_as           *new_as = <a class="code" href="rn-extern_8h.html#d3b2637627bbb86acf01b38d07495042">rn_getas</a>(<a class="code" href="rn-extern_8h.html#b586ebafc20ad652dd538635f5c816b0">rn_getmachine</a>(new-&gt;src));
<a name="l00038"></a>00038         rn_as           *exist_as = <a class="code" href="rn-extern_8h.html#d3b2637627bbb86acf01b38d07495042">rn_getas</a>(<a class="code" href="rn-extern_8h.html#b586ebafc20ad652dd538635f5c816b0">rn_getmachine</a>(exist-&gt;src));
<a name="l00039"></a>00039 
<a name="l00040"></a>00040         <span class="comment">// LOCAL PREF : lower is higher priority (better)</span>
<a name="l00041"></a>00041         <span class="comment">// was next_hop .. next_hop is AS id, not node id</span>
<a name="l00042"></a>00042         <span class="keywordflow">if</span>(<a class="code" href="bgp-extern_8h.html#c272d2ccc839a484a3bc7b4b0e3eb706">g_bgp_state</a>-&gt;b.local_pref &amp;&amp; 
<a name="l00043"></a>00043                 <a class="code" href="bgp-extern_8h.html#5c7a53c0af93ddd5e897fe79643be44d">g_bgp_as</a>[new_as-&gt;id].local_pref &lt; <a class="code" href="bgp-extern_8h.html#5c7a53c0af93ddd5e897fe79643be44d">g_bgp_as</a>[exist_as-&gt;id].local_pref)
<a name="l00044"></a>00044         {
<a name="l00045"></a>00045 <span class="preprocessor">#if VERIFY_BGP_DECISION</span>
<a name="l00046"></a>00046 <span class="preprocessor"></span>                fprintf(state-&gt;log, <span class="stringliteral">"\tdecision: local_pref (%d &gt; %d) \n"</span>,
<a name="l00047"></a>00047                         <a class="code" href="bgp-extern_8h.html#5c7a53c0af93ddd5e897fe79643be44d">g_bgp_as</a>[new_as-&gt;id].local_pref, 
<a name="l00048"></a>00048                         <a class="code" href="bgp-extern_8h.html#5c7a53c0af93ddd5e897fe79643be44d">g_bgp_as</a>[exist_as-&gt;id].local_pref);
<a name="l00049"></a>00049 <span class="preprocessor">#endif</span>
<a name="l00050"></a>00050 <span class="preprocessor"></span>                <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_ndec_local_pref++;
<a name="l00051"></a>00051                 <span class="keywordflow">return</span> TW_TRUE;
<a name="l00052"></a>00052         } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="bgp-extern_8h.html#c272d2ccc839a484a3bc7b4b0e3eb706">g_bgp_state</a>-&gt;b.local_pref &amp;&amp; 
<a name="l00053"></a>00053                   <a class="code" href="bgp-extern_8h.html#5c7a53c0af93ddd5e897fe79643be44d">g_bgp_as</a>[exist_as-&gt;id].local_pref &lt; <a class="code" href="bgp-extern_8h.html#5c7a53c0af93ddd5e897fe79643be44d">g_bgp_as</a>[new_as-&gt;id].local_pref)
<a name="l00054"></a>00054         {
<a name="l00055"></a>00055 <span class="preprocessor">#if VERIFY_BGP_DECISION</span>
<a name="l00056"></a>00056 <span class="preprocessor"></span>                fprintf(state-&gt;log, <span class="stringliteral">"\tdecision: local_pref (%d &lt; %d) \n"</span>,
<a name="l00057"></a>00057                         <a class="code" href="bgp-extern_8h.html#5c7a53c0af93ddd5e897fe79643be44d">g_bgp_as</a>[new_as-&gt;id].local_pref, 
<a name="l00058"></a>00058                         <a class="code" href="bgp-extern_8h.html#5c7a53c0af93ddd5e897fe79643be44d">g_bgp_as</a>[exist_as-&gt;id].local_pref);
<a name="l00059"></a>00059 <span class="preprocessor">#endif</span>
<a name="l00060"></a>00060 <span class="preprocessor"></span>                <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_ndec_local_pref++;
<a name="l00061"></a>00061                 <span class="keywordflow">return</span> TW_FALSE;
<a name="l00062"></a>00062         }
<a name="l00063"></a>00063 
<a name="l00064"></a>00064         <span class="comment">// shortest AS path</span>
<a name="l00065"></a>00065         <span class="keywordflow">if</span>(<a class="code" href="bgp-extern_8h.html#c272d2ccc839a484a3bc7b4b0e3eb706">g_bgp_state</a>-&gt;b.as_path &amp;&amp; new-&gt;as_path.size &lt; exist-&gt;as_path.size)
<a name="l00066"></a>00066         {
<a name="l00067"></a>00067 <span class="preprocessor">#if VERIFY_BGP_DECISION</span>
<a name="l00068"></a>00068 <span class="preprocessor"></span>                fprintf(state-&gt;log, <span class="stringliteral">"\tdecision: as path (%d &lt; %d)\n"</span>,
<a name="l00069"></a>00069                         new-&gt;as_path.size, exist-&gt;as_path.size);
<a name="l00070"></a>00070 <span class="preprocessor">#endif</span>
<a name="l00071"></a>00071 <span class="preprocessor"></span>                <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_ndec_aspath++;
<a name="l00072"></a>00072                 <span class="keywordflow">return</span> TW_TRUE;
<a name="l00073"></a>00073         } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="bgp-extern_8h.html#c272d2ccc839a484a3bc7b4b0e3eb706">g_bgp_state</a>-&gt;b.as_path &amp;&amp; new-&gt;as_path.size &gt; exist-&gt;as_path.size)
<a name="l00074"></a>00074         {
<a name="l00075"></a>00075 <span class="preprocessor">#if VERIFY_BGP_DECISION</span>
<a name="l00076"></a>00076 <span class="preprocessor"></span>                fprintf(state-&gt;log, <span class="stringliteral">"\tdecision: as path (%d &gt; %d)\n"</span>,
<a name="l00077"></a>00077                         new-&gt;as_path.size, exist-&gt;as_path.size);
<a name="l00078"></a>00078 <span class="preprocessor">#endif</span>
<a name="l00079"></a>00079 <span class="preprocessor"></span>                <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_ndec_aspath++;
<a name="l00080"></a>00080                 <span class="keywordflow">return</span> TW_FALSE;
<a name="l00081"></a>00081         }
<a name="l00082"></a>00082 
<a name="l00083"></a>00083         <span class="comment">// ORIGIN code pref: 1 IGP 2 EGP 3 Incomplete</span>
<a name="l00084"></a>00084         <span class="keywordflow">if</span>(<a class="code" href="bgp-extern_8h.html#c272d2ccc839a484a3bc7b4b0e3eb706">g_bgp_state</a>-&gt;b.origin &amp;&amp; new-&gt;origin &gt; exist-&gt;origin)
<a name="l00085"></a>00085         {
<a name="l00086"></a>00086 <span class="preprocessor">#if VERIFY_BGP_DECISION</span>
<a name="l00087"></a>00087 <span class="preprocessor"></span>                fprintf(state-&gt;log, <span class="stringliteral">"\tdecision: origin (%d &gt; %d)\n"</span>,
<a name="l00088"></a>00088                         new-&gt;origin, exist-&gt;origin);
<a name="l00089"></a>00089 <span class="preprocessor">#endif</span>
<a name="l00090"></a>00090 <span class="preprocessor"></span>                <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_ndec_origin++;
<a name="l00091"></a>00091                 <span class="keywordflow">return</span> TW_TRUE;
<a name="l00092"></a>00092         } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="bgp-extern_8h.html#c272d2ccc839a484a3bc7b4b0e3eb706">g_bgp_state</a>-&gt;b.origin &amp;&amp; new-&gt;origin &lt; exist-&gt;origin)
<a name="l00093"></a>00093         {
<a name="l00094"></a>00094 <span class="preprocessor">#if VERIFY_BGP_DECISION</span>
<a name="l00095"></a>00095 <span class="preprocessor"></span>                fprintf(state-&gt;log, <span class="stringliteral">"\tdecision: origin (%d &lt; %d)\n"</span>,
<a name="l00096"></a>00096                         new-&gt;origin, exist-&gt;origin);
<a name="l00097"></a>00097 <span class="preprocessor">#endif</span>
<a name="l00098"></a>00098 <span class="preprocessor"></span>                <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_ndec_origin++;
<a name="l00099"></a>00099                 <span class="keywordflow">return</span> TW_FALSE;
<a name="l00100"></a>00100         }
<a name="l00101"></a>00101 
<a name="l00102"></a>00102         <span class="comment">//bgp_route_print(state, new);</span>
<a name="l00103"></a>00103         <span class="comment">//bgp_route_print(state, exist);</span>
<a name="l00104"></a>00104 
<a name="l00105"></a>00105         <span class="comment">// lowest med preferred, next_hop must be equal</span>
<a name="l00106"></a>00106         <span class="keywordflow">if</span>(<a class="code" href="bgp-extern_8h.html#c272d2ccc839a484a3bc7b4b0e3eb706">g_bgp_state</a>-&gt;b.med &amp;&amp; new-&gt;next_hop == exist-&gt;next_hop)
<a name="l00107"></a>00107         {
<a name="l00108"></a>00108                 <span class="keywordflow">if</span>(new-&gt;med &lt; exist-&gt;med)
<a name="l00109"></a>00109                 {
<a name="l00110"></a>00110 <span class="preprocessor">#if VERIFY_BGP_DECISION</span>
<a name="l00111"></a>00111 <span class="preprocessor"></span>                        fprintf(state-&gt;log, <span class="stringliteral">"\tdecision: MED (%d &lt; %d)\n"</span>, 
<a name="l00112"></a>00112                                 new-&gt;med, exist-&gt;med);
<a name="l00113"></a>00113 <span class="preprocessor">#endif</span>
<a name="l00114"></a>00114 <span class="preprocessor"></span>                        <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_ndec_med++;
<a name="l00115"></a>00115                         <span class="keywordflow">return</span> TW_TRUE;
<a name="l00116"></a>00116                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(new-&gt;med &gt; exist-&gt;med)
<a name="l00117"></a>00117                 {
<a name="l00118"></a>00118 <span class="preprocessor">#if VERIFY_BGP_DECISION</span>
<a name="l00119"></a>00119 <span class="preprocessor"></span>                        fprintf(state-&gt;log, <span class="stringliteral">"\tdecision: MED (%d &gt; %d)\n"</span>, 
<a name="l00120"></a>00120                                 new-&gt;med, exist-&gt;med);
<a name="l00121"></a>00121 <span class="preprocessor">#endif</span>
<a name="l00122"></a>00122 <span class="preprocessor"></span>                        <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_ndec_med++;
<a name="l00123"></a>00123                         <span class="keywordflow">return</span> TW_FALSE;
<a name="l00124"></a>00124                 }
<a name="l00125"></a>00125         }
<a name="l00126"></a>00126 
<a name="l00127"></a>00127         <span class="keywordflow">if</span>(<a class="code" href="bgp-extern_8h.html#c272d2ccc839a484a3bc7b4b0e3eb706">g_bgp_state</a>-&gt;b.hot_potato)
<a name="l00128"></a>00128         {
<a name="l00129"></a>00129                 bgp_nbr *exist_n = <a class="code" href="bgp-extern_8h.html#5ed527027df1ef2895f4a8b3642dc991">bgp_getnbr</a>(state, exist-&gt;src);
<a name="l00130"></a>00130                 bgp_nbr *new_n = <a class="code" href="bgp-extern_8h.html#5ed527027df1ef2895f4a8b3642dc991">bgp_getnbr</a>(state, new-&gt;src);
<a name="l00131"></a>00131 
<a name="l00132"></a>00132                 <span class="keywordflow">if</span>(exist_n-&gt;hop_count &lt; new_n-&gt;hop_count)
<a name="l00133"></a>00133                 {
<a name="l00134"></a>00134                         <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_ndec_hot_potato++;
<a name="l00135"></a>00135                         <span class="keywordflow">return</span> TW_FALSE;
<a name="l00136"></a>00136                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(new_n-&gt;hop_count &lt; exist_n-&gt;hop_count)
<a name="l00137"></a>00137                 {
<a name="l00138"></a>00138 <span class="comment">/*</span>
<a name="l00139"></a>00139 <span class="comment">                        fprintf(state-&gt;log, "\tdecision: hot-potato (%d &lt; %d) \n",</span>
<a name="l00140"></a>00140 <span class="comment">                                new_n-&gt;hop_count, exist_n-&gt;hop_count);</span>
<a name="l00141"></a>00141 <span class="comment">*/</span>
<a name="l00142"></a>00142                         <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_ndec_hot_potato++;
<a name="l00143"></a>00143                         <span class="keywordflow">return</span> TW_TRUE;
<a name="l00144"></a>00144                 }
<a name="l00145"></a>00145         }
<a name="l00146"></a>00146 
<a name="l00147"></a>00147         <span class="comment">// Always take lowest next_hop</span>
<a name="l00148"></a>00148         <span class="keywordflow">if</span>(<a class="code" href="bgp-extern_8h.html#c272d2ccc839a484a3bc7b4b0e3eb706">g_bgp_state</a>-&gt;b.next_hop &amp;&amp; new-&gt;next_hop &lt; exist-&gt;next_hop)
<a name="l00149"></a>00149         {
<a name="l00150"></a>00150 <span class="preprocessor">#if VERIFY_BGP_DECISION</span>
<a name="l00151"></a>00151 <span class="preprocessor"></span>                fprintf(state-&gt;log, <span class="stringliteral">"\tdecision: next hop (%d &lt; %d)\n"</span>,
<a name="l00152"></a>00152                         new-&gt;next_hop, exist-&gt;next_hop);
<a name="l00153"></a>00153 <span class="preprocessor">#endif</span>
<a name="l00154"></a>00154 <span class="preprocessor"></span>                <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_ndec_next_hop++;
<a name="l00155"></a>00155                 <span class="keywordflow">return</span> TW_TRUE;
<a name="l00156"></a>00156         }
<a name="l00157"></a>00157 
<a name="l00158"></a>00158         <span class="keywordflow">if</span>(<a class="code" href="bgp-extern_8h.html#c272d2ccc839a484a3bc7b4b0e3eb706">g_bgp_state</a>-&gt;b.existing)
<a name="l00159"></a>00159         {
<a name="l00160"></a>00160 <span class="preprocessor">#if VERIFY_BGP_DECISION</span>
<a name="l00161"></a>00161 <span class="preprocessor"></span>                fprintf(state-&gt;log, <span class="stringliteral">"\tdecision: default, keep existing route! \n"</span>);
<a name="l00162"></a>00162 <span class="preprocessor">#endif</span>
<a name="l00163"></a>00163 <span class="preprocessor"></span>                <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_ndec_existing++;
<a name="l00164"></a>00164                 <span class="keywordflow">return</span> TW_FALSE;
<a name="l00165"></a>00165         } <span class="keywordflow">else</span>
<a name="l00166"></a>00166         {
<a name="l00167"></a>00167 <span class="preprocessor">#if VERIFY_BGP_DECISION</span>
<a name="l00168"></a>00168 <span class="preprocessor"></span>                fprintf(state-&gt;log, <span class="stringliteral">"\tdecision: default, install new route! \n"</span>);
<a name="l00169"></a>00169 <span class="preprocessor">#endif</span>
<a name="l00170"></a>00170 <span class="preprocessor"></span>                <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_ndec_existing++;
<a name="l00171"></a>00171                 <span class="keywordflow">return</span> TW_TRUE;
<a name="l00172"></a>00172         }
<a name="l00173"></a>00173 
<a name="l00174"></a>00174         <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_ndec_default++;
<a name="l00175"></a>00175         <span class="keywordflow">return</span> TW_FALSE;
<a name="l00176"></a>00176 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="7234acaf8c420de90f05cfdd14f90b9b"></a><!-- doxytag: member="bgp-extern.h::bgp_event_handler" ref="7234acaf8c420de90f05cfdd14f90b9b" args="(bgp_state *, tw_bf *, rn_message *, tw_lp *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bgp_event_handler           </td>
          <td>(</td>
          <td class="paramtype">bgp_state *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_bf *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">rn_message *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="bgp-router_8c-source.html#l00004">4</a> of file <a class="el" href="bgp-router_8c-source.html">bgp-router.c</a>.</p>

<p>References <a class="el" href="bgp-keepalive_8c-source.html#l00042">bgp_keepalive()</a>, <a class="el" href="bgp-keepalive_8c-source.html#l00113">bgp_keepalive_timer()</a>, <a class="el" href="bgp-mrai_8c-source.html#l00020">bgp_mrai_timer()</a>, <a class="el" href="bgp-notify_8c-source.html#l00029">bgp_notify()</a>, <a class="el" href="bgp-open_8c-source.html#l00048">bgp_open()</a>, <a class="el" href="bgp-update_8c-source.html#l00081">bgp_update()</a>, <a class="el" href="bgp-keepalive_8c-source.html#l00156">deal_with_timed_out_routers()</a>, <a class="el" href="bgp-global_8c-source.html#l00010">g_bgp_fd</a>, and <a class="el" href="rn-global_8c-source.html#l00004">g_rn_converge_ospf</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00005"></a>00005 {
<a name="l00006"></a>00006         tw_memory      *hdr;
<a name="l00007"></a>00007 
<a name="l00008"></a>00008         bgp_message    *msg;
<a name="l00009"></a>00009 
<a name="l00010"></a>00010         *(<span class="keywordtype">int</span> *) bf = 0;
<a name="l00011"></a>00011 
<a name="l00012"></a>00012         <span class="comment">// reset that neighbors timer</span>
<a name="l00013"></a>00013         hdr = tw_event_memory_get(lp);
<a name="l00014"></a>00014         msg = tw_memory_data(hdr);
<a name="l00015"></a>00015 
<a name="l00016"></a>00016         <span class="keywordflow">if</span>(<a class="code" href="rn-extern_8h.html#1f8c72ceadd5707b682dc77968ffd6d5">g_rn_converge_ospf</a>)
<a name="l00017"></a>00017                 tw_error(TW_LOC, <span class="stringliteral">"Should not be in BGP!"</span>);
<a name="l00018"></a>00018 
<a name="l00019"></a>00019         <span class="keywordflow">if</span>(rn_msg-&gt;port != 169)
<a name="l00020"></a>00020                 tw_error(TW_LOC, <span class="stringliteral">"recv non-bgp message!"</span>);
<a name="l00021"></a>00021 
<a name="l00022"></a>00022         <span class="comment">// 'cause it would be a timer..</span>
<a name="l00023"></a>00023         <span class="keywordflow">if</span> (rn_msg-&gt;src != lp-&gt;id)
<a name="l00024"></a>00024                 <a class="code" href="bgp-extern_8h.html#73e6cce223930f12a8132dc39259b480">bgp_keepalive</a>(state, rn_msg-&gt;src, (<span class="keywordtype">int</span>) rn_msg-&gt;ttl, lp);
<a name="l00025"></a>00025 
<a name="l00026"></a>00026         <span class="keywordflow">switch</span> (msg-&gt;b.type)
<a name="l00027"></a>00027         {
<a name="l00028"></a>00028                 <span class="keywordflow">case</span> CONNECT:
<a name="l00029"></a>00029 <span class="preprocessor">#if VERIFY_BGP</span>
<a name="l00030"></a>00030 <span class="preprocessor"></span>                        fprintf(state-&gt;log, <span class="stringliteral">"\n%ld BGP: CONNECT from %ld at %lf\n"</span>,
<a name="l00031"></a>00031                                 lp-&gt;id, rn_msg-&gt;src, tw_now(lp));
<a name="l00032"></a>00032 <span class="preprocessor">#endif</span>
<a name="l00033"></a>00033 <span class="preprocessor"></span>                        <span class="keywordflow">break</span>;
<a name="l00034"></a>00034                 <span class="keywordflow">case</span> OPEN:
<a name="l00035"></a>00035 <span class="preprocessor">#if VERIFY_BGP</span>
<a name="l00036"></a>00036 <span class="preprocessor"></span>                        fprintf(state-&gt;log, <span class="stringliteral">"\n%ld BGP: OPEN from %ld at %lf\n"</span>,
<a name="l00037"></a>00037                                 lp-&gt;id, rn_msg-&gt;src, tw_now(lp));
<a name="l00038"></a>00038 <span class="preprocessor">#endif</span>
<a name="l00039"></a>00039 <span class="preprocessor"></span>                        <a class="code" href="bgp-extern_8h.html#037961ede688c23e798d7f8c0e995001">bgp_open</a>(state, bf, msg, rn_msg-&gt;src, lp);
<a name="l00040"></a>00040 
<a name="l00041"></a>00041                         state-&gt;stats-&gt;s_cause_ospf += msg-&gt;b.cause_ospf;
<a name="l00042"></a>00042                         state-&gt;stats-&gt;s_cause_bgp += msg-&gt;b.cause_bgp;
<a name="l00043"></a>00043                         <span class="keywordflow">break</span>;
<a name="l00044"></a>00044                 <span class="keywordflow">case</span> UPDATE:
<a name="l00045"></a>00045 <span class="preprocessor">#if VERIFY_BGP</span>
<a name="l00046"></a>00046 <span class="preprocessor"></span>                        fprintf(state-&gt;log, <span class="stringliteral">"\n%ld BGP: UPDATE from %ld at %lf\n"</span>,
<a name="l00047"></a>00047                                 lp-&gt;id, rn_msg-&gt;src, tw_now(lp));
<a name="l00048"></a>00048 <span class="preprocessor">#endif</span>
<a name="l00049"></a>00049 <span class="preprocessor"></span>                        <a class="code" href="bgp-extern_8h.html#c1feb49d9f7df249a5f66c813d284082">bgp_update</a>(state, bf, msg, rn_msg-&gt;src, lp);
<a name="l00050"></a>00050                         state-&gt;stats-&gt;s_nupdates_recv++;
<a name="l00051"></a>00051                         <span class="keywordflow">break</span>;
<a name="l00052"></a>00052                 <span class="keywordflow">case</span> NOTIFICATION:
<a name="l00053"></a>00053 <span class="preprocessor">#if VERIFY_BGP</span>
<a name="l00054"></a>00054 <span class="preprocessor"></span>                        fprintf(state-&gt;log, <span class="stringliteral">"\n%ld BGP: NOTIFY from %ld at %lf\n"</span>,
<a name="l00055"></a>00055                                 lp-&gt;id, rn_msg-&gt;src, tw_now(lp));
<a name="l00056"></a>00056 <span class="preprocessor">#endif</span>
<a name="l00057"></a>00057 <span class="preprocessor"></span>                        <a class="code" href="bgp-extern_8h.html#c147f8b7fd06df22000d2276209b20b7">bgp_notify</a>(state, bf, rn_msg-&gt;src, lp);
<a name="l00058"></a>00058                         state-&gt;stats-&gt;s_nnotify_recv++;
<a name="l00059"></a>00059                         <span class="keywordflow">break</span>;
<a name="l00060"></a>00060                 <span class="keywordflow">case</span> KEEPALIVE:
<a name="l00061"></a>00061 <span class="preprocessor">#if VERIFY_BGP_KEEPALIVE</span>
<a name="l00062"></a>00062 <span class="preprocessor"></span>                        fprintf(state-&gt;log, <span class="stringliteral">"\n%ld BGP: KEEPALIVE from %ld at %lf\n"</span>,
<a name="l00063"></a>00063                                 lp-&gt;id, rn_msg-&gt;src, tw_now(lp));
<a name="l00064"></a>00064 <span class="preprocessor">#endif</span>
<a name="l00065"></a>00065 <span class="preprocessor"></span>                        state-&gt;stats-&gt;s_nkeepalives++;
<a name="l00066"></a>00066                         <span class="keywordflow">break</span>;
<a name="l00067"></a>00067                 <span class="keywordflow">case</span> KEEPALIVETIMER:
<a name="l00068"></a>00068 <span class="preprocessor">#if VERIFY_BGP_KEEPALIVE</span>
<a name="l00069"></a>00069 <span class="preprocessor"></span>                        fprintf(state-&gt;log, <span class="stringliteral">"\n%ld BGP: KEEPALIVE_TIMER at %lf\n"</span>,
<a name="l00070"></a>00070                                 lp-&gt;id, tw_now(lp));
<a name="l00071"></a>00071 <span class="preprocessor">#endif</span>
<a name="l00072"></a>00072 <span class="preprocessor"></span>                        <a class="code" href="bgp-extern_8h.html#4558ddaaf24c01e0a8fad172ceb4ca98">bgp_keepalive_timer</a>(state, bf, msg, lp);
<a name="l00073"></a>00073                         <a class="code" href="bgp-extern_8h.html#08efb2d86f752aeffd7d5631960ad79e">deal_with_timed_out_routers</a>(state, bf, msg, lp);
<a name="l00074"></a>00074                         <span class="keywordflow">break</span>;
<a name="l00075"></a>00075                 <span class="keywordflow">case</span> MRAITIMER:
<a name="l00076"></a>00076 <span class="preprocessor">#if VERIFY_BGP</span>
<a name="l00077"></a>00077 <span class="preprocessor"></span>                        fprintf(state-&gt;log, <span class="stringliteral">"\n%ld: BGP: MRAI_TIMER at %lf \n"</span>,
<a name="l00078"></a>00078                                 lp-&gt;id, tw_now(lp));
<a name="l00079"></a>00079 <span class="preprocessor">#endif</span>
<a name="l00080"></a>00080 <span class="preprocessor"></span>                        state-&gt;stats-&gt;s_nmrai_timers++;
<a name="l00081"></a>00081                         <a class="code" href="bgp-extern_8h.html#59f8330e587f1072e4a8c3b27cac40a3">bgp_mrai_timer</a>(state, bf, msg, lp);
<a name="l00082"></a>00082                         <span class="keywordflow">break</span>;
<a name="l00083"></a>00083                 <span class="keywordflow">default</span>:
<a name="l00084"></a>00084                         tw_error(TW_LOC, <span class="stringliteral">"Unhandled BGP event type!"</span>);
<a name="l00085"></a>00085         }
<a name="l00086"></a>00086 
<a name="l00087"></a>00087         tw_memory_free(lp, hdr, <a class="code" href="bgp-extern_8h.html#0c0827f912b6c5550b6dfaa922b3fdc9">g_bgp_fd</a>);
<a name="l00088"></a>00088 
<a name="l00089"></a>00089         <span class="keywordflow">if</span>(NULL != lp-&gt;pe-&gt;cur_event-&gt;memory)
<a name="l00090"></a>00090                 tw_error(TW_LOC, <span class="stringliteral">"memory buffers remain on event! \n"</span>);
<a name="l00091"></a>00091 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="9ea418760c3216a70a0788b65ac60201"></a><!-- doxytag: member="bgp-extern.h::bgp_final" ref="9ea418760c3216a70a0788b65ac60201" args="(bgp_state *, tw_lp *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bgp_final           </td>
          <td>(</td>
          <td class="paramtype">bgp_state *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="bgp-stats_8c-source.html#l00004">4</a> of file <a class="el" href="bgp-stats_8c-source.html">bgp-stats.c</a>.</p>

<p>References <a class="el" href="bgp-route_8c-source.html#l00360">bgp_rib_print()</a>, <a class="el" href="bgp-route_8c-source.html#l00350">bgp_route_print()</a>, <a class="el" href="bgp-global_8c-source.html#l00032">g_bgp_rt_fd</a>, <a class="el" href="bgp-global_8c-source.html#l00023">g_bgp_stats</a>, <a class="el" href="rn-global_8c-source.html#l00004">g_rn_converge_ospf</a>, <a class="el" href="rn-global_8c-source.html#l00085">g_rn_logs_dir</a>, <a class="el" href="rn-global_8c-source.html#l00043">g_rn_nas</a>, <a class="el" href="rn-machine_8c-source.html#l00028">rn_getas()</a>, and <a class="el" href="rn-machine_8c-source.html#l00004">rn_getmachine()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00005"></a>00005 {
<a name="l00006"></a>00006 <span class="preprocessor">#ifndef BGP_CONVERGED</span>
<a name="l00007"></a>00007 <span class="preprocessor"></span>        bgp_route       *r;
<a name="l00008"></a>00008 
<a name="l00009"></a>00009 <span class="preprocessor">#endif</span>
<a name="l00010"></a>00010 <span class="preprocessor"></span>        <span class="keywordtype">int</span>              i;
<a name="l00011"></a>00011 
<a name="l00012"></a>00012         <a class="code" href="bgp-extern_8h.html#2b77b435184207db72886c00a74dfd21">bgp_rib_print</a>(state, lp);
<a name="l00013"></a>00013         
<a name="l00014"></a>00014         <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_nroute_adds += state-&gt;stats-&gt;s_nroute_adds;
<a name="l00015"></a>00015         <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_nroute_removes += state-&gt;stats-&gt;s_nroute_removes;
<a name="l00016"></a>00016 
<a name="l00017"></a>00017         <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_nupdates_sent += state-&gt;stats-&gt;s_nupdates_sent;
<a name="l00018"></a>00018         <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_nupdates_recv+= state-&gt;stats-&gt;s_nupdates_recv;
<a name="l00019"></a>00019 
<a name="l00020"></a>00020         <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_nnotify_sent += state-&gt;stats-&gt;s_nnotify_sent;
<a name="l00021"></a>00021         <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_nnotify_recv += state-&gt;stats-&gt;s_nnotify_recv;
<a name="l00022"></a>00022 
<a name="l00023"></a>00023         <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_nopens += state-&gt;stats-&gt;s_nopens;
<a name="l00024"></a>00024         <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.d_opens += state-&gt;stats-&gt;d_opens;
<a name="l00025"></a>00025 
<a name="l00026"></a>00026         <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_nunreachable += state-&gt;stats-&gt;s_nunreachable;
<a name="l00027"></a>00027         <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_nkeepalives += state-&gt;stats-&gt;s_nkeepalives;
<a name="l00028"></a>00028         <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_nkeepalivetimers += state-&gt;stats-&gt;s_nkeepalivetimers;
<a name="l00029"></a>00029         <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_nmrai_timers += state-&gt;stats-&gt;s_nmrai_timers;
<a name="l00030"></a>00030 
<a name="l00031"></a>00031         <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_nconnects += state-&gt;stats-&gt;s_nconnects;
<a name="l00032"></a>00032         <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_nconnects_dropped += state-&gt;stats-&gt;s_nconnects_dropped;
<a name="l00033"></a>00033         <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_nconnects_dropped += state-&gt;stats-&gt;s_nconnects_dropped;
<a name="l00034"></a>00034 
<a name="l00035"></a>00035         <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_cause_bgp += state-&gt;stats-&gt;s_cause_bgp;
<a name="l00036"></a>00036         <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_cause_ospf += state-&gt;stats-&gt;s_cause_ospf;
<a name="l00037"></a>00037 
<a name="l00038"></a>00038         <span class="keywordflow">for</span>(i = 0; i &lt; state-&gt;n_interfaces; i++)
<a name="l00039"></a>00039         {
<a name="l00040"></a>00040                 <span class="keywordflow">if</span>(state-&gt;nbr[i].up == TW_FALSE)
<a name="l00041"></a>00041                 {
<a name="l00042"></a>00042                         <span class="keywordflow">if</span>(<a class="code" href="rn-extern_8h.html#d3b2637627bbb86acf01b38d07495042">rn_getas</a>(<a class="code" href="rn-extern_8h.html#b586ebafc20ad652dd538635f5c816b0">rn_getmachine</a>(state-&gt;nbr[i].id)) == state-&gt;as)
<a name="l00043"></a>00043                                 <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_nibgp_nbrs++;
<a name="l00044"></a>00044                         <span class="keywordflow">else</span>
<a name="l00045"></a>00045                                 <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_nebgp_nbrs++;
<a name="l00046"></a>00046                 } <span class="keywordflow">else</span>
<a name="l00047"></a>00047                 {
<a name="l00048"></a>00048                         <span class="keywordflow">if</span>(<a class="code" href="rn-extern_8h.html#d3b2637627bbb86acf01b38d07495042">rn_getas</a>(<a class="code" href="rn-extern_8h.html#b586ebafc20ad652dd538635f5c816b0">rn_getmachine</a>(state-&gt;nbr[i].id)) == state-&gt;as)
<a name="l00049"></a>00049                                 <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_nibgp_nbrs_up++;
<a name="l00050"></a>00050                         <span class="keywordflow">else</span>
<a name="l00051"></a>00051                                 <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_nebgp_nbrs_up++;
<a name="l00052"></a>00052                 }
<a name="l00053"></a>00053         }
<a name="l00054"></a>00054 
<a name="l00055"></a>00055 <span class="preprocessor">#if VERIFY_BGP</span>
<a name="l00056"></a>00056 <span class="preprocessor"></span>        <span class="keywordflow">if</span>(stdout != state-&gt;log)
<a name="l00057"></a>00057                 fclose(state-&gt;log);
<a name="l00058"></a>00058 <span class="preprocessor">#endif</span>
<a name="l00059"></a>00059 <span class="preprocessor"></span>
<a name="l00060"></a>00060 <span class="preprocessor">#ifndef BGP_CONVERGED</span>
<a name="l00061"></a>00061 <span class="preprocessor"></span>
<a name="l00062"></a>00062         <span class="keywordflow">if</span>(<a class="code" href="rn-extern_8h.html#1f8c72ceadd5707b682dc77968ffd6d5">g_rn_converge_ospf</a>)
<a name="l00063"></a>00063                 <span class="keywordflow">return</span>;
<a name="l00064"></a>00064 
<a name="l00065"></a>00065         <span class="keywordflow">if</span>(!<a class="code" href="bgp-extern_8h.html#f18fc4fa7c4a304602705fa8b8c0983a">g_bgp_rt_fd</a>)
<a name="l00066"></a>00066         {
<a name="l00067"></a>00067                 <span class="keywordtype">char</span> file[255];
<a name="l00068"></a>00068 
<a name="l00069"></a>00069                 sprintf(file, <span class="stringliteral">"%s/bgp-route.file"</span>, <a class="code" href="rn-extern_8h.html#a46f0adf0f6be6d672defc691800ce69">g_rn_logs_dir</a>);
<a name="l00070"></a>00070                 <a class="code" href="bgp-extern_8h.html#f18fc4fa7c4a304602705fa8b8c0983a">g_bgp_rt_fd</a> = fopen(file, <span class="stringliteral">"w"</span>);
<a name="l00071"></a>00071 
<a name="l00072"></a>00072                 <span class="keywordflow">if</span>(!<a class="code" href="bgp-extern_8h.html#f18fc4fa7c4a304602705fa8b8c0983a">g_bgp_rt_fd</a>)
<a name="l00073"></a>00073                         tw_error(TW_LOC, <span class="stringliteral">"Unable to open: %s"</span>, file);
<a name="l00074"></a>00074                 <span class="keywordflow">else</span>
<a name="l00075"></a>00075                         printf(<span class="stringliteral">"%lld: opening %s\n"</span>, lp-&gt;id, file);
<a name="l00076"></a>00076         }
<a name="l00077"></a>00077 
<a name="l00078"></a>00078         state-&gt;log = <a class="code" href="bgp-extern_8h.html#f18fc4fa7c4a304602705fa8b8c0983a">g_bgp_rt_fd</a>;
<a name="l00079"></a>00079         <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="rn-extern_8h.html#353089f1049e9e0d5160683103c17e62">g_rn_nas</a>; i++)
<a name="l00080"></a>00080         {
<a name="l00081"></a>00081                 <span class="keywordflow">if</span>(state-&gt;rib[i] == NULL)
<a name="l00082"></a>00082                 {
<a name="l00083"></a>00083                         fprintf(state-&gt;log, <span class="stringliteral">"-1 \n"</span>);
<a name="l00084"></a>00084                 } <span class="keywordflow">else</span>
<a name="l00085"></a>00085                 {
<a name="l00086"></a>00086                         r = tw_memory_data(state-&gt;rib[i]);
<a name="l00087"></a>00087 
<a name="l00088"></a>00088                         <a class="code" href="bgp-extern_8h.html#14a9a4b8da17993c0c3b37f43ecd0644">bgp_route_print</a>(state, r);
<a name="l00089"></a>00089                 }
<a name="l00090"></a>00090         }
<a name="l00091"></a>00091 <span class="preprocessor">#endif</span>
<a name="l00092"></a>00092 <span class="preprocessor"></span>}
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="5ed527027df1ef2895f4a8b3642dc991"></a><!-- doxytag: member="bgp-extern.h::bgp_getnbr" ref="5ed527027df1ef2895f4a8b3642dc991" args="(bgp_state *state, int id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bgp_nbr* bgp_getnbr           </td>
          <td>(</td>
          <td class="paramtype">bgp_state *&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>id</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function returns the PEER associated with id 
<p>Definition at line <a class="el" href="bgp-nbr_8c-source.html#l00007">7</a> of file <a class="el" href="bgp-nbr_8c-source.html">bgp-nbr.c</a>.</p>

<p>Referenced by <a class="el" href="bgp-decision_8c-source.html#l00035">bgp_decision()</a>, <a class="el" href="bgp-keepalive_8c-source.html#l00042">bgp_keepalive()</a>, <a class="el" href="bgp-notify_8c-source.html#l00029">bgp_notify()</a>, <a class="el" href="bgp-open_8c-source.html#l00048">bgp_open()</a>, <a class="el" href="bgp-rc-router_8c-source.html#l00179">bgp_r_event_handler()</a>, <a class="el" href="bgp-update_8c-source.html#l00081">bgp_update()</a>, and <a class="el" href="bgp-rc-router_8c-source.html#l00115">r_msg_notification()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00008"></a>00008 {
<a name="l00009"></a>00009         bgp_nbr         *n;
<a name="l00010"></a>00010         <span class="keywordtype">int</span>              i;
<a name="l00011"></a>00011 
<a name="l00012"></a>00012         <span class="keywordflow">for</span>(i = 0; i &lt; state-&gt;n_interfaces; i++)
<a name="l00013"></a>00013         {
<a name="l00014"></a>00014                 n = &amp;state-&gt;nbr[i];
<a name="l00015"></a>00015 
<a name="l00016"></a>00016                 <span class="keywordflow">if</span> (n-&gt;id == <span class="keywordtype">id</span>)
<a name="l00017"></a>00017                         <span class="keywordflow">return</span> n;
<a name="l00018"></a>00018         }
<a name="l00019"></a>00019 
<a name="l00020"></a>00020         <span class="comment">//tw_error(TW_LOC, "Unable to find nbr: %d \n", id);</span>
<a name="l00021"></a>00021         <span class="keywordflow">return</span> NULL;
<a name="l00022"></a>00022 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="9567531e9114b58a8b0a461d09dcbc8b"></a><!-- doxytag: member="bgp-extern.h::bgp_getroute" ref="9567531e9114b58a8b0a461d09dcbc8b" args="(bgp_state *state, bgp_route *find)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tw_memory* bgp_getroute           </td>
          <td>(</td>
          <td class="paramtype">bgp_state *&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bgp_route *&nbsp;</td>
          <td class="paramname"> <em>find</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="bgp-route_8c-source.html#l00043">43</a> of file <a class="el" href="bgp-route_8c-source.html">bgp-route.c</a>.</p>

<p>Referenced by <a class="el" href="bgp-update_8c-source.html#l00135">update_add()</a>, and <a class="el" href="bgp-update_8c-source.html#l00229">update_withdraw()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00044"></a>00044 {
<a name="l00045"></a>00045         <span class="keywordflow">if</span>(NULL != state-&gt;rib[find-&gt;dst])
<a name="l00046"></a>00046                 <span class="keywordflow">return</span> state-&gt;rib[find-&gt;dst];
<a name="l00047"></a>00047 
<a name="l00048"></a>00048         <span class="keywordflow">return</span> NULL;
<a name="l00049"></a>00049 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="0706d3bdabe2633440ec54e5379a2dad"></a><!-- doxytag: member="bgp-extern.h::bgp_init" ref="0706d3bdabe2633440ec54e5379a2dad" args="(bgp_state *, tw_lp *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bgp_init           </td>
          <td>(</td>
          <td class="paramtype">bgp_state *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="bgp-init_8c-source.html#l00070">70</a> of file <a class="el" href="bgp-init_8c-source.html">bgp-init.c</a>.</p>

<p>References <a class="el" href="bgp-connect_8c-source.html#l00013">bgp_connect()</a>, <a class="el" href="bgp-keepalive_8c-source.html#l00113">bgp_keepalive_timer()</a>, <a class="el" href="bgp-route_8c-source.html#l00073">bgp_route_add()</a>, <a class="el" href="bgp-route_8c-source.html#l00157">bgp_route_new()</a>, <a class="el" href="bgp-utils_8c-source.html#l00004">bgp_timer_start()</a>, <a class="el" href="rn-global_8c-source.html#l00047">g_rn_areas</a>, <a class="el" href="rn-global_8c-source.html#l00004">g_rn_converge_ospf</a>, <a class="el" href="rn-global_8c-source.html#l00085">g_rn_logs_dir</a>, <a class="el" href="rn-global_8c-source.html#l00043">g_rn_nas</a>, <a class="el" href="bgp-init_8c-source.html#l00004">init_rib()</a>, <a class="el" href="rn-machine_8c-source.html#l00022">rn_getarea()</a>, <a class="el" href="rn-machine_8c-source.html#l00028">rn_getas()</a>, <a class="el" href="rn-link_8c-source.html#l00017">rn_getlink()</a>, <a class="el" href="rn-machine_8c-source.html#l00004">rn_getmachine()</a>, and <a class="el" href="rn-routing_8c-source.html#l00007">rn_route()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00071"></a>00071 {
<a name="l00072"></a>00072         tw_stime         keepalive_interval;
<a name="l00073"></a>00073 
<a name="l00074"></a>00074         bgp_nbr         *n;
<a name="l00075"></a>00075 
<a name="l00076"></a>00076         <span class="keywordtype">int</span>              i;
<a name="l00077"></a>00077 
<a name="l00078"></a>00078 <span class="preprocessor">#if BGP_CONVERGED</span>
<a name="l00079"></a>00079 <span class="preprocessor"></span>        rn_area         *ar;
<a name="l00080"></a>00080         rn_area         *d_ar;
<a name="l00081"></a>00081 
<a name="l00082"></a>00082         <span class="keywordtype">int</span>              x_id;
<a name="l00083"></a>00083 <span class="preprocessor">#endif</span>
<a name="l00084"></a>00084 <span class="preprocessor"></span>
<a name="l00085"></a>00085 
<a name="l00086"></a>00086 <span class="preprocessor">#if VERIFY_BGP</span>
<a name="l00087"></a>00087 <span class="preprocessor"></span>        <span class="keywordtype">char</span>             name[255];
<a name="l00088"></a>00088 
<a name="l00089"></a>00089         sprintf(name, <span class="stringliteral">"%s/router-%ld.log"</span>, <a class="code" href="rn-extern_8h.html#a46f0adf0f6be6d672defc691800ce69">g_rn_logs_dir</a>, lp-&gt;id);
<a name="l00090"></a>00090 
<a name="l00091"></a>00091         <span class="keywordflow">if</span>(lp-&gt;log)
<a name="l00092"></a>00092                 state-&gt;log = lp-&gt;log;
<a name="l00093"></a>00093         <span class="keywordflow">else</span>
<a name="l00094"></a>00094                 state-&gt;log = stdout;
<a name="l00095"></a>00095                 <span class="comment">//lp-&gt;log = state-&gt;log = fopen(name, "w");</span>
<a name="l00096"></a>00096 <span class="preprocessor">#else</span>
<a name="l00097"></a>00097 <span class="preprocessor"></span>        state-&gt;log = stdout;
<a name="l00098"></a>00098 <span class="preprocessor">#endif</span>
<a name="l00099"></a>00099 <span class="preprocessor"></span>
<a name="l00100"></a>00100         state-&gt;m = <a class="code" href="rn-extern_8h.html#b586ebafc20ad652dd538635f5c816b0">rn_getmachine</a>(lp-&gt;id);
<a name="l00101"></a>00101         state-&gt;as = <a class="code" href="rn-extern_8h.html#d3b2637627bbb86acf01b38d07495042">rn_getas</a>(state-&gt;m);
<a name="l00102"></a>00102 
<a name="l00103"></a>00103         state-&gt;stats = (bgp_stats *) calloc(<span class="keyword">sizeof</span>(bgp_stats), 1);
<a name="l00104"></a>00104 
<a name="l00105"></a>00105         <span class="keywordflow">if</span>(!state-&gt;stats)
<a name="l00106"></a>00106                 tw_error(TW_LOC, <span class="stringliteral">"Out of memory!"</span>);
<a name="l00107"></a>00107 
<a name="l00108"></a>00108         state-&gt;rib = (tw_memory **) calloc(<span class="keyword">sizeof</span>(tw_memory *), <a class="code" href="rn-extern_8h.html#353089f1049e9e0d5160683103c17e62">g_rn_nas</a>);
<a name="l00109"></a>00109 
<a name="l00110"></a>00110         <span class="keywordflow">if</span>(!state-&gt;rib)
<a name="l00111"></a>00111                 tw_error(TW_LOC, <span class="stringliteral">"Out of memory!"</span>);
<a name="l00112"></a>00112 
<a name="l00113"></a>00113 <span class="preprocessor">#if 0</span>
<a name="l00114"></a>00114 <span class="preprocessor"></span>        <span class="comment">// connect all area tree roots</span>
<a name="l00115"></a>00115         <span class="keywordflow">if</span>(0 &amp;&amp; state-&gt;m-&gt;subnet-&gt;area-&gt;root == lp-&gt;id)
<a name="l00116"></a>00116         {
<a name="l00117"></a>00117 <span class="preprocessor">#if VERIFY_BGP &amp;&amp; 0</span>
<a name="l00118"></a>00118 <span class="preprocessor"></span>                printf(<span class="stringliteral">"%ld: I am root for area: %d, lvl %d \n"</span>, 
<a name="l00119"></a>00119                         lp-&gt;id, state-&gt;m-&gt;subnet-&gt;area-&gt;id, state-&gt;m-&gt;level);
<a name="l00120"></a>00120 <span class="preprocessor">#endif</span>
<a name="l00121"></a>00121 <span class="preprocessor"></span>
<a name="l00122"></a>00122                 <span class="keywordflow">for</span>(i = 0; i &lt; state-&gt;as-&gt;nareas; i++)
<a name="l00123"></a>00123                 {
<a name="l00124"></a>00124                         <span class="keywordflow">if</span>(<a class="code" href="rn-extern_8h.html#0589d14c7531c798c923c2bd972cfa09">g_rn_areas</a>[i+state-&gt;as-&gt;low].root == INT_MAX ||
<a name="l00125"></a>00125                            <a class="code" href="rn-extern_8h.html#0589d14c7531c798c923c2bd972cfa09">g_rn_areas</a>[i+state-&gt;as-&gt;low].root == lp-&gt;id)
<a name="l00126"></a>00126                                 <span class="keywordflow">continue</span>;
<a name="l00127"></a>00127 
<a name="l00128"></a>00128                         n = &amp;state-&gt;nbr[state-&gt;n_interfaces++];
<a name="l00129"></a>00129                         n-&gt;id = <a class="code" href="rn-extern_8h.html#0589d14c7531c798c923c2bd972cfa09">g_rn_areas</a>[i+state-&gt;as-&gt;low].root;
<a name="l00130"></a>00130                         n-&gt;up = TW_FALSE;
<a name="l00131"></a>00131                 }
<a name="l00132"></a>00132         }
<a name="l00133"></a>00133 <span class="preprocessor">#endif</span>
<a name="l00134"></a>00134 <span class="preprocessor"></span>
<a name="l00135"></a>00135         <span class="keywordflow">if</span>(<a class="code" href="rn-extern_8h.html#1f8c72ceadd5707b682dc77968ffd6d5">g_rn_converge_ospf</a>)
<a name="l00136"></a>00136                 <span class="keywordflow">return</span>;
<a name="l00137"></a>00137 
<a name="l00138"></a>00138         <span class="comment">// start the keepalive timer</span>
<a name="l00139"></a>00139         <span class="keywordflow">if</span>(0 &amp;&amp; state-&gt;as-&gt;hold_interval != 0.0)
<a name="l00140"></a>00140         {
<a name="l00141"></a>00141                 keepalive_interval = tw_rand_exponential(lp-&gt;rng, 
<a name="l00142"></a>00142                                         state-&gt;as-&gt;keepalive_interval);
<a name="l00143"></a>00143                 state-&gt;tmr_keep_alive = <a class="code" href="bgp-extern_8h.html#f1b737c47cf480cc11a8714a8426d02a">bgp_timer_start</a>(lp,
<a name="l00144"></a>00144                                                 state-&gt;tmr_keep_alive,
<a name="l00145"></a>00145                                                 keepalive_interval,
<a name="l00146"></a>00146                                                 KEEPALIVETIMER);
<a name="l00147"></a>00147         }
<a name="l00148"></a>00148 
<a name="l00149"></a>00149 <span class="preprocessor">#if BGP_CONVERGED</span>
<a name="l00150"></a>00150 <span class="preprocessor"></span>        <span class="keywordflow">for</span>(i = 0; i &lt; state-&gt;n_interfaces; i++)
<a name="l00151"></a>00151         {
<a name="l00152"></a>00152                 n = &amp;state-&gt;nbr[i];
<a name="l00153"></a>00153                 n-&gt;last_update = 0;
<a name="l00154"></a>00154 
<a name="l00155"></a>00155                 <span class="keywordflow">if</span>(-1 != <a class="code" href="rn-extern_8h.html#8890679c55545bd36e770b118a920b57">rn_route</a>(state-&gt;m, n-&gt;id) || <a class="code" href="rn-extern_8h.html#d7173e076af48912ba761e8ef0cc1b22">rn_getlink</a>(state-&gt;m, n-&gt;id))
<a name="l00156"></a>00156                         n-&gt;up = TW_TRUE;
<a name="l00157"></a>00157                 <span class="keywordflow">else</span>
<a name="l00158"></a>00158                         n-&gt;up = TW_FALSE;
<a name="l00159"></a>00159 
<a name="l00160"></a>00160                 ar = <a class="code" href="rn-extern_8h.html#d45bc39e5a89bce656786b571acb1ae8">rn_getarea</a>(state-&gt;m);
<a name="l00161"></a>00161                 d_ar = <a class="code" href="rn-extern_8h.html#d45bc39e5a89bce656786b571acb1ae8">rn_getarea</a>(<a class="code" href="rn-extern_8h.html#b586ebafc20ad652dd538635f5c816b0">rn_getmachine</a>(n-&gt;id));
<a name="l00162"></a>00162 
<a name="l00163"></a>00163                 <span class="comment">// x_id is 0 for nbr ASes!</span>
<a name="l00164"></a>00164                 <span class="keywordflow">if</span>(ar == d_ar)
<a name="l00165"></a>00165                         x_id = n-&gt;id - ar-&gt;low;
<a name="l00166"></a>00166                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>(state-&gt;as == d_ar-&gt;as)
<a name="l00167"></a>00167                         x_id = ar-&gt;nmachines + d_ar-&gt;id - state-&gt;as-&gt;low;
<a name="l00168"></a>00168                 <span class="keywordflow">else</span>
<a name="l00169"></a>00169                         x_id = -1;
<a name="l00170"></a>00170 
<a name="l00171"></a>00171                 <span class="keywordflow">if</span>(-1 == x_id)
<a name="l00172"></a>00172                         n-&gt;hop_count = 0;
<a name="l00173"></a>00173                 <span class="keywordflow">else</span>
<a name="l00174"></a>00174                         n-&gt;hop_count = state-&gt;m-&gt;nhop[x_id];
<a name="l00175"></a>00175         }
<a name="l00176"></a>00176 
<a name="l00177"></a>00177         <a class="code" href="bgp-init_8c.html#2bc201c689250e76649bbea4a4a7a191">init_rib</a>(state, lp);
<a name="l00178"></a>00178         <a class="code" href="bgp-extern_8h.html#4558ddaaf24c01e0a8fad172ceb4ca98">bgp_keepalive_timer</a>(state, NULL, NULL, lp);
<a name="l00179"></a>00179 <span class="preprocessor">#else</span>
<a name="l00180"></a>00180 <span class="preprocessor"></span>        <span class="comment">// Create and install the route in our table</span>
<a name="l00181"></a>00181         <a class="code" href="bgp-extern_8h.html#1a40f199f8cdc9503b572859ee63ba77">bgp_route_add</a>(state, <a class="code" href="bgp-extern_8h.html#525d4b98ef30f04b282a1f272f7fba3a">bgp_route_new</a>(state, lp, lp, lp));
<a name="l00182"></a>00182 
<a name="l00183"></a>00183         <span class="keywordflow">for</span>(i = 0; i &lt; state-&gt;n_interfaces; i++)
<a name="l00184"></a>00184         {
<a name="l00185"></a>00185                 n = &amp;state-&gt;nbr[i];
<a name="l00186"></a>00186                 n-&gt;last_update = 0;
<a name="l00187"></a>00187 
<a name="l00188"></a>00188                 <span class="keywordflow">if</span>(n-&gt;up == TW_FALSE)
<a name="l00189"></a>00189                         <a class="code" href="bgp-connect_8c.html#a1e689502a42cd1f8dc2e3e48ca2fd85">bgp_connect</a>(state, n, lp);
<a name="l00190"></a>00190         }
<a name="l00191"></a>00191 <span class="preprocessor">#endif</span>
<a name="l00192"></a>00192 <span class="preprocessor"></span>}
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="73e6cce223930f12a8132dc39259b480"></a><!-- doxytag: member="bgp-extern.h::bgp_keepalive" ref="73e6cce223930f12a8132dc39259b480" args="(bgp_state *state, int, int, tw_lp *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bgp_keepalive           </td>
          <td>(</td>
          <td class="paramtype">bgp_state *&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="bgp-keepalive_8c-source.html#l00042">42</a> of file <a class="el" href="bgp-keepalive_8c-source.html">bgp-keepalive.c</a>.</p>

<p>References <a class="el" href="bgp-nbr_8c-source.html#l00007">bgp_getnbr()</a>, <a class="el" href="bgp-mrai_8c-source.html#l00007">bgp_mrai_tmr()</a>, <a class="el" href="bgp-open_8c-source.html#l00004">bgp_open_send()</a>, <a class="el" href="bgp-global_8c-source.html#l00025">g_bgp_state</a>, <a class="el" href="rn-global_8c-source.html#l00043">g_rn_nas</a>, <a class="el" href="rn-machine_8c-source.html#l00022">rn_getarea()</a>, and <a class="el" href="rn-machine_8c-source.html#l00004">rn_getmachine()</a>.</p>

<p>Referenced by <a class="el" href="bgp-router_8c-source.html#l00004">bgp_event_handler()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00043"></a>00043 {
<a name="l00044"></a>00044         rn_area         *d_ar;
<a name="l00045"></a>00045         rn_area         *ar;
<a name="l00046"></a>00046 
<a name="l00047"></a>00047         bgp_route       *r;
<a name="l00048"></a>00048         bgp_nbr         *n;
<a name="l00049"></a>00049 
<a name="l00050"></a>00050         <span class="keywordtype">int</span>              x_id;
<a name="l00051"></a>00051         <span class="keywordtype">int</span>              i;
<a name="l00052"></a>00052 
<a name="l00053"></a>00053         n = <a class="code" href="bgp-extern_8h.html#5ed527027df1ef2895f4a8b3642dc991">bgp_getnbr</a>(state, src);
<a name="l00054"></a>00054 
<a name="l00055"></a>00055         <span class="keywordflow">if</span>(NULL == n)
<a name="l00056"></a>00056         {
<a name="l00057"></a>00057                 printf(<span class="stringliteral">"%lld: adding neighbor: %d \n"</span>, lp-&gt;id, src);
<a name="l00058"></a>00058                 n = &amp;state-&gt;nbr[state-&gt;n_interfaces++];
<a name="l00059"></a>00059                 n-&gt;id = src;
<a name="l00060"></a>00060                 n-&gt;up = TW_FALSE;
<a name="l00061"></a>00061         }
<a name="l00062"></a>00062 
<a name="l00063"></a>00063         ar = <a class="code" href="rn-extern_8h.html#d45bc39e5a89bce656786b571acb1ae8">rn_getarea</a>(state-&gt;m);
<a name="l00064"></a>00064         d_ar = <a class="code" href="rn-extern_8h.html#d45bc39e5a89bce656786b571acb1ae8">rn_getarea</a>(<a class="code" href="rn-extern_8h.html#b586ebafc20ad652dd538635f5c816b0">rn_getmachine</a>(n-&gt;id));
<a name="l00065"></a>00065 
<a name="l00066"></a>00066         <span class="keywordflow">if</span>(ar == d_ar)
<a name="l00067"></a>00067                 x_id = n-&gt;id - ar-&gt;low;
<a name="l00068"></a>00068         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(state-&gt;as == d_ar-&gt;as)
<a name="l00069"></a>00069                 x_id = ar-&gt;nmachines + d_ar-&gt;id - state-&gt;as-&gt;low;
<a name="l00070"></a>00070         <span class="keywordflow">else</span>
<a name="l00071"></a>00071                 x_id = -1;
<a name="l00072"></a>00072 
<a name="l00073"></a>00073         <span class="keywordflow">if</span>(-1 != x_id &amp;&amp; x_id &gt; ar-&gt;g_ospf_nlsa)
<a name="l00074"></a>00074                 tw_error(TW_LOC, <span class="stringliteral">"x_id out of range!"</span>);
<a name="l00075"></a>00075 
<a name="l00076"></a>00076         <span class="comment">// Get the latest hop count to the neighbor off this message</span>
<a name="l00077"></a>00077         <span class="keywordflow">if</span>(<a class="code" href="bgp-extern_8h.html#c272d2ccc839a484a3bc7b4b0e3eb706">g_bgp_state</a>-&gt;b.hot_potato &amp;&amp; 
<a name="l00078"></a>00078                 state-&gt;as == d_ar-&gt;as &amp;&amp; x_id != -1 &amp;&amp; 
<a name="l00079"></a>00079                 n-&gt;hop_count != state-&gt;m-&gt;nhop[x_id])
<a name="l00080"></a>00080         {
<a name="l00081"></a>00081                 n-&gt;hop_count = state-&gt;m-&gt;nhop[x_id];
<a name="l00082"></a>00082 
<a name="l00083"></a>00083                 <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="rn-extern_8h.html#353089f1049e9e0d5160683103c17e62">g_rn_nas</a>; i++)
<a name="l00084"></a>00084                 {
<a name="l00085"></a>00085                         <span class="keywordflow">if</span>(!state-&gt;rib[i])
<a name="l00086"></a>00086                                 <span class="keywordflow">continue</span>;
<a name="l00087"></a>00087 
<a name="l00088"></a>00088                         r = tw_memory_data(state-&gt;rib[i]);
<a name="l00089"></a>00089                         <span class="keywordflow">if</span>(r-&gt;src == n-&gt;id)
<a name="l00090"></a>00090                         {
<a name="l00091"></a>00091                                 state-&gt;rib[i]-&gt;bit = TW_TRUE;
<a name="l00092"></a>00092                                 <a class="code" href="bgp-extern_8h.html#da4aa0f47640a7070edb5cff82efef4e">bgp_mrai_tmr</a>(state, lp);
<a name="l00093"></a>00093                         }
<a name="l00094"></a>00094                 }
<a name="l00095"></a>00095         }
<a name="l00096"></a>00096 
<a name="l00097"></a>00097         <span class="comment">// If we receive a message from a down host, start the OPEN process</span>
<a name="l00098"></a>00098         <span class="keywordflow">if</span>(n-&gt;up == TW_FALSE)
<a name="l00099"></a>00099         {
<a name="l00100"></a>00100                 <a class="code" href="bgp-extern_8h.html#6b22cf4d43b6cb597d3c4b3d0ad97f9d">bgp_open_send</a>(state, n, lp);
<a name="l00101"></a>00101                 n-&gt;up = TW_TRUE;
<a name="l00102"></a>00102 
<a name="l00103"></a>00103 <span class="preprocessor">#if VERIFY_BGP</span>
<a name="l00104"></a>00104 <span class="preprocessor"></span>                fprintf(state-&gt;log, <span class="stringliteral">"\tbringing up nbr %d at %lf\n"</span>, 
<a name="l00105"></a>00105                         src, tw_now(lp));
<a name="l00106"></a>00106 <span class="preprocessor">#endif</span>
<a name="l00107"></a>00107 <span class="preprocessor"></span>        }
<a name="l00108"></a>00108 
<a name="l00109"></a>00109         n-&gt;last_update = floor(tw_now(lp));
<a name="l00110"></a>00110 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="f63d4cef317dafd93bdbd8d8558a4237"></a><!-- doxytag: member="bgp-extern.h::bgp_keepalive_send" ref="f63d4cef317dafd93bdbd8d8558a4237" args="(bgp_nbr *n, tw_lp *lp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bgp_keepalive_send           </td>
          <td>(</td>
          <td class="paramtype">bgp_nbr *&nbsp;</td>
          <td class="paramname"> <em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="bgp-keepalive_8c-source.html#l00020">20</a> of file <a class="el" href="bgp-keepalive_8c-source.html">bgp-keepalive.c</a>.</p>

<p>References <a class="el" href="bgp-types_8h-source.html#l00014">BGP_KEEPALIVE</a>, <a class="el" href="rn-types_8h-source.html#l00055">DOWNSTREAM</a>, <a class="el" href="bgp-global_8c-source.html#l00010">g_bgp_fd</a>, <a class="el" href="rn-event_8c-source.html#l00058">rn_event_new()</a>, and <a class="el" href="rn-event_8c-source.html#l00173">rn_event_send()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00021"></a>00021 {
<a name="l00022"></a>00022         tw_event       *e;
<a name="l00023"></a>00023         tw_memory      *hdr;
<a name="l00024"></a>00024 
<a name="l00025"></a>00025         bgp_message    *m;
<a name="l00026"></a>00026 
<a name="l00027"></a>00027         e = <a class="code" href="rn-event_8c.html#5508bcf53c1fbeb71e6055021634a726">rn_event_new</a>(n-&gt;id, 0.0, lp, <a class="code" href="rn-types_8h.html#3fc738f2924cae2b2d04a9a133c3ef02193085e792a05c4538ec2bc24c845652">DOWNSTREAM</a>, <a class="code" href="bgp-types_8h.html#dc46aa5a9793aa14b2f1aa82fc0473d3">BGP_KEEPALIVE</a>);
<a name="l00028"></a>00028                 <span class="keywordflow">return</span>;
<a name="l00029"></a>00029 
<a name="l00030"></a>00030         <span class="comment">// create the BGP header</span>
<a name="l00031"></a>00031         hdr = tw_memory_alloc(lp, <a class="code" href="bgp-extern_8h.html#0c0827f912b6c5550b6dfaa922b3fdc9">g_bgp_fd</a>);
<a name="l00032"></a>00032         m = tw_memory_data(hdr);
<a name="l00033"></a>00033 
<a name="l00034"></a>00034         m-&gt;b.type = KEEPALIVE;
<a name="l00035"></a>00035 
<a name="l00036"></a>00036         tw_event_memory_set(e, hdr, <a class="code" href="bgp-extern_8h.html#0c0827f912b6c5550b6dfaa922b3fdc9">g_bgp_fd</a>);
<a name="l00037"></a>00037         <a class="code" href="rn-event_8c.html#8c3496e774b118a7e411ea5bcd23d49a">rn_event_send</a>(e);
<a name="l00038"></a>00038 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="4558ddaaf24c01e0a8fad172ceb4ca98"></a><!-- doxytag: member="bgp-extern.h::bgp_keepalive_timer" ref="4558ddaaf24c01e0a8fad172ceb4ca98" args="(bgp_state *, tw_bf *, bgp_message *, tw_lp *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bgp_keepalive_timer           </td>
          <td>(</td>
          <td class="paramtype">bgp_state *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_bf *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bgp_message *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="bgp-keepalive_8c-source.html#l00113">113</a> of file <a class="el" href="bgp-keepalive_8c-source.html">bgp-keepalive.c</a>.</p>

<p>References <a class="el" href="bgp-types_8h-source.html#l00014">BGP_KEEPALIVE</a>, <a class="el" href="bgp-keepalive_8c-source.html#l00007">bgp_keepalive_tmr()</a>, <a class="el" href="bgp-open_8c-source.html#l00004">bgp_open_send()</a>, <a class="el" href="rn-types_8h-source.html#l00055">DOWNSTREAM</a>, <a class="el" href="bgp-global_8c-source.html#l00010">g_bgp_fd</a>, <a class="el" href="rn-event_8c-source.html#l00058">rn_event_new()</a>, and <a class="el" href="rn-event_8c-source.html#l00173">rn_event_send()</a>.</p>

<p>Referenced by <a class="el" href="bgp-router_8c-source.html#l00004">bgp_event_handler()</a>, and <a class="el" href="bgp-init_8c-source.html#l00070">bgp_init()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00114"></a>00114 {
<a name="l00115"></a>00115         tw_event       *e;
<a name="l00116"></a>00116         tw_memory      *hdr;
<a name="l00117"></a>00117 
<a name="l00118"></a>00118         bgp_message    *m;
<a name="l00119"></a>00119         bgp_nbr        *n;
<a name="l00120"></a>00120 
<a name="l00121"></a>00121         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>    i;
<a name="l00122"></a>00122 
<a name="l00123"></a>00123         state-&gt;stats-&gt;s_nkeepalivetimers++;
<a name="l00124"></a>00124 
<a name="l00125"></a>00125         <span class="comment">// send a keepalive to each neighbor</span>
<a name="l00126"></a>00126         <span class="keywordflow">for</span> (i = 0, n = state-&gt;nbr; i &lt; state-&gt;n_interfaces; n = &amp;state-&gt;nbr[++i])
<a name="l00127"></a>00127         {
<a name="l00128"></a>00128                 <span class="comment">// If the neighbor is down, attempt to send OPEN instead..</span>
<a name="l00129"></a>00129                 <span class="comment">// idea is to simulate transport connection layer attempt</span>
<a name="l00130"></a>00130                 <span class="keywordflow">if</span> (n-&gt;up == TW_FALSE)
<a name="l00131"></a>00131                 {
<a name="l00132"></a>00132                         <a class="code" href="bgp-extern_8h.html#6b22cf4d43b6cb597d3c4b3d0ad97f9d">bgp_open_send</a>(state, n, lp);
<a name="l00133"></a>00133                         <span class="keywordflow">continue</span>;
<a name="l00134"></a>00134                 }
<a name="l00135"></a>00135 
<a name="l00136"></a>00136                 e = <a class="code" href="rn-event_8c.html#5508bcf53c1fbeb71e6055021634a726">rn_event_new</a>(n-&gt;id, 0.0, lp, <a class="code" href="rn-types_8h.html#3fc738f2924cae2b2d04a9a133c3ef02193085e792a05c4538ec2bc24c845652">DOWNSTREAM</a>, <a class="code" href="bgp-types_8h.html#dc46aa5a9793aa14b2f1aa82fc0473d3">BGP_KEEPALIVE</a>);
<a name="l00137"></a>00137 
<a name="l00138"></a>00138                 hdr = tw_memory_alloc(lp, <a class="code" href="bgp-extern_8h.html#0c0827f912b6c5550b6dfaa922b3fdc9">g_bgp_fd</a>);
<a name="l00139"></a>00139                 m = tw_memory_data(hdr);
<a name="l00140"></a>00140                 m-&gt;b.type = KEEPALIVE;
<a name="l00141"></a>00141 
<a name="l00142"></a>00142                 tw_event_memory_set(e, hdr, <a class="code" href="bgp-extern_8h.html#0c0827f912b6c5550b6dfaa922b3fdc9">g_bgp_fd</a>);
<a name="l00143"></a>00143                 <a class="code" href="rn-event_8c.html#8c3496e774b118a7e411ea5bcd23d49a">rn_event_send</a>(e);
<a name="l00144"></a>00144 
<a name="l00145"></a>00145 <span class="preprocessor">#if VERIFY_BGP</span>
<a name="l00146"></a>00146 <span class="preprocessor"></span>                fprintf(state-&gt;log, <span class="stringliteral">"\tsent KEEPALIVE msg to %d at %lf \n"</span>,
<a name="l00147"></a>00147                         n-&gt;id, e-&gt;recv_ts);
<a name="l00148"></a>00148 <span class="preprocessor">#endif</span>
<a name="l00149"></a>00149 <span class="preprocessor"></span>        }
<a name="l00150"></a>00150 
<a name="l00151"></a>00151         <a class="code" href="bgp-extern_8h.html#9d19cdedf4a4cd318ed16a83eecf2843">bgp_keepalive_tmr</a>(state, lp);
<a name="l00152"></a>00152 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="9d19cdedf4a4cd318ed16a83eecf2843"></a><!-- doxytag: member="bgp-extern.h::bgp_keepalive_tmr" ref="9d19cdedf4a4cd318ed16a83eecf2843" args="(bgp_state *state, tw_lp *lp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bgp_keepalive_tmr           </td>
          <td>(</td>
          <td class="paramtype">bgp_state *&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="bgp-keepalive_8c-source.html#l00007">7</a> of file <a class="el" href="bgp-keepalive_8c-source.html">bgp-keepalive.c</a>.</p>

<p>References <a class="el" href="bgp-utils_8c-source.html#l00004">bgp_timer_start()</a>.</p>

<p>Referenced by <a class="el" href="bgp-keepalive_8c-source.html#l00113">bgp_keepalive_timer()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00008"></a>00008 {
<a name="l00009"></a>00009         <span class="keywordflow">if</span>(0 == state-&gt;as-&gt;hold_interval)
<a name="l00010"></a>00010                 <span class="keywordflow">return</span>;
<a name="l00011"></a>00011 
<a name="l00012"></a>00012         <span class="comment">// keep the keepalive timer going</span>
<a name="l00013"></a>00013         state-&gt;tmr_keep_alive = <a class="code" href="bgp-extern_8h.html#f1b737c47cf480cc11a8714a8426d02a">bgp_timer_start</a>(lp,
<a name="l00014"></a>00014                                                 state-&gt;tmr_keep_alive,
<a name="l00015"></a>00015                                                 state-&gt;as-&gt;keepalive_interval,
<a name="l00016"></a>00016                                                 KEEPALIVETIMER);
<a name="l00017"></a>00017 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="33804f6cc2a28b68a7e0322bd298bdf4"></a><!-- doxytag: member="bgp-extern.h::bgp_main" ref="33804f6cc2a28b68a7e0322bd298bdf4" args="(int argc, char **argv, char **env)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bgp_main           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&nbsp;</td>
          <td class="paramname"> <em>argv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&nbsp;</td>
          <td class="paramname"> <em>env</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="bgp-main_8c-source.html#l00147">147</a> of file <a class="el" href="bgp-main_8c-source.html">bgp-main.c</a>.</p>

<p>References <a class="el" href="bgp-main_8c-source.html#l00109">bgp_setup_ases()</a>, <a class="el" href="bgp-main_8c-source.html#l00007">bgp_setup_options()</a>, <a class="el" href="bgp-global_8c-source.html#l00010">g_bgp_fd</a>, <a class="el" href="bgp-global_8c-source.html#l00012">g_bgp_fd_asp</a>, <a class="el" href="bgp-global_8c-source.html#l00011">g_bgp_fd_rtes</a>, <a class="el" href="bgp-global_8c-source.html#l00032">g_bgp_rt_fd</a>, and <a class="el" href="rn-global_8c-source.html#l00084">g_rn_tools_dir</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00148"></a>00148 {
<a name="l00149"></a>00149         <span class="comment">/*</span>
<a name="l00150"></a>00150 <span class="comment">         * Init the memory buffers for this model</span>
<a name="l00151"></a>00151 <span class="comment">         */</span>
<a name="l00152"></a>00152 <span class="preprocessor">#if BGP_CONVERGED</span>
<a name="l00153"></a>00153 <span class="preprocessor"></span>        <span class="keywordtype">char</span>            file[1024];
<a name="l00154"></a>00154 <span class="preprocessor">#endif</span>
<a name="l00155"></a>00155 <span class="preprocessor"></span>
<a name="l00156"></a>00156         tw_kp          *kp;
<a name="l00157"></a>00157         <span class="keywordtype">int</span>             i;
<a name="l00158"></a>00158 
<a name="l00159"></a>00159         printf(<span class="stringliteral">"\nInitializing BGP memory buffers... "</span>);
<a name="l00160"></a>00160         <span class="keywordflow">for</span> (i = 0; i &lt; g_tw_nkp; i++)
<a name="l00161"></a>00161         {
<a name="l00162"></a>00162                 kp = tw_getkp(i);
<a name="l00163"></a>00163 
<a name="l00164"></a>00164 <span class="comment">/*</span>
<a name="l00165"></a>00165 <span class="comment">                // Commented out for NCS</span>
<a name="l00166"></a>00166 <span class="comment">                g_bgp_fd_rtes = tw_kp_memory_init(kp, 1000 * g_tw_nlp, sizeof(bgp_route), 1);</span>
<a name="l00167"></a>00167 <span class="comment">                g_bgp_fd_asp = tw_kp_memory_init(kp, 1000 * g_tw_nlp, sizeof(int), 1);</span>
<a name="l00168"></a>00168 <span class="comment">                g_bgp_fd = tw_kp_memory_init(kp, 2000 * g_tw_nlp, sizeof(bgp_message), 1);</span>
<a name="l00169"></a>00169 <span class="comment">*/</span>
<a name="l00170"></a>00170                 <a class="code" href="bgp-extern_8h.html#7603addb7e529a1f5639178c389a5500">g_bgp_fd_rtes</a> = tw_kp_memory_init(kp, g_tw_nlp, <span class="keyword">sizeof</span>(bgp_route), 1);
<a name="l00171"></a>00171                 <a class="code" href="bgp-extern_8h.html#ae8e41b9fd5752112bd1e1f06aa00843">g_bgp_fd_asp</a> = tw_kp_memory_init(kp, g_tw_nlp, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>), 1);
<a name="l00172"></a>00172                 <a class="code" href="bgp-extern_8h.html#0c0827f912b6c5550b6dfaa922b3fdc9">g_bgp_fd</a> = tw_kp_memory_init(kp, g_tw_nlp, <span class="keyword">sizeof</span>(bgp_message), 1);
<a name="l00173"></a>00173         }
<a name="l00174"></a>00174 
<a name="l00175"></a>00175         printf(<span class="stringliteral">"done!\n"</span>);
<a name="l00176"></a>00176 
<a name="l00177"></a>00177 <span class="comment">/*</span>
<a name="l00178"></a>00178 <span class="comment">        printf("\tRoute   q: %10ld bufs %10ld fd\n", 1000 * g_tw_nlp, g_bgp_fd_rtes);</span>
<a name="l00179"></a>00179 <span class="comment">        printf("\tAS Path q: %10ld bufs %10ld fd\n", 1000 * g_tw_nlp, g_bgp_fd_asp);</span>
<a name="l00180"></a>00180 <span class="comment">        printf("\tMessage q: %10ld bufs %10ld fd\n", 1000 * g_tw_nlp, g_bgp_fd);</span>
<a name="l00181"></a>00181 <span class="comment">*/</span>
<a name="l00182"></a>00182         printf(<span class="stringliteral">"\tRoute   q: %10lld bufs %10ld fd\n"</span>, g_tw_nlp, <a class="code" href="bgp-extern_8h.html#7603addb7e529a1f5639178c389a5500">g_bgp_fd_rtes</a>);
<a name="l00183"></a>00183         printf(<span class="stringliteral">"\tAS Path q: %10lld bufs %10ld fd\n"</span>, g_tw_nlp, <a class="code" href="bgp-extern_8h.html#ae8e41b9fd5752112bd1e1f06aa00843">g_bgp_fd_asp</a>);
<a name="l00184"></a>00184         printf(<span class="stringliteral">"\tMessage q: %10lld bufs %10ld fd\n"</span>, g_tw_nlp, <a class="code" href="bgp-extern_8h.html#0c0827f912b6c5550b6dfaa922b3fdc9">g_bgp_fd</a>);
<a name="l00185"></a>00185         printf(<span class="stringliteral">"\n"</span>);
<a name="l00186"></a>00186 
<a name="l00187"></a>00187         <a class="code" href="bgp-main_8c.html#9d73549fccbad0692fc7837beecaa0ab">bgp_setup_options</a>(argc, argv);
<a name="l00188"></a>00188         <a class="code" href="bgp-main_8c.html#bde3a323b81ee9de67d0b522361273af">bgp_setup_ases</a>();
<a name="l00189"></a>00189 
<a name="l00190"></a>00190 <span class="preprocessor">#if BGP_CONVERGED</span>
<a name="l00191"></a>00191 <span class="preprocessor"></span>        sprintf(file, <span class="stringliteral">"tools/%s/bgp-route.file"</span>, <a class="code" href="rn-extern_8h.html#7199204689d83ed6e37695c3baaa2f85">g_rn_tools_dir</a>);
<a name="l00192"></a>00192         <a class="code" href="bgp-extern_8h.html#f18fc4fa7c4a304602705fa8b8c0983a">g_bgp_rt_fd</a> = fopen(file, <span class="stringliteral">"r"</span>);
<a name="l00193"></a>00193 
<a name="l00194"></a>00194         <span class="keywordflow">if</span>(!<a class="code" href="bgp-extern_8h.html#f18fc4fa7c4a304602705fa8b8c0983a">g_bgp_rt_fd</a>)
<a name="l00195"></a>00195                 tw_error(TW_LOC, <span class="stringliteral">"Unable to open BGP routing file: %s"</span>, file);
<a name="l00196"></a>00196 <span class="preprocessor">#else</span>
<a name="l00197"></a>00197 <span class="preprocessor"></span><span class="comment">/*</span>
<a name="l00198"></a>00198 <span class="comment">        sprintf(file, "%s/bgp-route.file", g_rn_logs_dir);</span>
<a name="l00199"></a>00199 <span class="comment">        g_bgp_rt_fd = fopen(file, "w");</span>
<a name="l00200"></a>00200 <span class="comment"></span>
<a name="l00201"></a>00201 <span class="comment">        if(!g_bgp_rt_fd)</span>
<a name="l00202"></a>00202 <span class="comment">                tw_error(TW_LOC, "Unable to open file: %s!", file);</span>
<a name="l00203"></a>00203 <span class="comment">*/</span>
<a name="l00204"></a>00204 <span class="preprocessor">#endif</span>
<a name="l00205"></a>00205 <span class="preprocessor"></span>}
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="5d608721bb1a0a5006ff3e3b0ee610a6"></a><!-- doxytag: member="bgp-extern.h::bgp_md_final" ref="5d608721bb1a0a5006ff3e3b0ee610a6" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bgp_md_final           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="bgp-main_8c-source.html#l00208">208</a> of file <a class="el" href="bgp-main_8c-source.html">bgp-main.c</a>.</p>

<p>References <a class="el" href="bgp-global_8c-source.html#l00024">g_bgp_as</a>, <a class="el" href="bgp-global_8c-source.html#l00032">g_bgp_rt_fd</a>, <a class="el" href="bgp-global_8c-source.html#l00023">g_bgp_stats</a>, and <a class="el" href="rn-global_8c-source.html#l00043">g_rn_nas</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00209"></a>00209 {
<a name="l00210"></a>00210         <span class="keywordtype">int</span>      i;
<a name="l00211"></a>00211         <span class="keywordtype">int</span>      j;
<a name="l00212"></a>00212 
<a name="l00213"></a>00213         printf(<span class="stringliteral">"\nBGP4 Model Statistics: \n\n"</span>);
<a name="l00214"></a>00214 
<a name="l00215"></a>00215         printf(<span class="stringliteral">"\t%-50s %11d\n"</span>, <span class="stringliteral">"Connects"</span>, <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_nconnects);
<a name="l00216"></a>00216         printf(<span class="stringliteral">"\t%-50s %11d\n"</span>, <span class="stringliteral">"Connects Dropped"</span>, <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_nconnects_dropped);
<a name="l00217"></a>00217         printf(<span class="stringliteral">"\n"</span>);
<a name="l00218"></a>00218         printf(<span class="stringliteral">"\t%-50s %11d\n"</span>, <span class="stringliteral">"Opens"</span>, <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_nopens);
<a name="l00219"></a>00219         printf(<span class="stringliteral">"\t%-50s %11d\n"</span>, <span class="stringliteral">"D Opens"</span>, <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.d_opens);
<a name="l00220"></a>00220         printf(<span class="stringliteral">"\n"</span>);
<a name="l00221"></a>00221         printf(<span class="stringliteral">"\t%-50s %11d\n"</span>, <span class="stringliteral">"Routes Added"</span>, <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_nroute_adds);
<a name="l00222"></a>00222         printf(<span class="stringliteral">"\t%-50s %11d\n"</span>, <span class="stringliteral">"Routes Removed"</span>, <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_nroute_removes);
<a name="l00223"></a>00223         printf(<span class="stringliteral">"\n"</span>);
<a name="l00224"></a>00224         printf(<span class="stringliteral">"\t%-50s %11d\n"</span>, <span class="stringliteral">"Updates Sent"</span>, <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_nupdates_sent);
<a name="l00225"></a>00225         printf(<span class="stringliteral">"\t%-50s %11d\n"</span>, <span class="stringliteral">"Updates Recv"</span>, <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_nupdates_recv);
<a name="l00226"></a>00226         printf(<span class="stringliteral">"\t%-50s %11d\n"</span>, <span class="stringliteral">"Update Unreachable"</span>, <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_nunreachable);
<a name="l00227"></a>00227         printf(<span class="stringliteral">"\n"</span>);
<a name="l00228"></a>00228         printf(<span class="stringliteral">"\t%-50s %11d\n"</span>, <span class="stringliteral">"Notify Sent"</span>, <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_nnotify_sent);
<a name="l00229"></a>00229         printf(<span class="stringliteral">"\t%-50s %11d\n"</span>, <span class="stringliteral">"Notify Recv"</span>, <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_nnotify_recv);
<a name="l00230"></a>00230         printf(<span class="stringliteral">"\n"</span>);
<a name="l00231"></a>00231         printf(<span class="stringliteral">"\t%-50s %11d\n"</span>, <span class="stringliteral">"Keepalives"</span>, <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_nkeepalives);
<a name="l00232"></a>00232         printf(<span class="stringliteral">"\t%-50s %11d\n"</span>, <span class="stringliteral">"Keepalive Timers"</span>, <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_nkeepalivetimers);
<a name="l00233"></a>00233         printf(<span class="stringliteral">"\n"</span>);
<a name="l00234"></a>00234         printf(<span class="stringliteral">"\t%-50s %11d\n"</span>, <span class="stringliteral">"MRAI Timers"</span>, <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_nmrai_timers);
<a name="l00235"></a>00235         printf(<span class="stringliteral">"\n"</span>);
<a name="l00236"></a>00236         printf(<span class="stringliteral">"\t%-50s %11d\n"</span>, <span class="stringliteral">"iBGP Neighbors Down"</span>, <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_nibgp_nbrs);
<a name="l00237"></a>00237         printf(<span class="stringliteral">"\t%-50s %11d\n"</span>, <span class="stringliteral">"eBGP Neighbors Down"</span>, <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_nebgp_nbrs);
<a name="l00238"></a>00238         printf(<span class="stringliteral">"\n"</span>);
<a name="l00239"></a>00239         printf(<span class="stringliteral">"\t%-50s %11d\n"</span>, <span class="stringliteral">"iBGP Neighbors Up"</span>, <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_nibgp_nbrs_up);
<a name="l00240"></a>00240         printf(<span class="stringliteral">"\t%-50s %11d\n"</span>, <span class="stringliteral">"eBGP Neighbors Up"</span>, <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_nebgp_nbrs_up);
<a name="l00241"></a>00241         printf(<span class="stringliteral">"\n"</span>);
<a name="l00242"></a>00242         printf(<span class="stringliteral">"\t%-50s %11d\n"</span>, <span class="stringliteral">"Decision: Local Pref"</span>, <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_ndec_local_pref);
<a name="l00243"></a>00243         printf(<span class="stringliteral">"\t%-50s %11d\n"</span>, <span class="stringliteral">"Decision: AS Path"</span>, <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_ndec_aspath);
<a name="l00244"></a>00244         printf(<span class="stringliteral">"\t%-50s %11d\n"</span>, <span class="stringliteral">"Decision: Origin"</span>, <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_ndec_origin);
<a name="l00245"></a>00245         printf(<span class="stringliteral">"\t%-50s %11d\n"</span>, <span class="stringliteral">"Decision: MED"</span>, <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_ndec_med);
<a name="l00246"></a>00246         printf(<span class="stringliteral">"\t%-50s %11d\n"</span>, <span class="stringliteral">"Decision: Hot Potato"</span>, <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_ndec_hot_potato);
<a name="l00247"></a>00247         printf(<span class="stringliteral">"\t%-50s %11d\n"</span>, <span class="stringliteral">"Decision: Next Hop"</span>, <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_ndec_next_hop);
<a name="l00248"></a>00248         printf(<span class="stringliteral">"\t%-50s %11d\n"</span>, <span class="stringliteral">"Decision: Existing"</span>, <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_ndec_existing);
<a name="l00249"></a>00249         printf(<span class="stringliteral">"\t%-50s %11d\n"</span>, <span class="stringliteral">"Decision: Default"</span>, <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_ndec_default);
<a name="l00250"></a>00250         printf(<span class="stringliteral">"\n"</span>);
<a name="l00251"></a>00251         printf(<span class="stringliteral">"BGP Caused Updates: %d\n"</span>, <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_cause_bgp);
<a name="l00252"></a>00252         printf(<span class="stringliteral">"OSPF Caused BGP Updates: %d"</span>, <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_cause_ospf);
<a name="l00253"></a>00253         printf(<span class="stringliteral">"\n"</span>);
<a name="l00254"></a>00254 
<a name="l00255"></a>00255         printf(<span class="stringliteral">"BGP4 Topology: \n\n"</span>);
<a name="l00256"></a>00256 
<a name="l00257"></a>00257         <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="rn-extern_8h.html#353089f1049e9e0d5160683103c17e62">g_rn_nas</a>; i++)
<a name="l00258"></a>00258         {
<a name="l00259"></a>00259                 <span class="keywordflow">for</span>(j = 0; j &lt; g_rn_nas; j++)
<a name="l00260"></a>00260                         printf(<span class="stringliteral">"%10d "</span>, <a class="code" href="bgp-extern_8h.html#5c7a53c0af93ddd5e897fe79643be44d">g_bgp_as</a>[i].degree[j]);
<a name="l00261"></a>00261 
<a name="l00262"></a>00262                 printf(<span class="stringliteral">"\n"</span>);
<a name="l00263"></a>00263         }
<a name="l00264"></a>00264 
<a name="l00265"></a>00265         <span class="keywordflow">if</span>(0 &amp;&amp; <a class="code" href="bgp-extern_8h.html#f18fc4fa7c4a304602705fa8b8c0983a">g_bgp_rt_fd</a>)
<a name="l00266"></a>00266                 fclose(<a class="code" href="bgp-extern_8h.html#f18fc4fa7c4a304602705fa8b8c0983a">g_bgp_rt_fd</a>);
<a name="l00267"></a>00267 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="59f8330e587f1072e4a8c3b27cac40a3"></a><!-- doxytag: member="bgp-extern.h::bgp_mrai_timer" ref="59f8330e587f1072e4a8c3b27cac40a3" args="(bgp_state *, tw_bf *, bgp_message *, tw_lp *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bgp_mrai_timer           </td>
          <td>(</td>
          <td class="paramtype">bgp_state *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_bf *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bgp_message *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="bgp-mrai_8c-source.html#l00020">20</a> of file <a class="el" href="bgp-mrai_8c-source.html">bgp-mrai.c</a>.</p>

<p>References <a class="el" href="bgp-update_8c-source.html#l00264">bgp_update_all()</a>, and <a class="el" href="rn-global_8c-source.html#l00043">g_rn_nas</a>.</p>

<p>Referenced by <a class="el" href="bgp-router_8c-source.html#l00004">bgp_event_handler()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00021"></a>00021 {
<a name="l00022"></a>00022         tw_memory       *b;
<a name="l00023"></a>00023         bgp_route       *r;
<a name="l00024"></a>00024 
<a name="l00025"></a>00025         <span class="keywordtype">int</span>              i;
<a name="l00026"></a>00026 
<a name="l00027"></a>00027         state-&gt;tmr_mrai = NULL;
<a name="l00028"></a>00028 
<a name="l00029"></a>00029         msg-&gt;b.update = 1;
<a name="l00030"></a>00030         msg-&gt;b.cause_bgp = 1;
<a name="l00031"></a>00031         msg-&gt;b.cause_ospf = 0;
<a name="l00032"></a>00032 
<a name="l00033"></a>00033         <span class="comment">// Foreach route in the RIB with dirty bit set, send updates to nbrs</span>
<a name="l00034"></a>00034         <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="rn-extern_8h.html#353089f1049e9e0d5160683103c17e62">g_rn_nas</a>; i++)
<a name="l00035"></a>00035         {
<a name="l00036"></a>00036                 b = state-&gt;rib[i];
<a name="l00037"></a>00037 
<a name="l00038"></a>00038                 <span class="comment">// Route has not been updated since previous MRAI timer fired</span>
<a name="l00039"></a>00039                 <span class="keywordflow">if</span>(!b || b-&gt;bit == TW_FALSE)
<a name="l00040"></a>00040                         <span class="keywordflow">continue</span>;
<a name="l00041"></a>00041 
<a name="l00042"></a>00042                 r = tw_memory_data(b);
<a name="l00043"></a>00043                 b-&gt;bit = TW_FALSE;
<a name="l00044"></a>00044                 <a class="code" href="bgp-extern_8h.html#856060ffa6068321237ce35960f8a676">bgp_update_all</a>(state, msg, lp-&gt;id, r, lp);
<a name="l00045"></a>00045         }
<a name="l00046"></a>00046 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="da4aa0f47640a7070edb5cff82efef4e"></a><!-- doxytag: member="bgp-extern.h::bgp_mrai_tmr" ref="da4aa0f47640a7070edb5cff82efef4e" args="(bgp_state *state, tw_lp *lp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bgp_mrai_tmr           </td>
          <td>(</td>
          <td class="paramtype">bgp_state *&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="bgp-mrai_8c-source.html#l00007">7</a> of file <a class="el" href="bgp-mrai_8c-source.html">bgp-mrai.c</a>.</p>

<p>References <a class="el" href="bgp-utils_8c-source.html#l00004">bgp_timer_start()</a>.</p>

<p>Referenced by <a class="el" href="bgp-keepalive_8c-source.html#l00042">bgp_keepalive()</a>, and <a class="el" href="bgp-route_8c-source.html#l00073">bgp_route_add()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00008"></a>00008 {
<a name="l00009"></a>00009         <span class="keywordflow">if</span>(state-&gt;tmr_mrai &amp;&amp; state-&gt;tmr_mrai-&gt;recv_ts &gt;= tw_now(lp))
<a name="l00010"></a>00010                 <span class="keywordflow">return</span>;
<a name="l00011"></a>00011 
<a name="l00012"></a>00012         <span class="comment">// keep the keepalive timer going</span>
<a name="l00013"></a>00013         state-&gt;tmr_mrai = <a class="code" href="bgp-extern_8h.html#f1b737c47cf480cc11a8714a8426d02a">bgp_timer_start</a>(lp,
<a name="l00014"></a>00014                                           state-&gt;tmr_mrai,
<a name="l00015"></a>00015                                           state-&gt;as-&gt;mrai_interval,
<a name="l00016"></a>00016                                           MRAITIMER);
<a name="l00017"></a>00017 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="c147f8b7fd06df22000d2276209b20b7"></a><!-- doxytag: member="bgp-extern.h::bgp_notify" ref="c147f8b7fd06df22000d2276209b20b7" args="(bgp_state *state, tw_bf *bf, int src, tw_lp *lp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bgp_notify           </td>
          <td>(</td>
          <td class="paramtype">bgp_state *&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_bf *&nbsp;</td>
          <td class="paramname"> <em>bf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="bgp-notify_8c-source.html#l00029">29</a> of file <a class="el" href="bgp-notify_8c-source.html">bgp-notify.c</a>.</p>

<p>References <a class="el" href="bgp-nbr_8c-source.html#l00007">bgp_getnbr()</a>.</p>

<p>Referenced by <a class="el" href="bgp-router_8c-source.html#l00004">bgp_event_handler()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00030"></a>00030 {
<a name="l00031"></a>00031         bgp_nbr         *n;
<a name="l00032"></a>00032 
<a name="l00033"></a>00033         n = <a class="code" href="bgp-extern_8h.html#5ed527027df1ef2895f4a8b3642dc991">bgp_getnbr</a>(state, src);
<a name="l00034"></a>00034 
<a name="l00035"></a>00035 <span class="preprocessor">#if VERIFY_BGP</span>
<a name="l00036"></a>00036 <span class="preprocessor"></span>        printf(<span class="stringliteral">"%ld BGP: lost contact with %d \n"</span>, lp-&gt;id, n-&gt;id);
<a name="l00037"></a>00037 <span class="preprocessor">#endif</span>
<a name="l00038"></a>00038 <span class="preprocessor"></span>
<a name="l00039"></a>00039         <span class="comment">//msg-&gt;old_last_update = n-&gt;last_update;</span>
<a name="l00040"></a>00040         n-&gt;last_update = floor(tw_now(lp)) - state-&gt;as-&gt;hold_interval; <span class="comment">// - state-&gt;mrai;</span>
<a name="l00041"></a>00041 
<a name="l00042"></a>00042         bf-&gt;c1 = 1;
<a name="l00043"></a>00043 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="4fa53b04dce94d8076cde40e189b63a4"></a><!-- doxytag: member="bgp-extern.h::bgp_notify_send" ref="4fa53b04dce94d8076cde40e189b63a4" args="(bgp_state *, bgp_nbr *n, tw_lp *lp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bgp_notify_send           </td>
          <td>(</td>
          <td class="paramtype">bgp_state *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bgp_nbr *&nbsp;</td>
          <td class="paramname"> <em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="bgp-notify_8c-source.html#l00004">4</a> of file <a class="el" href="bgp-notify_8c-source.html">bgp-notify.c</a>.</p>

<p>References <a class="el" href="bgp-types_8h-source.html#l00016">BGP_NOTIFY</a>, <a class="el" href="rn-types_8h-source.html#l00055">DOWNSTREAM</a>, <a class="el" href="bgp-global_8c-source.html#l00010">g_bgp_fd</a>, <a class="el" href="rn-event_8c-source.html#l00058">rn_event_new()</a>, and <a class="el" href="rn-event_8c-source.html#l00173">rn_event_send()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00005"></a>00005 {
<a name="l00006"></a>00006         tw_event        *e;
<a name="l00007"></a>00007         tw_memory       *hdr;
<a name="l00008"></a>00008 
<a name="l00009"></a>00009         bgp_message     *m;
<a name="l00010"></a>00010 
<a name="l00011"></a>00011         state-&gt;stats-&gt;s_nnotify_sent++;
<a name="l00012"></a>00012         e = <a class="code" href="rn-event_8c.html#5508bcf53c1fbeb71e6055021634a726">rn_event_new</a>(n-&gt;id, 0.0, lp, <a class="code" href="rn-types_8h.html#3fc738f2924cae2b2d04a9a133c3ef02193085e792a05c4538ec2bc24c845652">DOWNSTREAM</a>, <a class="code" href="bgp-types_8h.html#81764e32e431942221cbcc6bee9b950a">BGP_NOTIFY</a>);
<a name="l00013"></a>00013 
<a name="l00014"></a>00014         hdr = tw_memory_alloc(lp, <a class="code" href="bgp-extern_8h.html#0c0827f912b6c5550b6dfaa922b3fdc9">g_bgp_fd</a>);
<a name="l00015"></a>00015         m = tw_memory_data(hdr);
<a name="l00016"></a>00016 
<a name="l00017"></a>00017         m-&gt;b.type = NOTIFICATION;
<a name="l00018"></a>00018 
<a name="l00019"></a>00019         tw_event_memory_set(e, hdr, <a class="code" href="bgp-extern_8h.html#0c0827f912b6c5550b6dfaa922b3fdc9">g_bgp_fd</a>);
<a name="l00020"></a>00020         <a class="code" href="rn-event_8c.html#8c3496e774b118a7e411ea5bcd23d49a">rn_event_send</a>(e);
<a name="l00021"></a>00021 
<a name="l00022"></a>00022 <span class="preprocessor">#if VERIFY_BGP</span>
<a name="l00023"></a>00023 <span class="preprocessor"></span>        fprintf(state-&gt;log, <span class="stringliteral">"\tsent notify to nbr %d at %f\n"</span>, n-&gt;id, tw_now(lp));
<a name="l00024"></a>00024 <span class="preprocessor">#endif</span>
<a name="l00025"></a>00025 <span class="preprocessor"></span>}
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="037961ede688c23e798d7f8c0e995001"></a><!-- doxytag: member="bgp-extern.h::bgp_open" ref="037961ede688c23e798d7f8c0e995001" args="(bgp_state *, tw_bf *, bgp_message *, int, tw_lp *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bgp_open           </td>
          <td>(</td>
          <td class="paramtype">bgp_state *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_bf *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bgp_message *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="bgp-open_8c-source.html#l00048">48</a> of file <a class="el" href="bgp-open_8c-source.html">bgp-open.c</a>.</p>

<p>References <a class="el" href="bgp-nbr_8c-source.html#l00007">bgp_getnbr()</a>, <a class="el" href="bgp-update_8c-source.html#l00007">bgp_update_send()</a>, <a class="el" href="rn-global_8c-source.html#l00043">g_rn_nas</a>, <a class="el" href="rn-machine_8c-source.html#l00028">rn_getas()</a>, and <a class="el" href="rn-machine_8c-source.html#l00004">rn_getmachine()</a>.</p>

<p>Referenced by <a class="el" href="bgp-router_8c-source.html#l00004">bgp_event_handler()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00049"></a>00049 {
<a name="l00050"></a>00050         tw_memory      *b;
<a name="l00051"></a>00051 
<a name="l00052"></a>00052         bgp_route       *r;
<a name="l00053"></a>00053         bgp_nbr         *n;
<a name="l00054"></a>00054 
<a name="l00055"></a>00055         <span class="keywordtype">int</span>              i;
<a name="l00056"></a>00056 
<a name="l00057"></a>00057         state-&gt;stats-&gt;d_opens = 1;
<a name="l00058"></a>00058         state-&gt;stats-&gt;s_nopens++;
<a name="l00059"></a>00059 
<a name="l00060"></a>00060         <span class="comment">// set the nbr to up</span>
<a name="l00061"></a>00061         n = <a class="code" href="bgp-extern_8h.html#5ed527027df1ef2895f4a8b3642dc991">bgp_getnbr</a>(state, src);
<a name="l00062"></a>00062         <span class="comment">//n-&gt;up = TW_TRUE;</span>
<a name="l00063"></a>00063 
<a name="l00064"></a>00064         <span class="comment">// send a keepalive in response to the open</span>
<a name="l00065"></a>00065         <span class="comment">//bgp_keepalive_send(n, lp);</span>
<a name="l00066"></a>00066 
<a name="l00067"></a>00067         <span class="comment">// now we will send this neighbor our full routing table</span>
<a name="l00068"></a>00068         <span class="comment">// reflection: only send down in the BGP hierarchy</span>
<a name="l00069"></a>00069 
<a name="l00070"></a>00070 <span class="preprocessor">#if VERIFY_BGP</span>
<a name="l00071"></a>00071 <span class="preprocessor"></span>        fprintf(state-&gt;log, <span class="stringliteral">"\tsending routing table to %d\n"</span>, n-&gt;id);
<a name="l00072"></a>00072 <span class="preprocessor">#endif</span>
<a name="l00073"></a>00073 <span class="preprocessor"></span>
<a name="l00074"></a>00074         <span class="comment">/*</span>
<a name="l00075"></a>00075 <span class="comment">         * If route source is down (timed out) and iBGP node,</span>
<a name="l00076"></a>00076 <span class="comment">         * then some internal OSPF route must have changed.</span>
<a name="l00077"></a>00077 <span class="comment">         *</span>
<a name="l00078"></a>00078 <span class="comment">         * If an eBGP node has timed out, it is not due to OSPF.</span>
<a name="l00079"></a>00079 <span class="comment">         *</span>
<a name="l00080"></a>00080 <span class="comment">         * Send an update for each route in our routing table.</span>
<a name="l00081"></a>00081 <span class="comment">         */</span>
<a name="l00082"></a>00082         <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="rn-extern_8h.html#353089f1049e9e0d5160683103c17e62">g_rn_nas</a>; i++)
<a name="l00083"></a>00083         {
<a name="l00084"></a>00084                 <span class="keywordflow">if</span>(NULL == (b = state-&gt;rib[i]))
<a name="l00085"></a>00085                         <span class="keywordflow">continue</span>;
<a name="l00086"></a>00086 
<a name="l00087"></a>00087                 r = tw_memory_data(b);
<a name="l00088"></a>00088                 msg-&gt;b.update = 1;
<a name="l00089"></a>00089 
<a name="l00090"></a>00090                 <span class="comment">// If OPEN from iBGP node, do not append to AS_PATH</span>
<a name="l00091"></a>00091                 <span class="keywordflow">if</span>(<a class="code" href="rn-extern_8h.html#d3b2637627bbb86acf01b38d07495042">rn_getas</a>(<a class="code" href="rn-extern_8h.html#b586ebafc20ad652dd538635f5c816b0">rn_getmachine</a>(n-&gt;id)) == state-&gt;as)
<a name="l00092"></a>00092                 {
<a name="l00093"></a>00093                         <span class="keywordflow">if</span>(r-&gt;dst == state-&gt;as-&gt;id)
<a name="l00094"></a>00094                                 <span class="keywordflow">continue</span>;
<a name="l00095"></a>00095 
<a name="l00096"></a>00096                         <a class="code" href="bgp-extern_8h.html#496b5be995649aa5e3a0da073a317755">bgp_update_send</a>(state, n, r, msg, 1, lp);
<a name="l00097"></a>00097                 } <span class="keywordflow">else</span>
<a name="l00098"></a>00098                 {
<a name="l00099"></a>00099                         <span class="keywordflow">if</span>(r-&gt;dst == <a class="code" href="rn-extern_8h.html#d3b2637627bbb86acf01b38d07495042">rn_getas</a>(<a class="code" href="rn-extern_8h.html#b586ebafc20ad652dd538635f5c816b0">rn_getmachine</a>(n-&gt;id))-&gt;id)
<a name="l00100"></a>00100                                 <span class="keywordflow">continue</span>;
<a name="l00101"></a>00101 
<a name="l00102"></a>00102                         <a class="code" href="bgp-extern_8h.html#496b5be995649aa5e3a0da073a317755">bgp_update_send</a>(state, n, r, msg, 0, lp);
<a name="l00103"></a>00103                 }
<a name="l00104"></a>00104         }
<a name="l00105"></a>00105 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="6b22cf4d43b6cb597d3c4b3d0ad97f9d"></a><!-- doxytag: member="bgp-extern.h::bgp_open_send" ref="6b22cf4d43b6cb597d3c4b3d0ad97f9d" args="(bgp_state *, bgp_nbr *n, tw_lp *lp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bgp_open_send           </td>
          <td>(</td>
          <td class="paramtype">bgp_state *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bgp_nbr *&nbsp;</td>
          <td class="paramname"> <em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="bgp-open_8c-source.html#l00004">4</a> of file <a class="el" href="bgp-open_8c-source.html">bgp-open.c</a>.</p>

<p>References <a class="el" href="bgp-types_8h-source.html#l00013">BGP_OPEN</a>, <a class="el" href="rn-types_8h-source.html#l00055">DOWNSTREAM</a>, <a class="el" href="bgp-global_8c-source.html#l00010">g_bgp_fd</a>, <a class="el" href="rn-event_8c-source.html#l00058">rn_event_new()</a>, <a class="el" href="rn-event_8c-source.html#l00173">rn_event_send()</a>, <a class="el" href="rn-machine_8c-source.html#l00028">rn_getas()</a>, and <a class="el" href="rn-machine_8c-source.html#l00004">rn_getmachine()</a>.</p>

<p>Referenced by <a class="el" href="bgp-keepalive_8c-source.html#l00042">bgp_keepalive()</a>, and <a class="el" href="bgp-keepalive_8c-source.html#l00113">bgp_keepalive_timer()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00005"></a>00005 {
<a name="l00006"></a>00006         tw_event        *e;
<a name="l00007"></a>00007         tw_memory       *b;
<a name="l00008"></a>00008 
<a name="l00009"></a>00009         bgp_message     *m;
<a name="l00010"></a>00010 
<a name="l00011"></a>00011         e = <a class="code" href="rn-event_8c.html#5508bcf53c1fbeb71e6055021634a726">rn_event_new</a>(n-&gt;id, 0.0, lp, <a class="code" href="rn-types_8h.html#3fc738f2924cae2b2d04a9a133c3ef02193085e792a05c4538ec2bc24c845652">DOWNSTREAM</a>, <a class="code" href="bgp-types_8h.html#f59e4909ae8c509378360acb4420a471">BGP_OPEN</a>);
<a name="l00012"></a>00012 
<a name="l00013"></a>00013         <span class="comment">// Create the BGP message header</span>
<a name="l00014"></a>00014         b = tw_memory_alloc(lp, <a class="code" href="bgp-extern_8h.html#0c0827f912b6c5550b6dfaa922b3fdc9">g_bgp_fd</a>);
<a name="l00015"></a>00015         m = tw_memory_data(b);
<a name="l00016"></a>00016         m-&gt;b.type = OPEN;
<a name="l00017"></a>00017 
<a name="l00018"></a>00018         <span class="comment">// Must be caused by OSPF route newly available to iBGP neighbor</span>
<a name="l00019"></a>00019         <span class="comment">// Also, to avoid counting on initial OPEN messages, tw_now &gt; 0.0</span>
<a name="l00020"></a>00020         <span class="keywordflow">if</span>(tw_now(lp) &gt; 0.0 &amp;&amp; state-&gt;as == <a class="code" href="rn-extern_8h.html#d3b2637627bbb86acf01b38d07495042">rn_getas</a>(<a class="code" href="rn-extern_8h.html#b586ebafc20ad652dd538635f5c816b0">rn_getmachine</a>(n-&gt;id)))
<a name="l00021"></a>00021         {
<a name="l00022"></a>00022                 m-&gt;b.cause_ospf = 1;
<a name="l00023"></a>00023                 m-&gt;b.cause_bgp = 0;
<a name="l00024"></a>00024         } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(tw_now(lp) &gt; 0.0)
<a name="l00025"></a>00025         {
<a name="l00026"></a>00026                 m-&gt;b.cause_ospf = 0;
<a name="l00027"></a>00027                 m-&gt;b.cause_bgp = 1;
<a name="l00028"></a>00028         } <span class="keywordflow">else</span>
<a name="l00029"></a>00029         {
<a name="l00030"></a>00030                 m-&gt;b.cause_ospf = 0;
<a name="l00031"></a>00031                 m-&gt;b.cause_bgp = 0;
<a name="l00032"></a>00032         }
<a name="l00033"></a>00033 
<a name="l00034"></a>00034         tw_event_memory_set(e, b, <a class="code" href="bgp-extern_8h.html#0c0827f912b6c5550b6dfaa922b3fdc9">g_bgp_fd</a>);
<a name="l00035"></a>00035 
<a name="l00036"></a>00036         <a class="code" href="rn-event_8c.html#8c3496e774b118a7e411ea5bcd23d49a">rn_event_send</a>(e);
<a name="l00037"></a>00037 
<a name="l00038"></a>00038 <span class="preprocessor">#if VERIFY_BGP</span>
<a name="l00039"></a>00039 <span class="preprocessor"></span>        fprintf(state-&gt;log, <span class="stringliteral">"%ld BGP: Send OPEN to %d\n"</span>, lp-&gt;id, n-&gt;id);
<a name="l00040"></a>00040 <span class="preprocessor">#endif</span>
<a name="l00041"></a>00041 <span class="preprocessor"></span>}
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="d5ded4c2c6117ea800399d494e17307e"></a><!-- doxytag: member="bgp-extern.h::bgp_ospf_flush" ref="d5ded4c2c6117ea800399d494e17307e" args="(bgp_state *, rn_as *, bgp_route *, int, tw_lp *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bgp_ospf_flush           </td>
          <td>(</td>
          <td class="paramtype">bgp_state *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">rn_as *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bgp_route *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="bgp-ospf_8c-source.html#l00330">330</a> of file <a class="el" href="bgp-ospf_8c-source.html">bgp-ospf.c</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00331"></a>00331 {
<a name="l00332"></a>00332         tw_error(TW_LOC, <span class="stringliteral">"argh"</span>);
<a name="l00333"></a>00333 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="9f09a0dfb45964426db4e112b31ed33d"></a><!-- doxytag: member="bgp-extern.h::bgp_ospf_init" ref="9f09a0dfb45964426db4e112b31ed33d" args="(bgp_state *bs, bgp_route *r, tw_lp *lp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bgp_ospf_init           </td>
          <td>(</td>
          <td class="paramtype">bgp_state *&nbsp;</td>
          <td class="paramname"> <em>bs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bgp_route *&nbsp;</td>
          <td class="paramname"> <em>r</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="bgp-ospf_8c-source.html#l00008">8</a> of file <a class="el" href="bgp-ospf_8c-source.html">bgp-ospf.c</a>.</p>

<p>References <a class="el" href="bgp-ospf_8c-source.html#l00203">bgp_lsa_find()</a>, <a class="el" href="ospf-database_8c-source.html#l00380">ospf_db_remove()</a>, <a class="el" href="ospf-database_8c-source.html#l00006">ospf_db_route()</a>, <a class="el" href="ospf-data-types_8h-source.html#l00016">OSPF_MIN_LSA_SEQNUM</a>, <a class="el" href="rn-machine_8c-source.html#l00022">rn_getarea()</a>, <a class="el" href="rn-machine_8c-source.html#l00004">rn_getmachine()</a>, <a class="el" href="rn-stream_8c-source.html#l00004">rn_getstream_byport()</a>, and <a class="el" href="ospf-global_8c-source.html#l00030">s</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00009"></a>00009 {
<a name="l00010"></a>00010         rn_lp_state     *rn_state;
<a name="l00011"></a>00011         rn_stream       *<a class="code" href="ospf-extern_8h.html#b4c6c03359486e6fb0ac52a94493df1e">s</a>;
<a name="l00012"></a>00012         rn_area         *ar;
<a name="l00013"></a>00013 
<a name="l00014"></a>00014         ospf_state      *state;
<a name="l00015"></a>00015 
<a name="l00016"></a>00016         ospf_db_entry   *dbe;
<a name="l00017"></a>00017 
<a name="l00018"></a>00018         <span class="keywordtype">int</span>              entry;
<a name="l00019"></a>00019 
<a name="l00020"></a>00020         ar = <a class="code" href="rn-extern_8h.html#d45bc39e5a89bce656786b571acb1ae8">rn_getarea</a>(<a class="code" href="rn-extern_8h.html#b586ebafc20ad652dd538635f5c816b0">rn_getmachine</a>(lp-&gt;id));
<a name="l00021"></a>00021         entry = ar-&gt;nmachines + ar-&gt;as-&gt;nareas + r-&gt;dst;
<a name="l00022"></a>00022 
<a name="l00023"></a>00023         rn_state = lp-&gt;cur_state;
<a name="l00024"></a>00024         s = <a class="code" href="rn-extern_8h.html#70fa5882507af4b8bd22a59ab93cfa30">rn_getstream_byport</a>(rn_state, 23);
<a name="l00025"></a>00025 
<a name="l00026"></a>00026         <span class="keywordflow">if</span>(!s || s-&gt;port != 23)
<a name="l00027"></a>00027                 <span class="keywordflow">return</span>;
<a name="l00028"></a>00028 
<a name="l00029"></a>00029         state = s-&gt;layers[0].lp.cur_state;
<a name="l00030"></a>00030         dbe = &amp;state-&gt;db[entry];
<a name="l00031"></a>00031 
<a name="l00032"></a>00032         <span class="comment">/*** CANNOT RE-BUILD ROUTING TABLES !!! ***/</span>
<a name="l00033"></a>00033 
<a name="l00034"></a>00034         <span class="keywordflow">if</span>(NULL == r)
<a name="l00035"></a>00035         {
<a name="l00036"></a>00036                 <span class="comment">// remove from database</span>
<a name="l00037"></a>00037                 <a class="code" href="ospf-database_8c.html#32f38a24ced7e66d2a7c106ae0c7cbf6">ospf_db_remove</a>(state, entry, lp);
<a name="l00038"></a>00038         } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(1 == dbe-&gt;b.free)
<a name="l00039"></a>00039         {
<a name="l00040"></a>00040                 <span class="comment">// insert into DB</span>
<a name="l00041"></a>00041                 dbe-&gt;b.age = 0;
<a name="l00042"></a>00042                 dbe-&gt;b.free = 0;
<a name="l00043"></a>00043                 dbe-&gt;b.entry = entry;
<a name="l00044"></a>00044                 dbe-&gt;seqnum = <a class="code" href="ospf-data-types_8h.html#046cf2935a363d19e94b7ce7ffac27ed">OSPF_MIN_LSA_SEQNUM</a>;
<a name="l00045"></a>00045                 dbe-&gt;lsa = <a class="code" href="bgp-ospf_8c.html#cdb16c8387fc627bb7e224b9d0f12c6c">bgp_lsa_find</a>(bs, state, r, entry, lp);
<a name="l00046"></a>00046 
<a name="l00047"></a>00047                 <a class="code" href="ospf-database_8c.html#9ad2afaaa16ce23be59af9c6b159f321">ospf_db_route</a>(state, dbe, lp);
<a name="l00048"></a>00048         } <span class="keywordflow">else</span>
<a name="l00049"></a>00049         {
<a name="l00050"></a>00050                 <span class="comment">// update database</span>
<a name="l00051"></a>00051                 dbe = &amp;state-&gt;db[entry];
<a name="l00052"></a>00052 
<a name="l00053"></a>00053                 dbe-&gt;b.age = 0;
<a name="l00054"></a>00054                 dbe-&gt;b.free = 0;
<a name="l00055"></a>00055                 dbe-&gt;b.entry = entry;
<a name="l00056"></a>00056                 dbe-&gt;seqnum = <a class="code" href="ospf-data-types_8h.html#046cf2935a363d19e94b7ce7ffac27ed">OSPF_MIN_LSA_SEQNUM</a>;
<a name="l00057"></a>00057                 dbe-&gt;lsa = <a class="code" href="bgp-ospf_8c.html#cdb16c8387fc627bb7e224b9d0f12c6c">bgp_lsa_find</a>(bs, state, r, entry, lp);
<a name="l00058"></a>00058 
<a name="l00059"></a>00059                 <a class="code" href="ospf-database_8c.html#9ad2afaaa16ce23be59af9c6b159f321">ospf_db_route</a>(state, dbe, lp);
<a name="l00060"></a>00060         }
<a name="l00061"></a>00061 
<a name="l00062"></a>00062 <span class="preprocessor">#if VERIFY_BGP</span>
<a name="l00063"></a>00063 <span class="preprocessor"></span>        fprintf(bs-&gt;log, <span class="stringliteral">"\tinitialized OSPF lsa: AS %d, LSA %d \n"</span>, 
<a name="l00064"></a>00064                 r-&gt;dst, entry);
<a name="l00065"></a>00065 <span class="preprocessor">#endif</span>
<a name="l00066"></a>00066 <span class="preprocessor"></span>}
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="25cf78022511c7500c4fba258fe99071"></a><!-- doxytag: member="bgp-extern.h::bgp_ospf_update" ref="25cf78022511c7500c4fba258fe99071" args="(bgp_state *, rn_as *, bgp_route *, int, tw_lp *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bgp_ospf_update           </td>
          <td>(</td>
          <td class="paramtype">bgp_state *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">rn_as *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bgp_route *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="bgp-ospf_8c-source.html#l00070">70</a> of file <a class="el" href="bgp-ospf_8c-source.html">bgp-ospf.c</a>.</p>

<p>References <a class="el" href="bgp-ospf_8c-source.html#l00203">bgp_lsa_find()</a>, <a class="el" href="ospf-lsa_8c-source.html#l00247">getlsa()</a>, <a class="el" href="ospf-lsa_8c-source.html#l00527">ospf_lsa_create()</a>, <a class="el" href="ospf-global_8c-source.html#l00021">OSPF_LSA_MAX_AGE</a>, <a class="el" href="rn-machine_8c-source.html#l00022">rn_getarea()</a>, <a class="el" href="rn-machine_8c-source.html#l00004">rn_getmachine()</a>, <a class="el" href="rn-stream_8c-source.html#l00004">rn_getstream_byport()</a>, and <a class="el" href="ospf-global_8c-source.html#l00030">s</a>.</p>

<p>Referenced by <a class="el" href="bgp-keepalive_8c-source.html#l00156">deal_with_timed_out_routers()</a>, <a class="el" href="bgp-update_8c-source.html#l00135">update_add()</a>, and <a class="el" href="bgp-update_8c-source.html#l00229">update_withdraw()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00071"></a>00071 {
<a name="l00072"></a>00072 <span class="preprocessor">#ifdef HAVE_OSPF_H</span>
<a name="l00073"></a>00073 <span class="preprocessor"></span>        tw_lp           *cur_lp;
<a name="l00074"></a>00074 
<a name="l00075"></a>00075         rn_lp_state     *rn_state;
<a name="l00076"></a>00076         rn_area         *ar;
<a name="l00077"></a>00077         rn_stream       *<a class="code" href="ospf-extern_8h.html#b4c6c03359486e6fb0ac52a94493df1e">s</a>;
<a name="l00078"></a>00078 
<a name="l00079"></a>00079         ospf_state      *state;
<a name="l00080"></a>00080 
<a name="l00081"></a>00081         ospf_db_entry   *dbe;
<a name="l00082"></a>00082         ospf_lsa        *old_lsa;
<a name="l00083"></a>00083         ospf_nbr         nbr;
<a name="l00084"></a>00084 
<a name="l00085"></a>00085         <span class="keywordtype">int</span>              entry;
<a name="l00086"></a>00086         <span class="keywordtype">int</span>              cur_stream;
<a name="l00087"></a>00087 
<a name="l00088"></a>00088         ar = <a class="code" href="rn-extern_8h.html#d45bc39e5a89bce656786b571acb1ae8">rn_getarea</a>(<a class="code" href="rn-extern_8h.html#b586ebafc20ad652dd538635f5c816b0">rn_getmachine</a>(lp-&gt;id));
<a name="l00089"></a>00089         entry = ar-&gt;nmachines + ar-&gt;as-&gt;nareas + dest_as-&gt;id;
<a name="l00090"></a>00090 
<a name="l00091"></a>00091         <span class="comment">// Get the OSPF router state</span>
<a name="l00092"></a>00092         rn_state = lp-&gt;cur_state;
<a name="l00093"></a>00093         cur_stream = rn_state-&gt;cur_stream;
<a name="l00094"></a>00094         cur_lp = rn_state-&gt;cur_lp;
<a name="l00095"></a>00095 
<a name="l00096"></a>00096         s = <a class="code" href="rn-extern_8h.html#70fa5882507af4b8bd22a59ab93cfa30">rn_getstream_byport</a>(rn_state, 23);
<a name="l00097"></a>00097 
<a name="l00098"></a>00098         <span class="keywordflow">if</span>(!s || s-&gt;port != 23)
<a name="l00099"></a>00099         {
<a name="l00100"></a>00100                 printf(<span class="stringliteral">"%ld: Did not send update (%d) to OSPF! \n"</span>, lp-&gt;id, <span class="keyword">add</span>);
<a name="l00101"></a>00101                 rn_state-&gt;cur_stream = cur_stream;
<a name="l00102"></a>00102 
<a name="l00103"></a>00103                 <span class="keywordflow">return</span>;
<a name="l00104"></a>00104         }
<a name="l00105"></a>00105 
<a name="l00106"></a>00106         state = s-&gt;layers[0].lp.cur_state;
<a name="l00107"></a>00107         rn_state-&gt;cur_lp = &amp;s-&gt;layers[0].lp;
<a name="l00108"></a>00108 
<a name="l00109"></a>00109         <span class="comment">// Get and fill in the new LSA</span>
<a name="l00110"></a>00110         dbe = &amp;state-&gt;db[entry];
<a name="l00111"></a>00111 
<a name="l00112"></a>00112 <span class="comment">/*</span>
<a name="l00113"></a>00113 <span class="comment">        You *MUST* restore the cur_stream and cur_lp pointers</span>
<a name="l00114"></a>00114 <span class="comment">        BEFORE return-ing from this function!!!!!!!!!!!!!!!!!</span>
<a name="l00115"></a>00115 <span class="comment"></span>
<a name="l00116"></a>00116 <span class="comment">        If you don't, future BGP pkts will go to OSPF on the</span>
<a name="l00117"></a>00117 <span class="comment">        other side of the connection!</span>
<a name="l00118"></a>00118 <span class="comment">*/</span>
<a name="l00119"></a>00119 
<a name="l00120"></a>00120         <span class="keywordflow">if</span>(<span class="keyword">add</span> &amp;&amp; dbe-&gt;b.free == 0)
<a name="l00121"></a>00121         {
<a name="l00122"></a>00122                 <span class="comment">// If multiple possible originators,</span>
<a name="l00123"></a>00123                 <span class="comment">// rtr w/ &gt; id is originator.  </span>
<a name="l00124"></a>00124                 <span class="comment">// Eliminates oscillation / duplicate effort</span>
<a name="l00125"></a>00125                 old_lsa = <a class="code" href="ospf-extern_8h.html#9608d8ba29ae5cc559afe788cddade3f">getlsa</a>(state-&gt;m, dbe-&gt;lsa, entry);
<a name="l00126"></a>00126 
<a name="l00127"></a>00127                 <span class="keywordflow">if</span>(old_lsa &amp;&amp; lp-&gt;id &lt; old_lsa-&gt;adv_r)
<a name="l00128"></a>00128                 {
<a name="l00129"></a>00129                         rn_state-&gt;cur_lp = cur_lp;
<a name="l00130"></a>00130                         rn_state-&gt;cur_stream = cur_stream;
<a name="l00131"></a>00131 
<a name="l00132"></a>00132                         <span class="keywordflow">return</span>;
<a name="l00133"></a>00133                 }
<a name="l00134"></a>00134 
<a name="l00135"></a>00135                 <span class="comment">// No need to change LSA is route src has not changed!</span>
<a name="l00136"></a>00136                 <span class="keywordflow">if</span>(old_lsa)
<a name="l00137"></a>00137                 {
<a name="l00138"></a>00138                         ospf_lsa_link *l = tw_memory_data(old_lsa-&gt;links.head);
<a name="l00139"></a>00139 
<a name="l00140"></a>00140                         <span class="keywordflow">if</span>(l-&gt;dst == r-&gt;src &amp;&amp; old_lsa-&gt;adv_r == lp-&gt;id)
<a name="l00141"></a>00141                         {
<a name="l00142"></a>00142                                 rn_state-&gt;cur_lp = cur_lp;
<a name="l00143"></a>00143                                 rn_state-&gt;cur_stream = cur_stream;
<a name="l00144"></a>00144 
<a name="l00145"></a>00145                                 <span class="keywordflow">return</span>;
<a name="l00146"></a>00146                         }
<a name="l00147"></a>00147                 }
<a name="l00148"></a>00148         }
<a name="l00149"></a>00149 
<a name="l00150"></a>00150         <span class="comment">/*</span>
<a name="l00151"></a>00151 <span class="comment">         * Construct the DB entry we need, and have OSPF process it.</span>
<a name="l00152"></a>00152 <span class="comment">         * If we wanted to connect BGP to OSPF on different routers,</span>
<a name="l00153"></a>00153 <span class="comment">         * we would simply need to send the OSPF node an UPDATE message</span>
<a name="l00154"></a>00154 <span class="comment">         */</span>
<a name="l00155"></a>00155         <span class="comment">//dbe-&gt;b.entry = entry;</span>
<a name="l00156"></a>00156         dbe-&gt;cause_bgp = 1;
<a name="l00157"></a>00157         dbe-&gt;lsa = <a class="code" href="bgp-ospf_8c.html#cdb16c8387fc627bb7e224b9d0f12c6c">bgp_lsa_find</a>(bs, state, r, entry, lp);
<a name="l00158"></a>00158 
<a name="l00159"></a>00159         nbr.id = r-&gt;src;
<a name="l00160"></a>00160         nbr.state = ospf_nbr_full_st;
<a name="l00161"></a>00161 
<a name="l00162"></a>00162         <span class="keywordflow">if</span>(<span class="keyword">add</span>)
<a name="l00163"></a>00163         {
<a name="l00164"></a>00164                 dbe-&gt;b.age = 0;
<a name="l00165"></a>00165                 dbe-&gt;b.free = 0;
<a name="l00166"></a>00166                 dbe-&gt;seqnum = state-&gt;lsa_seqnum;
<a name="l00167"></a>00167                 <a class="code" href="ospf-extern_8h.html#90f786d8f758711eb5797ff19ca0097b">ospf_lsa_create</a>(state, &amp;nbr, entry, lp);
<a name="l00168"></a>00168         } <span class="keywordflow">else</span>
<a name="l00169"></a>00169         {
<a name="l00170"></a>00170                 <span class="keywordflow">if</span>(dbe-&gt;b.free)
<a name="l00171"></a>00171                 {
<a name="l00172"></a>00172                         rn_state-&gt;cur_stream = cur_stream;
<a name="l00173"></a>00173                         rn_state-&gt;cur_lp = cur_lp;
<a name="l00174"></a>00174                         <span class="keywordflow">return</span>;
<a name="l00175"></a>00175                 }
<a name="l00176"></a>00176 
<a name="l00177"></a>00177                 dbe-&gt;b.age = <a class="code" href="ospf-extern_8h.html#354846699ca7e45e6f42d17268d8fac2">OSPF_LSA_MAX_AGE</a>;
<a name="l00178"></a>00178                 <a class="code" href="ospf-extern_8h.html#90f786d8f758711eb5797ff19ca0097b">ospf_lsa_create</a>(state, &amp;nbr, entry, lp);
<a name="l00179"></a>00179                 dbe-&gt;b.free = 1;
<a name="l00180"></a>00180         }
<a name="l00181"></a>00181 
<a name="l00182"></a>00182         state-&gt;stats-&gt;s_cause_bgp++;
<a name="l00183"></a>00183 
<a name="l00184"></a>00184 <span class="preprocessor">#if VERIFY_BGP</span>
<a name="l00185"></a>00185 <span class="preprocessor"></span>        <span class="keywordflow">if</span>(<span class="keyword">add</span>)
<a name="l00186"></a>00186                 fprintf(bs-&gt;log, <span class="stringliteral">"\tinstalled lsa into OSPF! AS %d, LSA %d \n"</span>, 
<a name="l00187"></a>00187                         dest_as-&gt;id, entry);
<a name="l00188"></a>00188         <span class="keywordflow">else</span>
<a name="l00189"></a>00189                 fprintf(bs-&gt;log, <span class="stringliteral">"removed lsa from OSPF! \n"</span>);
<a name="l00190"></a>00190 <span class="preprocessor">#endif</span>
<a name="l00191"></a>00191 <span class="preprocessor"></span>
<a name="l00192"></a>00192         rn_state-&gt;cur_stream = cur_stream;
<a name="l00193"></a>00193         rn_state-&gt;cur_lp = cur_lp;
<a name="l00194"></a>00194 <span class="preprocessor">#endif</span>
<a name="l00195"></a>00195 <span class="preprocessor"></span>}
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="be38660a391e5fe149403e94cefa9150"></a><!-- doxytag: member="bgp-extern.h::bgp_r_event_handler" ref="be38660a391e5fe149403e94cefa9150" args="(bgp_state *, tw_bf *, rn_message *, tw_lp *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bgp_r_event_handler           </td>
          <td>(</td>
          <td class="paramtype">bgp_state *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_bf *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">rn_message *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="bgp-rc-router_8c-source.html#l00179">179</a> of file <a class="el" href="bgp-rc-router_8c-source.html">bgp-rc-router.c</a>.</p>

<p>References <a class="el" href="bgp-nbr_8c-source.html#l00007">bgp_getnbr()</a>, <a class="el" href="bgp-rc-router_8c-source.html#l00021">r_msg_keepalive()</a>, <a class="el" href="bgp-rc-router_8c-source.html#l00127">r_msg_keepalivetimer()</a>, <a class="el" href="bgp-rc-router_8c-source.html#l00004">r_msg_open()</a>, <a class="el" href="bgp-rc-router_8c-source.html#l00027">r_msg_update()</a>, and <a class="el" href="rn-message_8c-source.html#l00016">rn_message_data()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00180"></a>00180 {
<a name="l00181"></a>00181 
<a name="l00182"></a>00182         bgp_message    *msg;
<a name="l00183"></a>00183         bgp_nbr         *n;
<a name="l00184"></a>00184 
<a name="l00185"></a>00185         msg = <a class="code" href="rn-extern_8h.html#86476e44643558d9a2008c976220a0a3">rn_message_data</a>(rn_msg);
<a name="l00186"></a>00186 
<a name="l00187"></a>00187         <span class="keywordflow">switch</span> (msg-&gt;type)
<a name="l00188"></a>00188         {
<a name="l00189"></a>00189         <span class="keywordflow">case</span> OPEN:
<a name="l00190"></a>00190                 {
<a name="l00191"></a>00191                         <span class="comment">// open bgp_message</span>
<a name="l00192"></a>00192                         <a class="code" href="bgp-rc-router_8c.html#6766975f0feba3cd4789906d68b22f8b">r_msg_open</a>(state, bf, msg, lp);
<a name="l00193"></a>00193                         <span class="keywordflow">break</span>;
<a name="l00194"></a>00194                 }
<a name="l00195"></a>00195         <span class="keywordflow">case</span> KEEPALIVE:
<a name="l00196"></a>00196                 {
<a name="l00197"></a>00197                         <span class="comment">// keepalive bgp_message</span>
<a name="l00198"></a>00198                         <a class="code" href="bgp-rc-router_8c.html#2c9c939fe71424e3e0c40220df4f02a6">r_msg_keepalive</a>(state, bf, msg, lp);
<a name="l00199"></a>00199                         <span class="keywordflow">break</span>;
<a name="l00200"></a>00200                 }
<a name="l00201"></a>00201         <span class="keywordflow">case</span> UPDATE:
<a name="l00202"></a>00202                 {
<a name="l00203"></a>00203                         <span class="comment">// update bgp_message</span>
<a name="l00204"></a>00204                         <a class="code" href="bgp-rc-router_8c.html#f11b83a2149787c460b427d8664c7090">r_msg_update</a>(state, bf, msg, lp);
<a name="l00205"></a>00205                         <span class="keywordflow">break</span>;
<a name="l00206"></a>00206                 }
<a name="l00207"></a>00207         <span class="keywordflow">case</span> NOTIFICATION:
<a name="l00208"></a>00208                 {
<a name="l00209"></a>00209                         <span class="comment">// notification (error) bgp_message</span>
<a name="l00210"></a>00210                         <span class="comment">// r_msg_notification(state, bf, msg, lp);</span>
<a name="l00211"></a>00211                         <span class="keywordflow">break</span>;
<a name="l00212"></a>00212                 }
<a name="l00213"></a>00213         <span class="keywordflow">case</span> KEEPALIVETIMER:
<a name="l00214"></a>00214                 {
<a name="l00215"></a>00215                         <span class="comment">// keepalive timer event</span>
<a name="l00216"></a>00216                         <span class="comment">// r_deal_with_timed_out_routers(state, bf, msg, lp);</span>
<a name="l00217"></a>00217                         <a class="code" href="bgp-rc-router_8c.html#fb986cb95e00f60ade5a54645b11b208">r_msg_keepalivetimer</a>(state, bf, msg, lp);
<a name="l00218"></a>00218                         <span class="keywordflow">break</span>;
<a name="l00219"></a>00219                 }
<a name="l00220"></a>00220         <span class="keywordflow">default</span>:
<a name="l00221"></a>00221                 printf(<span class="stringliteral">"Unhandled message type: %d \n"</span>, msg-&gt;type);
<a name="l00222"></a>00222         }
<a name="l00223"></a>00223 
<a name="l00224"></a>00224         n = <a class="code" href="bgp-extern_8h.html#5ed527027df1ef2895f4a8b3642dc991">bgp_getnbr</a>(state, msg-&gt;src);
<a name="l00225"></a>00225         n-&gt;last_update = msg-&gt;old_last_update;
<a name="l00226"></a>00226         n-&gt;up = msg-&gt;was_up;
<a name="l00227"></a>00227 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="2b77b435184207db72886c00a74dfd21"></a><!-- doxytag: member="bgp-extern.h::bgp_rib_print" ref="2b77b435184207db72886c00a74dfd21" args="(bgp_state *state, tw_lp *lp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bgp_rib_print           </td>
          <td>(</td>
          <td class="paramtype">bgp_state *&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="bgp-route_8c-source.html#l00360">360</a> of file <a class="el" href="bgp-route_8c-source.html">bgp-route.c</a>.</p>

<p>References <a class="el" href="bgp-route_8c-source.html#l00350">bgp_route_print()</a>, <a class="el" href="rn-global_8c-source.html#l00043">g_rn_nas</a>, <a class="el" href="rn-machine_8c-source.html#l00028">rn_getas()</a>, and <a class="el" href="rn-machine_8c-source.html#l00004">rn_getmachine()</a>.</p>

<p>Referenced by <a class="el" href="bgp-stats_8c-source.html#l00004">bgp_final()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00361"></a>00361 {
<a name="l00362"></a>00362 <span class="preprocessor">#if VERIFY_BGP</span>
<a name="l00363"></a>00363 <span class="preprocessor"></span>        tw_memory       *b;
<a name="l00364"></a>00364 
<a name="l00365"></a>00365         rn_as           *as;
<a name="l00366"></a>00366         rn_machine      *m;
<a name="l00367"></a>00367 
<a name="l00368"></a>00368         bgp_route       *r;
<a name="l00369"></a>00369 
<a name="l00370"></a>00370         <span class="keywordtype">int</span>              offset;
<a name="l00371"></a>00371         <span class="keywordtype">int</span>              i;
<a name="l00372"></a>00372 
<a name="l00373"></a>00373         m = <a class="code" href="rn-extern_8h.html#b586ebafc20ad652dd538635f5c816b0">rn_getmachine</a>(lp-&gt;id);
<a name="l00374"></a>00374         as = <a class="code" href="rn-extern_8h.html#d3b2637627bbb86acf01b38d07495042">rn_getas</a>(m);
<a name="l00375"></a>00375 
<a name="l00376"></a>00376         fprintf(state-&gt;log, <span class="stringliteral">"\nRouting Information Base (RIB): Node %ld, AS %d\n"</span>, 
<a name="l00377"></a>00377                 lp-&gt;id, as-&gt;id);
<a name="l00378"></a>00378         fprintf(state-&gt;log, <span class="stringliteral">"%-10s%-10s%-10s%-10s%-10s%-10s\n"</span>, 
<a name="l00379"></a>00379                 <span class="stringliteral">"Dest"</span>, <span class="stringliteral">"NHI"</span>, <span class="stringliteral">"NHI Node"</span>, <span class="stringliteral">"MED"</span>, <span class="stringliteral">"ORIGIN"</span>, <span class="stringliteral">" #  AS Path"</span>);
<a name="l00380"></a>00380 
<a name="l00381"></a>00381         offset = m-&gt;subnet-&gt;area-&gt;nmachines + as-&gt;nareas;
<a name="l00382"></a>00382 
<a name="l00383"></a>00383         <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="rn-extern_8h.html#353089f1049e9e0d5160683103c17e62">g_rn_nas</a>; i++)
<a name="l00384"></a>00384         {
<a name="l00385"></a>00385                 <span class="keywordflow">if</span>(NULL == (b = state-&gt;rib[i]))
<a name="l00386"></a>00386                         <span class="keywordflow">continue</span>;
<a name="l00387"></a>00387 
<a name="l00388"></a>00388                 r = tw_memory_data(b);
<a name="l00389"></a>00389 
<a name="l00390"></a>00390                 <span class="keywordflow">if</span>(r-&gt;dst == as-&gt;id)
<a name="l00391"></a>00391                 {
<a name="l00392"></a>00392                         <a class="code" href="bgp-extern_8h.html#14a9a4b8da17993c0c3b37f43ecd0644">bgp_route_print</a>(state, r);
<a name="l00393"></a>00393                         fprintf(state-&gt;log, <span class="stringliteral">"\n"</span>);
<a name="l00394"></a>00394                 } <span class="keywordflow">else</span>
<a name="l00395"></a>00395                 {
<a name="l00396"></a>00396                         <a class="code" href="bgp-extern_8h.html#14a9a4b8da17993c0c3b37f43ecd0644">bgp_route_print</a>(state, r);
<a name="l00397"></a>00397                         fprintf(state-&gt;log, <span class="stringliteral">"\n"</span>);
<a name="l00398"></a>00398                 }
<a name="l00399"></a>00399         }
<a name="l00400"></a>00400 <span class="preprocessor">#endif</span>
<a name="l00401"></a>00401 <span class="preprocessor"></span>}
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="1a40f199f8cdc9503b572859ee63ba77"></a><!-- doxytag: member="bgp-extern.h::bgp_route_add" ref="1a40f199f8cdc9503b572859ee63ba77" args="(bgp_state *state, tw_memory *b)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bgp_route_add           </td>
          <td>(</td>
          <td class="paramtype">bgp_state *&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_memory *&nbsp;</td>
          <td class="paramname"> <em>b</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="bgp-route_8c-source.html#l00073">73</a> of file <a class="el" href="bgp-route_8c-source.html">bgp-route.c</a>.</p>

<p>References <a class="el" href="bgp-mrai_8c-source.html#l00007">bgp_mrai_tmr()</a>, <a class="el" href="bgp-route_8c-source.html#l00350">bgp_route_print()</a>, <a class="el" href="rn-machine_8c-source.html#l00022">rn_getarea()</a>, <a class="el" href="rn-machine_8c-source.html#l00028">rn_getas()</a>, <a class="el" href="rn-link_8c-source.html#l00017">rn_getlink()</a>, <a class="el" href="rn-machine_8c-source.html#l00004">rn_getmachine()</a>, <a class="el" href="rn-routing_8c-source.html#l00007">rn_route()</a>, and <a class="el" href="rn-routing_8c-source.html#l00048">rn_route_change()</a>.</p>

<p>Referenced by <a class="el" href="bgp-init_8c-source.html#l00070">bgp_init()</a>, and <a class="el" href="bgp-update_8c-source.html#l00135">update_add()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00074"></a>00074 {
<a name="l00075"></a>00075         rn_link         *l;
<a name="l00076"></a>00076         rn_area         *ar;
<a name="l00077"></a>00077 
<a name="l00078"></a>00078         bgp_route       *r;
<a name="l00079"></a>00079 
<a name="l00080"></a>00080         <span class="keywordtype">int</span>              offset;
<a name="l00081"></a>00081         <span class="keywordtype">int</span>              nhi;
<a name="l00082"></a>00082         <span class="keywordtype">int</span>              dst;
<a name="l00083"></a>00083         <span class="keywordtype">int</span>              i;
<a name="l00084"></a>00084 
<a name="l00085"></a>00085         ar = <a class="code" href="rn-extern_8h.html#d45bc39e5a89bce656786b571acb1ae8">rn_getarea</a>(state-&gt;m);
<a name="l00086"></a>00086         r = tw_memory_data(b);
<a name="l00087"></a>00087 
<a name="l00088"></a>00088         nhi = -1;
<a name="l00089"></a>00089         offset = ar-&gt;nmachines + ar-&gt;as-&gt;nareas;
<a name="l00090"></a>00090 
<a name="l00091"></a>00091         <span class="keywordflow">if</span>(state-&gt;rib[r-&gt;dst] != NULL)
<a name="l00092"></a>00092                 tw_error(TW_LOC, <span class="stringliteral">"Over-writing route for AS %d!"</span>, r-&gt;dst);
<a name="l00093"></a>00093 
<a name="l00094"></a>00094         state-&gt;rib[r-&gt;dst] = b;
<a name="l00095"></a>00095 
<a name="l00096"></a>00096         <span class="comment">// reset the MRAI timer as needed</span>
<a name="l00097"></a>00097         b-&gt;bit = TW_TRUE;
<a name="l00098"></a>00098         <a class="code" href="bgp-extern_8h.html#da4aa0f47640a7070edb5cff82efef4e">bgp_mrai_tmr</a>(state, tw_getlp(state-&gt;m-&gt;id));
<a name="l00099"></a>00099 
<a name="l00100"></a>00100         state-&gt;stats-&gt;s_nroute_adds++;
<a name="l00101"></a>00101 
<a name="l00102"></a>00102         <span class="comment">// Self-originated route</span>
<a name="l00103"></a>00103         <span class="keywordflow">if</span>(r-&gt;src == state-&gt;m-&gt;id)
<a name="l00104"></a>00104                 <span class="keywordflow">return</span>;
<a name="l00105"></a>00105 
<a name="l00106"></a>00106         l = <a class="code" href="rn-extern_8h.html#d7173e076af48912ba761e8ef0cc1b22">rn_getlink</a>(state-&gt;m, r-&gt;src);
<a name="l00107"></a>00107 
<a name="l00108"></a>00108         <span class="comment">// eBGP route being added, so must have interface to node</span>
<a name="l00109"></a>00109         <span class="comment">// (could be iBGP w/o OSPF network in-between also)</span>
<a name="l00110"></a>00110         <span class="keywordflow">if</span>(l)
<a name="l00111"></a>00111         {
<a name="l00112"></a>00112                 <span class="keywordflow">for</span>(i = 0; i &lt; state-&gt;m-&gt;nlinks; i++)
<a name="l00113"></a>00113                         <span class="keywordflow">if</span>(state-&gt;m-&gt;link[i].addr == r-&gt;src)
<a name="l00114"></a>00114                         {
<a name="l00115"></a>00115                                 nhi = i;
<a name="l00116"></a>00116                                 <span class="keywordflow">break</span>;
<a name="l00117"></a>00117                         }
<a name="l00118"></a>00118 
<a name="l00119"></a>00119                 dst = r-&gt;src;
<a name="l00120"></a>00120                 offset += <a class="code" href="rn-extern_8h.html#d3b2637627bbb86acf01b38d07495042">rn_getas</a>(<a class="code" href="rn-extern_8h.html#b586ebafc20ad652dd538635f5c816b0">rn_getmachine</a>(r-&gt;src))-&gt;id;
<a name="l00121"></a>00121         } <span class="keywordflow">else</span> <span class="comment">// must be iBGP route being added, so must get route to node</span>
<a name="l00122"></a>00122         {
<a name="l00123"></a>00123                 dst = r-&gt;src;
<a name="l00124"></a>00124                 nhi = <a class="code" href="rn-extern_8h.html#8890679c55545bd36e770b118a920b57">rn_route</a>(state-&gt;m, r-&gt;src);
<a name="l00125"></a>00125                 offset += r-&gt;dst;
<a name="l00126"></a>00126         }
<a name="l00127"></a>00127 
<a name="l00128"></a>00128         <a class="code" href="rn-extern_8h.html#2071d019422a8152e6d4e70cb9151f64">rn_route_change</a>(state-&gt;m, offset, nhi);
<a name="l00129"></a>00129 
<a name="l00130"></a>00130 <span class="preprocessor">#if VERIFY_BGP</span>
<a name="l00131"></a>00131 <span class="preprocessor"></span>        fprintf(state-&gt;log, <span class="stringliteral">"\tadding route: ft[%d]=%d \n\t"</span>, 
<a name="l00132"></a>00132                 offset, <a class="code" href="rn-extern_8h.html#8890679c55545bd36e770b118a920b57">rn_route</a>(state-&gt;m, dst));
<a name="l00133"></a>00133         <a class="code" href="bgp-extern_8h.html#14a9a4b8da17993c0c3b37f43ecd0644">bgp_route_print</a>(state, r);
<a name="l00134"></a>00134 <span class="preprocessor">#endif</span>
<a name="l00135"></a>00135 <span class="preprocessor"></span>}
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="611a185745683484cadfa6518e1a0446"></a><!-- doxytag: member="bgp-extern.h::bgp_route_aspath_print" ref="611a185745683484cadfa6518e1a0446" args="(bgp_state *state, bgp_route *r)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bgp_route_aspath_print           </td>
          <td>(</td>
          <td class="paramtype">bgp_state *&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bgp_route *&nbsp;</td>
          <td class="paramname"> <em>r</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="bgp-route_8c-source.html#l00030">30</a> of file <a class="el" href="bgp-route_8c-source.html">bgp-route.c</a>.</p>

<p>Referenced by <a class="el" href="bgp-route_8c-source.html#l00350">bgp_route_print()</a>, and <a class="el" href="bgp-update_8c-source.html#l00135">update_add()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00031"></a>00031 {
<a name="l00032"></a>00032 <span class="preprocessor">#if VERIFY_BGP || !BGP_CONVERGED</span>
<a name="l00033"></a>00033 <span class="preprocessor"></span>        tw_memory       *b;
<a name="l00034"></a>00034 
<a name="l00035"></a>00035         fprintf(state-&gt;log, <span class="stringliteral">" %d  "</span>, r-&gt;as_path.size);
<a name="l00036"></a>00036         <span class="keywordflow">for</span> (b = r-&gt;as_path.head; b != NULL; b = b-&gt;next)
<a name="l00037"></a>00037                 fprintf(state-&gt;log, <span class="stringliteral">"%d "</span>, * (<span class="keywordtype">int</span> *) tw_memory_data(b));
<a name="l00038"></a>00038         fprintf(state-&gt;log, <span class="stringliteral">"\n"</span>);
<a name="l00039"></a>00039 <span class="preprocessor">#endif</span>
<a name="l00040"></a>00040 <span class="preprocessor"></span>}
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="5309f3f3a56a7548ef5c28bc9205f2c6"></a><!-- doxytag: member="bgp-extern.h::bgp_route_copy" ref="5309f3f3a56a7548ef5c28bc9205f2c6" args="(bgp_state *, bgp_route *, bgp_nbr *, bgp_update_type, tw_lp *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tw_memory* bgp_route_copy           </td>
          <td>(</td>
          <td class="paramtype">bgp_state *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bgp_route *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bgp_nbr *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bgp_update_type&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="bgp-route_8c-source.html#l00221">221</a> of file <a class="el" href="bgp-route_8c-source.html">bgp-route.c</a>.</p>

<p>References <a class="el" href="bgp-route_8c-source.html#l00052">bgp_route_free()</a>, <a class="el" href="bgp-global_8c-source.html#l00024">g_bgp_as</a>, <a class="el" href="bgp-global_8c-source.html#l00012">g_bgp_fd_asp</a>, <a class="el" href="bgp-global_8c-source.html#l00011">g_bgp_fd_rtes</a>, <a class="el" href="rn-machine_8c-source.html#l00028">rn_getas()</a>, <a class="el" href="rn-link_8c-source.html#l00017">rn_getlink()</a>, <a class="el" href="rn-machine_8c-source.html#l00004">rn_getmachine()</a>, and <a class="el" href="rn-routing_8c-source.html#l00007">rn_route()</a>.</p>

<p>Referenced by <a class="el" href="bgp-update_8c-source.html#l00007">bgp_update_send()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00223"></a>00223 {
<a name="l00224"></a>00224         rn_as           *as;
<a name="l00225"></a>00225         rn_as           *d_as;
<a name="l00226"></a>00226 
<a name="l00227"></a>00227         tw_memory       *new_route;
<a name="l00228"></a>00228         tw_memory       *b;
<a name="l00229"></a>00229         tw_memory       *b1;
<a name="l00230"></a>00230 
<a name="l00231"></a>00231         bgp_nbr         *nbr;
<a name="l00232"></a>00232         bgp_route       *r;
<a name="l00233"></a>00233 
<a name="l00234"></a>00234         <span class="keywordtype">int</span>             *hop;
<a name="l00235"></a>00235 
<a name="l00236"></a>00236         <span class="keywordtype">int</span>              last;
<a name="l00237"></a>00237         <span class="keywordtype">int</span>              size;
<a name="l00238"></a>00238         <span class="keywordtype">int</span>              i;
<a name="l00239"></a>00239 
<a name="l00240"></a>00240         as = <a class="code" href="rn-extern_8h.html#d3b2637627bbb86acf01b38d07495042">rn_getas</a>(<a class="code" href="rn-extern_8h.html#b586ebafc20ad652dd538635f5c816b0">rn_getmachine</a>(lp-&gt;id));
<a name="l00241"></a>00241         d_as = <a class="code" href="rn-extern_8h.html#d3b2637627bbb86acf01b38d07495042">rn_getas</a>(<a class="code" href="rn-extern_8h.html#b586ebafc20ad652dd538635f5c816b0">rn_getmachine</a>(n-&gt;id));
<a name="l00242"></a>00242 
<a name="l00243"></a>00243         new_route = tw_memory_alloc(lp, <a class="code" href="bgp-extern_8h.html#7603addb7e529a1f5639178c389a5500">g_bgp_fd_rtes</a>);
<a name="l00244"></a>00244         new_route-&gt;bit = 0;
<a name="l00245"></a>00245         r = tw_memory_data(new_route);
<a name="l00246"></a>00246 
<a name="l00247"></a>00247         <span class="comment">// If IP drops pkt, it does not know to free these bufs</span>
<a name="l00248"></a>00248         <span class="keywordflow">if</span>(r-&gt;as_path.head || r-&gt;as_path.tail)
<a name="l00249"></a>00249         {
<a name="l00250"></a>00250                 <a class="code" href="bgp-extern_8h.html#8c7954f03a848dbd36bdf2e0ebbb7fa4">bgp_route_free</a>(state, new_route, lp);
<a name="l00251"></a>00251                 new_route = tw_memory_alloc(lp, <a class="code" href="bgp-extern_8h.html#7603addb7e529a1f5639178c389a5500">g_bgp_fd_rtes</a>);
<a name="l00252"></a>00252 
<a name="l00253"></a>00253                 <span class="keywordflow">if</span>(r-&gt;as_path.head || r-&gt;as_path.tail)
<a name="l00254"></a>00254                         tw_error(TW_LOC, <span class="stringliteral">"STILL!"</span>);
<a name="l00255"></a>00255         }
<a name="l00256"></a>00256 
<a name="l00257"></a>00257         <span class="comment">/*</span>
<a name="l00258"></a>00258 <span class="comment">         5.1.4   MULTI_EXIT_DISC</span>
<a name="l00259"></a>00259 <span class="comment"></span>
<a name="l00260"></a>00260 <span class="comment">                The MULTI_EXIT_DISC attribute may be used on external (inter-AS)</span>
<a name="l00261"></a>00261 <span class="comment">                links to discriminate among multiple exit or entry points to the same</span>
<a name="l00262"></a>00262 <span class="comment">                neighboring AS.  The value of the MULTI_EXIT_DISC attribute is a four</span>
<a name="l00263"></a>00263 <span class="comment">                octet unsigned number which is called a metric.  All other factors</span>
<a name="l00264"></a>00264 <span class="comment">                being equal, the exit or entry point with lower metric should be</span>
<a name="l00265"></a>00265 <span class="comment">                preferred.  If received over external links, the MULTI_EXIT_DISC</span>
<a name="l00266"></a>00266 <span class="comment">                attribute may be propagated over internal links to other BGP speakers</span>
<a name="l00267"></a>00267 <span class="comment">                within the same AS.  The MULTI_EXIT_DISC attribute is never</span>
<a name="l00268"></a>00268 <span class="comment">                propagated to other BGP speakers in neighboring AS's.</span>
<a name="l00269"></a>00269 <span class="comment"></span>
<a name="l00270"></a>00270 <span class="comment">                Cisco MED example: http://www.cisco.com/warp/public/459/37.html</span>
<a name="l00271"></a>00271 <span class="comment">         */</span>
<a name="l00272"></a>00272         <span class="keywordflow">if</span>(d_as == as)
<a name="l00273"></a>00273         {
<a name="l00274"></a>00274                 r-&gt;med = to_be_copied-&gt;med;
<a name="l00275"></a>00275         } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(to_be_copied-&gt;src == lp-&gt;id)
<a name="l00276"></a>00276         {
<a name="l00277"></a>00277                 <span class="comment">// Should only be executed when we are creating route for</span>
<a name="l00278"></a>00278                 <span class="comment">// the first time, which should only be once per connection</span>
<a name="l00279"></a>00279                 <span class="keywordflow">for</span>(size = 0, i = 0; i &lt; state-&gt;n_interfaces; i++)
<a name="l00280"></a>00280                 {
<a name="l00281"></a>00281                         nbr = &amp;state-&gt;nbr[i];
<a name="l00282"></a>00282                         <span class="keywordflow">if</span>(<a class="code" href="rn-extern_8h.html#d3b2637627bbb86acf01b38d07495042">rn_getas</a>(<a class="code" href="rn-extern_8h.html#b586ebafc20ad652dd538635f5c816b0">rn_getmachine</a>(nbr-&gt;id))-&gt;id == d_as-&gt;id)
<a name="l00283"></a>00283                                 size++;
<a name="l00284"></a>00284                 }
<a name="l00285"></a>00285 
<a name="l00286"></a>00286                 <span class="keywordflow">if</span>(size &gt; 1)
<a name="l00287"></a>00287                         r-&gt;med = <a class="code" href="bgp-extern_8h.html#5c7a53c0af93ddd5e897fe79643be44d">g_bgp_as</a>[as-&gt;id].med;
<a name="l00288"></a>00288                 <span class="keywordflow">else</span>
<a name="l00289"></a>00289                         r-&gt;med = 0xffff;
<a name="l00290"></a>00290         } <span class="keywordflow">else</span>
<a name="l00291"></a>00291                 r-&gt;med = 0xffff;
<a name="l00292"></a>00292 
<a name="l00293"></a>00293         r-&gt;src = lp-&gt;id;
<a name="l00294"></a>00294         r-&gt;dst = to_be_copied-&gt;dst;
<a name="l00295"></a>00295         
<a name="l00296"></a>00296         <span class="keywordflow">if</span>(d_as != state-&gt;as)
<a name="l00297"></a>00297                 r-&gt;origin = 2;
<a name="l00298"></a>00298         <span class="keywordflow">else</span>
<a name="l00299"></a>00299                 r-&gt;origin = 1;
<a name="l00300"></a>00300 
<a name="l00301"></a>00301         <span class="comment">// Copy the AS path</span>
<a name="l00302"></a>00302         <span class="comment">// have to preserve the AS path order, so go backwards through list!</span>
<a name="l00303"></a>00303         size = to_be_copied-&gt;as_path.size;
<a name="l00304"></a>00304         last = -1;
<a name="l00305"></a>00305         <span class="keywordflow">for</span>(i = 0, b = to_be_copied-&gt;as_path.tail; i &lt; size; i++, b = b-&gt;prev)
<a name="l00306"></a>00306         {
<a name="l00307"></a>00307                 b1 = tw_memory_alloc(lp, <a class="code" href="bgp-extern_8h.html#ae8e41b9fd5752112bd1e1f06aa00843">g_bgp_fd_asp</a>);
<a name="l00308"></a>00308 
<a name="l00309"></a>00309                 hop = tw_memory_data(b1);
<a name="l00310"></a>00310                 *hop = *(<span class="keywordtype">int</span> *) tw_memory_data(b);
<a name="l00311"></a>00311                 last = *hop;
<a name="l00312"></a>00312         
<a name="l00313"></a>00313                 tw_memoryq_push(&amp;r-&gt;as_path, b1);
<a name="l00314"></a>00314         }
<a name="l00315"></a>00315 
<a name="l00316"></a>00316         <span class="keywordflow">if</span>(d_as == as)
<a name="l00317"></a>00317         {
<a name="l00318"></a>00318                 r-&gt;next_hop = to_be_copied-&gt;next_hop;
<a name="l00319"></a>00319 
<a name="l00320"></a>00320                 <span class="keywordflow">if</span>(<a class="code" href="rn-extern_8h.html#d7173e076af48912ba761e8ef0cc1b22">rn_getlink</a>(state-&gt;m, n-&gt;id))
<a name="l00321"></a>00321                         r-&gt;next_hop = n-&gt;id;
<a name="l00322"></a>00322                 <span class="keywordflow">else</span>
<a name="l00323"></a>00323                         r-&gt;next_hop = state-&gt;m-&gt;link[<a class="code" href="rn-extern_8h.html#8890679c55545bd36e770b118a920b57">rn_route</a>(state-&gt;m, n-&gt;id)].addr;
<a name="l00324"></a>00324         } <span class="keywordflow">else</span>
<a name="l00325"></a>00325         {
<a name="l00326"></a>00326                 r-&gt;next_hop = as-&gt;id;
<a name="l00327"></a>00327 
<a name="l00328"></a>00328                 <span class="comment">// Add myself to the AS path only on UPDATE adds</span>
<a name="l00329"></a>00329                 <span class="keywordflow">if</span>(t == ADD)
<a name="l00330"></a>00330                 {
<a name="l00331"></a>00331 <span class="comment">/*</span>
<a name="l00332"></a>00332 <span class="comment">                        printf("Padding by %d for AS %d \n", </span>
<a name="l00333"></a>00333 <span class="comment">                                g_bgp_as[as-&gt;id].path_padding, as-&gt;id);</span>
<a name="l00334"></a>00334 <span class="comment">*/</span>
<a name="l00335"></a>00335                         <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="bgp-extern_8h.html#5c7a53c0af93ddd5e897fe79643be44d">g_bgp_as</a>[as-&gt;id].path_padding; i++)
<a name="l00336"></a>00336                         {
<a name="l00337"></a>00337                                 b1 = tw_memory_alloc(lp, <a class="code" href="bgp-extern_8h.html#ae8e41b9fd5752112bd1e1f06aa00843">g_bgp_fd_asp</a>);
<a name="l00338"></a>00338                                 hop = tw_memory_data(b1);
<a name="l00339"></a>00339                                 *hop = lp-&gt;id;
<a name="l00340"></a>00340 
<a name="l00341"></a>00341                                 tw_memoryq_push(&amp;r-&gt;as_path, b1);
<a name="l00342"></a>00342                         }
<a name="l00343"></a>00343                 }
<a name="l00344"></a>00344         }
<a name="l00345"></a>00345 
<a name="l00346"></a>00346         <span class="keywordflow">return</span> new_route;
<a name="l00347"></a>00347 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="5b6d4dabf1b791dd477d545cd58bf324"></a><!-- doxytag: member="bgp-extern.h::bgp_route_equals" ref="5b6d4dabf1b791dd477d545cd58bf324" args="(bgp_route *, bgp_route *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int bgp_route_equals           </td>
          <td>(</td>
          <td class="paramtype">bgp_route *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bgp_route *&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="bgp-route_8c-source.html#l00176">176</a> of file <a class="el" href="bgp-route_8c-source.html">bgp-route.c</a>.</p>

<p>Referenced by <a class="el" href="bgp-update_8c-source.html#l00007">bgp_update_send()</a>, and <a class="el" href="bgp-update_8c-source.html#l00229">update_withdraw()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00177"></a>00177 {
<a name="l00178"></a>00178         tw_memory       *b1;
<a name="l00179"></a>00179         tw_memory       *b2;
<a name="l00180"></a>00180 
<a name="l00181"></a>00181         <span class="keywordtype">int</span>             *hop1;
<a name="l00182"></a>00182         <span class="keywordtype">int</span>             *hop2;
<a name="l00183"></a>00183 
<a name="l00184"></a>00184         <span class="keywordflow">if</span> (r1-&gt;dst != r2-&gt;dst)
<a name="l00185"></a>00185                 <span class="keywordflow">return</span> TW_FALSE;
<a name="l00186"></a>00186 
<a name="l00187"></a>00187         <span class="keywordflow">if</span> (r1-&gt;next_hop != r2-&gt;next_hop)
<a name="l00188"></a>00188                 <span class="keywordflow">return</span> TW_FALSE;
<a name="l00189"></a>00189 
<a name="l00190"></a>00190         <span class="keywordflow">if</span> (r1-&gt;as_path.size != r2-&gt;as_path.size)
<a name="l00191"></a>00191                 <span class="keywordflow">return</span> TW_FALSE;
<a name="l00192"></a>00192 
<a name="l00193"></a>00193         <span class="keywordflow">if</span> (r1-&gt;med != r2-&gt;med)
<a name="l00194"></a>00194                 <span class="keywordflow">return</span> TW_FALSE;
<a name="l00195"></a>00195 
<a name="l00196"></a>00196         <span class="comment">// Since AS path order is preserved, we should have </span>
<a name="l00197"></a>00197         <span class="comment">// a one to one mapping between route AS paths</span>
<a name="l00198"></a>00198         b1 = r1-&gt;as_path.head;
<a name="l00199"></a>00199         b2 = r2-&gt;as_path.head;
<a name="l00200"></a>00200         <span class="keywordflow">for</span>(; b1 &amp;&amp; b2; b1 = b1-&gt;next, b2 = b2-&gt;next)
<a name="l00201"></a>00201         {
<a name="l00202"></a>00202                 hop1 = tw_memory_data(b1);
<a name="l00203"></a>00203                 hop2 = tw_memory_data(b2);
<a name="l00204"></a>00204 
<a name="l00205"></a>00205                 <span class="keywordflow">if</span>(*hop1 != *hop2)
<a name="l00206"></a>00206                         <span class="keywordflow">return</span> TW_FALSE;
<a name="l00207"></a>00207         }
<a name="l00208"></a>00208 
<a name="l00209"></a>00209         <span class="keywordflow">return</span> TW_TRUE;
<a name="l00210"></a>00210 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="8c7954f03a848dbd36bdf2e0ebbb7fa4"></a><!-- doxytag: member="bgp-extern.h::bgp_route_free" ref="8c7954f03a848dbd36bdf2e0ebbb7fa4" args="(bgp_state *state, tw_memory *route, tw_lp *lp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int bgp_route_free           </td>
          <td>(</td>
          <td class="paramtype">bgp_state *&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_memory *&nbsp;</td>
          <td class="paramname"> <em>route</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="bgp-route_8c-source.html#l00052">52</a> of file <a class="el" href="bgp-route_8c-source.html">bgp-route.c</a>.</p>

<p>References <a class="el" href="bgp-global_8c-source.html#l00012">g_bgp_fd_asp</a>, and <a class="el" href="bgp-global_8c-source.html#l00011">g_bgp_fd_rtes</a>.</p>

<p>Referenced by <a class="el" href="bgp-route_8c-source.html#l00221">bgp_route_copy()</a>, <a class="el" href="bgp-update_8c-source.html#l00081">bgp_update()</a>, <a class="el" href="bgp-keepalive_8c-source.html#l00156">deal_with_timed_out_routers()</a>, <a class="el" href="bgp-update_8c-source.html#l00135">update_add()</a>, and <a class="el" href="bgp-update_8c-source.html#l00229">update_withdraw()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00053"></a>00053 {
<a name="l00054"></a>00054         tw_memory       *b;
<a name="l00055"></a>00055         bgp_route       *r;
<a name="l00056"></a>00056         <span class="keywordtype">int</span>              rv;
<a name="l00057"></a>00057 
<a name="l00058"></a>00058         r = tw_memory_data(route);
<a name="l00059"></a>00059         rv = r-&gt;as_path.size;
<a name="l00060"></a>00060 
<a name="l00061"></a>00061         <span class="keywordflow">while</span>((b = tw_memoryq_pop(&amp;r-&gt;as_path)))
<a name="l00062"></a>00062                 tw_memory_free(lp, b, <a class="code" href="bgp-extern_8h.html#ae8e41b9fd5752112bd1e1f06aa00843">g_bgp_fd_asp</a>);
<a name="l00063"></a>00063 
<a name="l00064"></a>00064         <span class="keywordflow">if</span>(r-&gt;as_path.head || r-&gt;as_path.tail)
<a name="l00065"></a>00065                 tw_error(TW_LOC, <span class="stringliteral">"AS Path not empty!"</span>);
<a name="l00066"></a>00066 
<a name="l00067"></a>00067         tw_memory_free(lp, route, <a class="code" href="bgp-extern_8h.html#7603addb7e529a1f5639178c389a5500">g_bgp_fd_rtes</a>);
<a name="l00068"></a>00068 
<a name="l00069"></a>00069         <span class="keywordflow">return</span> rv;
<a name="l00070"></a>00070 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="100bf7ef1e9abdd8f9e35beeeaca77a6"></a><!-- doxytag: member="bgp-extern.h::bgp_route_inpath" ref="100bf7ef1e9abdd8f9e35beeeaca77a6" args="(bgp_state *state, bgp_route *r_in, tw_lp *lp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int bgp_route_inpath           </td>
          <td>(</td>
          <td class="paramtype">bgp_state *&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bgp_route *&nbsp;</td>
          <td class="paramname"> <em>r_in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="bgp-route_8c-source.html#l00005">5</a> of file <a class="el" href="bgp-route_8c-source.html">bgp-route.c</a>.</p>

<p>Referenced by <a class="el" href="bgp-update_8c-source.html#l00135">update_add()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00006"></a>00006 {
<a name="l00007"></a>00007         tw_memory       *b;
<a name="l00008"></a>00008         <span class="keywordtype">int</span>             *hop;
<a name="l00009"></a>00009         <span class="keywordtype">int</span>              i;
<a name="l00010"></a>00010 
<a name="l00011"></a>00011         <span class="comment">//for (b = r_in-&gt;as_path.head; b; b = b-&gt;next)</span>
<a name="l00012"></a>00012         <span class="keywordflow">for</span>(i = 0, b = r_in-&gt;as_path.head; i &lt; r_in-&gt;as_path.size; i++, b = b-&gt;next)
<a name="l00013"></a>00013         {
<a name="l00014"></a>00014                 hop = tw_memory_data(b);
<a name="l00015"></a>00015                 <span class="keywordflow">if</span>(*hop == lp-&gt;id)
<a name="l00016"></a>00016                 {
<a name="l00017"></a>00017 <span class="preprocessor">#if VERIFY_BGP</span>
<a name="l00018"></a>00018 <span class="preprocessor"></span>                        fprintf(state-&gt;log, <span class="stringliteral">"\tfound myself in AS path: %ld\n"</span>,
<a name="l00019"></a>00019                                 lp-&gt;id);
<a name="l00020"></a>00020 <span class="preprocessor">#endif</span>
<a name="l00021"></a>00021 <span class="preprocessor"></span>
<a name="l00022"></a>00022                         <span class="keywordflow">return</span> TW_TRUE;
<a name="l00023"></a>00023                 }
<a name="l00024"></a>00024         }
<a name="l00025"></a>00025 
<a name="l00026"></a>00026         <span class="keywordflow">return</span> TW_FALSE;
<a name="l00027"></a>00027 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="525d4b98ef30f04b282a1f272f7fba3a"></a><!-- doxytag: member="bgp-extern.h::bgp_route_new" ref="525d4b98ef30f04b282a1f272f7fba3a" args="(bgp_state *, tw_lp *, tw_lp *, tw_lp *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tw_memory* bgp_route_new           </td>
          <td>(</td>
          <td class="paramtype">bgp_state *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="bgp-route_8c-source.html#l00157">157</a> of file <a class="el" href="bgp-route_8c-source.html">bgp-route.c</a>.</p>

<p>References <a class="el" href="bgp-global_8c-source.html#l00011">g_bgp_fd_rtes</a>, <a class="el" href="rn-machine_8c-source.html#l00028">rn_getas()</a>, and <a class="el" href="rn-machine_8c-source.html#l00004">rn_getmachine()</a>.</p>

<p>Referenced by <a class="el" href="bgp-init_8c-source.html#l00070">bgp_init()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00158"></a>00158 {
<a name="l00159"></a>00159         tw_memory       *b;
<a name="l00160"></a>00160 
<a name="l00161"></a>00161         bgp_route       *r;
<a name="l00162"></a>00162 
<a name="l00163"></a>00163         b = tw_memory_alloc(lp, <a class="code" href="bgp-extern_8h.html#7603addb7e529a1f5639178c389a5500">g_bgp_fd_rtes</a>);
<a name="l00164"></a>00164         r = tw_memory_data(b);
<a name="l00165"></a>00165 
<a name="l00166"></a>00166         r-&gt;src = src-&gt;id;
<a name="l00167"></a>00167         r-&gt;dst = <a class="code" href="rn-extern_8h.html#d3b2637627bbb86acf01b38d07495042">rn_getas</a>(<a class="code" href="rn-extern_8h.html#b586ebafc20ad652dd538635f5c816b0">rn_getmachine</a>(dst-&gt;id))-&gt;id;
<a name="l00168"></a>00168         r-&gt;next_hop = state-&gt;as-&gt;id;
<a name="l00169"></a>00169         r-&gt;origin = 3;
<a name="l00170"></a>00170         r-&gt;med = 0xffff;
<a name="l00171"></a>00171 
<a name="l00172"></a>00172         <span class="keywordflow">return</span> b;
<a name="l00173"></a>00173 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="14a9a4b8da17993c0c3b37f43ecd0644"></a><!-- doxytag: member="bgp-extern.h::bgp_route_print" ref="14a9a4b8da17993c0c3b37f43ecd0644" args="(bgp_state *state, bgp_route *r)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bgp_route_print           </td>
          <td>(</td>
          <td class="paramtype">bgp_state *&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bgp_route *&nbsp;</td>
          <td class="paramname"> <em>r</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="bgp-route_8c-source.html#l00350">350</a> of file <a class="el" href="bgp-route_8c-source.html">bgp-route.c</a>.</p>

<p>References <a class="el" href="bgp-route_8c-source.html#l00030">bgp_route_aspath_print()</a>.</p>

<p>Referenced by <a class="el" href="bgp-stats_8c-source.html#l00004">bgp_final()</a>, <a class="el" href="bgp-route_8c-source.html#l00360">bgp_rib_print()</a>, <a class="el" href="bgp-route_8c-source.html#l00073">bgp_route_add()</a>, <a class="el" href="bgp-route_8c-source.html#l00138">bgp_route_withdraw()</a>, <a class="el" href="bgp-update_8c-source.html#l00007">bgp_update_send()</a>, and <a class="el" href="bgp-update_8c-source.html#l00229">update_withdraw()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00351"></a>00351 {
<a name="l00352"></a>00352 <span class="preprocessor">#if VERIFY_BGP || !BGP_CONVERGED</span>
<a name="l00353"></a>00353 <span class="preprocessor"></span>        fprintf(state-&gt;log, <span class="stringliteral">"%-10hd%-10hd%-10d%-10hd%-10hd"</span>, 
<a name="l00354"></a>00354                 r-&gt;dst, r-&gt;next_hop, r-&gt;src, r-&gt;med, r-&gt;origin);
<a name="l00355"></a>00355         <a class="code" href="bgp-extern_8h.html#611a185745683484cadfa6518e1a0446">bgp_route_aspath_print</a>(state, r);
<a name="l00356"></a>00356 <span class="preprocessor">#endif</span>
<a name="l00357"></a>00357 <span class="preprocessor"></span>}
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="c3940d75bca1133bfd81eee76261dda2"></a><!-- doxytag: member="bgp-extern.h::bgp_route_withdraw" ref="c3940d75bca1133bfd81eee76261dda2" args="(bgp_state *state, bgp_route *r)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bgp_route_withdraw           </td>
          <td>(</td>
          <td class="paramtype">bgp_state *&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bgp_route *&nbsp;</td>
          <td class="paramname"> <em>r</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="bgp-route_8c-source.html#l00138">138</a> of file <a class="el" href="bgp-route_8c-source.html">bgp-route.c</a>.</p>

<p>References <a class="el" href="bgp-route_8c-source.html#l00350">bgp_route_print()</a>, <a class="el" href="rn-machine_8c-source.html#l00022">rn_getarea()</a>, <a class="el" href="rn-routing_8c-source.html#l00007">rn_route()</a>, and <a class="el" href="rn-routing_8c-source.html#l00048">rn_route_change()</a>.</p>

<p>Referenced by <a class="el" href="bgp-keepalive_8c-source.html#l00156">deal_with_timed_out_routers()</a>, <a class="el" href="bgp-update_8c-source.html#l00135">update_add()</a>, and <a class="el" href="bgp-update_8c-source.html#l00229">update_withdraw()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00139"></a>00139 {
<a name="l00140"></a>00140         rn_area         *ar;
<a name="l00141"></a>00141 
<a name="l00142"></a>00142         ar = <a class="code" href="rn-extern_8h.html#d45bc39e5a89bce656786b571acb1ae8">rn_getarea</a>(state-&gt;m);
<a name="l00143"></a>00143 
<a name="l00144"></a>00144         state-&gt;rib[r-&gt;dst] = NULL;
<a name="l00145"></a>00145         <a class="code" href="rn-extern_8h.html#2071d019422a8152e6d4e70cb9151f64">rn_route_change</a>(state-&gt;m, ar-&gt;nmachines + ar-&gt;as-&gt;nareas + r-&gt;dst, -1);
<a name="l00146"></a>00146         state-&gt;stats-&gt;s_nroute_removes++;
<a name="l00147"></a>00147 
<a name="l00148"></a>00148 <span class="preprocessor">#if VERIFY_BGP</span>
<a name="l00149"></a>00149 <span class="preprocessor"></span>        fprintf(state-&gt;log, <span class="stringliteral">"\twithdrawing route: ft[%d]=%d \n\t"</span>,
<a name="l00150"></a>00150                 ar-&gt;nmachines + ar-&gt;as-&gt;nareas + r-&gt;dst, 
<a name="l00151"></a>00151                 <a class="code" href="rn-extern_8h.html#8890679c55545bd36e770b118a920b57">rn_route</a>(state-&gt;m, ar-&gt;nmachines + ar-&gt;as-&gt;nareas + r-&gt;dst));
<a name="l00152"></a>00152         <a class="code" href="bgp-extern_8h.html#14a9a4b8da17993c0c3b37f43ecd0644">bgp_route_print</a>(state, r);
<a name="l00153"></a>00153 <span class="preprocessor">#endif</span>
<a name="l00154"></a>00154 <span class="preprocessor"></span>}
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="39bc7fd789695e7d60f7d2fc8b053f1d"></a><!-- doxytag: member="bgp-extern.h::bgp_rt_file" ref="39bc7fd789695e7d60f7d2fc8b053f1d" args="(int *read)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bgp_rt_file           </td>
          <td>(</td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>read</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="f1b737c47cf480cc11a8714a8426d02a"></a><!-- doxytag: member="bgp-extern.h::bgp_timer_start" ref="f1b737c47cf480cc11a8714a8426d02a" args="(tw_lp *, tw_event *, tw_stime, bgp_message_type)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tw_event* bgp_timer_start           </td>
          <td>(</td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_event *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_stime&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bgp_message_type&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="bgp-utils_8c-source.html#l00004">4</a> of file <a class="el" href="bgp-utils_8c-source.html">bgp-utils.c</a>.</p>

<p>References <a class="el" href="bgp-global_8c-source.html#l00010">g_bgp_fd</a>, and <a class="el" href="rn-timer_8c-source.html#l00004">rn_timer_simple()</a>.</p>

<p>Referenced by <a class="el" href="bgp-init_8c-source.html#l00070">bgp_init()</a>, <a class="el" href="bgp-keepalive_8c-source.html#l00007">bgp_keepalive_tmr()</a>, and <a class="el" href="bgp-mrai_8c-source.html#l00007">bgp_mrai_tmr()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00005"></a>00005 {
<a name="l00006"></a>00006         tw_memory       *b = tw_memory_alloc(lp, <a class="code" href="bgp-extern_8h.html#0c0827f912b6c5550b6dfaa922b3fdc9">g_bgp_fd</a>);
<a name="l00007"></a>00007         bgp_message     *m = tw_memory_data(b);
<a name="l00008"></a>00008 
<a name="l00009"></a>00009         tmr = <a class="code" href="rn-extern_8h.html#1b018b2a83777582dde06961f4ef2b80">rn_timer_simple</a>(lp, ts);
<a name="l00010"></a>00010 
<a name="l00011"></a>00011         m-&gt;b.type = type;
<a name="l00012"></a>00012         
<a name="l00013"></a>00013         tw_event_memory_set(tmr, b, <a class="code" href="bgp-extern_8h.html#0c0827f912b6c5550b6dfaa922b3fdc9">g_bgp_fd</a>);
<a name="l00014"></a>00014 
<a name="l00015"></a>00015         <span class="keywordflow">return</span> tmr;
<a name="l00016"></a>00016 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="c1feb49d9f7df249a5f66c813d284082"></a><!-- doxytag: member="bgp-extern.h::bgp_update" ref="c1feb49d9f7df249a5f66c813d284082" args="(bgp_state *, tw_bf *, bgp_message *, int, tw_lp *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bgp_update           </td>
          <td>(</td>
          <td class="paramtype">bgp_state *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_bf *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bgp_message *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="bgp-update_8c-source.html#l00081">81</a> of file <a class="el" href="bgp-update_8c-source.html">bgp-update.c</a>.</p>

<p>References <a class="el" href="bgp-nbr_8c-source.html#l00007">bgp_getnbr()</a>, <a class="el" href="bgp-route_8c-source.html#l00052">bgp_route_free()</a>, <a class="el" href="bgp-update_8c-source.html#l00007">bgp_update_send()</a>, <a class="el" href="bgp-update_8c-source.html#l00135">update_add()</a>, and <a class="el" href="bgp-update_8c-source.html#l00229">update_withdraw()</a>.</p>

<p>Referenced by <a class="el" href="bgp-router_8c-source.html#l00004">bgp_event_handler()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00082"></a>00082 {
<a name="l00083"></a>00083         tw_memory       *b_in;
<a name="l00084"></a>00084         bgp_route       *r;
<a name="l00085"></a>00085 
<a name="l00086"></a>00086         <span class="keywordtype">int</span>              cause;
<a name="l00087"></a>00087         <span class="keywordtype">char</span>             temp[2048];
<a name="l00088"></a>00088 
<a name="l00089"></a>00089         <span class="keywordflow">if</span>(NULL == (b_in = tw_event_memory_get(lp)))
<a name="l00090"></a>00090                 tw_error(TW_LOC, <span class="stringliteral">"No UPDATE on event!"</span>);
<a name="l00091"></a>00091 
<a name="l00092"></a>00092         r = tw_memory_data(b_in);
<a name="l00093"></a>00093 
<a name="l00094"></a>00094         <span class="keywordflow">if</span>(!r)
<a name="l00095"></a>00095                 tw_error(TW_LOC, <span class="stringliteral">"Invalid route on UDPATE!"</span>);
<a name="l00096"></a>00096 
<a name="l00097"></a>00097         sprintf(temp, <span class="stringliteral">"%d %d %d"</span>, r-&gt;src, r-&gt;dst, r-&gt;next_hop);
<a name="l00098"></a>00098 
<a name="l00099"></a>00099         <span class="comment">// we're adding a route</span>
<a name="l00100"></a>00100         <span class="keywordflow">if</span>(msg-&gt;b.update)
<a name="l00101"></a>00101         {
<a name="l00102"></a>00102                 <a class="code" href="bgp-update_8c.html#cd360ab51dd044e64b909e63159d79ec">update_add</a>(state, bf, b_in, msg, src, lp);
<a name="l00103"></a>00103         } <span class="keywordflow">else</span>
<a name="l00104"></a>00104         {
<a name="l00105"></a>00105                 <a class="code" href="bgp-update_8c.html#6da7d6655e192cb4add1618a73bbc214">update_withdraw</a>(state, bf, r, msg, src, lp);
<a name="l00106"></a>00106 
<a name="l00107"></a>00107                 <span class="keywordflow">if</span>(msg-&gt;b.unreachable == 0)
<a name="l00108"></a>00108                         <span class="keywordflow">return</span>;
<a name="l00109"></a>00109 
<a name="l00110"></a>00110 <span class="preprocessor">#if VERIFY_BGP</span>
<a name="l00111"></a>00111 <span class="preprocessor"></span>                fprintf(state-&gt;log, <span class="stringliteral">"\tgot UNREACHABLE UPDATE from %d, for AS %d\n"</span>,
<a name="l00112"></a>00112                         src, r-&gt;dst);
<a name="l00113"></a>00113 <span class="preprocessor">#endif</span>
<a name="l00114"></a>00114 <span class="preprocessor"></span>
<a name="l00115"></a>00115                 <span class="keywordflow">if</span>(state-&gt;rib[r-&gt;dst] != NULL)
<a name="l00116"></a>00116                 {
<a name="l00117"></a>00117                         msg-&gt;b.update = 1;
<a name="l00118"></a>00118         
<a name="l00119"></a>00119                         <span class="keywordflow">if</span>(msg-&gt;b.cause_ospf)
<a name="l00120"></a>00120                                 cause = 1;
<a name="l00121"></a>00121                         <span class="keywordflow">else</span>
<a name="l00122"></a>00122                                 cause = 0;
<a name="l00123"></a>00123 
<a name="l00124"></a>00124                         <a class="code" href="bgp-extern_8h.html#496b5be995649aa5e3a0da073a317755">bgp_update_send</a>(state, <a class="code" href="bgp-extern_8h.html#5ed527027df1ef2895f4a8b3642dc991">bgp_getnbr</a>(state, src), 
<a name="l00125"></a>00125                                         tw_memory_data(state-&gt;rib[r-&gt;dst]), 
<a name="l00126"></a>00126                                         msg, cause, lp);
<a name="l00127"></a>00127                         state-&gt;stats-&gt;s_nunreachable++;
<a name="l00128"></a>00128                 }
<a name="l00129"></a>00129 
<a name="l00130"></a>00130                 <a class="code" href="bgp-extern_8h.html#8c7954f03a848dbd36bdf2e0ebbb7fa4">bgp_route_free</a>(state, b_in, lp);
<a name="l00131"></a>00131         }
<a name="l00132"></a>00132 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="856060ffa6068321237ce35960f8a676"></a><!-- doxytag: member="bgp-extern.h::bgp_update_all" ref="856060ffa6068321237ce35960f8a676" args="(bgp_state *, bgp_message *, int, bgp_route *, tw_lp *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bgp_update_all           </td>
          <td>(</td>
          <td class="paramtype">bgp_state *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bgp_message *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bgp_route *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="bgp-update_8c-source.html#l00264">264</a> of file <a class="el" href="bgp-update_8c-source.html">bgp-update.c</a>.</p>

<p>References <a class="el" href="bgp-update_8c-source.html#l00007">bgp_update_send()</a>, <a class="el" href="rn-machine_8c-source.html#l00028">rn_getas()</a>, and <a class="el" href="rn-machine_8c-source.html#l00004">rn_getmachine()</a>.</p>

<p>Referenced by <a class="el" href="bgp-mrai_8c-source.html#l00020">bgp_mrai_timer()</a>, <a class="el" href="bgp-update_8c-source.html#l00135">update_add()</a>, and <a class="el" href="bgp-update_8c-source.html#l00229">update_withdraw()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00266"></a>00266 {
<a name="l00267"></a>00267         bgp_nbr         *n;
<a name="l00268"></a>00268         <span class="keywordtype">int</span>              i;
<a name="l00269"></a>00269 
<a name="l00270"></a>00270         <span class="keywordflow">for</span>(i = 0, n = state-&gt;nbr; i &lt; state-&gt;n_interfaces; n = &amp;state-&gt;nbr[++i])
<a name="l00271"></a>00271         {
<a name="l00272"></a>00272                 <span class="keywordflow">if</span> (n-&gt;up == TW_FALSE || (src == n-&gt;id))
<a name="l00273"></a>00273                         <span class="keywordflow">continue</span>;
<a name="l00274"></a>00274 
<a name="l00275"></a>00275                 <span class="keywordflow">if</span>(r-&gt;dst == <a class="code" href="rn-extern_8h.html#d3b2637627bbb86acf01b38d07495042">rn_getas</a>(<a class="code" href="rn-extern_8h.html#b586ebafc20ad652dd538635f5c816b0">rn_getmachine</a>(n-&gt;id))-&gt;id)
<a name="l00276"></a>00276                         <span class="keywordflow">continue</span>;
<a name="l00277"></a>00277 
<a name="l00278"></a>00278                 <span class="comment">// If from iBGP peer, do not send to other iBGP peers</span>
<a name="l00279"></a>00279                 <span class="keywordflow">if</span>(state-&gt;as == <a class="code" href="rn-extern_8h.html#d3b2637627bbb86acf01b38d07495042">rn_getas</a>(<a class="code" href="rn-extern_8h.html#b586ebafc20ad652dd538635f5c816b0">rn_getmachine</a>(r-&gt;src)) &amp;&amp;
<a name="l00280"></a>00280                    state-&gt;as == <a class="code" href="rn-extern_8h.html#d3b2637627bbb86acf01b38d07495042">rn_getas</a>(<a class="code" href="rn-extern_8h.html#b586ebafc20ad652dd538635f5c816b0">rn_getmachine</a>(n-&gt;id)))
<a name="l00281"></a>00281                         <span class="keywordflow">continue</span>;
<a name="l00282"></a>00282 
<a name="l00283"></a>00283                 <span class="keywordflow">if</span>(msg-&gt;b.cause_bgp == msg-&gt;b.cause_ospf)
<a name="l00284"></a>00284                         tw_error(TW_LOC, <span class="stringliteral">"Unmarked UPDATE!"</span>);
<a name="l00285"></a>00285 
<a name="l00286"></a>00286                 <span class="keywordflow">if</span>(msg-&gt;b.cause_bgp)
<a name="l00287"></a>00287                         <a class="code" href="bgp-extern_8h.html#496b5be995649aa5e3a0da073a317755">bgp_update_send</a>(state, n, r, msg, 0, lp);
<a name="l00288"></a>00288                 <span class="keywordflow">else</span>
<a name="l00289"></a>00289                         <a class="code" href="bgp-extern_8h.html#496b5be995649aa5e3a0da073a317755">bgp_update_send</a>(state, n, r, msg, 1, lp);
<a name="l00290"></a>00290 
<a name="l00291"></a>00291                 <span class="comment">//msg-&gt;b.rev_num_neighbors++;</span>
<a name="l00292"></a>00292         }
<a name="l00293"></a>00293 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="496b5be995649aa5e3a0da073a317755"></a><!-- doxytag: member="bgp-extern.h::bgp_update_send" ref="496b5be995649aa5e3a0da073a317755" args="(bgp_state *, bgp_nbr *, bgp_route *, bgp_message *, int, tw_lp *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bgp_update_send           </td>
          <td>(</td>
          <td class="paramtype">bgp_state *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bgp_nbr *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bgp_route *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bgp_message *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="bgp-update_8c-source.html#l00007">7</a> of file <a class="el" href="bgp-update_8c-source.html">bgp-update.c</a>.</p>

<p>References <a class="el" href="bgp-route_8c-source.html#l00221">bgp_route_copy()</a>, <a class="el" href="bgp-route_8c-source.html#l00176">bgp_route_equals()</a>, <a class="el" href="bgp-route_8c-source.html#l00350">bgp_route_print()</a>, <a class="el" href="bgp-types_8h-source.html#l00015">BGP_UPDATE</a>, <a class="el" href="rn-types_8h-source.html#l00055">DOWNSTREAM</a>, <a class="el" href="bgp-global_8c-source.html#l00010">g_bgp_fd</a>, <a class="el" href="bgp-global_8c-source.html#l00011">g_bgp_fd_rtes</a>, <a class="el" href="bgp-global_8c-source.html#l00023">g_bgp_stats</a>, <a class="el" href="rn-event_8c-source.html#l00058">rn_event_new()</a>, <a class="el" href="rn-event_8c-source.html#l00173">rn_event_send()</a>, <a class="el" href="rn-machine_8c-source.html#l00028">rn_getas()</a>, and <a class="el" href="rn-machine_8c-source.html#l00004">rn_getmachine()</a>.</p>

<p>Referenced by <a class="el" href="bgp-open_8c-source.html#l00048">bgp_open()</a>, <a class="el" href="bgp-update_8c-source.html#l00081">bgp_update()</a>, <a class="el" href="bgp-update_8c-source.html#l00264">bgp_update_all()</a>, and <a class="el" href="bgp-keepalive_8c-source.html#l00156">deal_with_timed_out_routers()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00009"></a>00009 {
<a name="l00010"></a>00010         tw_event        *e;
<a name="l00011"></a>00011 
<a name="l00012"></a>00012         tw_memory       *hdr;
<a name="l00013"></a>00013         tw_memory       *b;
<a name="l00014"></a>00014 
<a name="l00015"></a>00015         <span class="comment">//bgp_route     *test;</span>
<a name="l00016"></a>00016         bgp_message     *m;
<a name="l00017"></a>00017 
<a name="l00018"></a>00018         state-&gt;stats-&gt;s_nupdates_sent++;
<a name="l00019"></a>00019         e = <a class="code" href="rn-event_8c.html#5508bcf53c1fbeb71e6055021634a726">rn_event_new</a>(n-&gt;id, 0.0, lp, <a class="code" href="rn-types_8h.html#3fc738f2924cae2b2d04a9a133c3ef02193085e792a05c4538ec2bc24c845652">DOWNSTREAM</a>, <a class="code" href="bgp-types_8h.html#d2ba5f048eb9164fe794e3cddae73e81">BGP_UPDATE</a>);
<a name="l00020"></a>00020 
<a name="l00021"></a>00021         hdr = tw_memory_alloc(lp, <a class="code" href="bgp-extern_8h.html#0c0827f912b6c5550b6dfaa922b3fdc9">g_bgp_fd</a>);
<a name="l00022"></a>00022         m = tw_memory_data(hdr);
<a name="l00023"></a>00023 
<a name="l00024"></a>00024         m-&gt;b.type = UPDATE;
<a name="l00025"></a>00025         m-&gt;b.update = msg-&gt;b.update;
<a name="l00026"></a>00026         m-&gt;b.cause_bgp = m-&gt;b.cause_ospf = 0;
<a name="l00027"></a>00027 
<a name="l00028"></a>00028         <span class="keywordflow">if</span>(cause)
<a name="l00029"></a>00029                 m-&gt;b.cause_ospf = 1;
<a name="l00030"></a>00030         <span class="keywordflow">else</span>
<a name="l00031"></a>00031         {
<a name="l00032"></a>00032                 m-&gt;b.cause_bgp = 1;
<a name="l00033"></a>00033                 <a class="code" href="bgp-extern_8h.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>.s_cause_bgp++;
<a name="l00034"></a>00034         }
<a name="l00035"></a>00035 
<a name="l00036"></a>00036 
<a name="l00037"></a>00037         <span class="comment">// Having problems with membufs being attached to membufs.. impossible</span>
<a name="l00038"></a>00038         <span class="comment">// to free them if the pkt is dropped outside the BGP model.</span>
<a name="l00039"></a>00039         tw_event_memory_set(e, hdr, <a class="code" href="bgp-extern_8h.html#0c0827f912b6c5550b6dfaa922b3fdc9">g_bgp_fd</a>);
<a name="l00040"></a>00040         <a class="code" href="rn-event_8c.html#8c3496e774b118a7e411ea5bcd23d49a">rn_event_send</a>(e);
<a name="l00041"></a>00041 
<a name="l00042"></a>00042         <span class="keywordflow">if</span>(e-&gt;state.owner == TW_pe_free_q || e == lp-&gt;pe-&gt;abort_event)
<a name="l00043"></a>00043                 <span class="keywordflow">return</span>;
<a name="l00044"></a>00044 
<a name="l00045"></a>00045         <span class="comment">// if can be sent, get the hdr back off the event now so the route</span>
<a name="l00046"></a>00046         <span class="comment">// can be put on first.</span>
<a name="l00047"></a>00047         e-&gt;memory = NULL;
<a name="l00048"></a>00048 
<a name="l00049"></a>00049         <span class="comment">// Add the route to the UPDATE message</span>
<a name="l00050"></a>00050         <span class="keywordflow">if</span>(msg-&gt;b.update == 0 || <a class="code" href="rn-extern_8h.html#d3b2637627bbb86acf01b38d07495042">rn_getas</a>(<a class="code" href="rn-extern_8h.html#b586ebafc20ad652dd538635f5c816b0">rn_getmachine</a>(n-&gt;id)) == state-&gt;as)
<a name="l00051"></a>00051                 b = <a class="code" href="bgp-extern_8h.html#5309f3f3a56a7548ef5c28bc9205f2c6">bgp_route_copy</a>(state, r_send, n, 0, lp);
<a name="l00052"></a>00052         <span class="keywordflow">else</span>
<a name="l00053"></a>00053                 b = <a class="code" href="bgp-extern_8h.html#5309f3f3a56a7548ef5c28bc9205f2c6">bgp_route_copy</a>(state, r_send, n, 1, lp);
<a name="l00054"></a>00054 
<a name="l00055"></a>00055 <span class="preprocessor">#if 0</span>
<a name="l00056"></a>00056 <span class="preprocessor"></span>        test = tw_memory_data(b);
<a name="l00057"></a>00057         <span class="keywordflow">if</span>(TW_FALSE == <a class="code" href="bgp-extern_8h.html#5b6d4dabf1b791dd477d545cd58bf324">bgp_route_equals</a>(test, r_send))
<a name="l00058"></a>00058                 tw_error(TW_LOC, <span class="stringliteral">"Invalid ROUTE copy!"</span>);
<a name="l00059"></a>00059 <span class="preprocessor">#endif</span>
<a name="l00060"></a>00060 <span class="preprocessor"></span>
<a name="l00061"></a>00061         <span class="keywordflow">if</span>(m-&gt;b.update == REMOVE &amp;&amp; state-&gt;rib[r_send-&gt;dst] == NULL)
<a name="l00062"></a>00062                 m-&gt;b.unreachable = 1;
<a name="l00063"></a>00063         <span class="keywordflow">else</span>
<a name="l00064"></a>00064                 m-&gt;b.unreachable = 0;
<a name="l00065"></a>00065 
<a name="l00066"></a>00066         tw_event_memory_set(e, b, <a class="code" href="bgp-extern_8h.html#7603addb7e529a1f5639178c389a5500">g_bgp_fd_rtes</a>);
<a name="l00067"></a>00067         tw_event_memory_set(e, hdr, <a class="code" href="bgp-extern_8h.html#0c0827f912b6c5550b6dfaa922b3fdc9">g_bgp_fd</a>);
<a name="l00068"></a>00068 
<a name="l00069"></a>00069         <span class="comment">// Had to be moved up to before membufs placed onto event.. because</span>
<a name="l00070"></a>00070         <span class="comment">// event may be aborted, and then we do not want to copy the route</span>
<a name="l00071"></a>00071         <span class="comment">//rn_event_send(e);</span>
<a name="l00072"></a>00072 
<a name="l00073"></a>00073 <span class="preprocessor">#if VERIFY_BGP</span>
<a name="l00074"></a>00074 <span class="preprocessor"></span>        fprintf(state-&gt;log, <span class="stringliteral">"\t\tsent UPDATE (%d) to %d at %f: \n\t\t"</span>, 
<a name="l00075"></a>00075                 m-&gt;b.update, n-&gt;id, tw_now(lp));
<a name="l00076"></a>00076         <a class="code" href="bgp-extern_8h.html#14a9a4b8da17993c0c3b37f43ecd0644">bgp_route_print</a>(state, tw_memory_data(b));
<a name="l00077"></a>00077 <span class="preprocessor">#endif</span>
<a name="l00078"></a>00078 <span class="preprocessor"></span>}
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="191ebe1a28b02a64501a5a85081f7e22"></a><!-- doxytag: member="bgp-extern.h::bgp_xml" ref="191ebe1a28b02a64501a5a85081f7e22" args="(bgp_state *state, const xmlNodePtr node, tw_lp *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bgp_xml           </td>
          <td>(</td>
          <td class="paramtype">bgp_state *&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const xmlNodePtr&nbsp;</td>
          <td class="paramname"> <em>node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="bgp-xml_8c-source.html#l00006">6</a> of file <a class="el" href="bgp-xml_8c-source.html">bgp-xml.c</a>.</p>

<p>References <a class="el" href="bgp-global_8c-source.html#l00024">g_bgp_as</a>, <a class="el" href="bgp-global_8c-source.html#l00031">g_bgp_ases</a>, <a class="el" href="bgp-global_8c-source.html#l00025">g_bgp_state</a>, <a class="el" href="rn-machine_8c-source.html#l00022">rn_getarea()</a>, <a class="el" href="rn-machine_8c-source.html#l00028">rn_getas()</a>, <a class="el" href="rn-machine_8c-source.html#l00004">rn_getmachine()</a>, and <a class="el" href="xml-libxml_8c-source.html#l00207">xml_getprop()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00007"></a>00007 {
<a name="l00008"></a>00008 <span class="preprocessor">#if IBGP </span>
<a name="l00009"></a>00009 <span class="preprocessor"></span>        xmlXPathObjectPtr        obj;
<a name="l00010"></a>00010         xmlNodePtr               node2;
<a name="l00011"></a>00011 
<a name="l00012"></a>00012         <span class="keywordtype">int</span>                      id;
<a name="l00013"></a>00013         <span class="keywordtype">int</span>                      j;
<a name="l00014"></a>00014 <span class="preprocessor">#endif</span>
<a name="l00015"></a>00015 <span class="preprocessor"></span>
<a name="l00016"></a>00016         xmlNodePtr               interface;
<a name="l00017"></a>00017 
<a name="l00018"></a>00018         rn_machine              *m;
<a name="l00019"></a>00019         rn_area                 *ar;
<a name="l00020"></a>00020 
<a name="l00021"></a>00021         bgp_nbr                 *n;
<a name="l00022"></a>00022 
<a name="l00023"></a>00023         <span class="comment">//char                  *local_pref;</span>
<a name="l00024"></a>00024 
<a name="l00025"></a>00025         <span class="keywordtype">int</span>                      i;
<a name="l00026"></a>00026         <span class="keywordtype">int</span>                      lvl;
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <span class="preprocessor">#if IBGP_TREE</span>
<a name="l00029"></a>00029 <span class="preprocessor"></span>        <span class="keywordtype">int</span>                      diff;
<a name="l00030"></a>00030         <span class="keywordtype">int</span>                      has_ibgp;
<a name="l00031"></a>00031 <span class="preprocessor">#endif</span>
<a name="l00032"></a>00032 <span class="preprocessor"></span>
<a name="l00033"></a>00033         state-&gt;m = m = <a class="code" href="rn-extern_8h.html#b586ebafc20ad652dd538635f5c816b0">rn_getmachine</a>(lp-&gt;id);
<a name="l00034"></a>00034         state-&gt;as = <a class="code" href="rn-extern_8h.html#d3b2637627bbb86acf01b38d07495042">rn_getas</a>(m);
<a name="l00035"></a>00035         ar = <a class="code" href="rn-extern_8h.html#d45bc39e5a89bce656786b571acb1ae8">rn_getarea</a>(m);
<a name="l00036"></a>00036 
<a name="l00037"></a>00037         <span class="comment">// Check for local parameter settings</span>
<a name="l00038"></a>00038         <span class="comment">// then check for global parameter settings</span>
<a name="l00039"></a>00039         <span class="comment">// then set to defaults</span>
<a name="l00040"></a>00040         <span class="keywordflow">if</span>(0 != strcmp(<span class="stringliteral">""</span>, <a class="code" href="rn-extern_8h.html#7a1c29f5a0e60ab08e5593acf5a463ba">xml_getprop</a>(node, <span class="stringliteral">"keep_alive"</span>)))
<a name="l00041"></a>00041         {
<a name="l00042"></a>00042                 <span class="comment">//state-&gt;keepalive_interval = atof(xml_getprop(node, "keep_alive"));</span>
<a name="l00043"></a>00043                 <span class="comment">//state-&gt;hold_interval = atof(xml_getprop(node, "hold"));</span>
<a name="l00044"></a>00044                 <span class="comment">//state-&gt;mrai = atof(xml_getprop(node, "mrai"));</span>
<a name="l00045"></a>00045         } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(NULL != <a class="code" href="bgp-extern_8h.html#c272d2ccc839a484a3bc7b4b0e3eb706">g_bgp_state</a>)
<a name="l00046"></a>00046         {
<a name="l00047"></a>00047                 state-&gt;keepalive_interval = <a class="code" href="bgp-extern_8h.html#c272d2ccc839a484a3bc7b4b0e3eb706">g_bgp_state</a>-&gt;keepalive_interval;
<a name="l00048"></a>00048                 state-&gt;hold_interval = <a class="code" href="bgp-extern_8h.html#c272d2ccc839a484a3bc7b4b0e3eb706">g_bgp_state</a>-&gt;hold_interval;
<a name="l00049"></a>00049                 state-&gt;mrai_interval = <a class="code" href="bgp-extern_8h.html#c272d2ccc839a484a3bc7b4b0e3eb706">g_bgp_state</a>-&gt;mrai_interval;
<a name="l00050"></a>00050         } <span class="keywordflow">else</span>
<a name="l00051"></a>00051         {
<a name="l00052"></a>00052                 <span class="comment">//state-&gt;keepalive_interval = 30.0;</span>
<a name="l00053"></a>00053                 <span class="comment">//state-&gt;hold_interval = 45.0;</span>
<a name="l00054"></a>00054                 <span class="comment">//state-&gt;mrai = 90.0;</span>
<a name="l00055"></a>00055         }
<a name="l00056"></a>00056 
<a name="l00057"></a>00057         <span class="comment">/*</span>
<a name="l00058"></a>00058 <span class="comment">         * Now we need to set up the interfaces for the BGP neighbors</span>
<a name="l00059"></a>00059 <span class="comment">         */</span>
<a name="l00060"></a>00060         <span class="keywordflow">for</span>(interface = node-&gt;children; interface; interface = interface-&gt;next)
<a name="l00061"></a>00061         {
<a name="l00062"></a>00062                 <span class="keywordflow">if</span>(0 != strcmp((<span class="keywordtype">char</span> *) interface-&gt;name, <span class="stringliteral">"neighbor"</span>))
<a name="l00063"></a>00063                         <span class="keywordflow">continue</span>;
<a name="l00064"></a>00064 
<a name="l00065"></a>00065                 state-&gt;n_interfaces++;
<a name="l00066"></a>00066         }
<a name="l00067"></a>00067 
<a name="l00068"></a>00068         <span class="comment">// Add in the iBGP neighbors</span>
<a name="l00069"></a>00069 <span class="preprocessor">#if IBGP</span>
<a name="l00070"></a>00070 <span class="preprocessor"></span>        state-&gt;n_interfaces += <a class="code" href="bgp-extern_8h.html#37246d0bc0a86a0894140f428db491ed">g_bgp_ases</a>[state-&gt;as-&gt;id]-&gt;nodesetval-&gt;nodeNr - 1;
<a name="l00071"></a>00071         state-&gt;n_interfaces += state-&gt;as-&gt;nareas;
<a name="l00072"></a>00072 <span class="preprocessor">#endif</span>
<a name="l00073"></a>00073 <span class="preprocessor"></span>
<a name="l00074"></a>00074         <span class="keywordflow">if</span>(state-&gt;n_interfaces &lt;= 0)
<a name="l00075"></a>00075                 <span class="keywordflow">return</span>; <span class="comment">//tw_error(TW_LOC, "BGP router has no neighbors!");</span>
<a name="l00076"></a>00076 
<a name="l00077"></a>00077         state-&gt;nbr = (bgp_nbr *) calloc(<span class="keyword">sizeof</span>(bgp_nbr), state-&gt;n_interfaces);
<a name="l00078"></a>00078 
<a name="l00079"></a>00079         <span class="keywordflow">if</span>(!state-&gt;nbr)
<a name="l00080"></a>00080                 tw_error(TW_LOC, <span class="stringliteral">"Out of memory!"</span>);
<a name="l00081"></a>00081 
<a name="l00082"></a>00082         <span class="keywordflow">for</span>(i = 0, interface = node-&gt;children; interface; interface = interface-&gt;next)
<a name="l00083"></a>00083         {
<a name="l00084"></a>00084                 <span class="keywordflow">if</span>(0 != strcmp((<span class="keywordtype">char</span> *) interface-&gt;name, <span class="stringliteral">"neighbor"</span>))
<a name="l00085"></a>00085                         <span class="keywordflow">continue</span>;
<a name="l00086"></a>00086 
<a name="l00087"></a>00087                 <span class="keywordflow">if</span>(<a class="code" href="rn-extern_8h.html#b586ebafc20ad652dd538635f5c816b0">rn_getmachine</a>(atoi(<a class="code" href="rn-extern_8h.html#7a1c29f5a0e60ab08e5593acf5a463ba">xml_getprop</a>(interface, <span class="stringliteral">"addr"</span>)))-&gt;subnet-&gt;area-&gt;as == state-&gt;as)
<a name="l00088"></a>00088                 {
<a name="l00089"></a>00089                         <span class="keywordflow">if</span>(lp-&gt;id % 100000 == 0)
<a name="l00090"></a>00090                                 printf(<span class="stringliteral">"%lld: removing iBGP node from nbrs: %d \n"</span>,
<a name="l00091"></a>00091                                         lp-&gt;id, atoi(<a class="code" href="rn-extern_8h.html#7a1c29f5a0e60ab08e5593acf5a463ba">xml_getprop</a>(interface, <span class="stringliteral">"addr"</span>)));
<a name="l00092"></a>00092                         state-&gt;n_interfaces--;
<a name="l00093"></a>00093                         <span class="keywordflow">continue</span>;
<a name="l00094"></a>00094                 }
<a name="l00095"></a>00095 
<a name="l00096"></a>00096                 n = &amp;state-&gt;nbr[i++];
<a name="l00097"></a>00097 
<a name="l00098"></a>00098                 n-&gt;up = TW_FALSE;
<a name="l00099"></a>00099                 n-&gt;id = atoi(<a class="code" href="rn-extern_8h.html#7a1c29f5a0e60ab08e5593acf5a463ba">xml_getprop</a>(interface, <span class="stringliteral">"addr"</span>));
<a name="l00100"></a>00100 
<a name="l00101"></a>00101                 <a class="code" href="bgp-extern_8h.html#5c7a53c0af93ddd5e897fe79643be44d">g_bgp_as</a>[state-&gt;as-&gt;id].degree[<a class="code" href="rn-extern_8h.html#d3b2637627bbb86acf01b38d07495042">rn_getas</a>(<a class="code" href="rn-extern_8h.html#b586ebafc20ad652dd538635f5c816b0">rn_getmachine</a>(n-&gt;id))-&gt;id]++;
<a name="l00102"></a>00102                 <a class="code" href="bgp-extern_8h.html#5c7a53c0af93ddd5e897fe79643be44d">g_bgp_as</a>[state-&gt;as-&gt;id].degree[state-&gt;as-&gt;id]++;
<a name="l00103"></a>00103 
<a name="l00104"></a>00104 <span class="preprocessor">#if 0</span>
<a name="l00105"></a>00105 <span class="preprocessor"></span>                local_pref = <a class="code" href="rn-extern_8h.html#7a1c29f5a0e60ab08e5593acf5a463ba">xml_getprop</a>(interface, <span class="stringliteral">"local_pref"</span>);
<a name="l00106"></a>00106 
<a name="l00107"></a>00107                 <span class="keywordflow">if</span>(0 != strcmp(<span class="stringliteral">""</span>, local_pref))
<a name="l00108"></a>00108                 {
<a name="l00109"></a>00109                         n-&gt;local_pref = atoi(local_pref);
<a name="l00110"></a>00110 
<a name="l00111"></a>00111 <span class="preprocessor">#if VERIFY_BGP</span>
<a name="l00112"></a>00112 <span class="preprocessor"></span>                        printf(<span class="stringliteral">"%ld BGP: nbr %d local_pref: %d \n"</span>,
<a name="l00113"></a>00113                                 lp-&gt;id, n-&gt;id, n-&gt;local_pref);
<a name="l00114"></a>00114 <span class="preprocessor">#endif</span>
<a name="l00115"></a>00115 <span class="preprocessor"></span>                } <span class="keywordflow">else</span>
<a name="l00116"></a>00116                 {
<a name="l00117"></a>00117                         n-&gt;local_pref = 100;
<a name="l00118"></a>00118                 }
<a name="l00119"></a>00119 <span class="preprocessor">#endif</span>
<a name="l00120"></a>00120 <span class="preprocessor"></span>        }
<a name="l00121"></a>00121 
<a name="l00122"></a>00122 <span class="preprocessor">#if IBGP</span>
<a name="l00123"></a>00123 <span class="preprocessor"></span>        <span class="comment">// AS level</span>
<a name="l00124"></a>00124 <span class="preprocessor">#if 0</span>
<a name="l00125"></a>00125 <span class="preprocessor"></span>        <span class="comment">// Determine Area root node</span>
<a name="l00126"></a>00126         <span class="keywordflow">if</span>(ar-&gt;root_lvl &gt; m-&gt;level)
<a name="l00127"></a>00127         {
<a name="l00128"></a>00128                 ar-&gt;root = m-&gt;id;
<a name="l00129"></a>00129                 ar-&gt;root_lvl = m-&gt;level;
<a name="l00130"></a>00130         }
<a name="l00131"></a>00131 <span class="preprocessor">#endif</span>
<a name="l00132"></a>00132 <span class="preprocessor"></span>
<a name="l00133"></a>00133         state-&gt;n_interfaces -= state-&gt;as-&gt;nareas;
<a name="l00134"></a>00134 
<a name="l00135"></a>00135         obj = <a class="code" href="bgp-extern_8h.html#37246d0bc0a86a0894140f428db491ed">g_bgp_ases</a>[state-&gt;as-&gt;id];
<a name="l00136"></a>00136         node2 = obj-&gt;nodesetval-&gt;nodeTab[0];
<a name="l00137"></a>00137         <span class="keywordflow">for</span>(j = 0; j &lt; obj-&gt;nodesetval-&gt;nodeNr; node2 = obj-&gt;nodesetval-&gt;nodeTab[++j])
<a name="l00138"></a>00138         {
<a name="l00139"></a>00139                 <span class="keywordtype">id</span> = atoi(<a class="code" href="rn-extern_8h.html#7a1c29f5a0e60ab08e5593acf5a463ba">xml_getprop</a>(node2-&gt;parent, <span class="stringliteral">"id"</span>));
<a name="l00140"></a>00140                 lvl = atoi(<a class="code" href="rn-extern_8h.html#7a1c29f5a0e60ab08e5593acf5a463ba">xml_getprop</a>(node2-&gt;parent, <span class="stringliteral">"lvl"</span>));
<a name="l00141"></a>00141 
<a name="l00142"></a>00142                 <span class="keywordflow">if</span>(<span class="keywordtype">id</span> == lp-&gt;id)
<a name="l00143"></a>00143                         <span class="keywordflow">continue</span>;
<a name="l00144"></a>00144 
<a name="l00145"></a>00145 <span class="preprocessor">#if IBGP_TREE</span>
<a name="l00146"></a>00146 <span class="preprocessor"></span>                diff = state-&gt;m-&gt;level - lvl;
<a name="l00147"></a>00147                 <span class="keywordflow">if</span>(state-&gt;m-&gt;subnet-&gt;area == <a class="code" href="rn-extern_8h.html#d45bc39e5a89bce656786b571acb1ae8">rn_getarea</a>(<a class="code" href="rn-extern_8h.html#b586ebafc20ad652dd538635f5c816b0">rn_getmachine</a>(<span class="keywordtype">id</span>)) &amp;&amp;
<a name="l00148"></a>00148                     (diff == -1 || diff == 1))
<a name="l00149"></a>00149                 {
<a name="l00150"></a>00150                         has_ibgp = 1;
<a name="l00151"></a>00151                         n = &amp;state-&gt;nbr[i++];
<a name="l00152"></a>00152                         n-&gt;id = id;
<a name="l00153"></a>00153                         n-&gt;up = TW_TRUE;
<a name="l00154"></a>00154                 } <span class="keywordflow">else</span>
<a name="l00155"></a>00155                         state-&gt;n_interfaces--;
<a name="l00156"></a>00156 <span class="preprocessor">#else</span>
<a name="l00157"></a>00157 <span class="preprocessor"></span>                n = &amp;state-&gt;nbr[i++];
<a name="l00158"></a>00158                 n-&gt;id = id;
<a name="l00159"></a>00159                 n-&gt;up = TW_TRUE;
<a name="l00160"></a>00160 <span class="preprocessor">#endif</span>
<a name="l00161"></a>00161 <span class="preprocessor"></span>        }
<a name="l00162"></a>00162 
<a name="l00163"></a>00163 <span class="preprocessor">#if 0</span>
<a name="l00164"></a>00164 <span class="preprocessor"></span>        <span class="comment">// Make sure we're at least connected once to our BGP network</span>
<a name="l00165"></a>00165         <span class="keywordflow">if</span>(state-&gt;m-&gt;root == 0 &amp;&amp; has_ibgp == 0)
<a name="l00166"></a>00166         {
<a name="l00167"></a>00167                 state-&gt;n_interfaces++;
<a name="l00168"></a>00168                 n = &amp;state-&gt;nbr[i++];
<a name="l00169"></a>00169                 n-&gt;id = state-&gt;m-&gt;subnet-&gt;area-&gt;root;
<a name="l00170"></a>00170                 n-&gt;up = TW_FALSE;
<a name="l00171"></a>00171         }
<a name="l00172"></a>00172 <span class="preprocessor">#endif</span>
<a name="l00173"></a>00173 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00174"></a>00174 <span class="preprocessor"></span>}
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="08efb2d86f752aeffd7d5631960ad79e"></a><!-- doxytag: member="bgp-extern.h::deal_with_timed_out_routers" ref="08efb2d86f752aeffd7d5631960ad79e" args="(bgp_state *state, tw_bf *bf, bgp_message *msg, tw_lp *lp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void deal_with_timed_out_routers           </td>
          <td>(</td>
          <td class="paramtype">bgp_state *&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_bf *&nbsp;</td>
          <td class="paramname"> <em>bf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bgp_message *&nbsp;</td>
          <td class="paramname"> <em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="bgp-keepalive_8c-source.html#l00156">156</a> of file <a class="el" href="bgp-keepalive_8c-source.html">bgp-keepalive.c</a>.</p>

<p>References <a class="el" href="bgp-ospf_8c-source.html#l00070">bgp_ospf_update()</a>, <a class="el" href="bgp-route_8c-source.html#l00052">bgp_route_free()</a>, <a class="el" href="bgp-route_8c-source.html#l00138">bgp_route_withdraw()</a>, <a class="el" href="bgp-update_8c-source.html#l00007">bgp_update_send()</a>, <a class="el" href="rn-global_8c-source.html#l00043">g_rn_nas</a>, <a class="el" href="rn-machine_8c-source.html#l00028">rn_getas()</a>, and <a class="el" href="rn-machine_8c-source.html#l00004">rn_getmachine()</a>.</p>

<p>Referenced by <a class="el" href="bgp-router_8c-source.html#l00004">bgp_event_handler()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00158"></a>00158 {
<a name="l00159"></a>00159         tw_stime        now;
<a name="l00160"></a>00160 
<a name="l00161"></a>00161         tw_memory      *b;
<a name="l00162"></a>00162         tw_memory      *r_next;
<a name="l00163"></a>00163 
<a name="l00164"></a>00164         bgp_route      *r;
<a name="l00165"></a>00165         bgp_nbr        *n;
<a name="l00166"></a>00166         bgp_nbr        *n1;
<a name="l00167"></a>00167 
<a name="l00168"></a>00168         <span class="keywordtype">int</span>             cause;
<a name="l00169"></a>00169         <span class="keywordtype">int</span>             found;
<a name="l00170"></a>00170         <span class="keywordtype">int</span>             i;
<a name="l00171"></a>00171         <span class="keywordtype">int</span>             j;
<a name="l00172"></a>00172 
<a name="l00173"></a>00173         now = floor(tw_now(lp));
<a name="l00174"></a>00174         <span class="comment">//msg-&gt;rev_num_neighbors = 0;</span>
<a name="l00175"></a>00175         <span class="comment">//msg-&gt;rc_asp = 0;</span>
<a name="l00176"></a>00176 
<a name="l00177"></a>00177         <span class="keywordflow">for</span> (i = 0, n = state-&gt;nbr; i &lt; state-&gt;n_interfaces; n = &amp;state-&gt;nbr[++i])
<a name="l00178"></a>00178         {
<a name="l00179"></a>00179                 <span class="keywordflow">if</span> (!n-&gt;up || ((now - n-&gt;last_update) &lt;= state-&gt;as-&gt;hold_interval))
<a name="l00180"></a>00180                         <span class="keywordflow">continue</span>;
<a name="l00181"></a>00181 
<a name="l00182"></a>00182 <span class="preprocessor">#if VERIFY_BGP</span>
<a name="l00183"></a>00183 <span class="preprocessor"></span>                fprintf(state-&gt;log, <span class="stringliteral">"\tnbr %d timed out: %lf &gt; %lf hold interval\n"</span>, 
<a name="l00184"></a>00184                         n-&gt;id, (now - n-&gt;last_update), state-&gt;as-&gt;hold_interval);
<a name="l00185"></a>00185 <span class="preprocessor">#endif</span>
<a name="l00186"></a>00186 <span class="preprocessor"></span>
<a name="l00187"></a>00187                 n-&gt;up = TW_FALSE;
<a name="l00188"></a>00188                 found = TW_FALSE;
<a name="l00189"></a>00189 
<a name="l00190"></a>00190                 <span class="comment">// If nbr timed out due to failed eBGP link, then the</span>
<a name="l00191"></a>00191                 <span class="comment">// cause of the UPDATES is BGP.</span>
<a name="l00192"></a>00192                 <span class="comment">//</span>
<a name="l00193"></a>00193                 <span class="comment">// If the nbr timed out due to a failed iBGP path to the</span>
<a name="l00194"></a>00194                 <span class="comment">// nbr, then the cause of the UPDATES is the OSPF network.</span>
<a name="l00195"></a>00195                 <span class="keywordflow">if</span>(<a class="code" href="rn-extern_8h.html#d3b2637627bbb86acf01b38d07495042">rn_getas</a>(<a class="code" href="rn-extern_8h.html#b586ebafc20ad652dd538635f5c816b0">rn_getmachine</a>(n-&gt;id)) != state-&gt;as)
<a name="l00196"></a>00196                         cause = 0;
<a name="l00197"></a>00197                 <span class="keywordflow">else</span>
<a name="l00198"></a>00198                         cause = 1;
<a name="l00199"></a>00199 
<a name="l00200"></a>00200                 <span class="comment">//bgp_notify_send(state, n, lp);</span>
<a name="l00201"></a>00201 
<a name="l00202"></a>00202                 <span class="comment">// Delete any routes originated by this timed out router</span>
<a name="l00203"></a>00203                 <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="rn-extern_8h.html#353089f1049e9e0d5160683103c17e62">g_rn_nas</a>; i++)
<a name="l00204"></a>00204                 {
<a name="l00205"></a>00205                         <span class="keywordflow">if</span>(NULL == (b = state-&gt;rib[i]))
<a name="l00206"></a>00206                                 <span class="keywordflow">continue</span>;
<a name="l00207"></a>00207 
<a name="l00208"></a>00208                         r = tw_memory_data(b);
<a name="l00209"></a>00209                         r_next = b-&gt;next;
<a name="l00210"></a>00210 
<a name="l00211"></a>00211                         <span class="keywordflow">if</span> (n-&gt;id != r-&gt;src)
<a name="l00212"></a>00212                                 <span class="keywordflow">continue</span>;
<a name="l00213"></a>00213 
<a name="l00214"></a>00214                         <span class="keywordflow">for</span> (j = 0; j &lt; state-&gt;n_interfaces; j++)
<a name="l00215"></a>00215                         {
<a name="l00216"></a>00216                                 n1 = &amp;state-&gt;nbr[j];
<a name="l00217"></a>00217 
<a name="l00218"></a>00218                                 <span class="keywordflow">if</span> (n1-&gt;up != TW_TRUE)
<a name="l00219"></a>00219                                         <span class="keywordflow">continue</span>;
<a name="l00220"></a>00220 
<a name="l00221"></a>00221                                 <span class="comment">//msg-&gt;rev_num_neighbors++;</span>
<a name="l00222"></a>00222 
<a name="l00223"></a>00223                                 msg-&gt;b.update = 0;
<a name="l00224"></a>00224                                 <a class="code" href="bgp-extern_8h.html#496b5be995649aa5e3a0da073a317755">bgp_update_send</a>(state, n1, r, msg, 1, lp);
<a name="l00225"></a>00225                         }
<a name="l00226"></a>00226 
<a name="l00227"></a>00227                         <a class="code" href="bgp-extern_8h.html#c3940d75bca1133bfd81eee76261dda2">bgp_route_withdraw</a>(state, r);
<a name="l00228"></a>00228                         <a class="code" href="bgp-extern_8h.html#8c7954f03a848dbd36bdf2e0ebbb7fa4">bgp_route_free</a>(state, b, lp);
<a name="l00229"></a>00229 
<a name="l00230"></a>00230                         <span class="comment">// Don't do for iBGP connections</span>
<a name="l00231"></a>00231                         <span class="keywordflow">if</span> (<a class="code" href="rn-extern_8h.html#d3b2637627bbb86acf01b38d07495042">rn_getas</a>(<a class="code" href="rn-extern_8h.html#b586ebafc20ad652dd538635f5c816b0">rn_getmachine</a>(r-&gt;src)) != state-&gt;as)
<a name="l00232"></a>00232                                 <a class="code" href="bgp-extern_8h.html#25cf78022511c7500c4fba258fe99071">bgp_ospf_update</a>(state, 
<a name="l00233"></a>00233                                                 <a class="code" href="rn-extern_8h.html#d3b2637627bbb86acf01b38d07495042">rn_getas</a>(<a class="code" href="rn-extern_8h.html#b586ebafc20ad652dd538635f5c816b0">rn_getmachine</a>(r-&gt;dst)), 
<a name="l00234"></a>00234                                                 r, TW_FALSE, lp);
<a name="l00235"></a>00235                 }
<a name="l00236"></a>00236         }
<a name="l00237"></a>00237 }
</pre></div>
<p>

</div>
</div><p>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="5c7a53c0af93ddd5e897fe79643be44d"></a><!-- doxytag: member="bgp-extern.h::g_bgp_as" ref="5c7a53c0af93ddd5e897fe79643be44d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bgp_as* <a class="el" href="bgp-global_8c.html#5c7a53c0af93ddd5e897fe79643be44d">g_bgp_as</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="bgp-global_8c-source.html#l00024">24</a> of file <a class="el" href="bgp-global_8c-source.html">bgp-global.c</a>.</p>

<p>Referenced by <a class="el" href="bgp-decision_8c-source.html#l00035">bgp_decision()</a>, <a class="el" href="bgp-main_8c-source.html#l00208">bgp_md_final()</a>, <a class="el" href="bgp-route_8c-source.html#l00221">bgp_route_copy()</a>, <a class="el" href="bgp-main_8c-source.html#l00109">bgp_setup_ases()</a>, <a class="el" href="bgp-main_8c-source.html#l00007">bgp_setup_options()</a>, and <a class="el" href="bgp-xml_8c-source.html#l00006">bgp_xml()</a>.</p>

</div>
</div><p>
<a class="anchor" name="37246d0bc0a86a0894140f428db491ed"></a><!-- doxytag: member="bgp-extern.h::g_bgp_ases" ref="37246d0bc0a86a0894140f428db491ed" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">xmlXPathObjectPtr* <a class="el" href="bgp-global_8c.html#37246d0bc0a86a0894140f428db491ed">g_bgp_ases</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="bgp-global_8c-source.html#l00031">31</a> of file <a class="el" href="bgp-global_8c-source.html">bgp-global.c</a>.</p>

<p>Referenced by <a class="el" href="bgp-main_8c-source.html#l00109">bgp_setup_ases()</a>, and <a class="el" href="bgp-xml_8c-source.html#l00006">bgp_xml()</a>.</p>

</div>
</div><p>
<a class="anchor" name="0c0827f912b6c5550b6dfaa922b3fdc9"></a><!-- doxytag: member="bgp-extern.h::g_bgp_fd" ref="0c0827f912b6c5550b6dfaa922b3fdc9" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tw_fd <a class="el" href="bgp-global_8c.html#0c0827f912b6c5550b6dfaa922b3fdc9">g_bgp_fd</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="bgp-global_8c-source.html#l00010">10</a> of file <a class="el" href="bgp-global_8c-source.html">bgp-global.c</a>.</p>

<p>Referenced by <a class="el" href="bgp-connect_8c-source.html#l00013">bgp_connect()</a>, <a class="el" href="bgp-router_8c-source.html#l00004">bgp_event_handler()</a>, <a class="el" href="bgp-keepalive_8c-source.html#l00020">bgp_keepalive_send()</a>, <a class="el" href="bgp-keepalive_8c-source.html#l00113">bgp_keepalive_timer()</a>, <a class="el" href="bgp-main_8c-source.html#l00147">bgp_main()</a>, <a class="el" href="bgp-notify_8c-source.html#l00004">bgp_notify_send()</a>, <a class="el" href="bgp-open_8c-source.html#l00004">bgp_open_send()</a>, <a class="el" href="bgp-utils_8c-source.html#l00004">bgp_timer_start()</a>, and <a class="el" href="bgp-update_8c-source.html#l00007">bgp_update_send()</a>.</p>

</div>
</div><p>
<a class="anchor" name="ae8e41b9fd5752112bd1e1f06aa00843"></a><!-- doxytag: member="bgp-extern.h::g_bgp_fd_asp" ref="ae8e41b9fd5752112bd1e1f06aa00843" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tw_fd <a class="el" href="bgp-global_8c.html#ae8e41b9fd5752112bd1e1f06aa00843">g_bgp_fd_asp</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="bgp-global_8c-source.html#l00012">12</a> of file <a class="el" href="bgp-global_8c-source.html">bgp-global.c</a>.</p>

<p>Referenced by <a class="el" href="bgp-main_8c-source.html#l00147">bgp_main()</a>, <a class="el" href="bgp-route_8c-source.html#l00221">bgp_route_copy()</a>, <a class="el" href="bgp-route_8c-source.html#l00052">bgp_route_free()</a>, <a class="el" href="bgp-init_8c-source.html#l00004">init_rib()</a>, <a class="el" href="bgp-rc-router_8c-source.html#l00138">r_deal_with_timed_out_bgp_routers()</a>, and <a class="el" href="bgp-rc-router_8c-source.html#l00027">r_msg_update()</a>.</p>

</div>
</div><p>
<a class="anchor" name="7603addb7e529a1f5639178c389a5500"></a><!-- doxytag: member="bgp-extern.h::g_bgp_fd_rtes" ref="7603addb7e529a1f5639178c389a5500" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tw_fd <a class="el" href="bgp-global_8c.html#7603addb7e529a1f5639178c389a5500">g_bgp_fd_rtes</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="bgp-global_8c-source.html#l00011">11</a> of file <a class="el" href="bgp-global_8c-source.html">bgp-global.c</a>.</p>

<p>Referenced by <a class="el" href="bgp-main_8c-source.html#l00147">bgp_main()</a>, <a class="el" href="bgp-route_8c-source.html#l00221">bgp_route_copy()</a>, <a class="el" href="bgp-route_8c-source.html#l00052">bgp_route_free()</a>, <a class="el" href="bgp-route_8c-source.html#l00157">bgp_route_new()</a>, <a class="el" href="bgp-update_8c-source.html#l00007">bgp_update_send()</a>, <a class="el" href="bgp-init_8c-source.html#l00004">init_rib()</a>, <a class="el" href="bgp-rc-router_8c-source.html#l00138">r_deal_with_timed_out_bgp_routers()</a>, and <a class="el" href="bgp-rc-router_8c-source.html#l00027">r_msg_update()</a>.</p>

</div>
</div><p>
<a class="anchor" name="9831e3cdf81522cd09b8691b0a8fe89f"></a><!-- doxytag: member="bgp-extern.h::g_bgp_init_file" ref="9831e3cdf81522cd09b8691b0a8fe89f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* <a class="el" href="bgp-global_8c.html#9831e3cdf81522cd09b8691b0a8fe89f">g_bgp_init_file</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="bgp-global_8c-source.html#l00026">26</a> of file <a class="el" href="bgp-global_8c-source.html">bgp-global.c</a>.</p>

<p>Referenced by <a class="el" href="bgp-main_8c-source.html#l00007">bgp_setup_options()</a>.</p>

</div>
</div><p>
<a class="anchor" name="f18fc4fa7c4a304602705fa8b8c0983a"></a><!-- doxytag: member="bgp-extern.h::g_bgp_rt_fd" ref="f18fc4fa7c4a304602705fa8b8c0983a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">FILE* <a class="el" href="bgp-global_8c.html#f18fc4fa7c4a304602705fa8b8c0983a">g_bgp_rt_fd</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="bgp-global_8c-source.html#l00032">32</a> of file <a class="el" href="bgp-global_8c-source.html">bgp-global.c</a>.</p>

<p>Referenced by <a class="el" href="bgp-stats_8c-source.html#l00004">bgp_final()</a>, <a class="el" href="bgp-main_8c-source.html#l00147">bgp_main()</a>, <a class="el" href="bgp-main_8c-source.html#l00208">bgp_md_final()</a>, and <a class="el" href="bgp-init_8c-source.html#l00004">init_rib()</a>.</p>

</div>
</div><p>
<a class="anchor" name="c272d2ccc839a484a3bc7b4b0e3eb706"></a><!-- doxytag: member="bgp-extern.h::g_bgp_state" ref="c272d2ccc839a484a3bc7b4b0e3eb706" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bgp_state* <a class="el" href="bgp-global_8c.html#c272d2ccc839a484a3bc7b4b0e3eb706">g_bgp_state</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="bgp-global_8c-source.html#l00025">25</a> of file <a class="el" href="bgp-global_8c-source.html">bgp-global.c</a>.</p>

<p>Referenced by <a class="el" href="bgp-decision_8c-source.html#l00035">bgp_decision()</a>, <a class="el" href="bgp-keepalive_8c-source.html#l00042">bgp_keepalive()</a>, <a class="el" href="bgp-main_8c-source.html#l00109">bgp_setup_ases()</a>, <a class="el" href="bgp-main_8c-source.html#l00007">bgp_setup_options()</a>, and <a class="el" href="bgp-xml_8c-source.html#l00006">bgp_xml()</a>.</p>

</div>
</div><p>
<a class="anchor" name="8dabf86717f4ff196e80b39046d6cb5e"></a><!-- doxytag: member="bgp-extern.h::g_bgp_stats" ref="8dabf86717f4ff196e80b39046d6cb5e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bgp_stats <a class="el" href="bgp-global_8c.html#8dabf86717f4ff196e80b39046d6cb5e">g_bgp_stats</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="bgp-global_8c-source.html#l00023">23</a> of file <a class="el" href="bgp-global_8c-source.html">bgp-global.c</a>.</p>

<p>Referenced by <a class="el" href="bgp-decision_8c-source.html#l00035">bgp_decision()</a>, <a class="el" href="bgp-stats_8c-source.html#l00004">bgp_final()</a>, <a class="el" href="bgp-main_8c-source.html#l00208">bgp_md_final()</a>, and <a class="el" href="bgp-update_8c-source.html#l00007">bgp_update_send()</a>.</p>

</div>
</div><p>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Tue Jan 27 09:38:29 2009 for ROSS.Net by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.5 </small></address>
</body>
</html>
