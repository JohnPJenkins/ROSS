<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>ROSS.Net: bgp-connect.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.5 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>bgp-connect.c File Reference</h1>
<p>
<code>#include &lt;<a class="el" href="bgp_8h-source.html">bgp.h</a>&gt;</code><br>

<p>
<a href="bgp-connect_8c-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp-connect_8c.html#a1e689502a42cd1f8dc2e3e48ca2fd85">bgp_connect</a> (bgp_state *state, bgp_nbr *n, tw_lp *lp)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a1e689502a42cd1f8dc2e3e48ca2fd85"></a><!-- doxytag: member="bgp-connect.c::bgp_connect" ref="a1e689502a42cd1f8dc2e3e48ca2fd85" args="(bgp_state *state, bgp_nbr *n, tw_lp *lp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bgp_connect           </td>
          <td>(</td>
          <td class="paramtype">bgp_state *&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bgp_nbr *&nbsp;</td>
          <td class="paramname"> <em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Send a BGP CONNECT message to complete the connection established process.<p>
BGP needs CONNECT message from transport layer.. upon receiving ANY msg from another BGP router, the OPEN msg is created and sent to that neighbor. Do not use these for anything other than during the init phase. I have changed the process somewhat so that each peer on either side of a connection do not need to send the CONNECT. 
<p>Definition at line <a class="el" href="bgp-connect_8c-source.html#l00013">13</a> of file <a class="el" href="bgp-connect_8c-source.html">bgp-connect.c</a>.</p>

<p>References <a class="el" href="bgp-types_8h-source.html#l00012">BGP_CONNECT</a>, <a class="el" href="rn-types_8h-source.html#l00055">DOWNSTREAM</a>, <a class="el" href="bgp-global_8c-source.html#l00010">g_bgp_fd</a>, <a class="el" href="rn-event_8c-source.html#l00058">rn_event_new()</a>, <a class="el" href="rn-event_8c-source.html#l00173">rn_event_send()</a>, <a class="el" href="rn-link_8c-source.html#l00017">rn_getlink()</a>, and <a class="el" href="rn-routing_8c-source.html#l00007">rn_route()</a>.</p>

<p>Referenced by <a class="el" href="bgp-init_8c-source.html#l00070">bgp_init()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00014"></a>00014 {
<a name="l00015"></a>00015         tw_event        *e;
<a name="l00016"></a>00016         tw_memory       *hdr;
<a name="l00017"></a>00017         tw_stime         ts = 0.0;
<a name="l00018"></a>00018 
<a name="l00019"></a>00019         bgp_message     *m;
<a name="l00020"></a>00020 
<a name="l00021"></a>00021 <span class="preprocessor">#if 1</span>
<a name="l00022"></a>00022 <span class="preprocessor"></span>        <span class="keywordflow">if</span>(lp-&gt;id &lt; n-&gt;id)
<a name="l00023"></a>00023                 ts = 0.0;
<a name="l00024"></a>00024         <span class="keywordflow">else</span>
<a name="l00025"></a>00025                 <span class="keywordflow">return</span>;
<a name="l00026"></a>00026 <span class="preprocessor">#endif</span>
<a name="l00027"></a>00027 <span class="preprocessor"></span>
<a name="l00028"></a>00028 <span class="preprocessor">#if VERIFY_BGP</span>
<a name="l00029"></a>00029 <span class="preprocessor"></span>        printf(<span class="stringliteral">"%ld: BGP router coming online, connecting to %d: %lf \n"</span>, 
<a name="l00030"></a>00030                 lp-&gt;id, n-&gt;id, ts);
<a name="l00031"></a>00031 <span class="preprocessor">#endif</span>
<a name="l00032"></a>00032 <span class="preprocessor"></span>
<a name="l00033"></a>00033         state-&gt;stats-&gt;s_nconnects++;
<a name="l00034"></a>00034         e = <a class="code" href="rn-event_8c.html#5508bcf53c1fbeb71e6055021634a726">rn_event_new</a>(n-&gt;id, ts, lp, <a class="code" href="rn-types_8h.html#3fc738f2924cae2b2d04a9a133c3ef02193085e792a05c4538ec2bc24c845652">DOWNSTREAM</a>, <a class="code" href="bgp-types_8h.html#eb7e42361408128a97040f1b9e75b305">BGP_CONNECT</a>);
<a name="l00035"></a>00035 
<a name="l00036"></a>00036         <span class="comment">// Create the BGP message header</span>
<a name="l00037"></a>00037         hdr = tw_memory_alloc(lp, <a class="code" href="bgp-extern_8h.html#0c0827f912b6c5550b6dfaa922b3fdc9">g_bgp_fd</a>);
<a name="l00038"></a>00038         m = tw_memory_data(hdr);
<a name="l00039"></a>00039 
<a name="l00040"></a>00040         m-&gt;b.type = CONNECT;
<a name="l00041"></a>00041         m-&gt;b.cause_bgp = 1;
<a name="l00042"></a>00042         m-&gt;b.cause_ospf = 0;
<a name="l00043"></a>00043 
<a name="l00044"></a>00044         tw_event_memory_set(e, hdr, <a class="code" href="bgp-extern_8h.html#0c0827f912b6c5550b6dfaa922b3fdc9">g_bgp_fd</a>);
<a name="l00045"></a>00045         <a class="code" href="rn-event_8c.html#8c3496e774b118a7e411ea5bcd23d49a">rn_event_send</a>(e);
<a name="l00046"></a>00046 
<a name="l00047"></a>00047         <span class="keywordflow">if</span>(e == lp-&gt;pe-&gt;abort_event)
<a name="l00048"></a>00048         {
<a name="l00049"></a>00049                 state-&gt;stats-&gt;s_nconnects_dropped++;
<a name="l00050"></a>00050         } <span class="keywordflow">else</span>
<a name="l00051"></a>00051         {
<a name="l00052"></a>00052                 <span class="keywordflow">if</span>(NULL == <a class="code" href="rn-extern_8h.html#d7173e076af48912ba761e8ef0cc1b22">rn_getlink</a>(state-&gt;m, n-&gt;id))
<a name="l00053"></a>00053                         <span class="keywordflow">if</span>(-1 == <a class="code" href="rn-extern_8h.html#8890679c55545bd36e770b118a920b57">rn_route</a>(state-&gt;m, n-&gt;id))
<a name="l00054"></a>00054                                 state-&gt;stats-&gt;s_nconnects_dropped++;
<a name="l00055"></a>00055         }
<a name="l00056"></a>00056 }
</pre></div>
<p>

</div>
</div><p>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Tue Jan 27 09:38:29 2009 for ROSS.Net by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.5 </small></address>
</body>
</html>
