<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>ROSS.Net: tcp-extern.h File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.5 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>tcp-extern.h File Reference</h1>
<p>

<p>
<a href="tcp-extern_8h-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">tw_event *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="tcp-extern_8h.html#691485c1594ac62ccef2c1666b9400ae">tcp_timer_reset</a> (tw_event *timer, tw_bf *bf, tcp_message *old, tw_stime ts, int sn, tw_lp *lp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">tw_event *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="tcp-extern_8h.html#29578a91955aef8aeeea1b8a62a8a8a1">tcp_rc_timer_reset</a> (tw_event *, tw_bf *bf, tcp_message *old, tw_lp *lp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="tcp-extern_8h.html#f80b2e5842194d41e1afe313399b9969">tcp_timer_cancel</a> (tw_event *timer, tw_bf *bf, tcp_message *old, tw_lp *lp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">tw_event *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="tcp-extern_8h.html#31e654422e1a04177aa379303009eade">tcp_rc_timer_cancel</a> (tcp_message *old, tw_lp *lp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="tcp-extern_8h.html#785c5082870b45cce614c327c6e56931">tcp_xml</a> (tcp_state *, const xmlNodePtr node, tw_lp *)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="tcp-extern_8h.html#cb9618e87865af63cb138f314b6eb7ac">tcp_md_init</a> (int argc, char **argv, char **env)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="tcp-extern_8h.html#2e48ecfb966ea421f650c398d14ff80e">tcp_md_final</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="tcp-extern_8h.html#f85588003ef283f2b22a0f4139c1a92c">tcp_init</a> (tcp_state *, tw_lp *)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="tcp-extern_8h.html#000a6ff7c7155a9758ee94b8fa6e7053">tcp_event_handler</a> (tcp_state *, tw_bf *, rn_message *, tw_lp *)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="tcp-extern_8h.html#0d9d5d4bbe6d7bc40126ee2f83a5763a">tcp_final</a> (tcp_state *, tw_lp *)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="tcp-extern_8h.html#1642d0b80ac5976179f759c750b8c2f4">tcp_rc_event_handler</a> (tcp_state *, tw_bf *, rn_message *, tw_lp *)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="tcp-extern_8h.html#6fa1c6585b6900b71ceb9d3b924b2973">tcp_process</a> (tcp_state *, tw_bf *, tcp_message *, tw_lp *)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="tcp-extern_8h.html#32de62f36baa6ebfdfe80cf401b7b43c">tcp_process_ack</a> (tcp_state *, tw_bf *, tcp_message *, tw_lp *)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="tcp-extern_8h.html#1e09a7f153c40da7c51f70a98c52d2f0">tcp_process_data</a> (tcp_state *, tw_bf *, tcp_message *, tw_lp *)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="tcp-extern_8h.html#988ae04ae2641397b555bf920b74dbab">tcp_update_cwnd</a> (tcp_state *, tw_bf *, tcp_message *, tw_lp *)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="tcp-extern_8h.html#9fea5e5b8ba7c3c26e34485ff852f15c">tcp_update_rtt</a> (tcp_state *, tw_bf *, tcp_message *, tw_lp *)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="tcp-extern_8h.html#6740b899f7c26447920a330f61c81785">tcp_timeout</a> (tcp_state *, tw_bf *, tcp_message *, tw_lp *)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="tcp-extern_8h.html#c72732ddf7b49aa5a488bfa5c5cb903a">tcp_rc_process_ack</a> (tcp_state *, tw_bf *, tcp_message *, tw_lp *)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="tcp-extern_8h.html#ff2d805121df3d917e635a5fe3ee3f98">tcp_rc_process_data</a> (tcp_state *, tw_bf *, tcp_message *, tw_lp *)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="tcp-extern_8h.html#018b307dc3390350de6b0bbae2fcbf10">tcp_rc_timeout</a> (tcp_state *, tw_bf *, tcp_message *, tw_lp *)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="tcp-extern_8h.html#9fb1779004db5917c4b4a2b8aa11983c">tcp_event_send</a> (tcp_state *, tw_lpid, tw_stime, tw_lpid, int, int, int, tw_lp *)</td></tr>

<tr><td colspan="2"><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">tcp_state *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="tcp-extern_8h.html#52dec74980939216a0183d859900fcf9">g_state</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">tw_fd&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="tcp-extern_8h.html#fc7419e447b8804f025e5e639a074697">g_tcp_fd</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">tcp_statistics *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="tcp-extern_8h.html#619e70fec1748431359716fb7e41362b">g_tcp_stats</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="tcp-extern_8h.html#9b2cad8ae88cd10efe8c00282a4b95d5">g_tcp_mss</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="tcp-extern_8h.html#0a83cfbf10d9a57c9b242029954bf326">g_tcp_rwd</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">FILE *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="tcp-extern_8h.html#8be473910492b1465ebb3fa463de7bf7">g_tcp_f</a></td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="000a6ff7c7155a9758ee94b8fa6e7053"></a><!-- doxytag: member="tcp-extern.h::tcp_event_handler" ref="000a6ff7c7155a9758ee94b8fa6e7053" args="(tcp_state *, tw_bf *, rn_message *, tw_lp *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void tcp_event_handler           </td>
          <td>(</td>
          <td class="paramtype">tcp_state *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_bf *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">rn_message *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="tcp_8c-source.html#l00118">118</a> of file <a class="el" href="tcp_8c-source.html">tcp.c</a>.</p>

<p>References <a class="el" href="rn-types_8h-source.html#l00055">DOWNSTREAM</a>, <a class="el" href="tcp-global_8c-source.html#l00009">g_tcp_fd</a>, <a class="el" href="tcp_8c-source.html#l00025">start_transfer()</a>, <a class="el" href="tcp_8c-source.html#l00004">stop_transfer()</a>, <a class="el" href="tcp-process_8c-source.html#l00007">tcp_process_ack()</a>, <a class="el" href="tcp-process_8c-source.html#l00140">tcp_process_data()</a>, <a class="el" href="tcp-timeout_8c-source.html#l00004">tcp_timeout()</a>, and <a class="el" href="rn-types_8h-source.html#l00056">TIMER</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00119"></a>00119 {
<a name="l00120"></a>00120         tw_memory       *b;
<a name="l00121"></a>00121         tcp_message     *in = NULL;
<a name="l00122"></a>00122 
<a name="l00123"></a>00123         *(<span class="keywordtype">int</span> *) bf = 0;
<a name="l00124"></a>00124 
<a name="l00125"></a>00125         <span class="comment">// if no membuf, then must be application layer</span>
<a name="l00126"></a>00126         <span class="keywordflow">if</span>(NULL != (b = tw_event_memory_get(lp)))
<a name="l00127"></a>00127                 in = tw_memory_data(b);
<a name="l00128"></a>00128 
<a name="l00129"></a>00129         <span class="keywordflow">if</span>(m-&gt;type == <a class="code" href="rn-types_8h.html#3fc738f2924cae2b2d04a9a133c3ef02193085e792a05c4538ec2bc24c845652">DOWNSTREAM</a>)
<a name="l00130"></a>00130         {
<a name="l00131"></a>00131                 <span class="keywordflow">if</span>(m-&gt;size)
<a name="l00132"></a>00132                         <a class="code" href="tcp_8c.html#d11a233148fa4e10c6ac5aef0f160e23">start_transfer</a>(state, bf, m, lp);
<a name="l00133"></a>00133                 <span class="keywordflow">else</span>
<a name="l00134"></a>00134                         <a class="code" href="tcp_8c.html#62e3ac81f3a39354c45837214e90244c">stop_transfer</a>(state, bf, m, lp);
<a name="l00135"></a>00135         } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(m-&gt;type == <a class="code" href="rn-types_8h.html#3fc738f2924cae2b2d04a9a133c3ef0217ba9bae1b8d7e8d6c12d46ec58e0769">TIMER</a>)
<a name="l00136"></a>00136         {
<a name="l00137"></a>00137 <span class="preprocessor">#ifdef TCP_DEBUG</span>
<a name="l00138"></a>00138 <span class="preprocessor"></span>                printf(<span class="stringliteral">"%lld: RTO for %lld at %lf (%ld)\n"</span>,
<a name="l00139"></a>00139                         lp-&gt;id, in-&gt;src, tw_now(lp), (<span class="keywordtype">long</span> <span class="keywordtype">int</span>) lp-&gt;pe-&gt;cur_event);
<a name="l00140"></a>00140 <span class="preprocessor">#endif</span>
<a name="l00141"></a>00141 <span class="preprocessor"></span>
<a name="l00142"></a>00142                 <a class="code" href="tcp-extern_8h.html#6740b899f7c26447920a330f61c81785">tcp_timeout</a>(state, bf, in, lp);
<a name="l00143"></a>00143         } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(state-&gt;connection != -1)
<a name="l00144"></a>00144         {
<a name="l00145"></a>00145 <span class="preprocessor">#ifdef TCP_DEBUG</span>
<a name="l00146"></a>00146 <span class="preprocessor"></span>                printf(<span class="stringliteral">"%lld: ACK from %lld at %lf \n"</span>, lp-&gt;id, in-&gt;src, tw_now(lp));
<a name="l00147"></a>00147 <span class="preprocessor">#endif</span>
<a name="l00148"></a>00148 <span class="preprocessor"></span>                <a class="code" href="tcp-extern_8h.html#32de62f36baa6ebfdfe80cf401b7b43c">tcp_process_ack</a>(state, bf, in, lp);
<a name="l00149"></a>00149         } <span class="keywordflow">else</span>
<a name="l00150"></a>00150         {
<a name="l00151"></a>00151 <span class="preprocessor">#ifdef TCP_DEBUG</span>
<a name="l00152"></a>00152 <span class="preprocessor"></span>                printf(<span class="stringliteral">"%lld: DATA from %lld at %lf \n"</span>, lp-&gt;id, in-&gt;src, tw_now(lp));
<a name="l00153"></a>00153 <span class="preprocessor">#endif</span>
<a name="l00154"></a>00154 <span class="preprocessor"></span>                <a class="code" href="tcp-extern_8h.html#1e09a7f153c40da7c51f70a98c52d2f0">tcp_process_data</a>(state, bf, in, lp);
<a name="l00155"></a>00155         }
<a name="l00156"></a>00156 
<a name="l00157"></a>00157         <span class="keywordflow">if</span>(b)
<a name="l00158"></a>00158                 tw_memory_free(lp, b, <a class="code" href="tcp-extern_8h.html#fc7419e447b8804f025e5e639a074697">g_tcp_fd</a>);
<a name="l00159"></a>00159 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="9fb1779004db5917c4b4a2b8aa11983c"></a><!-- doxytag: member="tcp-extern.h::tcp_event_send" ref="9fb1779004db5917c4b4a2b8aa11983c" args="(tcp_state *, tw_lpid, tw_stime, tw_lpid, int, int, int, tw_lp *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void tcp_event_send           </td>
          <td>(</td>
          <td class="paramtype">tcp_state *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lpid&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_stime&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lpid&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="tcp-util_8c-source.html#l00004">4</a> of file <a class="el" href="tcp-util_8c-source.html">tcp-util.c</a>.</p>

<p>References <a class="el" href="rn-types_8h-source.html#l00055">DOWNSTREAM</a>, <a class="el" href="tcp-global_8c-source.html#l00012">g_tcp_f</a>, <a class="el" href="tcp-global_8c-source.html#l00009">g_tcp_fd</a>, <a class="el" href="rn-event_8c-source.html#l00058">rn_event_new()</a>, <a class="el" href="rn-event_8c-source.html#l00173">rn_event_send()</a>, and <a class="el" href="rn-message_8c-source.html#l00004">rn_message_setsize()</a>.</p>

<p>Referenced by <a class="el" href="tcp_8c-source.html#l00025">start_transfer()</a>, <a class="el" href="tcp-host_8c-source.html#l00010">tcp_host_process_ack()</a>, <a class="el" href="tcp-host_8c-source.html#l00156">tcp_host_process_data()</a>, <a class="el" href="tcp-host_8c-source.html#l00353">tcp_host_timeout()</a>, <a class="el" href="tcp-process_8c-source.html#l00007">tcp_process_ack()</a>, <a class="el" href="tcp-process_8c-source.html#l00140">tcp_process_data()</a>, and <a class="el" href="tcp-timeout_8c-source.html#l00004">tcp_timeout()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00006"></a>00006 {
<a name="l00007"></a>00007         tw_event        *e;
<a name="l00008"></a>00008         tw_memory       *b;
<a name="l00009"></a>00009         <span class="comment">//tw_stime       xfer;</span>
<a name="l00010"></a>00010 
<a name="l00011"></a>00011         tcp_message     *m;
<a name="l00012"></a>00012 
<a name="l00013"></a>00013 <span class="preprocessor">#if TCP_DEBUG</span>
<a name="l00014"></a>00014 <span class="preprocessor"></span><span class="keywordflow">if</span>(state-&gt;connection != -1)
<a name="l00015"></a>00015 {
<a name="l00016"></a>00016         printf(<span class="stringliteral">"\t\t%lld: SEND DATA at %lf (%d) to %lld \n"</span>, 
<a name="l00017"></a>00017                 lp-&gt;id, tw_now(lp) + ts, seq_num, dst);
<a name="l00018"></a>00018 
<a name="l00019"></a>00019         <span class="keywordflow">if</span>(lp-&gt;id == 504065)
<a name="l00020"></a>00020         {
<a name="l00021"></a>00021         fprintf(<a class="code" href="tcp-extern_8h.html#8be473910492b1465ebb3fa463de7bf7">g_tcp_f</a>, <span class="stringliteral">"0 %lf %d\n"</span>, tw_now(lp) + ts, seq_num % 60000);
<a name="l00022"></a>00022         fprintf(<a class="code" href="tcp-extern_8h.html#8be473910492b1465ebb3fa463de7bf7">g_tcp_f</a>, <span class="stringliteral">"2 %lf %lf\n"</span>, tw_now(lp) + ts, state-&gt;cwnd * state-&gt;mss);
<a name="l00023"></a>00023         fprintf(<a class="code" href="tcp-extern_8h.html#8be473910492b1465ebb3fa463de7bf7">g_tcp_f</a>, <span class="stringliteral">"3 %lf %d\n"</span>, tw_now(lp) + ts, state-&gt;recv_wnd* state-&gt;mss);
<a name="l00024"></a>00024         fprintf(<a class="code" href="tcp-extern_8h.html#8be473910492b1465ebb3fa463de7bf7">g_tcp_f</a>, <span class="stringliteral">"4 %lf %lf\n"</span>, tw_now(lp) + ts, state-&gt;ssthresh * state-&gt;mss);
<a name="l00025"></a>00025         }
<a name="l00026"></a>00026 } <span class="keywordflow">else</span>
<a name="l00027"></a>00027 {
<a name="l00028"></a>00028         printf(<span class="stringliteral">"\t\t%lld: SEND ACK at %lf (%d) to %lld \n"</span>, 
<a name="l00029"></a>00029                 lp-&gt;id, tw_now(lp) + ts, ack, dst);
<a name="l00030"></a>00030         <span class="keywordflow">if</span>(lp-&gt;id == 119654)
<a name="l00031"></a>00031         {
<a name="l00032"></a>00032         fprintf(<a class="code" href="tcp-extern_8h.html#8be473910492b1465ebb3fa463de7bf7">g_tcp_f</a>, <span class="stringliteral">"1 %lf %d\n"</span>, tw_now(lp) + ts, ack % 60000);
<a name="l00033"></a>00033         }
<a name="l00034"></a>00034 }
<a name="l00035"></a>00035 <span class="preprocessor">#endif</span>
<a name="l00036"></a>00036 <span class="preprocessor"></span>
<a name="l00037"></a>00037         e = <a class="code" href="rn-event_8c.html#5508bcf53c1fbeb71e6055021634a726">rn_event_new</a>(dst, ts, lp, <a class="code" href="rn-types_8h.html#3fc738f2924cae2b2d04a9a133c3ef02193085e792a05c4538ec2bc24c845652">DOWNSTREAM</a>, 0);
<a name="l00038"></a>00038         b = tw_memory_alloc(lp, <a class="code" href="tcp-extern_8h.html#fc7419e447b8804f025e5e639a074697">g_tcp_fd</a>);
<a name="l00039"></a>00039         m = tw_memory_data(b);
<a name="l00040"></a>00040 
<a name="l00041"></a>00041         m-&gt;src = src;
<a name="l00042"></a>00042         <span class="comment">//m-&gt;dst = dst;</span>
<a name="l00043"></a>00043         m-&gt;ack = ack;
<a name="l00044"></a>00044         m-&gt;seq_num = seq_num;
<a name="l00045"></a>00045 
<a name="l00046"></a>00046         tw_event_memory_set(e, b, <a class="code" href="tcp-extern_8h.html#fc7419e447b8804f025e5e639a074697">g_tcp_fd</a>);
<a name="l00047"></a>00047         <a class="code" href="rn-extern_8h.html#31389041e3d04f5bb4efd6f7543bf7cb">rn_message_setsize</a>(tw_event_data(e), 8.0 * size);
<a name="l00048"></a>00048 
<a name="l00049"></a>00049         <a class="code" href="rn-event_8c.html#8c3496e774b118a7e411ea5bcd23d49a">rn_event_send</a>(e);
<a name="l00050"></a>00050 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="0d9d5d4bbe6d7bc40126ee2f83a5763a"></a><!-- doxytag: member="tcp-extern.h::tcp_final" ref="0d9d5d4bbe6d7bc40126ee2f83a5763a" args="(tcp_state *, tw_lp *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void tcp_final           </td>
          <td>(</td>
          <td class="paramtype">tcp_state *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="tcp_8c-source.html#l00208">208</a> of file <a class="el" href="tcp_8c-source.html">tcp.c</a>.</p>

<p>References <a class="el" href="rn-global_8c-source.html#l00085">g_rn_logs_dir</a>, <a class="el" href="tcp-global_8c-source.html#l00010">g_tcp_stats</a>, and <a class="el" href="rn-machine_8c-source.html#l00004">rn_getmachine()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00209"></a>00209 {
<a name="l00210"></a>00210 <span class="preprocessor">#ifdef TCP_LOG</span>
<a name="l00211"></a>00211 <span class="preprocessor"></span>        <span class="keywordtype">char</span>    log[255];
<a name="l00212"></a>00212 
<a name="l00213"></a>00213         <span class="keywordflow">if</span>(state-&gt;log &amp;&amp; state-&gt;log != stdout)
<a name="l00214"></a>00214                 fclose(state-&gt;log);
<a name="l00215"></a>00215 
<a name="l00216"></a>00216         <span class="keywordflow">if</span>(state-&gt;connection &gt; -1)
<a name="l00217"></a>00217                 sprintf(log, <span class="stringliteral">"%s/tcp-host-%ld.log"</span>, <a class="code" href="rn-extern_8h.html#a46f0adf0f6be6d672defc691800ce69">g_rn_logs_dir</a>, lp-&gt;id);
<a name="l00218"></a>00218         <span class="keywordflow">else</span>
<a name="l00219"></a>00219                 sprintf(log, <span class="stringliteral">"%s/tcp-server-%ld.log"</span>, <a class="code" href="rn-extern_8h.html#a46f0adf0f6be6d672defc691800ce69">g_rn_logs_dir</a>, lp-&gt;id);
<a name="l00220"></a>00220 
<a name="l00221"></a>00221         state-&gt;log = fopen(log, <span class="stringliteral">"w"</span>);
<a name="l00222"></a>00222 
<a name="l00223"></a>00223         <span class="keywordflow">if</span>(!state-&gt;log)
<a name="l00224"></a>00224                 <span class="keywordflow">return</span>;
<a name="l00225"></a>00225 
<a name="l00226"></a>00226         <span class="keywordflow">if</span>(state-&gt;connection &gt; -1)
<a name="l00227"></a>00227         {
<a name="l00228"></a>00228                 fprintf(state-&gt;log, <span class="stringliteral">"TCP Svr %ld: Conn Duration: %lf-%lf \n\n"</span>, 
<a name="l00229"></a>00229                         lp-&gt;id, state-&gt;stats-&gt;start_time, state-&gt;stats-&gt;final_time);
<a name="l00230"></a>00230 
<a name="l00231"></a>00231                 <a class="code" href="tcp-extern_8h.html#619e70fec1748431359716fb7e41362b">g_tcp_stats</a>-&gt;throughput +=
<a name="l00232"></a>00232                         (((state-&gt;len * 8.0)/ 
<a name="l00233"></a>00233                                 (tw_now(lp) - state-&gt;stats-&gt;start_time)) / 1024);
<a name="l00234"></a>00234 
<a name="l00235"></a>00235                 fprintf(state-&gt;log, <span class="stringliteral">"\t%-50s %11d\n"</span>, <span class="stringliteral">"Server"</span>, <a class="code" href="rn-extern_8h.html#b586ebafc20ad652dd538635f5c816b0">rn_getmachine</a>(lp)-&gt;link[0].addr);
<a name="l00236"></a>00236                 fprintf(state-&gt;log, <span class="stringliteral">"\t%-50s %11d Bytes\n"</span>, <span class="stringliteral">"Length"</span>, state-&gt;len);
<a name="l00237"></a>00237                 fprintf(state-&gt;log, <span class="stringliteral">"\t%-50s %11.4lf Kbps\n"</span>, <span class="stringliteral">"Throughput"</span>, 
<a name="l00238"></a>00238                            (((state-&gt;len * 8) /
<a name="l00239"></a>00239                                  (tw_now(lp) - state-&gt;stats-&gt;start_time)) / 1024));
<a name="l00240"></a>00240 
<a name="l00241"></a>00241                 fprintf(state-&gt;log, <span class="stringliteral">"\t%-50s %11d\n"</span>, <span class="stringliteral">"Timeouts"</span>, state-&gt;stats-&gt;tout);
<a name="l00242"></a>00242                 fprintf(state-&gt;log, <span class="stringliteral">"\t%-50s %11.4lf\n"</span>, <span class="stringliteral">"Cwnd"</span>, state-&gt;cwnd);
<a name="l00243"></a>00243                 fprintf(state-&gt;log, <span class="stringliteral">"\n"</span>);
<a name="l00244"></a>00244         } <span class="keywordflow">else</span>
<a name="l00245"></a>00245         {
<a name="l00246"></a>00246                 fprintf(state-&gt;log, <span class="stringliteral">"TCP Clt %ld: Conn Duration: %lf-%lf \n\n"</span>, 
<a name="l00247"></a>00247                         lp-&gt;id, state-&gt;stats-&gt;start_time, state-&gt;stats-&gt;final_time);
<a name="l00248"></a>00248         }
<a name="l00249"></a>00249 
<a name="l00250"></a>00250         fprintf(state-&gt;log, <span class="stringliteral">"\t%-50s %11d\n"</span>, <span class="stringliteral">"Sent Pkts"</span>, state-&gt;stats-&gt;sent);
<a name="l00251"></a>00251         fprintf(state-&gt;log, <span class="stringliteral">"\t%-50s %11d\n"</span>, <span class="stringliteral">"Recv Pkts"</span>, state-&gt;stats-&gt;recv);
<a name="l00252"></a>00252         fprintf(state-&gt;log, <span class="stringliteral">"\t%-50s %11d\n"</span>, <span class="stringliteral">"Drop Pkts"</span>, state-&gt;stats-&gt;dropped_packets);
<a name="l00253"></a>00253         fprintf(state-&gt;log, <span class="stringliteral">"\t%-50s %11d\n"</span>, <span class="stringliteral">"Bad Pkts"</span>, state-&gt;stats-&gt;bad_msgs);
<a name="l00254"></a>00254         fprintf(state-&gt;log, <span class="stringliteral">"\n"</span>);
<a name="l00255"></a>00255         fprintf(state-&gt;log, <span class="stringliteral">"\t%-50s %11d\n"</span>, <span class="stringliteral">"ACK Sent"</span>, state-&gt;stats-&gt;ack_sent);
<a name="l00256"></a>00256         fprintf(state-&gt;log, <span class="stringliteral">"\t%-50s %11d\n"</span>, <span class="stringliteral">"ACK Recv"</span>, state-&gt;stats-&gt;ack_recv);
<a name="l00257"></a>00257         fprintf(state-&gt;log, <span class="stringliteral">"\t%-50s %11d\n"</span>, <span class="stringliteral">"ACK Invalid"</span>, state-&gt;stats-&gt;ack_invalid);
<a name="l00258"></a>00258 <span class="preprocessor">#endif</span>
<a name="l00259"></a>00259 <span class="preprocessor"></span>
<a name="l00260"></a>00260         <a class="code" href="tcp-extern_8h.html#619e70fec1748431359716fb7e41362b">g_tcp_stats</a>-&gt;sent += state-&gt;stats-&gt;sent;
<a name="l00261"></a>00261         <a class="code" href="tcp-extern_8h.html#619e70fec1748431359716fb7e41362b">g_tcp_stats</a>-&gt;recv += state-&gt;stats-&gt;recv;
<a name="l00262"></a>00262         <a class="code" href="tcp-extern_8h.html#619e70fec1748431359716fb7e41362b">g_tcp_stats</a>-&gt;tout += state-&gt;stats-&gt;tout;
<a name="l00263"></a>00263         <a class="code" href="tcp-extern_8h.html#619e70fec1748431359716fb7e41362b">g_tcp_stats</a>-&gt;ack_sent += state-&gt;stats-&gt;ack_sent;
<a name="l00264"></a>00264         <a class="code" href="tcp-extern_8h.html#619e70fec1748431359716fb7e41362b">g_tcp_stats</a>-&gt;ack_recv += state-&gt;stats-&gt;ack_recv;
<a name="l00265"></a>00265         <a class="code" href="tcp-extern_8h.html#619e70fec1748431359716fb7e41362b">g_tcp_stats</a>-&gt;ack_invalid += state-&gt;stats-&gt;ack_invalid;
<a name="l00266"></a>00266         <a class="code" href="tcp-extern_8h.html#619e70fec1748431359716fb7e41362b">g_tcp_stats</a>-&gt;bad_msgs += state-&gt;stats-&gt;bad_msgs;
<a name="l00267"></a>00267         <a class="code" href="tcp-extern_8h.html#619e70fec1748431359716fb7e41362b">g_tcp_stats</a>-&gt;dropped_packets += state-&gt;stats-&gt;dropped_packets;
<a name="l00268"></a>00268 
<a name="l00269"></a>00269         <span class="keywordflow">if</span>(0 &amp;&amp; lp-&gt;id % 100000 == 0)
<a name="l00270"></a>00270                 printf(<span class="stringliteral">"Finalizing TCP LP %lld \n"</span>, lp-&gt;gid);
<a name="l00271"></a>00271 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="f85588003ef283f2b22a0f4139c1a92c"></a><!-- doxytag: member="tcp-extern.h::tcp_init" ref="f85588003ef283f2b22a0f4139c1a92c" args="(tcp_state *, tw_lp *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void tcp_init           </td>
          <td>(</td>
          <td class="paramtype">tcp_state *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="tcp_8c-source.html#l00080">80</a> of file <a class="el" href="tcp_8c-source.html">tcp.c</a>.</p>

<p>References <a class="el" href="tcp-global_8c-source.html#l00003">g_state</a>, <a class="el" href="tcp-global_8c-source.html#l00005">g_tcp_mss</a>, <a class="el" href="tcp-global_8c-source.html#l00007">g_tcp_rwd</a>, <a class="el" href="rn-machine_8c-source.html#l00004">rn_getmachine()</a>, <a class="el" href="tcp_8c-source.html#l00025">start_transfer()</a>, and <a class="el" href="tcp-types_8h-source.html#l00006">TCP_SND_WND</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00081"></a>00081 {
<a name="l00082"></a>00082         state-&gt;cwnd = 1;
<a name="l00083"></a>00083         state-&gt;ssthresh = <a class="code" href="tcp-types_8h.html#98585e099218578c5a1bfbe33272c0b8">TCP_SND_WND</a>;
<a name="l00084"></a>00084         state-&gt;rto = 3.0;
<a name="l00085"></a>00085         <span class="comment">//state-&gt;host = rn_getmachine(lp-&gt;id);</span>
<a name="l00086"></a>00086         <span class="keywordflow">if</span>(<a class="code" href="rn-extern_8h.html#b586ebafc20ad652dd538635f5c816b0">rn_getmachine</a>(lp-&gt;id)-&gt;conn &gt; lp-&gt;id)
<a name="l00087"></a>00087                 state-&gt;connection = <a class="code" href="rn-extern_8h.html#b586ebafc20ad652dd538635f5c816b0">rn_getmachine</a>(lp-&gt;id)-&gt;conn;
<a name="l00088"></a>00088         <span class="keywordflow">else</span>
<a name="l00089"></a>00089                 state-&gt;connection = -1;
<a name="l00090"></a>00090 
<a name="l00091"></a>00091         state-&gt;stats = tw_calloc(TW_LOC, <span class="stringliteral">""</span>, <span class="keyword">sizeof</span>(tcp_statistics), 1);
<a name="l00092"></a>00092         state-&gt;mss = <a class="code" href="tcp-extern_8h.html#9b2cad8ae88cd10efe8c00282a4b95d5">g_tcp_mss</a>;
<a name="l00093"></a>00093         state-&gt;recv_wnd = <a class="code" href="tcp-extern_8h.html#0a83cfbf10d9a57c9b242029954bf326">g_tcp_rwd</a>;
<a name="l00094"></a>00094 
<a name="l00095"></a>00095         <span class="comment">// faking out that this is not in transfer</span>
<a name="l00096"></a>00096         state-&gt;len = 1;
<a name="l00097"></a>00097         state-&gt;unack = 0;
<a name="l00098"></a>00098 
<a name="l00099"></a>00099         <a class="code" href="tcp-extern_8h.html#52dec74980939216a0183d859900fcf9">g_state</a> = state;
<a name="l00100"></a>00100 
<a name="l00101"></a>00101 <span class="preprocessor">#ifdef TCP_LOG</span>
<a name="l00102"></a>00102 <span class="preprocessor"></span>        state-&gt;log = stdout;
<a name="l00103"></a>00103 <span class="preprocessor">#endif</span>
<a name="l00104"></a>00104 <span class="preprocessor"></span>
<a name="l00105"></a>00105         <span class="comment">//if(-1 != state-&gt;connection)</span>
<a name="l00106"></a>00106         <span class="keywordflow">if</span>(lp-&gt;id == 0)
<a name="l00107"></a>00107         {
<a name="l00108"></a>00108                 rn_message m;
<a name="l00109"></a>00109                 m.size = 40960;
<a name="l00110"></a>00110                 <a class="code" href="tcp_8c.html#d11a233148fa4e10c6ac5aef0f160e23">start_transfer</a>(state, NULL, &amp;m, lp);
<a name="l00111"></a>00111         }
<a name="l00112"></a>00112 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="2e48ecfb966ea421f650c398d14ff80e"></a><!-- doxytag: member="tcp-extern.h::tcp_md_final" ref="2e48ecfb966ea421f650c398d14ff80e" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void tcp_md_final           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="tcp-model_8c-source.html#l00027">27</a> of file <a class="el" href="tcp-model_8c-source.html">tcp-model.c</a>.</p>

<p>References <a class="el" href="tcp-global_8c-source.html#l00012">g_tcp_f</a>, and <a class="el" href="tcp-global_8c-source.html#l00010">g_tcp_stats</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00028"></a>00028 {
<a name="l00029"></a>00029         fclose(<a class="code" href="tcp-extern_8h.html#8be473910492b1465ebb3fa463de7bf7">g_tcp_f</a>);
<a name="l00030"></a>00030 
<a name="l00031"></a>00031         printf(<span class="stringliteral">"\nTCP Model Statistics: \n\n"</span>);
<a name="l00032"></a>00032         printf(<span class="stringliteral">"\t%-50s %11d\n"</span>, <span class="stringliteral">"Sent Packets"</span>, <a class="code" href="tcp-extern_8h.html#619e70fec1748431359716fb7e41362b">g_tcp_stats</a>-&gt;sent);
<a name="l00033"></a>00033         printf(<span class="stringliteral">"\t%-50s %11d\n"</span>, <span class="stringliteral">"Recv Packets"</span>, <a class="code" href="tcp-extern_8h.html#619e70fec1748431359716fb7e41362b">g_tcp_stats</a>-&gt;recv);
<a name="l00034"></a>00034         printf(<span class="stringliteral">"\t%-50s %11d\n"</span>, <span class="stringliteral">"Sent ACKs"</span>, <a class="code" href="tcp-extern_8h.html#619e70fec1748431359716fb7e41362b">g_tcp_stats</a>-&gt;ack_sent);
<a name="l00035"></a>00035         printf(<span class="stringliteral">"\t%-50s %11d\n"</span>, <span class="stringliteral">"Recv ACKs"</span>, <a class="code" href="tcp-extern_8h.html#619e70fec1748431359716fb7e41362b">g_tcp_stats</a>-&gt;ack_recv);
<a name="l00036"></a>00036         printf(<span class="stringliteral">"\t%-50s %11d\n"</span>, <span class="stringliteral">"Invalid ACKs"</span>, <a class="code" href="tcp-extern_8h.html#619e70fec1748431359716fb7e41362b">g_tcp_stats</a>-&gt;ack_invalid);
<a name="l00037"></a>00037         printf(<span class="stringliteral">"\t%-50s %11d\n"</span>, <span class="stringliteral">"TimeOut Packets"</span>, <a class="code" href="tcp-extern_8h.html#619e70fec1748431359716fb7e41362b">g_tcp_stats</a>-&gt;tout);
<a name="l00038"></a>00038         printf(<span class="stringliteral">"\t%-50s %11d\n"</span>, <span class="stringliteral">"Drop Packets"</span>, <a class="code" href="tcp-extern_8h.html#619e70fec1748431359716fb7e41362b">g_tcp_stats</a>-&gt;dropped_packets);
<a name="l00039"></a>00039         <span class="comment">//printf("\t%-50s %11.4lf\n", "Throughput", g_tcp_stats-&gt;throughput);</span>
<a name="l00040"></a>00040 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="cb9618e87865af63cb138f314b6eb7ac"></a><!-- doxytag: member="tcp-extern.h::tcp_md_init" ref="cb9618e87865af63cb138f314b6eb7ac" args="(int argc, char **argv, char **env)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void tcp_md_init           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&nbsp;</td>
          <td class="paramname"> <em>argv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&nbsp;</td>
          <td class="paramname"> <em>env</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="tcp-model_8c-source.html#l00004">4</a> of file <a class="el" href="tcp-model_8c-source.html">tcp-model.c</a>.</p>

<p>References <a class="el" href="tcp-global_8c-source.html#l00012">g_tcp_f</a>, <a class="el" href="tcp-global_8c-source.html#l00009">g_tcp_fd</a>, and <a class="el" href="tcp-global_8c-source.html#l00010">g_tcp_stats</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00005"></a>00005 {
<a name="l00006"></a>00006         <span class="keywordtype">int</span>      i;
<a name="l00007"></a>00007 
<a name="l00008"></a>00008         <a class="code" href="tcp-extern_8h.html#619e70fec1748431359716fb7e41362b">g_tcp_stats</a> = tw_calloc(TW_LOC, <span class="stringliteral">""</span>, <span class="keyword">sizeof</span>(*<a class="code" href="tcp-extern_8h.html#619e70fec1748431359716fb7e41362b">g_tcp_stats</a>), 1);
<a name="l00009"></a>00009         <a class="code" href="tcp-extern_8h.html#8be473910492b1465ebb3fa463de7bf7">g_tcp_f</a> = fopen(<span class="stringliteral">"tcp.data"</span>, <span class="stringliteral">"w"</span>);
<a name="l00010"></a>00010 
<a name="l00011"></a>00011         <span class="keywordflow">if</span>(!<a class="code" href="tcp-extern_8h.html#8be473910492b1465ebb3fa463de7bf7">g_tcp_f</a>)
<a name="l00012"></a>00012                 tw_error(TW_LOC, <span class="stringliteral">"Unable to open TCP validation file!"</span>);
<a name="l00013"></a>00013 
<a name="l00014"></a>00014         <span class="keywordflow">for</span>(i = 0; i &lt; g_tw_nkp; i++)
<a name="l00015"></a>00015                 <a class="code" href="tcp-extern_8h.html#fc7419e447b8804f025e5e639a074697">g_tcp_fd</a> = tw_kp_memory_init(tw_getkp(i), 1000000 / g_tw_nkp, 
<a name="l00016"></a>00016                                         <span class="keyword">sizeof</span>(tcp_message), 1);
<a name="l00017"></a>00017 
<a name="l00018"></a>00018         <span class="keywordflow">if</span>(tw_ismaster())
<a name="l00019"></a>00019         {
<a name="l00020"></a>00020                 printf(<span class="stringliteral">"\nInitializing Model: TCP Tahoe\n"</span>);
<a name="l00021"></a>00021                 printf(<span class="stringliteral">"\t%-50s %11d (%ld)\n"</span>, 
<a name="l00022"></a>00022                         <span class="stringliteral">"TCP Membufs"</span>, 1000000, <a class="code" href="tcp-extern_8h.html#fc7419e447b8804f025e5e639a074697">g_tcp_fd</a>);
<a name="l00023"></a>00023         }
<a name="l00024"></a>00024 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="6fa1c6585b6900b71ceb9d3b924b2973"></a><!-- doxytag: member="tcp-extern.h::tcp_process" ref="6fa1c6585b6900b71ceb9d3b924b2973" args="(tcp_state *, tw_bf *, tcp_message *, tw_lp *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void tcp_process           </td>
          <td>(</td>
          <td class="paramtype">tcp_state *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_bf *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tcp_message *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="32de62f36baa6ebfdfe80cf401b7b43c"></a><!-- doxytag: member="tcp-extern.h::tcp_process_ack" ref="32de62f36baa6ebfdfe80cf401b7b43c" args="(tcp_state *, tw_bf *, tcp_message *, tw_lp *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void tcp_process_ack           </td>
          <td>(</td>
          <td class="paramtype">tcp_state *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_bf *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tcp_message *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="tcp-process_8c-source.html#l00007">7</a> of file <a class="el" href="tcp-process_8c-source.html">tcp-process.c</a>.</p>

<p>References <a class="el" href="rn-event_8c-source.html#l00058">rn_event_new()</a>, <a class="el" href="rn-event_8c-source.html#l00173">rn_event_send()</a>, <a class="el" href="tcp-util_8c-source.html#l00004">tcp_event_send()</a>, <a class="el" href="tcp-types_8h-source.html#l00010">TCP_MTU</a>, <a class="el" href="tcp-timer_8c-source.html#l00007">tcp_timer_reset()</a>, <a class="el" href="tcp-update_8c-source.html#l00007">tcp_update_cwnd()</a>, <a class="el" href="tcp-update_8c-source.html#l00025">tcp_update_rtt()</a>, and <a class="el" href="rn-types_8h-source.html#l00057">UPSTREAM</a>.</p>

<p>Referenced by <a class="el" href="tcp_8c-source.html#l00118">tcp_event_handler()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00008"></a>00008 {
<a name="l00009"></a>00009         <span class="keywordtype">int</span>              ack;
<a name="l00010"></a>00010 
<a name="l00011"></a>00011         <span class="keywordflow">if</span>(state-&gt;unack == 0 &amp;&amp; in-&gt;ack &gt; 0)
<a name="l00012"></a>00012                 <span class="keywordflow">return</span>;
<a name="l00013"></a>00013 
<a name="l00014"></a>00014         <span class="keywordflow">if</span> ((bf-&gt;c2 = (state-&gt;unack &lt;= in-&gt;ack)))
<a name="l00015"></a>00015         {
<a name="l00016"></a>00016 <span class="preprocessor">#if TCP_DEBUG</span>
<a name="l00017"></a>00017 <span class="preprocessor"></span><span class="comment">//if(lp-&gt;id == 9377)</span>
<a name="l00018"></a>00018                 printf(<span class="stringliteral">"\t%lld: ACK: unack %d ack %d sn %d (%lf)\n"</span>, 
<a name="l00019"></a>00019                         lp-&gt;id, state-&gt;unack, in-&gt;ack , in-&gt;seq_num, tw_now(lp));
<a name="l00020"></a>00020 <span class="preprocessor">#endif</span>
<a name="l00021"></a>00021 <span class="preprocessor"></span>
<a name="l00022"></a>00022                 state-&gt;stats-&gt;ack_recv++;
<a name="l00023"></a>00023 
<a name="l00024"></a>00024                 <span class="comment">// printf(" should work %d %d %d\n",in-&gt;ack , in-&gt;seq_num, lp-&gt;id);</span>
<a name="l00025"></a>00025                 <span class="keywordflow">if</span> ((bf-&gt;c9 = (in-&gt;ack &gt;= state-&gt;seq_num)))
<a name="l00026"></a>00026                 {       <span class="comment">// CHANGE</span>
<a name="l00027"></a>00027                         <span class="comment">//in-&gt;RC.seq_num = state-&gt;seq_num;</span>
<a name="l00028"></a>00028                         <span class="comment">// printf("new seq %d \n",state-&gt;seq_num);</span>
<a name="l00029"></a>00029                         state-&gt;seq_num = in-&gt;ack + state-&gt;mss;
<a name="l00030"></a>00030                 }
<a name="l00031"></a>00031 
<a name="l00032"></a>00032                 <span class="comment">//in-&gt;RC.dup_count = state-&gt;dup_count;</span>
<a name="l00033"></a>00033                 state-&gt;dup_count = 0;
<a name="l00034"></a>00034 
<a name="l00035"></a>00035                 ack = state-&gt;unack;
<a name="l00036"></a>00036                 state-&gt;unack = in-&gt;ack + state-&gt;mss;
<a name="l00037"></a>00037                 <a class="code" href="tcp-extern_8h.html#988ae04ae2641397b555bf920b74dbab">tcp_update_cwnd</a>(state, bf, in, lp);
<a name="l00038"></a>00038 
<a name="l00039"></a>00039                 <a class="code" href="tcp-extern_8h.html#9fea5e5b8ba7c3c26e34485ff852f15c">tcp_update_rtt</a>(state, bf, in, lp);
<a name="l00040"></a>00040 
<a name="l00041"></a>00041                 <span class="comment">/*</span>
<a name="l00042"></a>00042 <span class="comment">                 * Prints the time it took to transfer, the rate and congestion</span>
<a name="l00043"></a>00043 <span class="comment">                 * window size     </span>
<a name="l00044"></a>00044 <span class="comment">                 */</span>
<a name="l00045"></a>00045                 <span class="keywordflow">if</span>(state-&gt;len &amp;&amp; state-&gt;unack &gt;= state-&gt;len)
<a name="l00046"></a>00046                 {
<a name="l00047"></a>00047 <span class="preprocessor">#if 0</span>
<a name="l00048"></a>00048 <span class="preprocessor"></span>                        <span class="keywordtype">double</span>   rate = ((state-&gt;len) /
<a name="l00049"></a>00049                                          (tw_now(lp) - state-&gt;stats-&gt;start_time)) /
<a name="l00050"></a>00050                                           1024;
<a name="l00051"></a>00051 
<a name="l00052"></a>00052                         fprintf(stdout, <span class="stringliteral">"\t%-50s %11.4lf KB\n"</span>, <span class="stringliteral">"Xfer"</span>, 
<a name="l00053"></a>00053                                         state-&gt;len / 1024.0);
<a name="l00054"></a>00054                         fprintf(stdout, <span class="stringliteral">"\t%-50s %11.4lf secs\n"</span>, <span class="stringliteral">"Time"</span>, 
<a name="l00055"></a>00055                                         tw_now(lp) - state-&gt;stats-&gt;start_time);
<a name="l00056"></a>00056                         fprintf(stdout, <span class="stringliteral">"\t%-50s %11.4lf Kbps\n"</span>, <span class="stringliteral">"Rate"</span>, rate);
<a name="l00057"></a>00057                         fprintf(stdout, <span class="stringliteral">"\t%-50s %11.4lf \n"</span>, <span class="stringliteral">"Cwnd"</span>, state-&gt;cwnd);
<a name="l00058"></a>00058                         fprintf(stdout, <span class="stringliteral">"\t%-50s %11d %11d \n"</span>, <span class="stringliteral">"ACK"</span>, state-&gt;unack, state-&gt;len);
<a name="l00059"></a>00059                         fprintf(stdout, <span class="stringliteral">"\t%-50s %11.4lf \n"</span>, <span class="stringliteral">"Now"</span>, tw_now(lp));
<a name="l00060"></a>00060 <span class="preprocessor">#endif</span>
<a name="l00061"></a>00061 <span class="preprocessor"></span>
<a name="l00062"></a>00062                         <span class="comment">//state-&gt;len = 0;</span>
<a name="l00063"></a>00063 <span class="preprocessor">#if TCP_DEBUG</span>
<a name="l00064"></a>00064 <span class="preprocessor"></span>        printf(<span class="stringliteral">"\t%lld: file complete (unack %d, len %d)\n"</span>, lp-&gt;id, state-&gt;unack, state-&gt;len);
<a name="l00065"></a>00065 <span class="preprocessor">#endif</span>
<a name="l00066"></a>00066 <span class="preprocessor"></span>                        <span class="comment">// send event up to app with throughput rate</span>
<a name="l00067"></a>00067                         <a class="code" href="rn-event_8c.html#8c3496e774b118a7e411ea5bcd23d49a">rn_event_send</a>(<a class="code" href="rn-event_8c.html#5508bcf53c1fbeb71e6055021634a726">rn_event_new</a>(lp-&gt;gid, 0.0, lp, <a class="code" href="rn-types_8h.html#3fc738f2924cae2b2d04a9a133c3ef02c7fd648c8ce81263fefd787373903e5c">UPSTREAM</a>, state-&gt;len));
<a name="l00068"></a>00068                 }
<a name="l00069"></a>00069 
<a name="l00070"></a>00070                 in-&gt;seq_num = 0;
<a name="l00071"></a>00071                 <span class="comment">//in-&gt;RC.lastsent = state-&gt;lastsent;</span>
<a name="l00072"></a>00072 
<a name="l00073"></a>00073                 <span class="keywordflow">while</span> (state-&gt;seq_num &lt; state-&gt;len &amp;&amp;
<a name="l00074"></a>00074                            (state-&gt;seq_num + state-&gt;mss) &lt;=
<a name="l00075"></a>00075                            (state-&gt;unack + (min(state-&gt;cwnd, state-&gt;recv_wnd) * state-&gt;mss)))
<a name="l00076"></a>00076                 {
<a name="l00077"></a>00077                         in-&gt;seq_num++;
<a name="l00078"></a>00078                         <a class="code" href="tcp-extern_8h.html#9fb1779004db5917c4b4a2b8aa11983c">tcp_event_send</a>(state, lp-&gt;id, 0.0, state-&gt;connection, <a class="code" href="tcp-types_8h.html#1f8dc5f80cd2792d88702179524ec1cd">TCP_MTU</a>, 
<a name="l00079"></a>00079                                         state-&gt;seq_num, 0, lp);
<a name="l00080"></a>00080 
<a name="l00081"></a>00081                         state-&gt;stats-&gt;sent++;
<a name="l00082"></a>00082                         state-&gt;seq_num += state-&gt;mss;
<a name="l00083"></a>00083                         printf(<span class="stringliteral">" %d + %d &lt;= %d + min(%lf, %d) * %d\n"</span>,
<a name="l00084"></a>00084                                 state-&gt;seq_num, state-&gt;mss, state-&gt;unack, state-&gt;cwnd, state-&gt;recv_wnd, state-&gt;mss);
<a name="l00085"></a>00085                 }
<a name="l00086"></a>00086 
<a name="l00087"></a>00087                 in-&gt;ack = ack;
<a name="l00088"></a>00088         } <span class="keywordflow">else</span>
<a name="l00089"></a>00089         {
<a name="l00090"></a>00090                 state-&gt;stats-&gt;ack_invalid++;
<a name="l00091"></a>00091 
<a name="l00092"></a>00092 <span class="preprocessor">#if TCP_DEBUG</span>
<a name="l00093"></a>00093 <span class="preprocessor"></span><span class="comment">//if(lp-&gt;id == 9377)</span>
<a name="l00094"></a>00094                 printf(<span class="stringliteral">"\t%lld: Invalid ACK: unack %d ack %d at %lf\n"</span>, lp-&gt;id, state-&gt;unack, in-&gt;ack, tw_now(lp));
<a name="l00095"></a>00095 <span class="preprocessor">#endif</span>
<a name="l00096"></a>00096 <span class="preprocessor"></span>
<a name="l00097"></a>00097                 <span class="keywordflow">if</span> ((bf-&gt;c3 = ((state-&gt;unack) == in-&gt;ack)))
<a name="l00098"></a>00098                 {
<a name="l00099"></a>00099                         state-&gt;dup_count += 1;
<a name="l00100"></a>00100                         <span class="keywordflow">if</span> ((bf-&gt;c4 = (state-&gt;dup_count == 4)))
<a name="l00101"></a>00101                         {
<a name="l00102"></a>00102 
<a name="l00103"></a>00103                                 <span class="comment">//in-&gt;dst = state-&gt;ssthresh;</span>
<a name="l00104"></a>00104                                 state-&gt;ssthresh =
<a name="l00105"></a>00105                                         (min(((<span class="keywordtype">int</span>)state-&gt;cwnd + 1), state-&gt;recv_wnd) / 2) *
<a name="l00106"></a>00106                                         state-&gt;mss;
<a name="l00107"></a>00107                                 <span class="comment">// CHANGED</span>
<a name="l00108"></a>00108                                 <span class="comment">//in-&gt;RC.cwnd = state-&gt;cwnd;</span>
<a name="l00109"></a>00109                                 state-&gt;cwnd = 1;
<a name="l00110"></a>00110 
<a name="l00111"></a>00111                                 <span class="comment">//in-&gt;RC.lastsent = state-&gt;lastsent;</span>
<a name="l00112"></a>00112 
<a name="l00113"></a>00113                                 <a class="code" href="tcp-extern_8h.html#9fb1779004db5917c4b4a2b8aa11983c">tcp_event_send</a>(state, lp-&gt;id, 0.0, state-&gt;connection, <a class="code" href="tcp-types_8h.html#1f8dc5f80cd2792d88702179524ec1cd">TCP_MTU</a>, 
<a name="l00114"></a>00114                                                 state-&gt;unack, 0, lp);
<a name="l00115"></a>00115 
<a name="l00116"></a>00116                                 in-&gt;ack = state-&gt;seq_num;
<a name="l00117"></a>00117                                 state-&gt;seq_num = state-&gt;unack + state-&gt;mss;
<a name="l00118"></a>00118 
<a name="l00119"></a>00119                                 <span class="comment">// CHANGE Maybe.</span>
<a name="l00120"></a>00120                                 state-&gt;rto_seq++;
<a name="l00121"></a>00121 
<a name="l00122"></a>00122                                 state-&gt;timer = <a class="code" href="tcp-extern_8h.html#691485c1594ac62ccef2c1666b9400ae">tcp_timer_reset</a>(state-&gt;timer, bf, in, 
<a name="l00123"></a>00123                                                 tw_now(lp) + state-&gt;rto, state-&gt;unack, lp);
<a name="l00124"></a>00124 
<a name="l00125"></a>00125                                 <span class="comment">// state-save variables into event</span>
<a name="l00126"></a>00126                                 <span class="comment">//in-&gt;RC.seq_num = state-&gt;rtt_seq;</span>
<a name="l00127"></a>00127                                 state-&gt;rtt_seq = state-&gt;unack;
<a name="l00128"></a>00128 
<a name="l00129"></a>00129                                 <span class="comment">//in-&gt;RC.rtt_time = state-&gt;rtt_time;</span>
<a name="l00130"></a>00130                                 state-&gt;rtt_time = 0;
<a name="l00131"></a>00131                         }
<a name="l00132"></a>00132                 }
<a name="l00133"></a>00133         }
<a name="l00134"></a>00134 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="1e09a7f153c40da7c51f70a98c52d2f0"></a><!-- doxytag: member="tcp-extern.h::tcp_process_data" ref="1e09a7f153c40da7c51f70a98c52d2f0" args="(tcp_state *, tw_bf *, tcp_message *, tw_lp *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void tcp_process_data           </td>
          <td>(</td>
          <td class="paramtype">tcp_state *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_bf *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tcp_message *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="tcp-process_8c-source.html#l00140">140</a> of file <a class="el" href="tcp-process_8c-source.html">tcp-process.c</a>.</p>

<p>References <a class="el" href="tcp-global_8c-source.html#l00007">g_tcp_rwd</a>, <a class="el" href="tcp-host_8c-source.html#l00003">TCP_DEBUG</a>, <a class="el" href="tcp-util_8c-source.html#l00004">tcp_event_send()</a>, <a class="el" href="tcp-types_8h-source.html#l00008">TCP_HEADER_SIZE</a>, and <a class="el" href="tcp-types_8h-source.html#l00006">TCP_SND_WND</a>.</p>

<p>Referenced by <a class="el" href="tcp_8c-source.html#l00118">tcp_event_handler()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00141"></a>00141 {
<a name="l00142"></a>00142 <span class="preprocessor">#if TCP_DEBUG</span>
<a name="l00143"></a>00143 <span class="preprocessor"></span><span class="comment">//if(lp-&gt;id == 42380)</span>
<a name="l00144"></a>00144         printf(<span class="stringliteral">"\t%lld: DATA: in sn %d, st sn %d \n"</span>, lp-&gt;id, in-&gt;seq_num, state-&gt;seq_num);
<a name="l00145"></a>00145 <span class="preprocessor">#endif</span>
<a name="l00146"></a>00146 <span class="preprocessor"></span>
<a name="l00147"></a>00147         state-&gt;stats-&gt;recv++;
<a name="l00148"></a>00148         state-&gt;stats-&gt;ack_sent++;
<a name="l00149"></a>00149 
<a name="l00150"></a>00150         <span class="comment">// server sending new file..</span>
<a name="l00151"></a>00151         <span class="keywordflow">if</span>(in-&gt;seq_num == 0)
<a name="l00152"></a>00152         {
<a name="l00153"></a>00153                 <span class="keywordtype">int</span>     i;
<a name="l00154"></a>00154 
<a name="l00155"></a>00155                 state-&gt;seq_num = 0;
<a name="l00156"></a>00156                 state-&gt;recv_wnd = <a class="code" href="tcp-extern_8h.html#0a83cfbf10d9a57c9b242029954bf326">g_tcp_rwd</a>;
<a name="l00157"></a>00157 
<a name="l00158"></a>00158                 <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="tcp-extern_8h.html#0a83cfbf10d9a57c9b242029954bf326">g_tcp_rwd</a>; i++)
<a name="l00159"></a>00159                         state-&gt;out_of_order[i] = 0;
<a name="l00160"></a>00160 
<a name="l00161"></a>00161 #<span class="keywordflow">if</span> <a class="code" href="tcp-host_8c.html#4f43bb8a430c7a52a1ad5086d3f2803c">TCP_DEBUG</a>
<a name="l00162"></a>00162                 printf(<span class="stringliteral">"\t%lld: Client starting new file receive!\n"</span>, lp-&gt;id);
<a name="l00163"></a>00163 <span class="preprocessor">#endif</span>
<a name="l00164"></a>00164 <span class="preprocessor"></span>        }
<a name="l00165"></a>00165 
<a name="l00166"></a>00166         <span class="keywordflow">if</span> ((bf-&gt;c2 = (in-&gt;seq_num == state-&gt;seq_num)))
<a name="l00167"></a>00167         {
<a name="l00168"></a>00168                 <span class="comment">//in-&gt;RC.dup_count = 0;</span>
<a name="l00169"></a>00169                 state-&gt;seq_num += state-&gt;mss;
<a name="l00170"></a>00170                 <span class="keywordflow">while</span>(state-&gt;out_of_order[(state-&gt;seq_num / (<span class="keywordtype">int</span>)state-&gt;mss) % 
<a name="l00171"></a>00171                                 state-&gt;recv_wnd])
<a name="l00172"></a>00172                 {
<a name="l00173"></a>00173                         <span class="comment">//in-&gt;RC.dup_count++;</span>
<a name="l00174"></a>00174                         state-&gt;out_of_order[(state-&gt;seq_num / (int)state-&gt;mss) %
<a name="l00175"></a>00175                                                                 state-&gt;recv_wnd] = 0;
<a name="l00176"></a>00176                         state-&gt;seq_num += state-&gt;mss;
<a name="l00177"></a>00177                 }
<a name="l00178"></a>00178         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((bf-&gt;c3 = (in-&gt;seq_num &gt; state-&gt;seq_num)))
<a name="l00179"></a>00179         {
<a name="l00180"></a>00180                 <span class="keywordflow">if</span> ((bf-&gt;c4 = (in-&gt;seq_num &gt; 
<a name="l00181"></a>00181                                 (state-&gt;seq_num + state-&gt;recv_wnd * state-&gt;mss
<a name="l00182"></a>00182                                         <span class="comment">/* TCP_SND_WND */</span>  - state-&gt;mss))))
<a name="l00183"></a>00183                 {
<a name="l00184"></a>00184                         <span class="comment">// look up need rc code CHANGE</span>
<a name="l00186"></a>00186 <span class="comment"></span>                        tw_printf(TW_LOC,<span class="stringliteral">"recv_wnd buffer overflow %d %d\n"</span>,
<a name="l00187"></a>00187                                          in-&gt;seq_num, 
<a name="l00188"></a>00188                                  state-&gt;seq_num + <a class="code" href="tcp-types_8h.html#98585e099218578c5a1bfbe33272c0b8">TCP_SND_WND</a> - state-&gt;mss);
<a name="l00189"></a>00189                         <span class="comment">//tw_error(TW_LOC, "recv_wnd buffer overflow %d %d\n",</span>
<a name="l00190"></a>00190                         <span class="comment">//               in-&gt;seq_num, </span>
<a name="l00191"></a>00191                         <span class="comment">//       state-&gt;seq_num + TCP_SND_WND - state-&gt;mss);</span>
<a name="l00192"></a>00192                 } <span class="keywordflow">else</span>
<a name="l00193"></a>00193                 {
<a name="l00194"></a>00194 <span class="preprocessor">#if TCP_DEBUG</span>
<a name="l00195"></a>00195 <span class="preprocessor"></span><span class="comment">//if(lp-&gt;id == 42380)</span>
<a name="l00196"></a>00196                         printf(<span class="stringliteral">"\tin sn %d, sn %d, window %d, loc %d\n"</span>, 
<a name="l00197"></a>00197                                 in-&gt;seq_num, state-&gt;seq_num,
<a name="l00198"></a>00198                                 (state-&gt;seq_num + <a class="code" href="tcp-types_8h.html#98585e099218578c5a1bfbe33272c0b8">TCP_SND_WND</a> - state-&gt;mss), 
<a name="l00199"></a>00199                                 (in-&gt;seq_num / state-&gt;mss) % state-&gt;recv_wnd);
<a name="l00200"></a>00200 <span class="preprocessor">#endif</span>
<a name="l00201"></a>00201 <span class="preprocessor"></span>
<a name="l00202"></a>00202                         state-&gt;out_of_order[(in-&gt;seq_num / state-&gt;mss) % 
<a name="l00203"></a>00203                                                 state-&gt;recv_wnd] = 1;
<a name="l00204"></a>00204                 }
<a name="l00205"></a>00205         }
<a name="l00206"></a>00206 
<a name="l00207"></a>00207         <span class="comment">//in-&gt;RC.lastsent = state-&gt;lastsent;</span>
<a name="l00208"></a>00208         <a class="code" href="tcp-extern_8h.html#9fb1779004db5917c4b4a2b8aa11983c">tcp_event_send</a>(state, lp-&gt;id, 0.0, in-&gt;src, <a class="code" href="tcp-types_8h.html#9fba9d361957423069d17225dc85390e">TCP_HEADER_SIZE</a>,
<a name="l00209"></a>00209                         0, state-&gt;seq_num - state-&gt;mss, lp);
<a name="l00210"></a>00210 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="1642d0b80ac5976179f759c750b8c2f4"></a><!-- doxytag: member="tcp-extern.h::tcp_rc_event_handler" ref="1642d0b80ac5976179f759c750b8c2f4" args="(tcp_state *, tw_bf *, rn_message *, tw_lp *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void tcp_rc_event_handler           </td>
          <td>(</td>
          <td class="paramtype">tcp_state *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_bf *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">rn_message *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="tcp_8c-source.html#l00165">165</a> of file <a class="el" href="tcp_8c-source.html">tcp.c</a>.</p>

<p>References <a class="el" href="tcp-global_8c-source.html#l00009">g_tcp_fd</a>, <a class="el" href="tcp-rc-process_8c-source.html#l00007">tcp_rc_process_ack()</a>, <a class="el" href="tcp-rc-process_8c-source.html#l00094">tcp_rc_process_data()</a>, <a class="el" href="tcp-rc-timeout_8c-source.html#l00007">tcp_rc_timeout()</a>, and <a class="el" href="rn-types_8h-source.html#l00056">TIMER</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00166"></a>00166 {
<a name="l00167"></a>00167 <span class="preprocessor">#if 0</span>
<a name="l00168"></a>00168 <span class="preprocessor"></span>        tw_memory       *b;
<a name="l00169"></a>00169         tcp_message     *in;
<a name="l00170"></a>00170 
<a name="l00171"></a>00171         <span class="keywordflow">if</span>(NULL == (b = tw_memory_free_rc(lp, <a class="code" href="tcp-extern_8h.html#fc7419e447b8804f025e5e639a074697">g_tcp_fd</a>)))
<a name="l00172"></a>00172                 tw_error(TW_LOC, <span class="stringliteral">"No membuf on event!"</span>);
<a name="l00173"></a>00173 
<a name="l00174"></a>00174         in = tw_memory_data(b);
<a name="l00175"></a>00175 
<a name="l00176"></a>00176         <span class="keywordflow">if</span>(m-&gt;type == <a class="code" href="rn-types_8h.html#3fc738f2924cae2b2d04a9a133c3ef0217ba9bae1b8d7e8d6c12d46ec58e0769">TIMER</a>)
<a name="l00177"></a>00177         {
<a name="l00178"></a>00178 <span class="preprocessor">#ifdef TCP_DEBUG</span>
<a name="l00179"></a>00179 <span class="preprocessor"></span>                printf(<span class="stringliteral">"%ld: RC RTO for %d at %lf (%ld)\n"</span>,
<a name="l00180"></a>00180                         lp-&gt;id, in-&gt;src, tw_now(lp), (<span class="keywordtype">long</span> <span class="keywordtype">int</span>) lp-&gt;cur_event);
<a name="l00181"></a>00181 <span class="preprocessor">#endif</span>
<a name="l00182"></a>00182 <span class="preprocessor"></span>                <a class="code" href="tcp-extern_8h.html#018b307dc3390350de6b0bbae2fcbf10">tcp_rc_timeout</a>(state, bf, in, lp);
<a name="l00183"></a>00183         } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(state-&gt;connection == -1)
<a name="l00184"></a>00184         {
<a name="l00185"></a>00185 <span class="preprocessor">#ifdef TCP_DEBUG</span>
<a name="l00186"></a>00186 <span class="preprocessor"></span>                printf(<span class="stringliteral">"%ld: RC ACK from %d at %lf \n"</span>,
<a name="l00187"></a>00187                         lp-&gt;id, in-&gt;src, tw_now(lp));
<a name="l00188"></a>00188 <span class="preprocessor">#endif</span>
<a name="l00189"></a>00189 <span class="preprocessor"></span>                <a class="code" href="tcp-extern_8h.html#c72732ddf7b49aa5a488bfa5c5cb903a">tcp_rc_process_ack</a>(state, bf, in, lp);
<a name="l00190"></a>00190         } <span class="keywordflow">else</span>
<a name="l00191"></a>00191         {
<a name="l00192"></a>00192 <span class="preprocessor">#ifdef TCP_DEBUG</span>
<a name="l00193"></a>00193 <span class="preprocessor"></span>                printf(<span class="stringliteral">"%ld: RC DATA from %d at %lf \n"</span>,
<a name="l00194"></a>00194                         lp-&gt;id, in-&gt;src, tw_now(lp));
<a name="l00195"></a>00195 <span class="preprocessor">#endif</span>
<a name="l00196"></a>00196 <span class="preprocessor"></span>                <a class="code" href="tcp-extern_8h.html#ff2d805121df3d917e635a5fe3ee3f98">tcp_rc_process_data</a>(state, bf, in, lp);
<a name="l00197"></a>00197         }
<a name="l00198"></a>00198 
<a name="l00199"></a>00199         <span class="keywordflow">if</span>(b)
<a name="l00200"></a>00200                 tw_event_memory_set(lp-&gt;cur_event, b, <a class="code" href="tcp-extern_8h.html#fc7419e447b8804f025e5e639a074697">g_tcp_fd</a>);
<a name="l00201"></a>00201 <span class="preprocessor">#endif</span>
<a name="l00202"></a>00202 <span class="preprocessor"></span>}
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="c72732ddf7b49aa5a488bfa5c5cb903a"></a><!-- doxytag: member="tcp-extern.h::tcp_rc_process_ack" ref="c72732ddf7b49aa5a488bfa5c5cb903a" args="(tcp_state *, tw_bf *, tcp_message *, tw_lp *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void tcp_rc_process_ack           </td>
          <td>(</td>
          <td class="paramtype">tcp_state *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_bf *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tcp_message *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="tcp-rc-process_8c-source.html#l00007">7</a> of file <a class="el" href="tcp-rc-process_8c-source.html">tcp-rc-process.c</a>.</p>

<p>References <a class="el" href="tcp-timer_8c-source.html#l00134">tcp_rc_timer_cancel()</a>, and <a class="el" href="tcp-timer_8c-source.html#l00060">tcp_rc_timer_reset()</a>.</p>

<p>Referenced by <a class="el" href="tcp_8c-source.html#l00165">tcp_rc_event_handler()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00008"></a>00008 {
<a name="l00009"></a>00009         <span class="keywordtype">int</span>             i;
<a name="l00010"></a>00010         <span class="keywordtype">int</span>             ack;
<a name="l00011"></a>00011 
<a name="l00012"></a>00012         <span class="keywordflow">if</span> (bf-&gt;c2)
<a name="l00013"></a>00013         {
<a name="l00014"></a>00014                 state-&gt;stats-&gt;ack_recv--;
<a name="l00015"></a>00015                 <span class="keywordflow">for</span> (i = 0; i &lt; in-&gt;seq_num; i++)
<a name="l00016"></a>00016                 {
<a name="l00017"></a>00017                         <span class="comment">// tw_rand_reverse_unif(lp-&gt;id);</span>
<a name="l00018"></a>00018                         state-&gt;seq_num -= state-&gt;mss;
<a name="l00019"></a>00019                         state-&gt;stats-&gt;sent--;
<a name="l00020"></a>00020                 }
<a name="l00021"></a>00021 
<a name="l00022"></a>00022                 state-&gt;lastsent = in-&gt;RC.lastsent;
<a name="l00023"></a>00023 
<a name="l00024"></a>00024                 <span class="comment">// reverse tcp_update_rtt </span>
<a name="l00025"></a>00025                 <span class="keywordflow">if</span> (bf-&gt;c5 || bf-&gt;c7)
<a name="l00026"></a>00026                 {
<a name="l00027"></a>00027                         state-&gt;rtt_seq = in-&gt;RC.rtt_seq;
<a name="l00028"></a>00028                         <span class="comment">// in-&gt;RC.rtt_seq = state-&gt;rtt_seq;</span>
<a name="l00029"></a>00029                         <span class="comment">// state-&gt;rtt_seq = in-&gt;ack; // wrong CHANGE</span>
<a name="l00030"></a>00030                         state-&gt;rtt_time = in-&gt;RC.rtt_time;
<a name="l00031"></a>00031 
<a name="l00032"></a>00032                         <span class="keywordflow">if</span> (bf-&gt;c6 &amp;&amp; bf-&gt;c5)
<a name="l00033"></a>00033                                 state-&gt;rto = in-&gt;dst;
<a name="l00034"></a>00034 
<a name="l00035"></a>00035                         state-&gt;rto_seq--;
<a name="l00036"></a>00036 
<a name="l00037"></a>00037                         state-&gt;timer = <a class="code" href="tcp-extern_8h.html#29578a91955aef8aeeea1b8a62a8a8a1">tcp_rc_timer_reset</a>(state-&gt;timer, bf, in, lp);
<a name="l00038"></a>00038                 }
<a name="l00039"></a>00039 
<a name="l00040"></a>00040                 <span class="comment">// Reverse tcp_update_cwnd</span>
<a name="l00041"></a>00041                 <span class="keywordflow">if</span> (bf-&gt;c3 || bf-&gt;c4)
<a name="l00042"></a>00042                         state-&gt;cwnd = in-&gt;RC.cwnd;
<a name="l00043"></a>00043 
<a name="l00044"></a>00044                 <span class="keywordflow">if</span>(bf-&gt;c15)
<a name="l00045"></a>00045                         state-&gt;timer = <a class="code" href="tcp-extern_8h.html#31e654422e1a04177aa379303009eade">tcp_rc_timer_cancel</a>(in, lp);
<a name="l00046"></a>00046 
<a name="l00047"></a>00047                 ack = state-&gt;unack;
<a name="l00048"></a>00048                 state-&gt;unack = in-&gt;ack;
<a name="l00049"></a>00049                 in-&gt;ack = ack - state-&gt;mss;
<a name="l00050"></a>00050                 state-&gt;dup_count = in-&gt;RC.dup_count;
<a name="l00051"></a>00051 
<a name="l00052"></a>00052                 <span class="keywordflow">if</span> (bf-&gt;c9)
<a name="l00053"></a>00053                         state-&gt;seq_num = in-&gt;RC.seq_num;
<a name="l00054"></a>00054         } <span class="keywordflow">else</span>
<a name="l00055"></a>00055         {
<a name="l00056"></a>00056 <span class="preprocessor">#if TCP_DEBUG</span>
<a name="l00057"></a>00057 <span class="preprocessor"></span>                printf(<span class="stringliteral">"\t%ld: INVALID ACK: %d \n"</span>, lp-&gt;id, in-&gt;ack);
<a name="l00058"></a>00058 <span class="preprocessor">#endif</span>
<a name="l00059"></a>00059 <span class="preprocessor"></span>
<a name="l00060"></a>00060                 state-&gt;stats-&gt;ack_invalid--;
<a name="l00061"></a>00061 
<a name="l00062"></a>00062                 <span class="keywordflow">if</span> (bf-&gt;c3)
<a name="l00063"></a>00063                 {
<a name="l00064"></a>00064                         state-&gt;dup_count -= 1;
<a name="l00065"></a>00065                         <span class="keywordflow">if</span> (bf-&gt;c4)
<a name="l00066"></a>00066                         {
<a name="l00067"></a>00067 
<a name="l00068"></a>00068                                 state-&gt;rtt_time = in-&gt;RC.rtt_time;
<a name="l00069"></a>00069                                 state-&gt;rtt_seq = in-&gt;RC.seq_num;        <span class="comment">// state-&gt;unack; //big CHANGE </span>
<a name="l00070"></a>00070                                 <span class="comment">// state-&gt;tout--;</span>
<a name="l00071"></a>00071                                 <span class="comment">// state-&gt;sent--;</span>
<a name="l00072"></a>00072 
<a name="l00073"></a>00073                                 state-&gt;rto_seq--;
<a name="l00074"></a>00074 
<a name="l00075"></a>00075                                 state-&gt;seq_num = in-&gt;ack;
<a name="l00076"></a>00076                                 in-&gt;ack = state-&gt;unack - state-&gt;mss;
<a name="l00077"></a>00077 
<a name="l00078"></a>00078                                 state-&gt;lastsent = in-&gt;RC.lastsent;
<a name="l00079"></a>00079                                 state-&gt;cwnd = in-&gt;RC.cwnd;
<a name="l00080"></a>00080                                 state-&gt;ssthresh = in-&gt;dst;
<a name="l00081"></a>00081 
<a name="l00082"></a>00082                                 state-&gt;timer = <a class="code" href="tcp-extern_8h.html#29578a91955aef8aeeea1b8a62a8a8a1">tcp_rc_timer_reset</a>(state-&gt;timer, bf, in, lp);
<a name="l00083"></a>00083                         }
<a name="l00084"></a>00084                 }
<a name="l00085"></a>00085         }
<a name="l00086"></a>00086 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="ff2d805121df3d917e635a5fe3ee3f98"></a><!-- doxytag: member="tcp-extern.h::tcp_rc_process_data" ref="ff2d805121df3d917e635a5fe3ee3f98" args="(tcp_state *, tw_bf *, tcp_message *, tw_lp *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void tcp_rc_process_data           </td>
          <td>(</td>
          <td class="paramtype">tcp_state *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_bf *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tcp_message *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="tcp-rc-process_8c-source.html#l00094">94</a> of file <a class="el" href="tcp-rc-process_8c-source.html">tcp-rc-process.c</a>.</p>

<p>Referenced by <a class="el" href="tcp_8c-source.html#l00165">tcp_rc_event_handler()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00095"></a>00095 {
<a name="l00096"></a>00096         <span class="comment">// printf("%f \n", in-&gt;RC.lastsent);</span>
<a name="l00097"></a>00097         state-&gt;stats-&gt;ack_sent--;
<a name="l00098"></a>00098         state-&gt;stats-&gt;recv--;
<a name="l00099"></a>00099         state-&gt;lastsent = in-&gt;RC.lastsent;
<a name="l00100"></a>00100 
<a name="l00101"></a>00101         <span class="keywordflow">if</span> (bf-&gt;c2)
<a name="l00102"></a>00102         {
<a name="l00103"></a>00103                 <span class="comment">// tw_rand_reverse_unif(lp-&gt;id);</span>
<a name="l00104"></a>00104                 state-&gt;seq_num -= state-&gt;mss;
<a name="l00105"></a>00105 
<a name="l00106"></a>00106                 <span class="keywordflow">while</span> (in-&gt;RC.dup_count)
<a name="l00107"></a>00107                 {
<a name="l00108"></a>00108                         state-&gt;out_of_order[(state-&gt;seq_num / (int)state-&gt;mss) %
<a name="l00109"></a>00109                                                                 state-&gt;recv_wnd] = 1;
<a name="l00110"></a>00110                         state-&gt;seq_num -= state-&gt;mss;
<a name="l00111"></a>00111                         in-&gt;RC.dup_count--;
<a name="l00112"></a>00112                 }
<a name="l00113"></a>00113         } <span class="keywordflow">else</span>
<a name="l00114"></a>00114         {
<a name="l00115"></a>00115                 <span class="keywordflow">if</span> (bf-&gt;c3)
<a name="l00116"></a>00116                 {
<a name="l00117"></a>00117                         <span class="keywordflow">if</span> (bf-&gt;c4)
<a name="l00118"></a>00118                         {
<a name="l00119"></a>00119                                 <span class="comment">// need to think about this one WILL NOT WORK</span>
<a name="l00120"></a>00120                                 <span class="comment">// UNTIL YOU FIX!!!!!</span>
<a name="l00121"></a>00121                                 tw_error(TW_LOC, <span class="stringliteral">"broken here"</span>);
<a name="l00122"></a>00122                         } <span class="keywordflow">else</span>
<a name="l00123"></a>00123                                 state-&gt;out_of_order[(in-&gt;seq_num / state-&gt;mss) %
<a name="l00124"></a>00124                                                         state-&gt;recv_wnd] = 0;
<a name="l00125"></a>00125                 }
<a name="l00126"></a>00126         }
<a name="l00127"></a>00127 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="018b307dc3390350de6b0bbae2fcbf10"></a><!-- doxytag: member="tcp-extern.h::tcp_rc_timeout" ref="018b307dc3390350de6b0bbae2fcbf10" args="(tcp_state *, tw_bf *, tcp_message *, tw_lp *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void tcp_rc_timeout           </td>
          <td>(</td>
          <td class="paramtype">tcp_state *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_bf *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tcp_message *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="tcp-rc-timeout_8c-source.html#l00007">7</a> of file <a class="el" href="tcp-rc-timeout_8c-source.html">tcp-rc-timeout.c</a>.</p>

<p>References <a class="el" href="tcp-timer_8c-source.html#l00060">tcp_rc_timer_reset()</a>.</p>

<p>Referenced by <a class="el" href="tcp_8c-source.html#l00165">tcp_rc_event_handler()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00008"></a>00008 {
<a name="l00009"></a>00009         <span class="keywordtype">int</span>             ssthresh = in-&gt;dst;
<a name="l00010"></a>00010         <span class="keywordtype">int</span>             seq_num = in-&gt;ack;
<a name="l00011"></a>00011 
<a name="l00012"></a>00012         <span class="keywordflow">if</span>(bf-&gt;c1 == 0)
<a name="l00013"></a>00013                 <span class="keywordflow">return</span>;
<a name="l00014"></a>00014 
<a name="l00015"></a>00015         state-&gt;rtt_time = in-&gt;RC.rtt_time;
<a name="l00016"></a>00016         state-&gt;rtt_seq = in-&gt;RC.rtt_seq;        
<a name="l00017"></a>00017         state-&gt;rto_seq--;
<a name="l00018"></a>00018         state-&gt;rto = in-&gt;RC.dup_count;  
<a name="l00019"></a>00019         state-&gt;stats-&gt;tout--;
<a name="l00020"></a>00020         state-&gt;seq_num = seq_num;
<a name="l00021"></a>00021         state-&gt;lastsent = in-&gt;RC.lastsent;
<a name="l00022"></a>00022         state-&gt;cwnd = in-&gt;RC.cwnd;
<a name="l00023"></a>00023         state-&gt;ssthresh = ssthresh;
<a name="l00024"></a>00024 
<a name="l00025"></a>00025         state-&gt;timer = <a class="code" href="tcp-extern_8h.html#29578a91955aef8aeeea1b8a62a8a8a1">tcp_rc_timer_reset</a>(state-&gt;timer, bf, in, lp);
<a name="l00026"></a>00026 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="31e654422e1a04177aa379303009eade"></a><!-- doxytag: member="tcp-extern.h::tcp_rc_timer_cancel" ref="31e654422e1a04177aa379303009eade" args="(tcp_message *old, tw_lp *lp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tw_event* tcp_rc_timer_cancel           </td>
          <td>(</td>
          <td class="paramtype">tcp_message *&nbsp;</td>
          <td class="paramname"> <em>old</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="tcp-timer_8c-source.html#l00134">134</a> of file <a class="el" href="tcp-timer_8c-source.html">tcp-timer.c</a>.</p>

<p>References <a class="el" href="tcp-global_8c-source.html#l00009">g_tcp_fd</a>.</p>

<p>Referenced by <a class="el" href="tcp-rc-process_8c-source.html#l00007">tcp_rc_process_ack()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00135"></a>00135 {
<a name="l00136"></a>00136         tw_event * timer = NULL;
<a name="l00137"></a>00137 
<a name="l00138"></a>00138         <span class="comment">//if(!old-&gt;RC.timer_ts)</span>
<a name="l00139"></a>00139                 tw_error(TW_LOC, <span class="stringliteral">"No prev timer ts!"</span>);
<a name="l00140"></a>00140 
<a name="l00141"></a>00141         <span class="keywordflow">if</span>(!timer)
<a name="l00142"></a>00142                 tw_error(TW_LOC, <span class="stringliteral">"Why cannot I create this timer now?"</span>);
<a name="l00143"></a>00143 
<a name="l00144"></a>00144         <span class="comment">//timer = rn_timer_init(lp, old-&gt;RC.timer_ts);</span>
<a name="l00145"></a>00145         timer-&gt;memory = tw_memory_free_rc(lp, <a class="code" href="tcp-extern_8h.html#fc7419e447b8804f025e5e639a074697">g_tcp_fd</a>);
<a name="l00146"></a>00146 
<a name="l00147"></a>00147         <span class="comment">// more debug</span>
<a name="l00148"></a>00148         <span class="keywordflow">if</span>(timer-&gt;memory)
<a name="l00149"></a>00149         {
<a name="l00150"></a>00150                 tcp_message *m = tw_memory_data(timer-&gt;memory);
<a name="l00151"></a>00151 
<a name="l00152"></a>00152                 <span class="keywordflow">if</span>(m-&gt;src != old-&gt;src)
<a name="l00153"></a>00153                         tw_error(TW_LOC, <span class="stringliteral">"bad membuf!"</span>);
<a name="l00154"></a>00154         } <span class="keywordflow">else</span>
<a name="l00155"></a>00155                 tw_error(TW_LOC, <span class="stringliteral">"Could not unfree membuf!"</span>);
<a name="l00156"></a>00156 
<a name="l00157"></a>00157         <span class="keywordflow">return</span> timer;
<a name="l00158"></a>00158 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="29578a91955aef8aeeea1b8a62a8a8a1"></a><!-- doxytag: member="tcp-extern.h::tcp_rc_timer_reset" ref="29578a91955aef8aeeea1b8a62a8a8a1" args="(tw_event *, tw_bf *bf, tcp_message *old, tw_lp *lp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tw_event* tcp_rc_timer_reset           </td>
          <td>(</td>
          <td class="paramtype">tw_event *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_bf *&nbsp;</td>
          <td class="paramname"> <em>bf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tcp_message *&nbsp;</td>
          <td class="paramname"> <em>old</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="tcp-timer_8c-source.html#l00060">60</a> of file <a class="el" href="tcp-timer_8c-source.html">tcp-timer.c</a>.</p>

<p>References <a class="el" href="tcp-global_8c-source.html#l00009">g_tcp_fd</a>, and <a class="el" href="rn-timer_8c-source.html#l00080">rn_timer_cancel()</a>.</p>

<p>Referenced by <a class="el" href="tcp-rc-process_8c-source.html#l00007">tcp_rc_process_ack()</a>, and <a class="el" href="tcp-rc-timeout_8c-source.html#l00007">tcp_rc_timeout()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00061"></a>00061 {
<a name="l00062"></a>00062         <span class="keywordflow">if</span>(bf-&gt;c14)
<a name="l00063"></a>00063         {
<a name="l00064"></a>00064                 <span class="comment">// If I init'd a timer, cancel it.</span>
<a name="l00065"></a>00065                 <span class="keywordflow">if</span>(timer)
<a name="l00066"></a>00066                 {
<a name="l00067"></a>00067                         tw_memory_alloc_rc(lp, timer-&gt;memory, <a class="code" href="tcp-extern_8h.html#fc7419e447b8804f025e5e639a074697">g_tcp_fd</a>);
<a name="l00068"></a>00068                         timer-&gt;memory = NULL;
<a name="l00069"></a>00069 
<a name="l00070"></a>00070 <span class="preprocessor">#if TCP_DEBUG</span>
<a name="l00071"></a>00071 <span class="preprocessor"></span>                        printf(<span class="stringliteral">"\t%lld: cancel timer at %lf (%ld)\n"</span>, 
<a name="l00072"></a>00072                                 lp-&gt;id, timer-&gt;recv_ts, (<span class="keywordtype">long</span> <span class="keywordtype">int</span>) timer);
<a name="l00073"></a>00073 <span class="preprocessor">#endif</span>
<a name="l00074"></a>00074 <span class="preprocessor"></span>
<a name="l00075"></a>00075                         <a class="code" href="rn-extern_8h.html#28a608317636d45bb278a081d3dea2d2">rn_timer_cancel</a>(lp, &amp;timer);
<a name="l00076"></a>00076                 }
<a name="l00077"></a>00077 
<a name="l00078"></a>00078                 <span class="comment">// restore pointer to previous timer</span>
<a name="l00079"></a>00079                 <span class="comment">//timer = old-&gt;RC.timer;</span>
<a name="l00080"></a>00080                 <span class="comment">//old-&gt;RC.timer = NULL;</span>
<a name="l00081"></a>00081         } <span class="keywordflow">else</span>
<a name="l00082"></a>00082         {
<a name="l00083"></a>00083                 <span class="comment">//rn_timer_reset(lp, &amp;timer, old-&gt;RC.timer_ts);</span>
<a name="l00084"></a>00084         }
<a name="l00085"></a>00085 
<a name="l00086"></a>00086         <span class="keywordflow">if</span>(bf-&gt;c13 == 0)
<a name="l00087"></a>00087                 <span class="keywordflow">return</span> timer;
<a name="l00088"></a>00088 
<a name="l00089"></a>00089         <span class="keywordflow">if</span>(timer)
<a name="l00090"></a>00090         {
<a name="l00091"></a>00091                 tcp_message     *m;
<a name="l00092"></a>00092 
<a name="l00093"></a>00093 <span class="preprocessor">#if TCP_DEBUG</span>
<a name="l00094"></a>00094 <span class="preprocessor"></span>                printf(<span class="stringliteral">"\t%lld: new RTO at %lf (%ld)\n"</span>, 
<a name="l00095"></a>00095                         lp-&gt;id, tw_now(lp), (<span class="keywordtype">long</span> <span class="keywordtype">int</span>) timer);
<a name="l00096"></a>00096 <span class="preprocessor">#endif</span>
<a name="l00097"></a>00097 <span class="preprocessor"></span>
<a name="l00098"></a>00098                 <span class="keywordflow">if</span>(NULL == timer-&gt;memory)
<a name="l00099"></a>00099                         timer-&gt;memory = tw_memory_alloc(lp, <a class="code" href="tcp-extern_8h.html#fc7419e447b8804f025e5e639a074697">g_tcp_fd</a>);
<a name="l00100"></a>00100 
<a name="l00101"></a>00101                 m = tw_memory_data(timer-&gt;memory);
<a name="l00102"></a>00102                 <span class="comment">//m-&gt;seq_num = old-&gt;RC.timer_seq;</span>
<a name="l00103"></a>00103                 m-&gt;src = old-&gt;src;
<a name="l00104"></a>00104         }
<a name="l00105"></a>00105 
<a name="l00106"></a>00106         <span class="keywordflow">if</span>(timer &amp;&amp; !timer-&gt;memory)
<a name="l00107"></a>00107                 tw_error(TW_LOC, <span class="stringliteral">"no membuf here!"</span>);
<a name="l00108"></a>00108 
<a name="l00109"></a>00109         <span class="keywordflow">return</span> timer;
<a name="l00110"></a>00110 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="6740b899f7c26447920a330f61c81785"></a><!-- doxytag: member="tcp-extern.h::tcp_timeout" ref="6740b899f7c26447920a330f61c81785" args="(tcp_state *, tw_bf *, tcp_message *, tw_lp *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void tcp_timeout           </td>
          <td>(</td>
          <td class="paramtype">tcp_state *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_bf *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tcp_message *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="tcp-timeout_8c-source.html#l00004">4</a> of file <a class="el" href="tcp-timeout_8c-source.html">tcp-timeout.c</a>.</p>

<p>References <a class="el" href="rn-event_8c-source.html#l00058">rn_event_new()</a>, <a class="el" href="rn-event_8c-source.html#l00173">rn_event_send()</a>, <a class="el" href="tcp-util_8c-source.html#l00004">tcp_event_send()</a>, <a class="el" href="tcp-types_8h-source.html#l00010">TCP_MTU</a>, <a class="el" href="tcp-timer_8c-source.html#l00007">tcp_timer_reset()</a>, and <a class="el" href="rn-types_8h-source.html#l00057">UPSTREAM</a>.</p>

<p>Referenced by <a class="el" href="tcp_8c-source.html#l00118">tcp_event_handler()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00005"></a>00005 {
<a name="l00006"></a>00006         <span class="keywordflow">if</span>(in-&gt;seq_num &lt; state-&gt;unack || state-&gt;unack &gt;= state-&gt;len)
<a name="l00007"></a>00007                 <span class="keywordflow">return</span>;
<a name="l00008"></a>00008 
<a name="l00009"></a>00009         bf-&gt;c1 = 1;
<a name="l00010"></a>00010 
<a name="l00011"></a>00011 <span class="preprocessor">#if TCP_DEBUG</span>
<a name="l00012"></a>00012 <span class="preprocessor"></span><span class="comment">//if(lp-&gt;id == 9377)</span>
<a name="l00013"></a>00013         printf(<span class="stringliteral">"\n\t%lld: timeout %lf\n"</span>, lp-&gt;id, tw_now(lp));
<a name="l00014"></a>00014 <span class="preprocessor">#endif</span>
<a name="l00015"></a>00015 <span class="preprocessor"></span>
<a name="l00016"></a>00016         <span class="comment">//in-&gt;dst = state-&gt;ssthresh;</span>
<a name="l00017"></a>00017         state-&gt;ssthresh = (min(((<span class="keywordtype">int</span>)state-&gt;cwnd + 1), state-&gt;recv_wnd) / 2) * state-&gt;mss;
<a name="l00018"></a>00018 
<a name="l00019"></a>00019         <span class="comment">//in-&gt;RC.cwnd = state-&gt;cwnd;</span>
<a name="l00020"></a>00020         state-&gt;cwnd = 1;
<a name="l00021"></a>00021 
<a name="l00022"></a>00022         <span class="comment">//in-&gt;RC.lastsent = state-&gt;lastsent;</span>
<a name="l00023"></a>00023         <a class="code" href="tcp-extern_8h.html#9fb1779004db5917c4b4a2b8aa11983c">tcp_event_send</a>(state, lp-&gt;id, 0.0, state-&gt;connection, <a class="code" href="tcp-types_8h.html#1f8dc5f80cd2792d88702179524ec1cd">TCP_MTU</a>, state-&gt;unack, 0, lp);
<a name="l00024"></a>00024 
<a name="l00025"></a>00025         in-&gt;ack = state-&gt;seq_num;
<a name="l00026"></a>00026         <span class="comment">//state-&gt;seq_num = state-&gt;unack + state-&gt;mss;</span>
<a name="l00027"></a>00027         state-&gt;stats-&gt;tout++;
<a name="l00028"></a>00028         state-&gt;stats-&gt;sent++;
<a name="l00029"></a>00029 
<a name="l00030"></a>00030         <span class="comment">//in-&gt;RC.dup_count = state-&gt;rto;</span>
<a name="l00031"></a>00031         state-&gt;rto = state-&gt;rto * 2;
<a name="l00032"></a>00032         state-&gt;rto_seq++;
<a name="l00033"></a>00033 
<a name="l00034"></a>00034         <span class="keywordflow">if</span>(state-&gt;rto &lt; 60.0)
<a name="l00035"></a>00035         {
<a name="l00036"></a>00036 <span class="preprocessor">#if TCP_DEBUG</span>
<a name="l00037"></a>00037 <span class="preprocessor"></span><span class="comment">//if(lp-&gt;id == 9377)</span>
<a name="l00038"></a>00038         printf(<span class="stringliteral">"\t%lld: timeout reset to %lf (was %lf) (unack %d)\n\n"</span>, lp-&gt;id, tw_now(lp) + state-&gt;rto, state-&gt;timer-&gt;recv_ts, state-&gt;unack);
<a name="l00039"></a>00039 <span class="preprocessor">#endif</span>
<a name="l00040"></a>00040 <span class="preprocessor"></span>                state-&gt;timer = <a class="code" href="tcp-extern_8h.html#691485c1594ac62ccef2c1666b9400ae">tcp_timer_reset</a>(state-&gt;timer, bf, in, 
<a name="l00041"></a>00041                                         tw_now(lp) + state-&gt;rto, state-&gt;unack, lp);
<a name="l00042"></a>00042         } <span class="keywordflow">else</span>
<a name="l00043"></a>00043         {
<a name="l00044"></a>00044 <span class="preprocessor">#if TCP_DEBUG</span>
<a name="l00045"></a>00045 <span class="preprocessor"></span><span class="comment">//if(lp-&gt;id == 9377)</span>
<a name="l00046"></a>00046         printf(<span class="stringliteral">"\t%lld: timeout cancelled (was %lf) (unack %d)\n\n"</span>, lp-&gt;id, state-&gt;timer-&gt;recv_ts, state-&gt;unack);
<a name="l00047"></a>00047                 state-&gt;timer = NULL;
<a name="l00048"></a>00048 <span class="preprocessor">#endif</span>
<a name="l00049"></a>00049 <span class="preprocessor"></span>                <a class="code" href="rn-event_8c.html#8c3496e774b118a7e411ea5bcd23d49a">rn_event_send</a>(<a class="code" href="rn-event_8c.html#5508bcf53c1fbeb71e6055021634a726">rn_event_new</a>(lp-&gt;gid, 0.0, lp, <a class="code" href="rn-types_8h.html#3fc738f2924cae2b2d04a9a133c3ef02c7fd648c8ce81263fefd787373903e5c">UPSTREAM</a>, 0));
<a name="l00050"></a>00050         }
<a name="l00051"></a>00051 
<a name="l00052"></a>00052         <span class="comment">// state-save into event</span>
<a name="l00053"></a>00053         <span class="comment">//in-&gt;RC.rtt_seq = state-&gt;rtt_seq;</span>
<a name="l00054"></a>00054         state-&gt;rtt_seq = state-&gt;unack;
<a name="l00055"></a>00055 
<a name="l00056"></a>00056         <span class="comment">//in-&gt;RC.rtt_time = state-&gt;rtt_time;</span>
<a name="l00057"></a>00057         state-&gt;rtt_time = 0;
<a name="l00058"></a>00058 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="f80b2e5842194d41e1afe313399b9969"></a><!-- doxytag: member="tcp-extern.h::tcp_timer_cancel" ref="f80b2e5842194d41e1afe313399b9969" args="(tw_event *timer, tw_bf *bf, tcp_message *old, tw_lp *lp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void tcp_timer_cancel           </td>
          <td>(</td>
          <td class="paramtype">tw_event *&nbsp;</td>
          <td class="paramname"> <em>timer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_bf *&nbsp;</td>
          <td class="paramname"> <em>bf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tcp_message *&nbsp;</td>
          <td class="paramname"> <em>old</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="tcp-timer_8c-source.html#l00113">113</a> of file <a class="el" href="tcp-timer_8c-source.html">tcp-timer.c</a>.</p>

<p>References <a class="el" href="tcp-global_8c-source.html#l00009">g_tcp_fd</a>, and <a class="el" href="rn-timer_8c-source.html#l00080">rn_timer_cancel()</a>.</p>

<p>Referenced by <a class="el" href="tcp-update_8c-source.html#l00025">tcp_update_rtt()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00114"></a>00114 {
<a name="l00115"></a>00115         <span class="comment">//old-&gt;RC.timer_ts = timer-&gt;recv_ts;</span>
<a name="l00116"></a>00116 <span class="comment">//      if(timer-&gt;recv_ts &lt;= tw_now(lp) || timer-&gt;state.uint == 0)</span>
<a name="l00117"></a>00117         <span class="keywordflow">if</span>(!timer || timer == lp-&gt;pe-&gt;cur_event)
<a name="l00118"></a>00118                 <span class="keywordflow">return</span>;
<a name="l00119"></a>00119 
<a name="l00120"></a>00120         <span class="keywordflow">if</span>(!timer-&gt;memory)
<a name="l00121"></a>00121                 tw_error(TW_LOC, <span class="stringliteral">"No membuf on timer!"</span>);
<a name="l00122"></a>00122 
<a name="l00123"></a>00123         tw_memory_free(lp, timer-&gt;memory, <a class="code" href="tcp-extern_8h.html#fc7419e447b8804f025e5e639a074697">g_tcp_fd</a>);
<a name="l00124"></a>00124         timer-&gt;memory = NULL;
<a name="l00125"></a>00125 
<a name="l00126"></a>00126         <a class="code" href="rn-extern_8h.html#28a608317636d45bb278a081d3dea2d2">rn_timer_cancel</a>(lp, &amp;timer);
<a name="l00127"></a>00127 
<a name="l00128"></a>00128 <span class="preprocessor">#if TCP_DEBUG &amp;&amp; 0</span>
<a name="l00129"></a>00129 <span class="preprocessor"></span>        printf(<span class="stringliteral">"\t%ld: cancel RTO for %lf\n"</span>, lp-&gt;id, old-&gt;RC.timer_ts);
<a name="l00130"></a>00130 <span class="preprocessor">#endif</span>
<a name="l00131"></a>00131 <span class="preprocessor"></span>}
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="691485c1594ac62ccef2c1666b9400ae"></a><!-- doxytag: member="tcp-extern.h::tcp_timer_reset" ref="691485c1594ac62ccef2c1666b9400ae" args="(tw_event *timer, tw_bf *bf, tcp_message *old, tw_stime ts, int sn, tw_lp *lp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tw_event* tcp_timer_reset           </td>
          <td>(</td>
          <td class="paramtype">tw_event *&nbsp;</td>
          <td class="paramname"> <em>timer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_bf *&nbsp;</td>
          <td class="paramname"> <em>bf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tcp_message *&nbsp;</td>
          <td class="paramname"> <em>old</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_stime&nbsp;</td>
          <td class="paramname"> <em>ts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>sn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="tcp-timer_8c-source.html#l00007">7</a> of file <a class="el" href="tcp-timer_8c-source.html">tcp-timer.c</a>.</p>

<p>References <a class="el" href="tcp-global_8c-source.html#l00009">g_tcp_fd</a>, <a class="el" href="rn-timer_8c-source.html#l00030">rn_timer_init()</a>, and <a class="el" href="rn-timer_8c-source.html#l00058">rn_timer_reset()</a>.</p>

<p>Referenced by <a class="el" href="tcp-process_8c-source.html#l00007">tcp_process_ack()</a>, <a class="el" href="tcp-timeout_8c-source.html#l00004">tcp_timeout()</a>, and <a class="el" href="tcp-update_8c-source.html#l00025">tcp_update_rtt()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00009"></a>00009 {
<a name="l00010"></a>00010         tcp_message     *m;
<a name="l00011"></a>00011 
<a name="l00012"></a>00012         <span class="keywordflow">if</span>(timer &amp;&amp; timer-&gt;recv_ts == ts)
<a name="l00013"></a>00013         {
<a name="l00014"></a>00014                 tw_printf(TW_LOC, <span class="stringliteral">"%ld: attempt to reset timer to cur ts!"</span>, lp-&gt;id);
<a name="l00015"></a>00015 
<a name="l00016"></a>00016                 m = tw_memory_data(timer-&gt;memory);
<a name="l00017"></a>00017                 m-&gt;src = old-&gt;src;
<a name="l00018"></a>00018                 m-&gt;seq_num = sn;
<a name="l00019"></a>00019 
<a name="l00020"></a>00020                 <span class="keywordflow">return</span> timer;
<a name="l00021"></a>00021         }
<a name="l00022"></a>00022 
<a name="l00023"></a>00023         <span class="comment">// if this IS the timer firing, then do create new timer!</span>
<a name="l00024"></a>00024         <span class="keywordflow">if</span>((bf-&gt;c14 = (!timer || timer == lp-&gt;pe-&gt;cur_event)))
<a name="l00025"></a>00025         {
<a name="l00026"></a>00026                 <span class="comment">//old-&gt;RC.timer = timer;</span>
<a name="l00027"></a>00027                 timer = NULL;
<a name="l00028"></a>00028                 timer = <a class="code" href="rn-extern_8h.html#0ac1d7574bf764f8813b77b2ee72d79d">rn_timer_init</a>(lp, ts);
<a name="l00029"></a>00029         } <span class="keywordflow">else</span>
<a name="l00030"></a>00030         {
<a name="l00031"></a>00031                 <span class="comment">//old-&gt;RC.timer_ts = timer-&gt;recv_ts;</span>
<a name="l00032"></a>00032                 <a class="code" href="rn-extern_8h.html#5b99d884fbe86665c417897138aff8a6">rn_timer_reset</a>(lp, &amp;timer, ts);
<a name="l00033"></a>00033         }
<a name="l00034"></a>00034 
<a name="l00035"></a>00035         <span class="keywordflow">if</span>((bf-&gt;c13 = (timer != NULL)))
<a name="l00036"></a>00036         {
<a name="l00037"></a>00037                 <span class="keywordflow">if</span>(!timer-&gt;memory)
<a name="l00038"></a>00038                         timer-&gt;memory = tw_memory_alloc(lp, <a class="code" href="tcp-extern_8h.html#fc7419e447b8804f025e5e639a074697">g_tcp_fd</a>);
<a name="l00039"></a>00039 
<a name="l00040"></a>00040 <span class="preprocessor">#if TCP_DEBUG</span>
<a name="l00041"></a>00041 <span class="preprocessor"></span>                printf(<span class="stringliteral">"\t%lld: reset RTO to %lf (%ld)\n"</span>, lp-&gt;id, ts, (<span class="keywordtype">long</span> <span class="keywordtype">int</span>)timer);
<a name="l00042"></a>00042 <span class="preprocessor">#endif</span>
<a name="l00043"></a>00043 <span class="preprocessor"></span>
<a name="l00044"></a>00044                 m = tw_memory_data(timer-&gt;memory);
<a name="l00045"></a>00045 
<a name="l00046"></a>00046                 <span class="comment">// do I need this?</span>
<a name="l00047"></a>00047                 <span class="comment">//old-&gt;RC.timer_seq = m-&gt;seq_num;</span>
<a name="l00048"></a>00048 
<a name="l00049"></a>00049                 m-&gt;src = old-&gt;src;
<a name="l00050"></a>00050                 m-&gt;seq_num = sn;
<a name="l00051"></a>00051         }
<a name="l00052"></a>00052 
<a name="l00053"></a>00053         <span class="keywordflow">if</span>(timer &amp;&amp; !timer-&gt;memory)
<a name="l00054"></a>00054                 tw_error(TW_LOC, <span class="stringliteral">"no membuf here!"</span>);
<a name="l00055"></a>00055 
<a name="l00056"></a>00056         <span class="keywordflow">return</span> timer;
<a name="l00057"></a>00057 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="988ae04ae2641397b555bf920b74dbab"></a><!-- doxytag: member="tcp-extern.h::tcp_update_cwnd" ref="988ae04ae2641397b555bf920b74dbab" args="(tcp_state *, tw_bf *, tcp_message *, tw_lp *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void tcp_update_cwnd           </td>
          <td>(</td>
          <td class="paramtype">tcp_state *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_bf *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tcp_message *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="tcp-update_8c-source.html#l00007">7</a> of file <a class="el" href="tcp-update_8c-source.html">tcp-update.c</a>.</p>

<p>References <a class="el" href="tcp-types_8h-source.html#l00006">TCP_SND_WND</a>.</p>

<p>Referenced by <a class="el" href="tcp-host_8c-source.html#l00010">tcp_host_process_ack()</a>, and <a class="el" href="tcp-process_8c-source.html#l00007">tcp_process_ack()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00008"></a>00008 {
<a name="l00009"></a>00009         <span class="keywordflow">if</span>((bf-&gt;c3 = ((state-&gt;cwnd * state-&gt;mss) &lt; state-&gt;ssthresh
<a name="l00010"></a>00010                   &amp;&amp; state-&gt;cwnd * state-&gt;mss &lt; <a class="code" href="tcp-types_8h.html#98585e099218578c5a1bfbe33272c0b8">TCP_SND_WND</a>)))
<a name="l00011"></a>00011         {
<a name="l00012"></a>00012                 <span class="comment">//in-&gt;RC.cwnd = state-&gt;cwnd;</span>
<a name="l00013"></a>00013                 state-&gt;cwnd += 1;
<a name="l00014"></a>00014         } <span class="keywordflow">else</span> <span class="keywordflow">if</span>((bf-&gt;c4 = (state-&gt;cwnd * state-&gt;mss &lt; <a class="code" href="tcp-types_8h.html#98585e099218578c5a1bfbe33272c0b8">TCP_SND_WND</a>)))
<a name="l00015"></a>00015         {
<a name="l00016"></a>00016                 <span class="comment">//in-&gt;RC.cwnd = state-&gt;cwnd;</span>
<a name="l00017"></a>00017                 state-&gt;cwnd += 1 / state-&gt;cwnd;
<a name="l00018"></a>00018         }
<a name="l00019"></a>00019 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="9fea5e5b8ba7c3c26e34485ff852f15c"></a><!-- doxytag: member="tcp-extern.h::tcp_update_rtt" ref="9fea5e5b8ba7c3c26e34485ff852f15c" args="(tcp_state *, tw_bf *, tcp_message *, tw_lp *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void tcp_update_rtt           </td>
          <td>(</td>
          <td class="paramtype">tcp_state *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_bf *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tcp_message *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="tcp-update_8c-source.html#l00025">25</a> of file <a class="el" href="tcp-update_8c-source.html">tcp-update.c</a>.</p>

<p>References <a class="el" href="tcp-timer_8c-source.html#l00113">tcp_timer_cancel()</a>, and <a class="el" href="tcp-timer_8c-source.html#l00007">tcp_timer_reset()</a>.</p>

<p>Referenced by <a class="el" href="tcp-host_8c-source.html#l00010">tcp_host_process_ack()</a>, and <a class="el" href="tcp-process_8c-source.html#l00007">tcp_process_ack()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00026"></a>00026 {
<a name="l00027"></a>00027         tw_stime ts;
<a name="l00028"></a>00028 
<a name="l00029"></a>00029         <span class="keywordflow">if</span> ((bf-&gt;c5 = (in-&gt;ack == state-&gt;rtt_seq &amp;&amp; state-&gt;unack &lt; state-&gt;len)))
<a name="l00030"></a>00030         {
<a name="l00031"></a>00031                 <span class="keywordflow">if</span> ((bf-&gt;c6 = (state-&gt;rtt_time != 0)))
<a name="l00032"></a>00032                 {
<a name="l00033"></a>00033                         <span class="comment">//in-&gt;dst = state-&gt;rto;</span>
<a name="l00034"></a>00034                         state-&gt;rto = .875 * state-&gt;rto +
<a name="l00035"></a>00035                                 (10 * (tw_now(lp) - state-&gt;rtt_time)) * .125;
<a name="l00036"></a>00036 
<a name="l00037"></a>00037                         state-&gt;rto = min(1.0, state-&gt;rto);
<a name="l00038"></a>00038                 }
<a name="l00039"></a>00039 
<a name="l00040"></a>00040                 <span class="comment">//in-&gt;RC.rtt_seq = state-&gt;rtt_seq;</span>
<a name="l00041"></a>00041                 <span class="comment">//in-&gt;RC.rtt_time = state-&gt;rtt_time;</span>
<a name="l00042"></a>00042 
<a name="l00043"></a>00043                 state-&gt;rtt_time = tw_now(lp);
<a name="l00044"></a>00044                 state-&gt;rtt_seq = state-&gt;seq_num;
<a name="l00045"></a>00045                 state-&gt;rto_seq++;
<a name="l00046"></a>00046         } <span class="keywordflow">else</span> <span class="keywordflow">if</span>((bf-&gt;c7 = (in-&gt;ack &gt; state-&gt;rtt_seq &amp;&amp; state-&gt;unack &lt; state-&gt;len)))
<a name="l00047"></a>00047         {
<a name="l00048"></a>00048                 <span class="comment">//in-&gt;RC.rtt_seq = state-&gt;rtt_seq;</span>
<a name="l00049"></a>00049                 <span class="comment">//in-&gt;RC.rtt_time = state-&gt;rtt_time;</span>
<a name="l00050"></a>00050 
<a name="l00051"></a>00051                 state-&gt;rtt_time = tw_now(lp);
<a name="l00052"></a>00052                 state-&gt;rtt_seq = state-&gt;seq_num;
<a name="l00053"></a>00053                 state-&gt;rto_seq++;
<a name="l00054"></a>00054         } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(state-&gt;unack &gt;= state-&gt;len)
<a name="l00055"></a>00055         {
<a name="l00056"></a>00056                 <span class="keywordflow">if</span>(!state-&gt;timer)
<a name="l00057"></a>00057                         <span class="keywordflow">return</span>;
<a name="l00058"></a>00058 
<a name="l00059"></a>00059                 bf-&gt;c15 = 1;
<a name="l00060"></a>00060                 <span class="comment">//state-&gt;stats-&gt;final_time = tw_now(lp);</span>
<a name="l00061"></a>00061                 <a class="code" href="tcp-extern_8h.html#f80b2e5842194d41e1afe313399b9969">tcp_timer_cancel</a>(state-&gt;timer, bf, in, lp);
<a name="l00062"></a>00062                 state-&gt;timer = NULL;
<a name="l00063"></a>00063 
<a name="l00064"></a>00064                 <span class="keywordflow">return</span>;
<a name="l00065"></a>00065         }
<a name="l00066"></a>00066 
<a name="l00067"></a>00067         <span class="keywordflow">if</span>(state-&gt;timer &amp;&amp; state-&gt;timer-&gt;recv_ts &gt; tw_now(lp))
<a name="l00068"></a>00068                 ts = state-&gt;timer-&gt;recv_ts;
<a name="l00069"></a>00069         <span class="keywordflow">else</span>
<a name="l00070"></a>00070                 ts = -1.0;
<a name="l00071"></a>00071 
<a name="l00072"></a>00072         state-&gt;timer = <a class="code" href="tcp-extern_8h.html#691485c1594ac62ccef2c1666b9400ae">tcp_timer_reset</a>(state-&gt;timer, bf, in, 
<a name="l00073"></a>00073                                         tw_now(lp) + state-&gt;rto, state-&gt;unack, lp);
<a name="l00074"></a>00074 <span class="preprocessor">#ifdef TCP_DEBUG</span>
<a name="l00075"></a>00075 <span class="preprocessor"></span><span class="comment">//if(lp-&gt;id == 9377)</span>
<a name="l00076"></a>00076         printf(<span class="stringliteral">"\t%lld: update RTT tmr to %lf (was %lf) (unack %d)\n"</span>, lp-&gt;id, tw_now(lp) + state-&gt;rto, ts, state-&gt;unack);
<a name="l00077"></a>00077 <span class="preprocessor">#endif</span>
<a name="l00078"></a>00078 <span class="preprocessor"></span>}
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="785c5082870b45cce614c327c6e56931"></a><!-- doxytag: member="tcp-extern.h::tcp_xml" ref="785c5082870b45cce614c327c6e56931" args="(tcp_state *, const xmlNodePtr node, tw_lp *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void tcp_xml           </td>
          <td>(</td>
          <td class="paramtype">tcp_state *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const xmlNodePtr&nbsp;</td>
          <td class="paramname"> <em>node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="tcp-xml_8c-source.html#l00004">4</a> of file <a class="el" href="tcp-xml_8c-source.html">tcp-xml.c</a>.</p>

<p>References <a class="el" href="tcp-global_8c-source.html#l00005">g_tcp_mss</a>, and <a class="el" href="tcp-global_8c-source.html#l00007">g_tcp_rwd</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00005"></a>00005 {
<a name="l00006"></a>00006         xmlNodePtr       e;
<a name="l00007"></a>00007 
<a name="l00008"></a>00008         <span class="keywordflow">for</span>(e = node-&gt;children; e; e = e-&gt;next)
<a name="l00009"></a>00009         {
<a name="l00010"></a>00010                 <span class="keywordflow">if</span>(0 == strcmp((<span class="keywordtype">char</span> *) e-&gt;name, <span class="stringliteral">"mss"</span>))
<a name="l00011"></a>00011                         state-&gt;mss = atoi((<span class="keywordtype">char</span> *)e-&gt;children-&gt;content);
<a name="l00012"></a>00012 
<a name="l00013"></a>00013                 <span class="keywordflow">if</span>(0 == strcmp((<span class="keywordtype">char</span> *) e-&gt;name, <span class="stringliteral">"recv_wnd"</span>))
<a name="l00014"></a>00014                         state-&gt;recv_wnd = atoi((<span class="keywordtype">char</span> *)e-&gt;children-&gt;content);
<a name="l00015"></a>00015         }
<a name="l00016"></a>00016 
<a name="l00017"></a>00017         <span class="keywordflow">if</span>(!state-&gt;mss)
<a name="l00018"></a>00018                 state-&gt;mss = <a class="code" href="tcp-extern_8h.html#9b2cad8ae88cd10efe8c00282a4b95d5">g_tcp_mss</a>;
<a name="l00019"></a>00019 
<a name="l00020"></a>00020         <span class="keywordflow">if</span>(!state-&gt;recv_wnd)
<a name="l00021"></a>00021                 state-&gt;recv_wnd = <a class="code" href="tcp-extern_8h.html#0a83cfbf10d9a57c9b242029954bf326">g_tcp_rwd</a>;
<a name="l00022"></a>00022 }
</pre></div>
<p>

</div>
</div><p>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="52dec74980939216a0183d859900fcf9"></a><!-- doxytag: member="tcp-extern.h::g_state" ref="52dec74980939216a0183d859900fcf9" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tcp_state* <a class="el" href="tcp-global_8c.html#52dec74980939216a0183d859900fcf9">g_state</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="tcp-global_8c-source.html#l00003">3</a> of file <a class="el" href="tcp-global_8c-source.html">tcp-global.c</a>.</p>

<p>Referenced by <a class="el" href="tcp_8c-source.html#l00080">tcp_init()</a>.</p>

</div>
</div><p>
<a class="anchor" name="8be473910492b1465ebb3fa463de7bf7"></a><!-- doxytag: member="tcp-extern.h::g_tcp_f" ref="8be473910492b1465ebb3fa463de7bf7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">FILE* <a class="el" href="tcp-global_8c.html#8be473910492b1465ebb3fa463de7bf7">g_tcp_f</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="tcp-global_8c-source.html#l00012">12</a> of file <a class="el" href="tcp-global_8c-source.html">tcp-global.c</a>.</p>

<p>Referenced by <a class="el" href="tcp-util_8c-source.html#l00004">tcp_event_send()</a>, <a class="el" href="tcp-model_8c-source.html#l00027">tcp_md_final()</a>, and <a class="el" href="tcp-model_8c-source.html#l00004">tcp_md_init()</a>.</p>

</div>
</div><p>
<a class="anchor" name="fc7419e447b8804f025e5e639a074697"></a><!-- doxytag: member="tcp-extern.h::g_tcp_fd" ref="fc7419e447b8804f025e5e639a074697" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tw_fd <a class="el" href="tcp-global_8c.html#fc7419e447b8804f025e5e639a074697">g_tcp_fd</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="tcp-global_8c-source.html#l00009">9</a> of file <a class="el" href="tcp-global_8c-source.html">tcp-global.c</a>.</p>

<p>Referenced by <a class="el" href="tcp_8c-source.html#l00025">start_transfer()</a>, <a class="el" href="tcp_8c-source.html#l00004">stop_transfer()</a>, <a class="el" href="tcp_8c-source.html#l00118">tcp_event_handler()</a>, <a class="el" href="tcp-util_8c-source.html#l00004">tcp_event_send()</a>, <a class="el" href="tcp-host_8c-source.html#l00010">tcp_host_process_ack()</a>, <a class="el" href="tcp-host_8c-source.html#l00353">tcp_host_timeout()</a>, <a class="el" href="tcp-host_8c-source.html#l00265">tcp_host_update_rtt()</a>, <a class="el" href="tcp-model_8c-source.html#l00004">tcp_md_init()</a>, <a class="el" href="tcp_8c-source.html#l00165">tcp_rc_event_handler()</a>, <a class="el" href="tcp-timer_8c-source.html#l00134">tcp_rc_timer_cancel()</a>, <a class="el" href="tcp-timer_8c-source.html#l00060">tcp_rc_timer_reset()</a>, <a class="el" href="tcp-timer_8c-source.html#l00113">tcp_timer_cancel()</a>, and <a class="el" href="tcp-timer_8c-source.html#l00007">tcp_timer_reset()</a>.</p>

</div>
</div><p>
<a class="anchor" name="9b2cad8ae88cd10efe8c00282a4b95d5"></a><!-- doxytag: member="tcp-extern.h::g_tcp_mss" ref="9b2cad8ae88cd10efe8c00282a4b95d5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="tcp-global_8c.html#9b2cad8ae88cd10efe8c00282a4b95d5">g_tcp_mss</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="tcp-global_8c-source.html#l00005">5</a> of file <a class="el" href="tcp-global_8c-source.html">tcp-global.c</a>.</p>

<p>Referenced by <a class="el" href="tcp_8c-source.html#l00080">tcp_init()</a>, and <a class="el" href="tcp-xml_8c-source.html#l00004">tcp_xml()</a>.</p>

</div>
</div><p>
<a class="anchor" name="0a83cfbf10d9a57c9b242029954bf326"></a><!-- doxytag: member="tcp-extern.h::g_tcp_rwd" ref="0a83cfbf10d9a57c9b242029954bf326" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="tcp-global_8c.html#0a83cfbf10d9a57c9b242029954bf326">g_tcp_rwd</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="tcp-global_8c-source.html#l00007">7</a> of file <a class="el" href="tcp-global_8c-source.html">tcp-global.c</a>.</p>

<p>Referenced by <a class="el" href="tcp_8c-source.html#l00080">tcp_init()</a>, <a class="el" href="tcp-process_8c-source.html#l00140">tcp_process_data()</a>, and <a class="el" href="tcp-xml_8c-source.html#l00004">tcp_xml()</a>.</p>

</div>
</div><p>
<a class="anchor" name="619e70fec1748431359716fb7e41362b"></a><!-- doxytag: member="tcp-extern.h::g_tcp_stats" ref="619e70fec1748431359716fb7e41362b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tcp_statistics* <a class="el" href="tcp-global_8c.html#619e70fec1748431359716fb7e41362b">g_tcp_stats</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="tcp-global_8c-source.html#l00010">10</a> of file <a class="el" href="tcp-global_8c-source.html">tcp-global.c</a>.</p>

<p>Referenced by <a class="el" href="tcp_8c-source.html#l00208">tcp_final()</a>, <a class="el" href="tcp-model_8c-source.html#l00027">tcp_md_final()</a>, and <a class="el" href="tcp-model_8c-source.html#l00004">tcp_md_init()</a>.</p>

</div>
</div><p>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Tue Jan 27 09:38:30 2009 for ROSS.Net by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.5 </small></address>
</body>
</html>
