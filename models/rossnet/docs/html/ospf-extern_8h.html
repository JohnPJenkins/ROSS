<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>ROSS.Net: ospf-extern.h File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.5 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>ospf-extern.h File Reference</h1>
<p>

<p>
<a href="ospf-extern_8h-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#5c4172f703019d7ea68ed34370d7120f">ospf_random_weights</a> (ospf_state *state, tw_lp *lp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#cd5973380a161924211634a9006bed4d">ospf_experiment_weights</a> (ospf_state *state, long int i, tw_lp *lp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#7516be363c55e3a4ce1c3ec37456b1d9">ospf_ip_route</a> (ospf_state *state, tw_bf *bf, rn_message *rn_msg, tw_lp *lp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#383c2652c0d20a8040a24ff45dd1b63c">ospf_router_debug_routing</a> (ospf_state *state, int <a class="el" href="ospf-global_8c.html#0ddbf789cfd814565dd88748311c1c36">d</a>, tw_lp *lp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#e28c849cc83c152931edc92df421d4a8">ospf_router_debug_rate</a> (tw_lp *lp, int *next)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#9b7db701dd7b3ff09df640b0eccf57a8">ospf_xml</a> (ospf_state *state, const xmlNodePtr my_node, tw_lp *lp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">ospf_lsa *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#9608d8ba29ae5cc559afe788cddade3f">getlsa</a> (rn_machine *, int index, int id)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#60f74e3207b2cb2822ba863cfd3f066b">shouldRecalculateTable</a> (ospf_lsa *newLsa, ospf_lsa *oldLsa)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">tw_event *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#17ce6f44467d016ba9c7c24c98ba11cb">ospf_timer_cancel</a> (tw_event *tmr, tw_lp *lp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">tw_event *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#75e3fe5d4b90cd1e2ca417ac3d9518c7">ospf_timer_start</a> (ospf_nbr *nbr, tw_event *tmr, tw_stime ts, int type, tw_lp *lp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#bd79355ae67c2a061b02a7cde07e0997">ospf_interface_event_handler</a> (ospf_nbr *nbr, ospf_int_event event, tw_lp *lp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#410670d4a1bcb8eb81f4f5e3a64f2447">ospf_list_free</a> (char *list, unsigned int *size)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#633eaa19a8d9455a45c44a1cfdb7144b">ospf_list_contains</a> (char *list, int index)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#b830c897232093436fa7594fa7b29db0">ospf_list_link</a> (char *list, int index, unsigned int *size)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#c0fa228f737ef79c5cabd264c61b2252">ospf_list_unlink</a> (char *list, int index, unsigned int *size)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#0ff2c1e877d460d2950c2228447c2a4d">ospf_aging_timer_set</a> (ospf_state *state, ospf_db_entry *, int, tw_lp *)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#1c68a2e5cdbbb0044932c3f3d2e1be34">ospf_aging_timer</a> (ospf_state *state, tw_bf *bf, tw_lp *lp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#bc4b7f40002d6ef94e990d8b3394db65">ospf_hello_send</a> (ospf_state *state, ospf_nbr *nbr, tw_bf *bf, tw_lp *lp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#c517556bf6d7725174df1e5dc931bf4f">ospf_hello_packet</a> (ospf_state *, ospf_nbr *, ospf_hello *, tw_bf *, tw_lp *)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#1a0d7bfac4f79c936b7940887971c1ec">ospf_nbr_event_handler</a> (ospf_state *state, ospf_nbr *nbr, ospf_nbr_event event, tw_lp *lp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">tw_memory *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#fda0e2596f0abb694cedc7244745151e">ospf_dd_copy</a> (tw_memory *b2, tw_lp *lp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#581d7d832f36b139dc5605c7ded7e645">ospf_dd_fill_hdrs</a> (ospf_nbr *nbr)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#73abd30e3f402591726493698a318452">ospf_dd_exchange</a> (ospf_state *state, tw_lp *lp, ospf_message *m, int)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#59924a888d975fc330fac606513592e5">ospf_dd_fill_header</a> (ospf_nbr *nbr, int index)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#8302f79c5782344981c84e75bdcc4e68">ospf_dd_compare</a> (ospf_dd_pkt *h1, ospf_dd_pkt *h2)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#7957a55965bc236c7fc18bdce945c51f">ospf_dd_event_handler</a> (ospf_state *, ospf_nbr *, tw_bf *, tw_lp *lp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#f20e4567a62674a867f580c9c9e3b6a6">ospf_dd_retransmit</a> (ospf_state *state, ospf_nbr *nbr, tw_bf *bf, tw_lp *lp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#f6538df19ba8760571cfa528f769f0d4">ospf_lsa_flush</a> (ospf_state *, ospf_nbr *, ospf_db_entry *, tw_lp *)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#4b5eb3d01fff0994efd88f1f1a305c6f">ospf_lsa_find</a> (ospf_state *state, ospf_nbr *, int id, tw_lp *lp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#a04cd2fd7a2636e7fab480a9647fac91">ospf_lsa_print</a> (FILE *log, ospf_lsa *lsa)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#5add44c8cd95a2a5e7766195d6f055fb">lsa_create</a> (ospf_state *state, int lsa_index, tw_lp *lp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#3eb1ae7a66c4c936b5971afb65492d09">ospf_lsa_link_allocate</a> (ospf_state *state, ospf_lsa *lsa, tw_lp *lp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">tw_memory *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#5e8fbd3b9d041de4eb34b5beb7b19221">ospf_lsa_allocate</a> (tw_lp *lp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#593a9576faedb8507895bd493785fdd9">ospf_lsa_premature_age</a> (ospf_state *state, ospf_db_entry *, tw_lp *lp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#f2ab0671b22732e9743355c30ea903a4">ospf_lsa_age</a> (ospf_state *, ospf_db_entry *dbe, tw_lp *lp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#9b306ecc8339fcb31d7c8e5448f60722">ospf_lsa_refresh</a> (ospf_state *state, ospf_db_entry *dbe, tw_lp *lp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#90f786d8f758711eb5797ff19ca0097b">ospf_lsa_create</a> (ospf_state *state, ospf_nbr *, int lsa_index, tw_lp *lp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#e70e8cf27e43c0e4d95dc254bd083a29">ospf_lsa_start_flood</a> (ospf_nbr *nbr, ospf_db_entry *dbe, tw_lp *lp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#51de1d77d40f0604d5a65e902ceda57b">ospf_lsa_flood</a> (ospf_state *<a class="el" href="ospf-global_8c.html#b4c6c03359486e6fb0ac52a94493df1e">s</a>, ospf_db_entry *<a class="el" href="ospf-global_8c.html#0ddbf789cfd814565dd88748311c1c36">d</a>, int <a class="el" href="ospf-global_8c.html#e3285ac7f4cc9a400327c9efb5f535f7">f</a>, tw_lp *lp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#b9d32c845d06ecdfdaf3b12e89297ab4">ospf_lsa_isnewer</a> (ospf_state *, ospf_db_entry *, ospf_db_entry *, tw_lp *)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#e05d8b610f94370f9a2d4c5209c163d2">ospf_lsa_process</a> (ospf_state *state, ospf_message *m, int interface)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">ospf_lsa *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#5cbd06df0703e6d22521d26dd0b53f29">ospf_lsa_compare</a> (ospf_nbr *n, ospf_lsa *lsa)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#df9d36c7dc21c44e40a6c1a4dc9302ba">ospf_ls_update_recv</a> (ospf_state *, tw_bf *, ospf_nbr *, tw_lp *)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#097224ed856a311b649344949fe3a3d6">ospf_ls_request</a> (ospf_state *state, ospf_nbr *nbr, tw_lp *lp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#8a8a0d0321d6cf2313d44d24f4367651">ospf_ls_request_recv</a> (ospf_state *, tw_bf *, ospf_nbr *, tw_lp *)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#08c473f603e6e76699516604a0f4133e">ospf_ack_delayed</a> (ospf_nbr *nbr, tw_memory *buf, int, tw_lp *lp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#8abab116520bc7c2e92cdb930eb5bca7">ospf_ack_timed_out</a> (ospf_nbr *, tw_bf *, tw_lp *lp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#fd46b5215e38eb7394cfeb784296b43e">ospf_ack_direct</a> (ospf_nbr *, tw_memory *, int size, tw_lp *lp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#31935383e7c5ef42f4d2b91297dbad6f">ospf_ack_process</a> (ospf_nbr *nbr, tw_bf *bf, tw_lp *lp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#4de527f30006dfc66eb2e24684aba5f5">ospf_db_read</a> (ospf_state *state, tw_lp *lp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#00045804159715e159464ad9d670e7d8">ospf_db_print_raw</a> (ospf_state *state, FILE *log, tw_lp *lp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#98158bd3d15459f0111a7bc37d0e2c05">ospf_db_print</a> (ospf_state *state, FILE *log, tw_lp *lp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#bf295d5d1675c07b08de04256d936bee">ospf_db_route</a> (ospf_state *, ospf_db_entry *curr, tw_lp *lp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#110492c4c846336629a9775968005230">ospf_db_remove</a> (ospf_state *state, int, tw_lp *lp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#01c993e7218639b1eb00314f4bfb2729">ospf_db_init</a> (ospf_state *state, tw_lp *lp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">ospf_db_entry *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#1ad0ef7a9b8314f07dbfd58efd8fc498">ospf_db_insert</a> (ospf_state *<a class="el" href="ospf-global_8c.html#b4c6c03359486e6fb0ac52a94493df1e">s</a>, int index, ospf_db_entry *, tw_lp *lp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#8f5c6d88e688325839a72006fb09d45b">ospf_db_update</a> (ospf_state *, ospf_nbr *nbr, ospf_db_entry *, tw_lp *)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">tw_event *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#a6ee00330aee5b151785a47a706cf226">ospf_event_new</a> (ospf_state *, tw_lp *, tw_stime, tw_lp *)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">tw_event *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#506873294c07e25082f4e8d2f631b522">ospf_event_send</a> (ospf_state *state, tw_event *event, int type, tw_lp *, int size, tw_memory *mem, int area)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#4c5211d9ed4ff3755621afdd64d71736">ospf_statistics_collection</a> (ospf_state *state, tw_lp *lp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">ospf_nbr *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#e1d40f1eb2223baa1a8b3d7d7b7b3d46">ospf_getnbr</a> (ospf_state *state, int id)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#05c4d9902736734864c528052070d101">ospf_neighbor_init</a> (ospf_state *state, tw_lp *lp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">ospf_nbr *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#71a8db07bf3a2da1fab6560e634180a7">ospf_get_neighbor</a> (ospf_state *state, int id)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#c687d13222a7d0e3e67998e0d6f48fdc">ospf_routing_init</a> (ospf_state *state, tw_lp *lp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#8e91da94f0927f20f1b2962a45bcb5b9">ospf_rt_build</a> (ospf_state *state, int start_vertex)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#fde0ede536714d6ad9959f7c80ebf026">ospf_rt_timer</a> (ospf_state *state, int start_vertex)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#5420dafebccc3fbaf5939cab2c4fe46f">ospf_rt_print</a> (ospf_state *state, tw_lp *lp, FILE *)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">ospf_nbr *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#a28c766dd7f8f5caa136fa2dc1bbb4e5">ospf_int_getinterface</a> (ospf_state *state, int id)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#af27e1a36d89f4970d13e70c4a1073af">ospf_startup</a> (ospf_state *state, tw_lp *lp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#3a8011d3fa8ad0d6ea7eba6cb3a48552">ospf_event_handler</a> (ospf_state *, tw_bf *bf, rn_message *m, tw_lp *lp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#12d56e24e160fc01f66e7972f06d7250">ospf_rc_event_handler</a> (ospf_state *, tw_bf *bf, rn_message *m, tw_lp *lp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#b24273470dfc60ba658a9a3a99344610">ospf_main</a> (int argc, char **argv, char **env)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#7795809faa2d0a044f6be6014033e6f1">ospf_md_final</a> ()</td></tr>

<tr><td colspan="2"><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#6c4827dc86376bc6eeba9589e6506ea9">g_ospf_link_weight</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#9f9f956462ca43b7fd2caa89db98c5a9">g_route</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#097cad055eec1bd215ad822a813dc62e">g_route1</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#432a4c78ffc399e9fb0d8070289f47e1">gr1</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#fb99688fe29cd99a5a48c77bfee16629">gr2</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#c90b3ca848617e3fe636407eb372c5d5">g_ospf_rt_write</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#44d2691741bf5a962646aca63243f118">db_sz</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">tw_fd&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#884d66f70a693353a1894758d71deb99">g_ospf_fd</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">tw_fd&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#76d058140af721aad20439b05b18e172">g_ospf_lsa_fd</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">tw_fd&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#6172717590c1e9795cb6db7baeb1bf4a">g_ospf_dd_fd</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">tw_fd&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#a0aabde3f0073b72fe5cbb892a014316">g_ospf_ll_fd</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">ospf_global_state *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#7f0b189fb4e0f9bde7b94669c36dc8d9">g_ospf_state</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#8a75915660265dac4f44f3f3b1f3ffcf">g_ospf_init_file</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">FILE *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#40c99b64349659459b09f91834346114">g_ospf_routing_file</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">FILE *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#49edbff370ec3a56723d1dc19e990d14">g_ospf_lsa_file</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">FILE *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#7a318634977625460e285269c959269f">g_ospf_lsa_input</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#61b0821c8ee2a2df1d8cf38ebe0f2b3c">p</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#b836172141b14032d67fde057a072992">front</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#e3285ac7f4cc9a400327c9efb5f535f7">f</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#b4c6c03359486e6fb0ac52a94493df1e">s</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#0ddbf789cfd814565dd88748311c1c36">d</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">ospf_statistics *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#6ff92e91f0531f31567a8453d5b2b08b">g_ospf_stats</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">tw_memory **&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#34b0e095c89f24ee59eaf77b52ad8f8a">g_ospf_lsa</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#fb9d98c42d13a533e0359397955e932c">g_routers</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#6f426e940000297dbd58e3967e65f9c9">g_max_updates</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#a602f5c7dfe578c80e262a82666f2a64">g_memory</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#354846699ca7e45e6f42d17268d8fac2">OSPF_LSA_MAX_AGE</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf-extern_8h.html#e536fe3d2be9c08e53d0e53d48046668">OSPF_LSA_REFRESH_AGE</a></td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="9608d8ba29ae5cc559afe788cddade3f"></a><!-- doxytag: member="ospf-extern.h::getlsa" ref="9608d8ba29ae5cc559afe788cddade3f" args="(rn_machine *, int index, int id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ospf_lsa* getlsa           </td>
          <td>(</td>
          <td class="paramtype">rn_machine *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>id</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-lsa_8c-source.html#l00247">247</a> of file <a class="el" href="ospf-lsa_8c-source.html">ospf-lsa.c</a>.</p>

<p>References <a class="el" href="ospf-extern_8h.html#34b0e095c89f24ee59eaf77b52ad8f8a">g_ospf_lsa</a>, and <a class="el" href="rn-machine_8c-source.html#l00022">rn_getarea()</a>.</p>

<p>Referenced by <a class="el" href="bgp-ospf_8c-source.html#l00070">bgp_ospf_update()</a>, <a class="el" href="ospf-dd_8c-source.html#l00004">dd_process()</a>, <a class="el" href="ospf-database_8c-source.html#l00518">flood_summary()</a>, <a class="el" href="ospf-ls_8c-source.html#l00243">ls_update_process()</a>, <a class="el" href="ospf-timer-aging_8c-source.html#l00147">ospf_aging_timer()</a>, <a class="el" href="ospf-database_8c-source.html#l00393">ospf_db_init()</a>, <a class="el" href="ospf-database_8c-source.html#l00193">ospf_db_print()</a>, <a class="el" href="ospf-database_8c-source.html#l00006">ospf_db_route()</a>, <a class="el" href="ospf-database_8c-source.html#l00288">ospf_db_update()</a>, <a class="el" href="ospf-ls_8c-source.html#l00335">ospf_ls_request()</a>, <a class="el" href="ospf-ls-request_8c-source.html#l00004">ospf_ls_request_recv()</a>, <a class="el" href="ospf-lsa_8c-source.html#l00527">ospf_lsa_create()</a>, <a class="el" href="ospf-lsa_8c-source.html#l00731">ospf_lsa_flood()</a>, <a class="el" href="ospf-lsa_8c-source.html#l00850">ospf_lsa_flush()</a>, <a class="el" href="ospf-lsa_8c-source.html#l00481">ospf_lsa_refresh()</a>, <a class="el" href="ospf-lsa_8c-source.html#l00646">ospf_lsa_start_flood()</a>, <a class="el" href="ospf-neighbor-state_8c-source.html#l00011">ospf_nbr_reset()</a>, <a class="el" href="ospf-routing_8c-source.html#l00224">ospf_rt_print()</a>, <a class="el" href="ospf-routing_8c-source.html#l00029">ospf_rt_timer()</a>, and <a class="el" href="ospf-ls_8c-source.html#l00026">process_lsa_recv()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00248"></a>00248 {
<a name="l00249"></a>00249         tw_memory       *b;
<a name="l00250"></a>00250         ospf_lsa        *lsa;
<a name="l00251"></a>00251         <span class="keywordtype">int</span> i;
<a name="l00252"></a>00252 
<a name="l00253"></a>00253         <span class="keywordflow">if</span>(NULL == (b = <a class="code" href="rn-extern_8h.html#d45bc39e5a89bce656786b571acb1ae8">rn_getarea</a>(m)-&gt;g_ospf_lsa[<span class="keywordtype">id</span>]))
<a name="l00254"></a>00254                 <span class="keywordflow">return</span> NULL;
<a name="l00255"></a>00255 
<a name="l00256"></a>00256         lsa = tw_memory_data(b);
<a name="l00257"></a>00257 
<a name="l00258"></a>00258         <span class="keywordflow">for</span>(i = 0; i &lt; index; i++)
<a name="l00259"></a>00259         {
<a name="l00260"></a>00260                 b = lsa-&gt;next;
<a name="l00261"></a>00261 
<a name="l00262"></a>00262                 <span class="keywordflow">if</span>(!b)
<a name="l00263"></a>00263                         <span class="keywordflow">return</span> NULL;
<a name="l00264"></a>00264 
<a name="l00265"></a>00265                 lsa = tw_memory_data(b);
<a name="l00266"></a>00266         }
<a name="l00267"></a>00267 
<a name="l00268"></a>00268         <span class="keywordflow">if</span>(lsa == NULL)
<a name="l00269"></a>00269                 tw_error(TW_LOC, <span class="stringliteral">"Could not locate the request lsa!!"</span>);
<a name="l00270"></a>00270 
<a name="l00271"></a>00271         <span class="keywordflow">return</span> lsa;
<a name="l00272"></a>00272 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="5add44c8cd95a2a5e7766195d6f055fb"></a><!-- doxytag: member="ospf-extern.h::lsa_create" ref="5add44c8cd95a2a5e7766195d6f055fb" args="(ospf_state *state, int lsa_index, tw_lp *lp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char lsa_create           </td>
          <td>(</td>
          <td class="paramtype">ospf_state *&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>lsa_index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-lsa_8c-source.html#l00278">278</a> of file <a class="el" href="ospf-lsa_8c-source.html">ospf-lsa.c</a>.</p>

<p>References <a class="el" href="ospf-neighbor_8c-source.html#l00004">ospf_getnbr()</a>, <a class="el" href="ospf-lsa_8c-source.html#l00387">ospf_lsa_allocate()</a>, <a class="el" href="ospf-lsa_8c-source.html#l00406">ospf_lsa_link_allocate()</a>, and <a class="el" href="rn-machine_8c-source.html#l00022">rn_getarea()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00279"></a>00279 {
<a name="l00280"></a>00280         tw_memory       *b;
<a name="l00281"></a>00281 
<a name="l00282"></a>00282         ospf_lsa        *lsa;
<a name="l00283"></a>00283         ospf_lsa_link   *l;
<a name="l00284"></a>00284         ospf_nbr        *nbr;
<a name="l00285"></a>00285 
<a name="l00286"></a>00286         <span class="keywordtype">int</span>              nlinks;
<a name="l00287"></a>00287         <span class="keywordtype">int</span>              i;
<a name="l00288"></a>00288         <span class="keywordtype">int</span>              x_id;
<a name="l00289"></a>00289         <span class="keywordtype">char</span>             index;
<a name="l00290"></a>00290 
<a name="l00291"></a>00291         nlinks = 0;
<a name="l00292"></a>00292 
<a name="l00293"></a>00293         <span class="keywordflow">if</span>(entry &lt; state-&gt;ar-&gt;nmachines)
<a name="l00294"></a>00294                 x_id = state-&gt;ar-&gt;id;
<a name="l00295"></a>00295         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(entry &gt;= state-&gt;ar-&gt;nmachines + state-&gt;ar-&gt;as-&gt;nareas)
<a name="l00296"></a>00296                 x_id = entry - state-&gt;ar-&gt;nmachines - state-&gt;ar-&gt;as-&gt;nareas;
<a name="l00297"></a>00297         <span class="keywordflow">else</span>
<a name="l00298"></a>00298                 x_id = entry - state-&gt;ar-&gt;nmachines + state-&gt;ar-&gt;as-&gt;low;
<a name="l00299"></a>00299 
<a name="l00300"></a>00300         <span class="comment">// Need to get nlinks FIRST, since # LSA links can be &lt; # current</span>
<a name="l00301"></a>00301         <span class="comment">// go by neighbor states, not topology, unless AS external LSA</span>
<a name="l00302"></a>00302         <span class="keywordflow">for</span>(i = 0; i &lt; state-&gt;n_interfaces; i++)
<a name="l00303"></a>00303         {
<a name="l00304"></a>00304                 nbr = &amp;state-&gt;nbr[i];
<a name="l00305"></a>00305 
<a name="l00306"></a>00306                 <span class="keywordflow">if</span>(nbr-&gt;state != ospf_nbr_full_st || 
<a name="l00307"></a>00307                    nbr-&gt;istate != ospf_int_point_to_point_st)
<a name="l00308"></a>00308                         <span class="keywordflow">continue</span>;
<a name="l00309"></a>00309 
<a name="l00310"></a>00310                 <span class="comment">// If router_lsa, only count links within my area</span>
<a name="l00311"></a>00311                 <span class="keywordflow">if</span>(entry &lt; state-&gt;ar-&gt;nmachines)
<a name="l00312"></a>00312                 {
<a name="l00313"></a>00313                         <span class="keywordflow">if</span>(nbr-&gt;ar != state-&gt;ar)
<a name="l00314"></a>00314                                 nlinks++;
<a name="l00315"></a>00315                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(entry &gt; state-&gt;ar-&gt;nmachines + state-&gt;ar-&gt;as-&gt;nareas)
<a name="l00316"></a>00316                 {
<a name="l00317"></a>00317                         <span class="comment">// AS ext LSA, count link if to nbr AS == id's AS</span>
<a name="l00318"></a>00318                         <span class="keywordflow">if</span>(nbr-&gt;ar-&gt;as-&gt;id == x_id)
<a name="l00319"></a>00319                                 nlinks++;
<a name="l00320"></a>00320                 } <span class="keywordflow">else</span>
<a name="l00321"></a>00321                 {
<a name="l00322"></a>00322                         <span class="comment">// Summary LSA, count link if to nbr Area == id's Area</span>
<a name="l00323"></a>00323                         <span class="keywordflow">if</span>(state-&gt;ar-&gt;id == x_id)
<a name="l00324"></a>00324                                 nlinks++;
<a name="l00325"></a>00325                 }
<a name="l00326"></a>00326         }
<a name="l00327"></a>00327 
<a name="l00328"></a>00328         <span class="comment">// Get the head of the LSA array for this index</span>
<a name="l00329"></a>00329         b = <a class="code" href="rn-extern_8h.html#d45bc39e5a89bce656786b571acb1ae8">rn_getarea</a>(state-&gt;m)-&gt;g_ospf_lsa[entry];
<a name="l00330"></a>00330         lsa = tw_memory_data(b);
<a name="l00331"></a>00331 
<a name="l00332"></a>00332         <span class="keywordflow">for</span>(index = 0; NULL != lsa; index++)
<a name="l00333"></a>00333         {
<a name="l00334"></a>00334                 <span class="keywordflow">if</span>(lsa-&gt;links.size == nlinks)
<a name="l00335"></a>00335                 {
<a name="l00336"></a>00336                         b = lsa-&gt;links.head;
<a name="l00337"></a>00337                         <span class="keywordflow">for</span>(i = 0; i &lt; lsa-&gt;links.size; i++)
<a name="l00338"></a>00338                         {
<a name="l00339"></a>00339                                 l = tw_memory_data(b);
<a name="l00340"></a>00340                                 nbr = <a class="code" href="ospf-extern_8h.html#e1d40f1eb2223baa1a8b3d7d7b7b3d46">ospf_getnbr</a>(state, l-&gt;dst);
<a name="l00341"></a>00341 
<a name="l00342"></a>00342                                 <span class="keywordflow">if</span>(!nbr || (nbr-&gt;state != ospf_nbr_full_st))
<a name="l00343"></a>00343                                         <span class="keywordflow">break</span>;
<a name="l00344"></a>00344 
<a name="l00345"></a>00345                                 b = b-&gt;next;
<a name="l00346"></a>00346                         }
<a name="l00347"></a>00347 
<a name="l00348"></a>00348                         <span class="keywordflow">if</span>(nlinks == i &amp;&amp; lsa-&gt;adv_r == lp-&gt;id)
<a name="l00349"></a>00349                         {
<a name="l00350"></a>00350 <span class="preprocessor">#if VERIFY_LS</span>
<a name="l00351"></a>00351 <span class="preprocessor"></span>                                printf(<span class="stringliteral">"%ld OSPF: Found LSA for %d in graph! \n"</span>, 
<a name="l00352"></a>00352                                         lp-&gt;id, lsa-&gt;id);
<a name="l00353"></a>00353 <span class="preprocessor">#endif</span>
<a name="l00354"></a>00354 <span class="preprocessor"></span>                                <span class="keywordflow">return</span> index;
<a name="l00355"></a>00355                         }
<a name="l00356"></a>00356                 }
<a name="l00357"></a>00357 
<a name="l00358"></a>00358                 <span class="keywordflow">if</span>(lsa-&gt;next == NULL)
<a name="l00359"></a>00359                 {
<a name="l00360"></a>00360                         index++;
<a name="l00361"></a>00361                         <span class="keywordflow">break</span>;
<a name="l00362"></a>00362                 }
<a name="l00363"></a>00363 
<a name="l00364"></a>00364                 b = lsa-&gt;next;
<a name="l00365"></a>00365                 lsa = tw_memory_data(b);
<a name="l00366"></a>00366         }
<a name="l00367"></a>00367 
<a name="l00368"></a>00368         lsa-&gt;next = <a class="code" href="ospf-extern_8h.html#5e8fbd3b9d041de4eb34b5beb7b19221">ospf_lsa_allocate</a>(lp);
<a name="l00369"></a>00369         lsa = tw_memory_data(lsa-&gt;next);
<a name="l00370"></a>00370 
<a name="l00371"></a>00371         lsa-&gt;id = entry;
<a name="l00372"></a>00372         lsa-&gt;adv_r = lp-&gt;id;
<a name="l00373"></a>00373 
<a name="l00374"></a>00374         <span class="keywordflow">if</span>(x_id &lt; state-&gt;ar-&gt;nmachines)
<a name="l00375"></a>00375                 lsa-&gt;type = ospf_lsa_router;
<a name="l00376"></a>00376         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(x_id &lt; state-&gt;ar-&gt;nmachines + state-&gt;ar-&gt;as-&gt;nareas)
<a name="l00377"></a>00377                 lsa-&gt;type = ospf_lsa_summary3;
<a name="l00378"></a>00378         <span class="keywordflow">else</span>
<a name="l00379"></a>00379                 lsa-&gt;type = ospf_lsa_as_ext;
<a name="l00380"></a>00380 
<a name="l00381"></a>00381         <a class="code" href="ospf-extern_8h.html#3eb1ae7a66c4c936b5971afb65492d09">ospf_lsa_link_allocate</a>(state, lsa, lp);
<a name="l00382"></a>00382 
<a name="l00383"></a>00383         <span class="keywordflow">return</span> index;
<a name="l00384"></a>00384 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="08c473f603e6e76699516604a0f4133e"></a><!-- doxytag: member="ospf-extern.h::ospf_ack_delayed" ref="08c473f603e6e76699516604a0f4133e" args="(ospf_nbr *nbr, tw_memory *buf, int, tw_lp *lp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf_ack_delayed           </td>
          <td>(</td>
          <td class="paramtype">ospf_nbr *&nbsp;</td>
          <td class="paramname"> <em>nbr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_memory *&nbsp;</td>
          <td class="paramname"> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-ack_8c-source.html#l00004">4</a> of file <a class="el" href="ospf-ack_8c-source.html">ospf-ack.c</a>.</p>

<p>References <a class="el" href="ospf-timer_8c-source.html#l00029">ospf_timer_start()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00005"></a>00005 {
<a name="l00006"></a>00006         <span class="keywordflow">if</span> (NULL != nbr-&gt;delay_ack_timer)
<a name="l00007"></a>00007         {
<a name="l00008"></a>00008                 <span class="comment">// This means that this is the first delayed ack to be added to the</span>
<a name="l00009"></a>00009                 <span class="comment">// queue..</span>
<a name="l00010"></a>00010                 nbr-&gt;delay_ack_timer = <a class="code" href="ospf-extern_8h.html#75e3fe5d4b90cd1e2ca417ac3d9518c7">ospf_timer_start</a>(nbr, nbr-&gt;delay_ack_timer,
<a name="l00011"></a>00011                                                         1, OSPF_ACK_TIMEOUT, lp);
<a name="l00012"></a>00012         }
<a name="l00013"></a>00013 
<a name="l00014"></a>00014         buf-&gt;next = nbr-&gt;delay;
<a name="l00015"></a>00015         nbr-&gt;delay = buf;
<a name="l00016"></a>00016         nbr-&gt;delay_ack_size += size;
<a name="l00017"></a>00017 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="fd46b5215e38eb7394cfeb784296b43e"></a><!-- doxytag: member="ospf-extern.h::ospf_ack_direct" ref="fd46b5215e38eb7394cfeb784296b43e" args="(ospf_nbr *, tw_memory *, int size, tw_lp *lp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf_ack_direct           </td>
          <td>(</td>
          <td class="paramtype">ospf_nbr *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_memory *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-ack_8c-source.html#l00049">49</a> of file <a class="el" href="ospf-ack_8c-source.html">ospf-ack.c</a>.</p>

<p>References <a class="el" href="ospf-data-types_8h-source.html#l00011">OSPF_ACK_HEADER</a>, <a class="el" href="ospf-util_8c-source.html#l00004">ospf_event_new()</a>, and <a class="el" href="ospf-util_8c-source.html#l00024">ospf_event_send()</a>.</p>

<p>Referenced by <a class="el" href="ospf-lsa_8c-source.html#l00850">ospf_lsa_flush()</a>, and <a class="el" href="ospf-ls_8c-source.html#l00026">process_lsa_recv()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00050"></a>00050 {
<a name="l00051"></a>00051         tw_event       *e;
<a name="l00052"></a>00052         
<a name="l00053"></a>00053         ospf_db_entry  *dbe;
<a name="l00054"></a>00054 
<a name="l00055"></a>00055         dbe = tw_memory_data(buf);
<a name="l00056"></a>00056         e = <a class="code" href="ospf-extern_8h.html#a6ee00330aee5b151785a47a706cf226">ospf_event_new</a>(nbr-&gt;router, tw_getlp(nbr-&gt;id), 0.0, lp);
<a name="l00057"></a>00057         <a class="code" href="ospf-extern_8h.html#506873294c07e25082f4e8d2f631b522">ospf_event_send</a>(nbr-&gt;router, e, OSPF_LS_ACK, lp, size + <a class="code" href="ospf-data-types_8h.html#ec56696fcc7c3856defe5b67c2860998">OSPF_ACK_HEADER</a>, 
<a name="l00058"></a>00058                                                 buf, nbr-&gt;router-&gt;ar-&gt;id);
<a name="l00059"></a>00059 <span class="comment">/*</span>
<a name="l00060"></a>00060 <span class="comment">        e = ospf_event_send(nbr-&gt;router, tw_getlp(nbr-&gt;id), OSPF_LS_ACK,</span>
<a name="l00061"></a>00061 <span class="comment">                                                lp, size + OSPF_ACK_HEADER, </span>
<a name="l00062"></a>00062 <span class="comment">                                                buf, nbr-&gt;router-&gt;area);</span>
<a name="l00063"></a>00063 <span class="comment">*/</span>
<a name="l00064"></a>00064 
<a name="l00065"></a>00065 <span class="preprocessor">#if VERIFY_OSPF_ACK</span>
<a name="l00066"></a>00066 <span class="preprocessor"></span>        printf(<span class="stringliteral">"%ld: sending direct ACK for LSA %d to %d at %f, now %f\n"</span>,
<a name="l00067"></a>00067                    lp-&gt;id, dbe-&gt;b.entry, nbr-&gt;id, e-&gt;recv_ts, tw_now(lp));
<a name="l00068"></a>00068 <span class="preprocessor">#endif</span>
<a name="l00069"></a>00069 <span class="preprocessor"></span>}
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="31935383e7c5ef42f4d2b91297dbad6f"></a><!-- doxytag: member="ospf-extern.h::ospf_ack_process" ref="31935383e7c5ef42f4d2b91297dbad6f" args="(ospf_nbr *nbr, tw_bf *bf, tw_lp *lp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf_ack_process           </td>
          <td>(</td>
          <td class="paramtype">ospf_nbr *&nbsp;</td>
          <td class="paramname"> <em>nbr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_bf *&nbsp;</td>
          <td class="paramname"> <em>bf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-ack_8c-source.html#l00075">75</a> of file <a class="el" href="ospf-ack_8c-source.html">ospf-ack.c</a>.</p>

<p>References <a class="el" href="ospf-global_8c-source.html#l00007">g_ospf_fd</a>.</p>

<p>Referenced by <a class="el" href="ospf-router_8c-source.html#l00037">ospf_event_handler()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00076"></a>00076 {
<a name="l00077"></a>00077         tw_memory      *buf;
<a name="l00078"></a>00078         ospf_db_entry  *dbe;
<a name="l00079"></a>00079         <span class="keywordtype">int</span>             cnt;
<a name="l00080"></a>00080 
<a name="l00081"></a>00081         cnt = 0;
<a name="l00082"></a>00082         <span class="keywordflow">for</span> (buf = tw_event_memory_get(lp); buf; buf = tw_event_memory_get(lp))
<a name="l00083"></a>00083         {
<a name="l00084"></a>00084                 dbe = tw_memory_data(buf);
<a name="l00085"></a>00085                 tw_memory_free(lp, buf, <a class="code" href="ospf-extern_8h.html#884d66f70a693353a1894758d71deb99">g_ospf_fd</a>);
<a name="l00086"></a>00086         }
<a name="l00087"></a>00087 
<a name="l00088"></a>00088 
<a name="l00089"></a>00089 <span class="preprocessor">#if VERIFY_OSPF_ACK</span>
<a name="l00090"></a>00090 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (nbr-&gt;state &lt; ospf_nbr_exchange_st)
<a name="l00091"></a>00091         {
<a name="l00092"></a>00092                 printf(<span class="stringliteral">"%ld: nbr state is %d: LS ACK is ignored\n"</span>, 
<a name="l00093"></a>00093                                 lp-&gt;id, nbr-&gt;state);
<a name="l00094"></a>00094                 <span class="keywordflow">return</span>;
<a name="l00095"></a>00095         }
<a name="l00096"></a>00096 <span class="preprocessor">#endif</span>
<a name="l00097"></a>00097 <span class="preprocessor"></span>}
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="8abab116520bc7c2e92cdb930eb5bca7"></a><!-- doxytag: member="ospf-extern.h::ospf_ack_timed_out" ref="8abab116520bc7c2e92cdb930eb5bca7" args="(ospf_nbr *, tw_bf *, tw_lp *lp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf_ack_timed_out           </td>
          <td>(</td>
          <td class="paramtype">ospf_nbr *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_bf *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-ack_8c-source.html#l00025">25</a> of file <a class="el" href="ospf-ack_8c-source.html">ospf-ack.c</a>.</p>

<p>References <a class="el" href="ospf-data-types_8h-source.html#l00011">OSPF_ACK_HEADER</a>, <a class="el" href="ospf-util_8c-source.html#l00004">ospf_event_new()</a>, <a class="el" href="ospf-util_8c-source.html#l00024">ospf_event_send()</a>, and <a class="el" href="ospf-timer_8c-source.html#l00004">ospf_timer_cancel()</a>.</p>

<p>Referenced by <a class="el" href="ospf-router_8c-source.html#l00037">ospf_event_handler()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00026"></a>00026 {
<a name="l00027"></a>00027         tw_event        *e;
<a name="l00028"></a>00028 
<a name="l00029"></a>00029         e = <a class="code" href="ospf-extern_8h.html#a6ee00330aee5b151785a47a706cf226">ospf_event_new</a>(nbr-&gt;router, tw_getlp(nbr-&gt;id), 0.0, lp);
<a name="l00030"></a>00030         <a class="code" href="ospf-extern_8h.html#506873294c07e25082f4e8d2f631b522">ospf_event_send</a>(nbr-&gt;router, e, OSPF_LS_ACK, lp,
<a name="l00031"></a>00031                                         nbr-&gt;delay_ack_size,
<a name="l00032"></a>00032                                         nbr-&gt;delay, nbr-&gt;router-&gt;ar-&gt;id);
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 <span class="comment">/*</span>
<a name="l00035"></a>00035 <span class="comment">        ospf_event_send(nbr-&gt;router, tw_getlp(nbr-&gt;id), OSPF_LS_ACK, lp, </span>
<a name="l00036"></a>00036 <span class="comment">                                        nbr-&gt;delay_ack_size,</span>
<a name="l00037"></a>00037 <span class="comment">                                        nbr-&gt;delay, nbr-&gt;router-&gt;ar-&gt;id);</span>
<a name="l00038"></a>00038 <span class="comment">*/</span>
<a name="l00039"></a>00039 
<a name="l00040"></a>00040         nbr-&gt;delay = NULL;
<a name="l00041"></a>00041         nbr-&gt;delay_ack_size = <a class="code" href="ospf-data-types_8h.html#ec56696fcc7c3856defe5b67c2860998">OSPF_ACK_HEADER</a>;
<a name="l00042"></a>00042         nbr-&gt;delay_ack_timer = <a class="code" href="ospf-extern_8h.html#17ce6f44467d016ba9c7c24c98ba11cb">ospf_timer_cancel</a>(nbr-&gt;delay_ack_timer, lp);
<a name="l00043"></a>00043 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="1c68a2e5cdbbb0044932c3f3d2e1be34"></a><!-- doxytag: member="ospf-extern.h::ospf_aging_timer" ref="1c68a2e5cdbbb0044932c3f3d2e1be34" args="(ospf_state *state, tw_bf *bf, tw_lp *lp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf_aging_timer           </td>
          <td>(</td>
          <td class="paramtype">ospf_state *&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_bf *&nbsp;</td>
          <td class="paramname"> <em>bf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-timer-aging_8c-source.html#l00147">147</a> of file <a class="el" href="ospf-timer-aging_8c-source.html">ospf-timer-aging.c</a>.</p>

<p>References <a class="el" href="ospf-timer-aging_8c-source.html#l00115">can_be_removed()</a>, <a class="el" href="ospf-lsa_8c-source.html#l00247">getlsa()</a>, <a class="el" href="ospf-neighbor-types_8h-source.html#l00004">OSPF_AGING_INTERVAL</a>, <a class="el" href="ospf-lsa_8c-source.html#l00731">ospf_lsa_flood()</a>, <a class="el" href="ospf-global_8c-source.html#l00021">OSPF_LSA_MAX_AGE</a>, <a class="el" href="ospf-lsa_8c-source.html#l00481">ospf_lsa_refresh()</a>, <a class="el" href="ospf-global_8c-source.html#l00022">OSPF_LSA_REFRESH_AGE</a>, <a class="el" href="ospf-data-types_8h-source.html#l00016">OSPF_MIN_LSA_SEQNUM</a>, <a class="el" href="ospf-routing_8c-source.html#l00004">ospf_rt_build()</a>, and <a class="el" href="ospf-timer_8c-source.html#l00029">ospf_timer_start()</a>.</p>

<p>Referenced by <a class="el" href="ospf-router_8c-source.html#l00037">ospf_event_handler()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00148"></a>00148 {
<a name="l00149"></a>00149         tw_stime        ts;
<a name="l00150"></a>00150 
<a name="l00151"></a>00151         ospf_db_entry  *dbe;
<a name="l00152"></a>00152         ospf_lsa       *lsa;
<a name="l00153"></a>00153 
<a name="l00154"></a>00154         <span class="keywordtype">int</span>             i;
<a name="l00155"></a>00155         <span class="keywordtype">int</span>             next_timer;
<a name="l00156"></a>00156         <span class="keywordtype">char</span>            rebuild_rt;
<a name="l00157"></a>00157         <span class="keywordtype">int</span>             aging_increment;
<a name="l00158"></a>00158 
<a name="l00159"></a>00159         ts = -1.0;
<a name="l00160"></a>00160         rebuild_rt = 0;
<a name="l00161"></a>00161         <span class="comment">//aging_increment = aging_timer_increment(state, lp);</span>
<a name="l00162"></a>00162         aging_increment = (floor(tw_now(lp) - state-&gt;db_last_ts) / 4) * 4;
<a name="l00163"></a>00163 
<a name="l00164"></a>00164         state-&gt;db_last_ts = tw_now(lp);
<a name="l00165"></a>00165 
<a name="l00166"></a>00166 <span class="preprocessor">#if VERIFY_AGING</span>
<a name="l00167"></a>00167 <span class="preprocessor"></span>        printf(<span class="stringliteral">"%ld: Aging DB: new last ts: %f \n"</span>, lp-&gt;id, tw_now(lp));
<a name="l00168"></a>00168 <span class="preprocessor">#endif</span>
<a name="l00169"></a>00169 <span class="preprocessor"></span>
<a name="l00170"></a>00170         next_timer = <a class="code" href="ospf-extern_8h.html#354846699ca7e45e6f42d17268d8fac2">OSPF_LSA_MAX_AGE</a>;
<a name="l00171"></a>00171         <span class="keywordflow">for</span> (i = 0; i &lt; state-&gt;ar-&gt;g_ospf_nlsa; i++)
<a name="l00172"></a>00172         {
<a name="l00173"></a>00173                 dbe = &amp;state-&gt;db[i];
<a name="l00174"></a>00174 
<a name="l00175"></a>00175                 <span class="keywordflow">if</span> (dbe-&gt;b.free)
<a name="l00176"></a>00176                         <span class="keywordflow">continue</span>;
<a name="l00177"></a>00177 
<a name="l00178"></a>00178                 lsa = <a class="code" href="ospf-extern_8h.html#9608d8ba29ae5cc559afe788cddade3f">getlsa</a>(state-&gt;m, dbe-&gt;lsa, i);
<a name="l00179"></a>00179 
<a name="l00180"></a>00180 <span class="preprocessor">#if VERIFY_AGING</span>
<a name="l00181"></a>00181 <span class="preprocessor"></span>                printf(<span class="stringliteral">"%ld: Age before aging lsa %d: %d (incr = %d), after %d\n"</span>,
<a name="l00182"></a>00182                            lp-&gt;id, lsa-&gt;id, dbe-&gt;b.age, aging_increment,
<a name="l00183"></a>00183                            dbe-&gt;b.age + aging_increment);
<a name="l00184"></a>00184 <span class="preprocessor">#endif</span>
<a name="l00185"></a>00185 <span class="preprocessor"></span>
<a name="l00186"></a>00186                 dbe-&gt;b.age += aging_increment;
<a name="l00187"></a>00187 
<a name="l00188"></a>00188                 <span class="keywordflow">if</span> (TW_TRUE == <a class="code" href="ospf-timer-aging_8c.html#6b9f2cf12cc3e86584a989279aad099e">can_be_removed</a>(state, dbe, lp))
<a name="l00189"></a>00189                 {
<a name="l00190"></a>00190 <span class="preprocessor">#if VERIFY_AGING</span>
<a name="l00191"></a>00191 <span class="preprocessor"></span>                        printf(<span class="stringliteral">"\tchecking db entry for LSA %d REMOVED (age = %d)\n"</span>,
<a name="l00192"></a>00192                                 i, dbe-&gt;b.age);
<a name="l00193"></a>00193 <span class="preprocessor">#endif</span>
<a name="l00194"></a>00194 <span class="preprocessor"></span>
<a name="l00195"></a>00195                         <span class="keywordflow">if</span> (lsa-&gt;adv_r == lp-&gt;id)
<a name="l00196"></a>00196                         {
<a name="l00197"></a>00197                                 <span class="comment">//printf("%d: my LSA reached MAX AGE! \n", lp-&gt;id);</span>
<a name="l00198"></a>00198                                 state-&gt;lsa_wrapping = 0;
<a name="l00199"></a>00199                                 state-&gt;lsa_seqnum = <a class="code" href="ospf-data-types_8h.html#046cf2935a363d19e94b7ce7ffac27ed">OSPF_MIN_LSA_SEQNUM</a> + 1;
<a name="l00200"></a>00200 
<a name="l00201"></a>00201                                 dbe-&gt;b.age = 0;
<a name="l00202"></a>00202                                 <a class="code" href="ospf-extern_8h.html#9b306ecc8339fcb31d7c8e5448f60722">ospf_lsa_refresh</a>(state, dbe, lp);
<a name="l00203"></a>00203                         } <span class="keywordflow">else</span>
<a name="l00204"></a>00204                         {
<a name="l00205"></a>00205                                 dbe-&gt;b.free = 1;
<a name="l00206"></a>00206                                 <span class="comment">//ospf_rt_build(state, lp-&gt;id);</span>
<a name="l00207"></a>00207                                 rebuild_rt = 1;
<a name="l00208"></a>00208                         }
<a name="l00209"></a>00209                 } <span class="keywordflow">else</span>
<a name="l00210"></a>00210                 {
<a name="l00211"></a>00211                         <span class="keywordflow">if</span> (lsa-&gt;adv_r == lp-&gt;id)
<a name="l00212"></a>00212                         {
<a name="l00213"></a>00213                                 <span class="keywordflow">if</span> (dbe-&gt;b.age &gt;= <a class="code" href="ospf-extern_8h.html#e536fe3d2be9c08e53d0e53d48046668">OSPF_LSA_REFRESH_AGE</a>)
<a name="l00214"></a>00214                                 {
<a name="l00215"></a>00215                                         dbe-&gt;b.age = 0;
<a name="l00216"></a>00216                                         printf(<span class="stringliteral">"\n%lld: refresh LSA %d: now %lf \n"</span>, 
<a name="l00217"></a>00217                                                 lp-&gt;id, dbe-&gt;b.entry, tw_now(lp));
<a name="l00218"></a>00218                                         <a class="code" href="ospf-extern_8h.html#9b306ecc8339fcb31d7c8e5448f60722">ospf_lsa_refresh</a>(state, dbe, lp);
<a name="l00219"></a>00219 
<a name="l00220"></a>00220                                         ts = <a class="code" href="ospf-extern_8h.html#e536fe3d2be9c08e53d0e53d48046668">OSPF_LSA_REFRESH_AGE</a>;
<a name="l00221"></a>00221 
<a name="l00222"></a>00222                                         <span class="keywordflow">continue</span>;
<a name="l00223"></a>00223 <span class="preprocessor">#if VERIFY_AGING</span>
<a name="l00224"></a>00224 <span class="preprocessor"></span>                                        printf(<span class="stringliteral">"set ts: %lf, now %lf &gt; REFRESH \n"</span>,
<a name="l00225"></a>00225                                                    ts, tw_now(lp));
<a name="l00226"></a>00226 <span class="preprocessor">#endif</span>
<a name="l00227"></a>00227 <span class="preprocessor"></span>                                } <span class="keywordflow">else</span>
<a name="l00228"></a>00228                                 {
<a name="l00229"></a>00229                                         next_timer = min(<a class="code" href="ospf-extern_8h.html#e536fe3d2be9c08e53d0e53d48046668">OSPF_LSA_REFRESH_AGE</a> -
<a name="l00230"></a>00230                                                          dbe-&gt;b.age, next_timer);
<a name="l00231"></a>00231 
<a name="l00232"></a>00232 <span class="preprocessor">#if VERIFY_AGING</span>
<a name="l00233"></a>00233 <span class="preprocessor"></span>                                        printf(<span class="stringliteral">"\tset next_timer: %d, &lt; REFRESH \n"</span>,
<a name="l00234"></a>00234                                                 next_timer);
<a name="l00235"></a>00235 <span class="preprocessor">#endif</span>
<a name="l00236"></a>00236 <span class="preprocessor"></span>                                }
<a name="l00237"></a>00237 
<a name="l00238"></a>00238                                 <span class="keywordflow">if</span> (dbe-&gt;b.age &gt;= <a class="code" href="ospf-extern_8h.html#e536fe3d2be9c08e53d0e53d48046668">OSPF_LSA_REFRESH_AGE</a>)
<a name="l00239"></a>00239                                 {
<a name="l00240"></a>00240                                         printf(<span class="stringliteral">"%lld: FLOODING LSA %d for refresh!\n"</span>, 
<a name="l00241"></a>00241                                                 lp-&gt;id, dbe-&gt;b.entry);
<a name="l00242"></a>00242 
<a name="l00243"></a>00243                                         <a class="code" href="ospf-extern_8h.html#51de1d77d40f0604d5a65e902ceda57b">ospf_lsa_flood</a>(state, dbe, -1, lp);
<a name="l00244"></a>00244                                         <span class="comment">//ospf_rt_build(state, lp-&gt;id);</span>
<a name="l00245"></a>00245                                         <span class="comment">//rebuild_rt = 1;</span>
<a name="l00246"></a>00246                                 }
<a name="l00247"></a>00247                         } <span class="keywordflow">else</span>
<a name="l00248"></a>00248                         {
<a name="l00249"></a>00249                                 <span class="comment">/*</span>
<a name="l00250"></a>00250 <span class="comment">                                 * Do not overwrite TS, if set already by either</span>
<a name="l00251"></a>00251 <span class="comment">                                 * a self-originated LSA, or otherwise.</span>
<a name="l00252"></a>00252 <span class="comment">                                 */</span>
<a name="l00253"></a>00253                                 <span class="keywordflow">if</span> (dbe-&gt;b.age &gt;= <a class="code" href="ospf-extern_8h.html#354846699ca7e45e6f42d17268d8fac2">OSPF_LSA_MAX_AGE</a> &amp;&amp; ts &lt; 0.0)
<a name="l00254"></a>00254                                 {
<a name="l00255"></a>00255                                         dbe-&gt;b.age = <a class="code" href="ospf-extern_8h.html#354846699ca7e45e6f42d17268d8fac2">OSPF_LSA_MAX_AGE</a>;
<a name="l00256"></a>00256 
<a name="l00257"></a>00257                                         ts = floor(tw_now(lp) / <a class="code" href="ospf-neighbor-types_8h.html#48f79e50920671162727e73bd9468f34">OSPF_AGING_INTERVAL</a>) *
<a name="l00258"></a>00258                                                 <a class="code" href="ospf-neighbor-types_8h.html#48f79e50920671162727e73bd9468f34">OSPF_AGING_INTERVAL</a>;
<a name="l00259"></a>00259                                         <span class="comment">//printf("%d: setting (ns) ts: %f, &gt; MAX AGE\n", lp-&gt;id, ts);</span>
<a name="l00260"></a>00260                                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ts &lt; 0.0)
<a name="l00261"></a>00261                                 {
<a name="l00262"></a>00262                                         next_timer = min(<a class="code" href="ospf-extern_8h.html#354846699ca7e45e6f42d17268d8fac2">OSPF_LSA_MAX_AGE</a> -
<a name="l00263"></a>00263                                                         dbe-&gt;b.age, next_timer);
<a name="l00264"></a>00264 
<a name="l00265"></a>00265 <span class="comment">/*</span>
<a name="l00266"></a>00266 <span class="comment">                                        printf("%d: setting (ns)next_timer: %d, &lt; REFRESH \n",</span>
<a name="l00267"></a>00267 <span class="comment">                                                   lp-&gt;id, next_timer);</span>
<a name="l00268"></a>00268 <span class="comment">*/</span>
<a name="l00269"></a>00269                                 }
<a name="l00270"></a>00270 
<a name="l00271"></a>00271                                 <span class="keywordflow">if</span> (dbe-&gt;b.age &gt;= <a class="code" href="ospf-extern_8h.html#354846699ca7e45e6f42d17268d8fac2">OSPF_LSA_MAX_AGE</a>)
<a name="l00272"></a>00272                                 {
<a name="l00273"></a>00273 <span class="comment">/*</span>
<a name="l00274"></a>00274 <span class="comment">                                        printf("%d: FLOODING %d LSA\n", </span>
<a name="l00275"></a>00275 <span class="comment">                                                                lp-&gt;id, lsa-&gt;adv_r);</span>
<a name="l00276"></a>00276 <span class="comment">*/</span>
<a name="l00277"></a>00277                                         <a class="code" href="ospf-extern_8h.html#51de1d77d40f0604d5a65e902ceda57b">ospf_lsa_flood</a>(state, dbe, -1, lp);
<a name="l00278"></a>00278                                         <span class="comment">//ospf_rt_build(state, lp-&gt;id);</span>
<a name="l00279"></a>00279                                         rebuild_rt = 1;
<a name="l00280"></a>00280                                 }
<a name="l00281"></a>00281                         }
<a name="l00282"></a>00282 
<a name="l00283"></a>00283                 }
<a name="l00284"></a>00284         }
<a name="l00285"></a>00285 
<a name="l00286"></a>00286         <span class="keywordflow">if</span>(rebuild_rt)
<a name="l00287"></a>00287                 <a class="code" href="ospf-extern_8h.html#8e91da94f0927f20f1b2962a45bcb5b9">ospf_rt_build</a>(state, lp-&gt;id);
<a name="l00288"></a>00288 
<a name="l00289"></a>00289         <span class="keywordflow">if</span>(ts &lt; 0.0)
<a name="l00290"></a>00290         {
<a name="l00291"></a>00291                 state-&gt;aging_timer = <a class="code" href="ospf-extern_8h.html#75e3fe5d4b90cd1e2ca417ac3d9518c7">ospf_timer_start</a>(NULL, state-&gt;aging_timer,
<a name="l00292"></a>00292                                                         next_timer,
<a name="l00293"></a>00293                                                         OSPF_AGING_TIMER, lp);
<a name="l00294"></a>00294         }
<a name="l00295"></a>00295         <span class="keywordflow">else</span>
<a name="l00296"></a>00296         {
<a name="l00297"></a>00297                 state-&gt;aging_timer = <a class="code" href="ospf-extern_8h.html#75e3fe5d4b90cd1e2ca417ac3d9518c7">ospf_timer_start</a>(NULL, state-&gt;aging_timer,
<a name="l00298"></a>00298                                                         ts,
<a name="l00299"></a>00299                                                         OSPF_AGING_TIMER, lp);
<a name="l00300"></a>00300         }
<a name="l00301"></a>00301 
<a name="l00302"></a>00302 <span class="preprocessor">#if VERIFY_AGING</span>
<a name="l00303"></a>00303 <span class="preprocessor"></span>        <span class="keywordflow">if</span>(state-&gt;aging_timer)
<a name="l00304"></a>00304                 printf(<span class="stringliteral">"\tnext aging timer to fire at %lf\n"</span>,
<a name="l00305"></a>00305                         state-&gt;aging_timer-&gt;recv_ts);
<a name="l00306"></a>00306 <span class="preprocessor">#endif</span>
<a name="l00307"></a>00307 <span class="preprocessor"></span>}
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="0ff2c1e877d460d2950c2228447c2a4d"></a><!-- doxytag: member="ospf-extern.h::ospf_aging_timer_set" ref="0ff2c1e877d460d2950c2228447c2a4d" args="(ospf_state *state, ospf_db_entry *, int, tw_lp *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf_aging_timer_set           </td>
          <td>(</td>
          <td class="paramtype">ospf_state *&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ospf_db_entry *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-timer-aging_8c-source.html#l00024">24</a> of file <a class="el" href="ospf-timer-aging_8c-source.html">ospf-timer-aging.c</a>.</p>

<p>References <a class="el" href="ospf-neighbor-types_8h-source.html#l00004">OSPF_AGING_INTERVAL</a>, <a class="el" href="ospf-lsa_8c-source.html#l00231">ospf_lsa_age()</a>, <a class="el" href="ospf-global_8c-source.html#l00021">OSPF_LSA_MAX_AGE</a>, <a class="el" href="ospf-global_8c-source.html#l00022">OSPF_LSA_REFRESH_AGE</a>, and <a class="el" href="ospf-timer_8c-source.html#l00029">ospf_timer_start()</a>.</p>

<p>Referenced by <a class="el" href="ospf-database_8c-source.html#l00288">ospf_db_update()</a>, <a class="el" href="ospf-lsa_8c-source.html#l00527">ospf_lsa_create()</a>, <a class="el" href="ospf-lsa_8c-source.html#l00481">ospf_lsa_refresh()</a>, and <a class="el" href="ospf-lsa_8c-source.html#l00646">ospf_lsa_start_flood()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00025"></a>00025 {
<a name="l00026"></a>00026         tw_stime        ts;
<a name="l00027"></a>00027 
<a name="l00028"></a>00028         <span class="keywordtype">int</span>     i;
<a name="l00029"></a>00029         <span class="keywordtype">int</span>     incr;
<a name="l00030"></a>00030 
<a name="l00031"></a>00031 <span class="preprocessor">#if VERIFY_AGING</span>
<a name="l00032"></a>00032 <span class="preprocessor"></span>        printf(<span class="stringliteral">"%ld: Aging DB for new LSA: new last ts: %f \n"</span>, lp-&gt;id, tw_now(lp));
<a name="l00033"></a>00033 <span class="preprocessor">#endif</span>
<a name="l00034"></a>00034 <span class="preprocessor"></span>
<a name="l00035"></a>00035         <span class="comment">/*</span>
<a name="l00036"></a>00036 <span class="comment">         * Have to subtract the over-aging that will occur on this lsa</span>
<a name="l00037"></a>00037 <span class="comment">         * in the next aging timer interval.</span>
<a name="l00038"></a>00038 <span class="comment">         */</span>
<a name="l00039"></a>00039         <span class="comment">//dbe-&gt;b.age = age - aging_timer_increment(state, lp);</span>
<a name="l00040"></a>00040 
<a name="l00041"></a>00041         <span class="comment">// age them all immediately, they cannot be past the timer!</span>
<a name="l00042"></a>00042         ts = DBL_MAX;
<a name="l00043"></a>00043         <span class="keywordflow">if</span>(state-&gt;aging_timer)
<a name="l00044"></a>00044                 ts = state-&gt;aging_timer-&gt;recv_ts - tw_now(lp);
<a name="l00045"></a>00045 
<a name="l00046"></a>00046         incr = (floor(tw_now(lp) - state-&gt;db_last_ts) / 4) * 4;
<a name="l00047"></a>00047 
<a name="l00048"></a>00048         state-&gt;db_last_ts = tw_now(lp);
<a name="l00049"></a>00049 
<a name="l00050"></a>00050         <span class="comment">// Age our LSAs, and increment the other LSA ages to the current time</span>
<a name="l00051"></a>00051         <span class="keywordflow">if</span>(incr &gt; 0)
<a name="l00052"></a>00052         {
<a name="l00053"></a>00053                 <span class="keywordflow">for</span>(i = 0; i &lt; state-&gt;ar-&gt;g_ospf_nlsa; i++)
<a name="l00054"></a>00054                 {
<a name="l00055"></a>00055                         <span class="keywordflow">if</span>(dbe-&gt;b.free)
<a name="l00056"></a>00056                                 <span class="keywordflow">continue</span>;
<a name="l00057"></a>00057         
<a name="l00058"></a>00058                         <span class="keywordflow">if</span>(dbe-&gt;b.entry == i)
<a name="l00059"></a>00059                                 state-&gt;db[i].b.age = age;
<a name="l00060"></a>00060                         <span class="keywordflow">else</span>
<a name="l00061"></a>00061                                 state-&gt;db[i].b.age += incr;
<a name="l00062"></a>00062         
<a name="l00063"></a>00063 <span class="preprocessor">#if VERIFY_AGING</span>
<a name="l00064"></a>00064 <span class="preprocessor"></span>                        printf(<span class="stringliteral">"\tLSA %d new age: %d\n"</span>, i, state-&gt;db[i].b.age);
<a name="l00065"></a>00065 <span class="preprocessor">#endif</span>
<a name="l00066"></a>00066 <span class="preprocessor"></span>                }
<a name="l00067"></a>00067         } <span class="keywordflow">else</span>
<a name="l00068"></a>00068         {
<a name="l00069"></a>00069                 state-&gt;db[dbe-&gt;b.entry].b.age = age;
<a name="l00070"></a>00070         }
<a name="l00071"></a>00071 
<a name="l00072"></a>00072         <span class="comment">// now move the timer up, if the new LSA is going to cause the next</span>
<a name="l00073"></a>00073         <span class="comment">// timer firing</span>
<a name="l00074"></a>00074         <span class="keywordflow">if</span>(dbe-&gt;b.entry == lp-&gt;id)
<a name="l00075"></a>00075         {
<a name="l00076"></a>00076                 <span class="keywordflow">if</span>(ts &gt; <a class="code" href="ospf-extern_8h.html#e536fe3d2be9c08e53d0e53d48046668">OSPF_LSA_REFRESH_AGE</a> - dbe-&gt;b.age)
<a name="l00077"></a>00077                         ts = <a class="code" href="ospf-extern_8h.html#e536fe3d2be9c08e53d0e53d48046668">OSPF_LSA_REFRESH_AGE</a> - dbe-&gt;b.age;
<a name="l00078"></a>00078         } <span class="keywordflow">else</span>
<a name="l00079"></a>00079         {
<a name="l00080"></a>00080                 <span class="keywordflow">if</span>(ts &gt; <a class="code" href="ospf-extern_8h.html#354846699ca7e45e6f42d17268d8fac2">OSPF_LSA_MAX_AGE</a> - dbe-&gt;b.age)
<a name="l00081"></a>00081                         ts = <a class="code" href="ospf-extern_8h.html#354846699ca7e45e6f42d17268d8fac2">OSPF_LSA_MAX_AGE</a> - dbe-&gt;b.age;
<a name="l00082"></a>00082         }
<a name="l00083"></a>00083 
<a name="l00084"></a>00084 <span class="preprocessor">#if VERIFY_AGING</span>
<a name="l00085"></a>00085 <span class="preprocessor"></span>        printf(<span class="stringliteral">"\tdbe age now : %d \n"</span>, dbe-&gt;b.age);
<a name="l00086"></a>00086         printf(<span class="stringliteral">"\tospf_lsa_age: %d \n"</span>, <a class="code" href="ospf-extern_8h.html#f2ab0671b22732e9743355c30ea903a4">ospf_lsa_age</a>(state, dbe, lp));
<a name="l00087"></a>00087         printf(<span class="stringliteral">"\tage increment: %d \n"</span>, incr);
<a name="l00088"></a>00088         printf(<span class="stringliteral">"\tnew age: %d \n"</span>, age);
<a name="l00089"></a>00089 <span class="preprocessor">#endif</span>
<a name="l00090"></a>00090 <span class="preprocessor"></span>
<a name="l00091"></a>00091         <span class="comment">/*</span>
<a name="l00092"></a>00092 <span class="comment">         * Set the timer for the next aging timer interval so we can compute the</span>
<a name="l00093"></a>00093 <span class="comment">         * new ages and reset the timer appropriately for REFRESH_AGE and MAX_AGE</span>
<a name="l00094"></a>00094 <span class="comment">         */</span>
<a name="l00095"></a>00095         ts = (floor(tw_now(lp) / <a class="code" href="ospf-neighbor-types_8h.html#48f79e50920671162727e73bd9468f34">OSPF_AGING_INTERVAL</a>) + 1) * <a class="code" href="ospf-neighbor-types_8h.html#48f79e50920671162727e73bd9468f34">OSPF_AGING_INTERVAL</a>;
<a name="l00096"></a>00096         ts -= tw_now(lp);
<a name="l00097"></a>00097         state-&gt;aging_timer = <a class="code" href="ospf-extern_8h.html#75e3fe5d4b90cd1e2ca417ac3d9518c7">ospf_timer_start</a>(NULL, state-&gt;aging_timer,
<a name="l00098"></a>00098                                   ts, OSPF_AGING_TIMER, lp);
<a name="l00099"></a>00099 
<a name="l00100"></a>00100 <span class="preprocessor">#if VERIFY_AGING</span>
<a name="l00101"></a>00101 <span class="preprocessor"></span>        <span class="keywordflow">if</span>(state-&gt;aging_timer)
<a name="l00102"></a>00102                 printf(<span class="stringliteral">"\tnext aging timer will fire at %lf, now %lf \n"</span>, 
<a name="l00103"></a>00103                                 state-&gt;aging_timer-&gt;recv_ts, tw_now(lp));
<a name="l00104"></a>00104         <span class="keywordflow">else</span>
<a name="l00105"></a>00105                 printf(<span class="stringliteral">"\tnext aging timer past end time (%f)!! \n"</span>,
<a name="l00106"></a>00106                                         tw_now(lp) + ts);
<a name="l00107"></a>00107 <span class="preprocessor">#endif</span>
<a name="l00108"></a>00108 <span class="preprocessor"></span>}
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="01c993e7218639b1eb00314f4bfb2729"></a><!-- doxytag: member="ospf-extern.h::ospf_db_init" ref="01c993e7218639b1eb00314f4bfb2729" args="(ospf_state *state, tw_lp *lp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int ospf_db_init           </td>
          <td>(</td>
          <td class="paramtype">ospf_state *&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-database_8c-source.html#l00393">393</a> of file <a class="el" href="ospf-database_8c-source.html">ospf-database.c</a>.</p>

<p>References <a class="el" href="ospf-database_8c-source.html#l00518">flood_summary()</a>, <a class="el" href="ospf-global_8c-source.html#l00019">g_ospf_rt_write</a>, <a class="el" href="rn-global_8c-source.html#l00043">g_rn_nas</a>, <a class="el" href="ospf-lsa_8c-source.html#l00247">getlsa()</a>, <a class="el" href="ospf-lsa_8c-source.html#l00076">ospf_lsa_find()</a>, <a class="el" href="ospf-global_8c-source.html#l00021">OSPF_LSA_MAX_AGE</a>, <a class="el" href="ospf-global_8c-source.html#l00022">OSPF_LSA_REFRESH_AGE</a>, <a class="el" href="ospf-data-types_8h-source.html#l00016">OSPF_MIN_LSA_SEQNUM</a>, and <a class="el" href="rn-machine_8c-source.html#l00022">rn_getarea()</a>.</p>

<p>Referenced by <a class="el" href="ospf-router_8c-source.html#l00237">ospf_startup()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00394"></a>00394 {
<a name="l00395"></a>00395         rn_area         *ar;
<a name="l00396"></a>00396 
<a name="l00397"></a>00397         ospf_db_entry   *dbe;
<a name="l00398"></a>00398         ospf_lsa        *lsa;
<a name="l00399"></a>00399 
<a name="l00400"></a>00400         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>    next_timer;
<a name="l00401"></a>00401         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>    j;
<a name="l00402"></a>00402         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>    i;
<a name="l00403"></a>00403 
<a name="l00404"></a>00404         ar = <a class="code" href="rn-extern_8h.html#d45bc39e5a89bce656786b571acb1ae8">rn_getarea</a>(state-&gt;m);      
<a name="l00405"></a>00405         state-&gt;db = (ospf_db_entry *) 
<a name="l00406"></a>00406                         calloc(<span class="keyword">sizeof</span>(ospf_db_entry), state-&gt;ar-&gt;g_ospf_nlsa);
<a name="l00407"></a>00407 
<a name="l00408"></a>00408         <span class="keywordflow">if</span>(!state-&gt;db)
<a name="l00409"></a>00409                 tw_error(TW_LOC, <span class="stringliteral">"Out of memory for local LSA database!"</span>);
<a name="l00410"></a>00410 
<a name="l00411"></a>00411 <span class="preprocessor">#if VERIFY_DATABASE</span>
<a name="l00412"></a>00412 <span class="preprocessor"></span>        printf(<span class="stringliteral">"%ld: INIT DB: nentries %d \n"</span>, lp-&gt;id, state-&gt;ar-&gt;g_ospf_nlsa);
<a name="l00413"></a>00413 <span class="preprocessor">#endif</span>
<a name="l00414"></a>00414 <span class="preprocessor"></span>
<a name="l00415"></a>00415         <span class="comment">/*</span>
<a name="l00416"></a>00416 <span class="comment">         * Starting converged, setup LSA database</span>
<a name="l00417"></a>00417 <span class="comment">         */</span>
<a name="l00418"></a>00418         state-&gt;db_last_ts = 0;
<a name="l00419"></a>00419         next_timer = <a class="code" href="ospf-extern_8h.html#354846699ca7e45e6f42d17268d8fac2">OSPF_LSA_MAX_AGE</a>;
<a name="l00420"></a>00420         j = 0;
<a name="l00421"></a>00421         <span class="keywordflow">for</span>(i = 0; i &lt; state-&gt;ar-&gt;g_ospf_nlsa - <a class="code" href="rn-extern_8h.html#353089f1049e9e0d5160683103c17e62">g_rn_nas</a>; i++)
<a name="l00422"></a>00422         {
<a name="l00423"></a>00423                 dbe = &amp;state-&gt;db[i];
<a name="l00424"></a>00424 
<a name="l00425"></a>00425                 dbe-&gt;b.age = 0;
<a name="l00426"></a>00426                 dbe-&gt;b.free = 1;
<a name="l00427"></a>00427                 dbe-&gt;b.entry = i;
<a name="l00428"></a>00428                 dbe-&gt;seqnum = <a class="code" href="ospf-data-types_8h.html#046cf2935a363d19e94b7ce7ffac27ed">OSPF_MIN_LSA_SEQNUM</a> + 1;
<a name="l00429"></a>00429 
<a name="l00430"></a>00430                 <span class="comment">// get the FIRST entry for the LSA</span>
<a name="l00431"></a>00431                 <span class="keywordflow">if</span>((NULL == (lsa = <a class="code" href="ospf-extern_8h.html#9608d8ba29ae5cc559afe788cddade3f">getlsa</a>(state-&gt;m, dbe-&gt;lsa, i))) ||
<a name="l00432"></a>00432                    lsa-&gt;adv_r == 0xffffffff)
<a name="l00433"></a>00433                 {
<a name="l00434"></a>00434                         <span class="keywordflow">if</span>(i &lt; state-&gt;ar-&gt;nmachines)
<a name="l00435"></a>00435                                 <span class="keywordflow">continue</span>;
<a name="l00436"></a>00436 
<a name="l00437"></a>00437                         <span class="comment">// May need to create the LSA from a prior run</span>
<a name="l00438"></a>00438                         <span class="keywordflow">if</span>(0 == <a class="code" href="ospf-extern_8h.html#c90b3ca848617e3fe636407eb372c5d5">g_ospf_rt_write</a> &amp;&amp; state-&gt;m-&gt;ft[i] != -1)
<a name="l00439"></a>00439                         {
<a name="l00440"></a>00440                                 dbe-&gt;lsa = <a class="code" href="ospf-extern_8h.html#4b5eb3d01fff0994efd88f1f1a305c6f">ospf_lsa_find</a>(state, 
<a name="l00441"></a>00441                                                         &amp;state-&gt;nbr[state-&gt;m-&gt;ft[i]],
<a name="l00442"></a>00442                                                          i, lp);
<a name="l00443"></a>00443                                 lsa = <a class="code" href="ospf-extern_8h.html#9608d8ba29ae5cc559afe788cddade3f">getlsa</a>(state-&gt;m, dbe-&gt;lsa, i);
<a name="l00444"></a>00444                         }
<a name="l00445"></a>00445                 }
<a name="l00446"></a>00446 
<a name="l00447"></a>00447                 <span class="comment">// I think this is ok, since an LSA with no links is not</span>
<a name="l00448"></a>00448                 <span class="comment">// part of the database.. at that point it is simply removed</span>
<a name="l00449"></a>00449                 <span class="keywordflow">if</span>(lsa-&gt;links.size == 0)
<a name="l00450"></a>00450                         <span class="keywordflow">continue</span>;
<a name="l00451"></a>00451 
<a name="l00452"></a>00452                 dbe-&gt;b.free = 0;
<a name="l00453"></a>00453 
<a name="l00454"></a>00454 <span class="preprocessor">#if VERIFY_DATABASE</span>
<a name="l00455"></a>00455 <span class="preprocessor"></span>                printf(<span class="stringliteral">"\t%ld: lsa %d: age %d, adv_r %d\n"</span>, 
<a name="l00456"></a>00456                         lp-&gt;id, i, dbe-&gt;b.age, lsa-&gt;adv_r);
<a name="l00457"></a>00457 <span class="preprocessor">#endif</span>
<a name="l00458"></a>00458 <span class="preprocessor"></span>
<a name="l00459"></a>00459                 <span class="keywordflow">if</span>(lsa-&gt;adv_r == lp-&gt;id)
<a name="l00460"></a>00460                 {
<a name="l00461"></a>00461 
<a name="l00462"></a>00462                         <span class="comment">// If mine, variable so not all flood simulataneously.</span>
<a name="l00463"></a>00463                         <span class="comment">//dbe-&gt;b.age = tw_rand_integer(lp-&gt;id, 0, OSPF_LSA_REFRESH_AGE - 1);</span>
<a name="l00464"></a>00464 
<a name="l00465"></a>00465                         <span class="keywordflow">if</span>(i &gt;= state-&gt;ar-&gt;nmachines &amp;&amp; 
<a name="l00466"></a>00466                                 i &lt; state-&gt;ar-&gt;g_ospf_nlsa - <a class="code" href="rn-extern_8h.html#353089f1049e9e0d5160683103c17e62">g_rn_nas</a>)
<a name="l00467"></a>00467                         {
<a name="l00468"></a>00468                                 <a class="code" href="ospf-database_8c.html#03d1305f943852e8e7ed5f05b44c97d0">flood_summary</a>(state, dbe, i, lp);
<a name="l00469"></a>00469                         }
<a name="l00470"></a>00470 
<a name="l00471"></a>00471                         <span class="keywordflow">if</span>(dbe-&gt;b.age &gt;= <a class="code" href="ospf-extern_8h.html#e536fe3d2be9c08e53d0e53d48046668">OSPF_LSA_REFRESH_AGE</a>)
<a name="l00472"></a>00472                                 tw_error(TW_LOC, <span class="stringliteral">"LSA %d too old to start off with, "</span>
<a name="l00473"></a>00473                                          <span class="stringliteral">"should be less than %d "</span>
<a name="l00474"></a>00474                                          <span class="stringliteral">"(OSPF_LSA_REFRESH_AGE) \n"</span>, 
<a name="l00475"></a>00475                                          dbe-&gt;b.age,
<a name="l00476"></a>00476                                          <a class="code" href="ospf-extern_8h.html#e536fe3d2be9c08e53d0e53d48046668">OSPF_LSA_REFRESH_AGE</a>);
<a name="l00477"></a>00477 
<a name="l00478"></a>00478                         next_timer = min(<a class="code" href="ospf-extern_8h.html#e536fe3d2be9c08e53d0e53d48046668">OSPF_LSA_REFRESH_AGE</a> - dbe-&gt;b.age, next_timer);
<a name="l00479"></a>00479 
<a name="l00480"></a>00480 <span class="preprocessor">#if VERIFY_DATABASE</span>
<a name="l00481"></a>00481 <span class="preprocessor"></span>                        printf(<span class="stringliteral">"\tLSA %d, next timer: %d (mine)\n"</span>, i, next_timer);
<a name="l00482"></a>00482 <span class="preprocessor">#endif</span>
<a name="l00483"></a>00483 <span class="preprocessor"></span>                } <span class="keywordflow">else</span>
<a name="l00484"></a>00484                 {
<a name="l00485"></a>00485                         <span class="keywordflow">if</span>(i &gt;= state-&gt;ar-&gt;nmachines &amp;&amp; 
<a name="l00486"></a>00486                                 i &lt; state-&gt;ar-&gt;g_ospf_nlsa - <a class="code" href="rn-extern_8h.html#353089f1049e9e0d5160683103c17e62">g_rn_nas</a>)
<a name="l00487"></a>00487                         {
<a name="l00488"></a>00488                                 <a class="code" href="ospf-database_8c.html#03d1305f943852e8e7ed5f05b44c97d0">flood_summary</a>(state, dbe, i, lp);
<a name="l00489"></a>00489                         }
<a name="l00490"></a>00490 
<a name="l00491"></a>00491                         <span class="keywordflow">if</span>(dbe-&gt;b.age &gt;= <a class="code" href="ospf-extern_8h.html#354846699ca7e45e6f42d17268d8fac2">OSPF_LSA_MAX_AGE</a>)
<a name="l00492"></a>00492                                 tw_error(TW_LOC, <span class="stringliteral">"LSA %d too old to start off with, "</span>
<a name="l00493"></a>00493                                          <span class="stringliteral">"should be less than %d "</span>
<a name="l00494"></a>00494                                          <span class="stringliteral">"(OSPF_LSA_MAX_AGE) \n"</span>, 
<a name="l00495"></a>00495                                          dbe-&gt;b.age,
<a name="l00496"></a>00496                                          <a class="code" href="ospf-extern_8h.html#354846699ca7e45e6f42d17268d8fac2">OSPF_LSA_MAX_AGE</a>);
<a name="l00497"></a>00497 
<a name="l00498"></a>00498                         next_timer = min(<a class="code" href="ospf-extern_8h.html#354846699ca7e45e6f42d17268d8fac2">OSPF_LSA_MAX_AGE</a> - dbe-&gt;b.age, next_timer);
<a name="l00499"></a>00499 
<a name="l00500"></a>00500 <span class="preprocessor">#if VERIFY_DATABASE</span>
<a name="l00501"></a>00501 <span class="preprocessor"></span>                        printf(<span class="stringliteral">"\tLSA %d, next timer: %d \n"</span>, i, next_timer);
<a name="l00502"></a>00502 <span class="preprocessor">#endif</span>
<a name="l00503"></a>00503 <span class="preprocessor"></span>                }
<a name="l00504"></a>00504         }
<a name="l00505"></a>00505 
<a name="l00506"></a>00506         <span class="keywordflow">for</span>(; i &lt; state-&gt;ar-&gt;g_ospf_nlsa; i++)
<a name="l00507"></a>00507         {
<a name="l00508"></a>00508                 state-&gt;db[i].b.entry = i;
<a name="l00509"></a>00509                 state-&gt;db[i].b.free = 1;
<a name="l00510"></a>00510         }
<a name="l00511"></a>00511 
<a name="l00512"></a>00512         <span class="comment">//ospf_db_print(state, stdout, lp);</span>
<a name="l00513"></a>00513 
<a name="l00514"></a>00514         <span class="keywordflow">return</span> next_timer;
<a name="l00515"></a>00515 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="1ad0ef7a9b8314f07dbfd58efd8fc498"></a><!-- doxytag: member="ospf-extern.h::ospf_db_insert" ref="1ad0ef7a9b8314f07dbfd58efd8fc498" args="(ospf_state *s, int index, ospf_db_entry *, tw_lp *lp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ospf_db_entry* ospf_db_insert           </td>
          <td>(</td>
          <td class="paramtype">ospf_state *&nbsp;</td>
          <td class="paramname"> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ospf_db_entry *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-database_8c-source.html#l00366">366</a> of file <a class="el" href="ospf-database_8c-source.html">ospf-database.c</a>.</p>

<p>References <a class="el" href="ospf-database_8c-source.html#l00006">ospf_db_route()</a>, and <a class="el" href="ospf-routing_8c-source.html#l00004">ospf_rt_build()</a>.</p>

<p>Referenced by <a class="el" href="ospf-lsa_8c-source.html#l00527">ospf_lsa_create()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00367"></a>00367 {
<a name="l00368"></a>00368         <a class="code" href="ospf-database_8c.html#9ad2afaaa16ce23be59af9c6b159f321">ospf_db_route</a>(state, curr, lp);
<a name="l00369"></a>00369 
<a name="l00370"></a>00370         curr-&gt;lsa = index;
<a name="l00371"></a>00371         curr-&gt;b.age = 0;
<a name="l00372"></a>00372         curr-&gt;b.free = 0;
<a name="l00373"></a>00373 
<a name="l00374"></a>00374         <a class="code" href="ospf-extern_8h.html#8e91da94f0927f20f1b2962a45bcb5b9">ospf_rt_build</a>(state, lp-&gt;id);
<a name="l00375"></a>00375 
<a name="l00376"></a>00376         <span class="keywordflow">return</span> curr;
<a name="l00377"></a>00377 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="98158bd3d15459f0111a7bc37d0e2c05"></a><!-- doxytag: member="ospf-extern.h::ospf_db_print" ref="98158bd3d15459f0111a7bc37d0e2c05" args="(ospf_state *state, FILE *log, tw_lp *lp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf_db_print           </td>
          <td>(</td>
          <td class="paramtype">ospf_state *&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FILE *&nbsp;</td>
          <td class="paramname"> <em>log</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-database_8c-source.html#l00193">193</a> of file <a class="el" href="ospf-database_8c-source.html">ospf-database.c</a>.</p>

<p>References <a class="el" href="ospf-lsa_8c-source.html#l00247">getlsa()</a>, and <a class="el" href="ospf-lsa_8c-source.html#l00004">ospf_lsa_print()</a>.</p>

<p>Referenced by <a class="el" href="ospf-stats_8c-source.html#l00008">ospf_statistics_collection()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00194"></a>00194 {
<a name="l00195"></a>00195         ospf_db_entry   *dbe;
<a name="l00196"></a>00196         ospf_lsa        *lsa;
<a name="l00197"></a>00197 
<a name="l00198"></a>00198         <span class="keywordtype">int</span>              i;
<a name="l00199"></a>00199         <span class="keywordtype">int</span>              x_id;
<a name="l00200"></a>00200 
<a name="l00201"></a>00201         fprintf(log, <span class="stringliteral">"LSA Database contains %d LSAs: db_last_ts %lf \n\n"</span>, 
<a name="l00202"></a>00202                 state-&gt;ar-&gt;g_ospf_nlsa, state-&gt;db_last_ts);
<a name="l00203"></a>00203 
<a name="l00204"></a>00204         fprintf(log, <span class="stringliteral">"\n\t%-15s %-10s %-10s # \n"</span>, 
<a name="l00205"></a>00205                 <span class="stringliteral">"Router Id"</span>, <span class="stringliteral">"index"</span>, <span class="stringliteral">"adv_r"</span>);
<a name="l00206"></a>00206         <span class="keywordflow">for</span>(i = 0; i &lt; state-&gt;ar-&gt;nmachines; i++)
<a name="l00207"></a>00207         {
<a name="l00208"></a>00208                 dbe = &amp;state-&gt;db[i];
<a name="l00209"></a>00209                 x_id = i + state-&gt;ar-&gt;low;
<a name="l00210"></a>00210 
<a name="l00211"></a>00211                 <span class="keywordflow">if</span>(x_id == state-&gt;m-&gt;id)
<a name="l00212"></a>00212                 {
<a name="l00213"></a>00213                         fprintf(log, <span class="stringliteral">"\t%-15d %-15s \n"</span>, 
<a name="l00214"></a>00214                                 x_id, <span class="stringliteral">"self"</span>);
<a name="l00215"></a>00215                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(state-&gt;db[i].b.free)
<a name="l00216"></a>00216                 {
<a name="l00217"></a>00217                         fprintf(log, <span class="stringliteral">"\t%-15d %-15s \n"</span>, 
<a name="l00218"></a>00218                                 x_id, <span class="stringliteral">"no entry"</span>);
<a name="l00219"></a>00219                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(NULL != (lsa = <a class="code" href="ospf-extern_8h.html#9608d8ba29ae5cc559afe788cddade3f">getlsa</a>(state-&gt;m, dbe-&gt;lsa, i)))
<a name="l00220"></a>00220                 {
<a name="l00221"></a>00221                         fprintf(log, <span class="stringliteral">"\t%-15d "</span>, x_id);
<a name="l00222"></a>00222                         <a class="code" href="ospf-extern_8h.html#a04cd2fd7a2636e7fab480a9647fac91">ospf_lsa_print</a>(log, lsa);
<a name="l00223"></a>00223                 } <span class="keywordflow">else</span>
<a name="l00224"></a>00224                 {
<a name="l00225"></a>00225                         fprintf(log, <span class="stringliteral">"\t%-15d %-15s"</span>, 
<a name="l00226"></a>00226                                 x_id, <span class="stringliteral">"Fatal Error: NO LSA"</span>);
<a name="l00227"></a>00227                 }
<a name="l00228"></a>00228         }
<a name="l00229"></a>00229 
<a name="l00230"></a>00230         fprintf(log, <span class="stringliteral">"\n\t%-15s %-10s %-10s # \n"</span>, 
<a name="l00231"></a>00231                 <span class="stringliteral">"Area Id"</span>, <span class="stringliteral">"index"</span>, <span class="stringliteral">"adv_r"</span>);
<a name="l00232"></a>00232         <span class="keywordflow">for</span>(; i &lt; state-&gt;ar-&gt;nmachines + state-&gt;ar-&gt;as-&gt;nareas; i++)
<a name="l00233"></a>00233         {
<a name="l00234"></a>00234                 dbe = &amp;state-&gt;db[i];
<a name="l00235"></a>00235                 x_id = i - state-&gt;ar-&gt;nmachines + state-&gt;ar-&gt;as-&gt;low;
<a name="l00236"></a>00236 
<a name="l00237"></a>00237                 <span class="keywordflow">if</span>(x_id == state-&gt;ar-&gt;id)
<a name="l00238"></a>00238                 {
<a name="l00239"></a>00239                         fprintf(log, <span class="stringliteral">"\t%-15d %-15s \n"</span>, 
<a name="l00240"></a>00240                                 x_id, <span class="stringliteral">"self"</span>);
<a name="l00241"></a>00241                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(state-&gt;db[i].b.free)
<a name="l00242"></a>00242                 {
<a name="l00243"></a>00243                         fprintf(log, <span class="stringliteral">"\t%-15d %-15s \n"</span>, 
<a name="l00244"></a>00244                                 x_id, <span class="stringliteral">"no entry"</span>);
<a name="l00245"></a>00245                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(NULL != (lsa = <a class="code" href="ospf-extern_8h.html#9608d8ba29ae5cc559afe788cddade3f">getlsa</a>(state-&gt;m, dbe-&gt;lsa, i)))
<a name="l00246"></a>00246                 {
<a name="l00247"></a>00247                         fprintf(log, <span class="stringliteral">"\t%-15d "</span>, x_id);
<a name="l00248"></a>00248                         <a class="code" href="ospf-extern_8h.html#a04cd2fd7a2636e7fab480a9647fac91">ospf_lsa_print</a>(log, lsa);
<a name="l00249"></a>00249                 } <span class="keywordflow">else</span>
<a name="l00250"></a>00250                 {
<a name="l00251"></a>00251                         fprintf(log, <span class="stringliteral">"\t%-15d %-15s \n"</span>, 
<a name="l00252"></a>00252                                 x_id, <span class="stringliteral">"Fatal Error: NO LSA"</span>);
<a name="l00253"></a>00253                 }
<a name="l00254"></a>00254         }
<a name="l00255"></a>00255 
<a name="l00256"></a>00256         fprintf(log, <span class="stringliteral">"\n\t%-15s %-10s %-10s # \n"</span>, 
<a name="l00257"></a>00257                 <span class="stringliteral">"AS Id"</span>, <span class="stringliteral">"index"</span>, <span class="stringliteral">"adv_r"</span>);
<a name="l00258"></a>00258         <span class="keywordflow">for</span>(; i &lt; state-&gt;ar-&gt;g_ospf_nlsa; i++)
<a name="l00259"></a>00259         {
<a name="l00260"></a>00260                 dbe = &amp;state-&gt;db[i];
<a name="l00261"></a>00261                 x_id = i - state-&gt;ar-&gt;nmachines - state-&gt;ar-&gt;as-&gt;nareas;
<a name="l00262"></a>00262 
<a name="l00263"></a>00263                 <span class="keywordflow">if</span>(x_id == state-&gt;ar-&gt;as-&gt;id)
<a name="l00264"></a>00264                 {
<a name="l00265"></a>00265                         fprintf(log, <span class="stringliteral">"\t%-15d %-15s \n"</span>, 
<a name="l00266"></a>00266                                 x_id, <span class="stringliteral">"self"</span>);
<a name="l00267"></a>00267                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(state-&gt;db[i].b.free)
<a name="l00268"></a>00268                 {
<a name="l00269"></a>00269                         fprintf(log, <span class="stringliteral">"\t%-15d %-15s \n"</span>, 
<a name="l00270"></a>00270                                 x_id, <span class="stringliteral">"no entry"</span>);
<a name="l00271"></a>00271                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(NULL != (lsa = <a class="code" href="ospf-extern_8h.html#9608d8ba29ae5cc559afe788cddade3f">getlsa</a>(state-&gt;m, dbe-&gt;lsa, i)))
<a name="l00272"></a>00272                 {
<a name="l00273"></a>00273                         fprintf(log, <span class="stringliteral">"\t%-15d "</span>, x_id);
<a name="l00274"></a>00274                         <a class="code" href="ospf-extern_8h.html#a04cd2fd7a2636e7fab480a9647fac91">ospf_lsa_print</a>(log, lsa);
<a name="l00275"></a>00275                 } <span class="keywordflow">else</span>
<a name="l00276"></a>00276                 {
<a name="l00277"></a>00277                         fprintf(log, <span class="stringliteral">"\t%-15d %-15s\n"</span>, 
<a name="l00278"></a>00278                                 x_id, <span class="stringliteral">"Fatal Error: NO LSA"</span>);
<a name="l00279"></a>00279                 }
<a name="l00280"></a>00280         }
<a name="l00281"></a>00281 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="00045804159715e159464ad9d670e7d8"></a><!-- doxytag: member="ospf-extern.h::ospf_db_print_raw" ref="00045804159715e159464ad9d670e7d8" args="(ospf_state *state, FILE *log, tw_lp *lp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf_db_print_raw           </td>
          <td>(</td>
          <td class="paramtype">ospf_state *&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FILE *&nbsp;</td>
          <td class="paramname"> <em>log</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-database_8c-source.html#l00065">65</a> of file <a class="el" href="ospf-database_8c-source.html">ospf-database.c</a>.</p>

<p>Referenced by <a class="el" href="ospf-stats_8c-source.html#l00008">ospf_statistics_collection()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00066"></a>00066 {
<a name="l00067"></a>00067         ospf_db_entry   *dbe;
<a name="l00068"></a>00068         <span class="keywordtype">int</span>              i;
<a name="l00069"></a>00069 
<a name="l00070"></a>00070         fprintf(log, <span class="stringliteral">"%lf\n"</span>, state-&gt;db_last_ts);
<a name="l00071"></a>00071 
<a name="l00072"></a>00072         <span class="keywordflow">for</span>(i = 0; i &lt; state-&gt;ar-&gt;g_ospf_nlsa; i++)
<a name="l00073"></a>00073         {
<a name="l00074"></a>00074                 dbe = &amp;state-&gt;db[i];
<a name="l00075"></a>00075 
<a name="l00076"></a>00076                 fprintf(log, <span class="stringliteral">"%d %d %d %d %d %d %d\n"</span>,
<a name="l00077"></a>00077                         dbe-&gt;b.free, dbe-&gt;b.age, dbe-&gt;b.entry, 
<a name="l00078"></a>00078                         dbe-&gt;lsa, dbe-&gt;seqnum, dbe-&gt;cause_bgp, dbe-&gt;cause_ospf);
<a name="l00079"></a>00079         }
<a name="l00080"></a>00080 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="4de527f30006dfc66eb2e24684aba5f5"></a><!-- doxytag: member="ospf-extern.h::ospf_db_read" ref="4de527f30006dfc66eb2e24684aba5f5" args="(ospf_state *state, tw_lp *lp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf_db_read           </td>
          <td>(</td>
          <td class="paramtype">ospf_state *&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-database_8c-source.html#l00083">83</a> of file <a class="el" href="ospf-database_8c-source.html">ospf-database.c</a>.</p>

<p>References <a class="el" href="ospf-global_8c-source.html#l00010">g_ospf_ll_fd</a>, <a class="el" href="ospf-global_8c-source.html#l00008">g_ospf_lsa_fd</a>, <a class="el" href="ospf-global_8c-source.html#l00040">g_ospf_lsa_input</a>, and <a class="el" href="ospf-lsa_8c-source.html#l00004">ospf_lsa_print()</a>.</p>

<p>Referenced by <a class="el" href="ospf-router_8c-source.html#l00237">ospf_startup()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00084"></a>00084 {
<a name="l00085"></a>00085         tw_memory       *b;
<a name="l00086"></a>00086         <span class="comment">//tw_stime       db_last_ts;</span>
<a name="l00087"></a>00087 
<a name="l00088"></a>00088         ospf_db_entry   *dbe;
<a name="l00089"></a>00089         ospf_lsa        *lsa;
<a name="l00090"></a>00090         ospf_lsa_link   *l;
<a name="l00091"></a>00091 
<a name="l00092"></a>00092         FILE            *fp;
<a name="l00093"></a>00093         <span class="keywordtype">int</span>              age;
<a name="l00094"></a>00094         <span class="keywordtype">int</span>              free;
<a name="l00095"></a>00095         <span class="keywordtype">int</span>              entry;
<a name="l00096"></a>00096         <span class="keywordtype">int</span>              id;
<a name="l00097"></a>00097         <span class="keywordtype">int</span>              size;
<a name="l00098"></a>00098         <span class="keywordtype">int</span>              i;
<a name="l00099"></a>00099         <span class="keywordtype">int</span>              j;
<a name="l00100"></a>00100 
<a name="l00101"></a>00101         fp = <a class="code" href="ospf-extern_8h.html#7a318634977625460e285269c959269f">g_ospf_lsa_input</a>;
<a name="l00102"></a>00102 
<a name="l00103"></a>00103         state-&gt;db = (ospf_db_entry *) 
<a name="l00104"></a>00104                         calloc(<span class="keyword">sizeof</span>(ospf_db_entry), state-&gt;ar-&gt;g_ospf_nlsa);
<a name="l00105"></a>00105 
<a name="l00106"></a>00106         <span class="keywordflow">if</span>(!state-&gt;db)
<a name="l00107"></a>00107                 tw_error(TW_LOC, <span class="stringliteral">"Out of memory for local LSA database!"</span>);
<a name="l00108"></a>00108 
<a name="l00109"></a>00109         fscanf(fp, <span class="stringliteral">"%lf"</span>, &amp;state-&gt;db_last_ts);
<a name="l00110"></a>00110 
<a name="l00111"></a>00111         <span class="keywordflow">if</span>(!state-&gt;db_last_ts)
<a name="l00112"></a>00112                 state-&gt;db_last_ts = 1;
<a name="l00113"></a>00113 
<a name="l00114"></a>00114         <span class="keywordflow">if</span>(state-&gt;ar-&gt;low == lp-&gt;id)
<a name="l00115"></a>00115         {
<a name="l00116"></a>00116                 <span class="comment">//printf("%ld: Reading in LSAs for area: %d \n", lp-&gt;id, state-&gt;ar-&gt;id);</span>
<a name="l00117"></a>00117                 state-&gt;ar-&gt;g_ospf_lsa = (tw_memory **) calloc(<span class="keyword">sizeof</span>(tw_memory *) *
<a name="l00118"></a>00118                                                 state-&gt;ar-&gt;g_ospf_nlsa, 1);
<a name="l00119"></a>00119 
<a name="l00120"></a>00120                 <span class="keywordflow">if</span>(!state-&gt;ar-&gt;g_ospf_lsa)
<a name="l00121"></a>00121                         tw_error(TW_LOC, <span class="stringliteral">"Unable to allocate global LSA table!"</span>);
<a name="l00122"></a>00122 
<a name="l00123"></a>00123                 fscanf(fp, <span class="stringliteral">"%d"</span>, &amp;<span class="keywordtype">id</span>);
<a name="l00124"></a>00124                 <span class="keywordflow">for</span>(i = 0; i &lt; state-&gt;ar-&gt;g_ospf_nlsa; i++)
<a name="l00125"></a>00125                 {
<a name="l00126"></a>00126                         state-&gt;ar-&gt;g_ospf_lsa[i] = tw_memory_alloc(lp, <a class="code" href="ospf-extern_8h.html#76d058140af721aad20439b05b18e172">g_ospf_lsa_fd</a>);
<a name="l00127"></a>00127                         lsa = tw_memory_data(state-&gt;ar-&gt;g_ospf_lsa[i]);
<a name="l00128"></a>00128 
<a name="l00129"></a>00129                         <span class="keywordflow">while</span>(<span class="keywordtype">id</span> == i)
<a name="l00130"></a>00130                         {
<a name="l00131"></a>00131                                 lsa-&gt;type = ospf_lsa_router;
<a name="l00132"></a>00132                                 lsa-&gt;id = id;
<a name="l00133"></a>00133 
<a name="l00134"></a>00134                                 fscanf(fp, <span class="stringliteral">"%d %d"</span>, &amp;lsa-&gt;adv_r, &amp;size);
<a name="l00135"></a>00135 
<a name="l00136"></a>00136                                 <span class="keywordflow">for</span>(j = 0; j &lt; size; j++)
<a name="l00137"></a>00137                                 {
<a name="l00138"></a>00138                                         b = tw_memory_alloc(lp, <a class="code" href="ospf-extern_8h.html#a0aabde3f0073b72fe5cbb892a014316">g_ospf_ll_fd</a>);
<a name="l00139"></a>00139                                         l = tw_memory_data(b);
<a name="l00140"></a>00140 
<a name="l00141"></a>00141                                         fscanf(fp, <span class="stringliteral">"%d %d"</span>, &amp;l-&gt;dst, &amp;l-&gt;metric);
<a name="l00142"></a>00142                                         tw_memoryq_push(&amp;lsa-&gt;links, b);
<a name="l00143"></a>00143                                 }
<a name="l00144"></a>00144 
<a name="l00145"></a>00145                                 fscanf(fp, <span class="stringliteral">"%d"</span>, &amp;<span class="keywordtype">id</span>);
<a name="l00146"></a>00146 
<a name="l00147"></a>00147                                 <span class="keywordflow">if</span>(<span class="keywordtype">id</span> == i)
<a name="l00148"></a>00148                                 {
<a name="l00149"></a>00149 <span class="preprocessor">#if VERIFY_OSPF_READ</span>
<a name="l00150"></a>00150 <span class="preprocessor"></span>                                        printf(<span class="stringliteral">"\t"</span>);
<a name="l00151"></a>00151                                         <a class="code" href="ospf-extern_8h.html#a04cd2fd7a2636e7fab480a9647fac91">ospf_lsa_print</a>(stdout, lsa);
<a name="l00152"></a>00152 <span class="preprocessor">#endif</span>
<a name="l00153"></a>00153 <span class="preprocessor"></span>                                        lsa-&gt;next = tw_memory_alloc(lp, <a class="code" href="ospf-extern_8h.html#76d058140af721aad20439b05b18e172">g_ospf_lsa_fd</a>);
<a name="l00154"></a>00154                                         lsa = tw_memory_data(lsa-&gt;next);
<a name="l00155"></a>00155                                 } <span class="keywordflow">else</span>
<a name="l00156"></a>00156                                 {
<a name="l00157"></a>00157 <span class="preprocessor">#if VERIFY_OSPF_READ</span>
<a name="l00158"></a>00158 <span class="preprocessor"></span>                                        printf(<span class="stringliteral">"\t"</span>);
<a name="l00159"></a>00159                                         <a class="code" href="ospf-extern_8h.html#a04cd2fd7a2636e7fab480a9647fac91">ospf_lsa_print</a>(stdout, lsa);
<a name="l00160"></a>00160 <span class="preprocessor">#endif</span>
<a name="l00161"></a>00161 <span class="preprocessor"></span>                                }
<a name="l00162"></a>00162                         }
<a name="l00163"></a>00163                 }
<a name="l00164"></a>00164         }
<a name="l00165"></a>00165 
<a name="l00166"></a>00166 <span class="preprocessor">#if VERIFY_OSPF_READ || 1</span>
<a name="l00167"></a>00167 <span class="preprocessor"></span>        printf(<span class="stringliteral">"%lld: Database: %lf \n"</span>, lp-&gt;gid, state-&gt;db_last_ts);
<a name="l00168"></a>00168 <span class="preprocessor">#endif</span>
<a name="l00169"></a>00169 <span class="preprocessor"></span>
<a name="l00170"></a>00170         <span class="keywordflow">for</span>(i = 0; i &lt; state-&gt;ar-&gt;g_ospf_nlsa; i++)
<a name="l00171"></a>00171         {
<a name="l00172"></a>00172                 dbe = &amp;state-&gt;db[i];
<a name="l00173"></a>00173 
<a name="l00174"></a>00174                 fscanf(fp, <span class="stringliteral">"%d %d %d %d %d %c %c"</span>,
<a name="l00175"></a>00175                         &amp;free, &amp;age, &amp;entry, &amp;dbe-&gt;lsa, &amp;dbe-&gt;seqnum, 
<a name="l00176"></a>00176                         &amp;dbe-&gt;cause_bgp, &amp;dbe-&gt;cause_ospf);
<a name="l00177"></a>00177 
<a name="l00178"></a>00178                 dbe-&gt;b.free = free;
<a name="l00179"></a>00179                 <span class="comment">//dbe-&gt;b.age = age;</span>
<a name="l00180"></a>00180                 dbe-&gt;b.age = 0;
<a name="l00181"></a>00181                 dbe-&gt;b.entry = entry;
<a name="l00182"></a>00182                 dbe-&gt;cause_bgp = dbe-&gt;cause_ospf = 0;
<a name="l00183"></a>00183 
<a name="l00184"></a>00184 <span class="preprocessor">#if VERIFY_OSPF_READ</span>
<a name="l00185"></a>00185 <span class="preprocessor"></span>                printf(<span class="stringliteral">"\t%d %d %d %d %d %c %c \n"</span>,
<a name="l00186"></a>00186                         dbe-&gt;b.free, dbe-&gt;b.age, dbe-&gt;b.entry,
<a name="l00187"></a>00187                         dbe-&gt;lsa, dbe-&gt;seqnum, dbe-&gt;cause_bgp, dbe-&gt;cause_ospf);
<a name="l00188"></a>00188 <span class="preprocessor">#endif</span>
<a name="l00189"></a>00189 <span class="preprocessor"></span>        }
<a name="l00190"></a>00190 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="110492c4c846336629a9775968005230"></a><!-- doxytag: member="ospf-extern.h::ospf_db_remove" ref="110492c4c846336629a9775968005230" args="(ospf_state *state, int, tw_lp *lp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf_db_remove           </td>
          <td>(</td>
          <td class="paramtype">ospf_state *&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-database_8c-source.html#l00380">380</a> of file <a class="el" href="ospf-database_8c-source.html">ospf-database.c</a>.</p>

<p>References <a class="el" href="ospf-database_8c-source.html#l00006">ospf_db_route()</a>, and <a class="el" href="ospf-global_8c-source.html#l00021">OSPF_LSA_MAX_AGE</a>.</p>

<p>Referenced by <a class="el" href="bgp-ospf_8c-source.html#l00008">bgp_ospf_init()</a>, <a class="el" href="ospf-lsa_8c-source.html#l00527">ospf_lsa_create()</a>, <a class="el" href="ospf-lsa_8c-source.html#l00850">ospf_lsa_flush()</a>, and <a class="el" href="ospf-neighbor-state_8c-source.html#l00011">ospf_nbr_reset()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00381"></a>00381 {
<a name="l00382"></a>00382         ospf_db_entry   *curr;
<a name="l00383"></a>00383 
<a name="l00384"></a>00384         curr = &amp;state-&gt;db[index];
<a name="l00385"></a>00385         
<a name="l00386"></a>00386         curr-&gt;b.free = 1;
<a name="l00387"></a>00387         curr-&gt;b.age = <a class="code" href="ospf-extern_8h.html#354846699ca7e45e6f42d17268d8fac2">OSPF_LSA_MAX_AGE</a>;
<a name="l00388"></a>00388 
<a name="l00389"></a>00389         <a class="code" href="ospf-database_8c.html#9ad2afaaa16ce23be59af9c6b159f321">ospf_db_route</a>(state, curr, lp);
<a name="l00390"></a>00390 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="bf295d5d1675c07b08de04256d936bee"></a><!-- doxytag: member="ospf-extern.h::ospf_db_route" ref="bf295d5d1675c07b08de04256d936bee" args="(ospf_state *, ospf_db_entry *curr, tw_lp *lp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf_db_route           </td>
          <td>(</td>
          <td class="paramtype">ospf_state *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ospf_db_entry *&nbsp;</td>
          <td class="paramname"> <em>curr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-database_8c-source.html#l00006">6</a> of file <a class="el" href="ospf-database_8c-source.html">ospf-database.c</a>.</p>

<p>References <a class="el" href="save_2ip-routing_8c-source.html#l00104">d</a>, <a class="el" href="ospf-lsa_8c-source.html#l00247">getlsa()</a>, <a class="el" href="rn-routing_8c-source.html#l00007">rn_route()</a>, and <a class="el" href="rn-routing_8c-source.html#l00048">rn_route_change()</a>.</p>

<p>Referenced by <a class="el" href="bgp-ospf_8c-source.html#l00008">bgp_ospf_init()</a>, <a class="el" href="ospf-database_8c-source.html#l00366">ospf_db_insert()</a>, <a class="el" href="ospf-database_8c-source.html#l00380">ospf_db_remove()</a>, <a class="el" href="ospf-database_8c-source.html#l00288">ospf_db_update()</a>, and <a class="el" href="ospf-routing_8c-source.html#l00029">ospf_rt_timer()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00007"></a>00007 {
<a name="l00008"></a>00008         tw_memory       *b;
<a name="l00009"></a>00009 
<a name="l00010"></a>00010         ospf_lsa_link   *l;
<a name="l00011"></a>00011         ospf_lsa        *lsa;
<a name="l00012"></a>00012         <span class="keywordtype">int</span>              <a class="code" href="save_2ip-routing_8c.html#0ddbf789cfd814565dd88748311c1c36">d</a> = -1;
<a name="l00013"></a>00013 
<a name="l00014"></a>00014         <span class="keywordflow">if</span>(curr-&gt;b.free)
<a name="l00015"></a>00015         {
<a name="l00016"></a>00016 <span class="preprocessor">#if VERIFY_DATABASE</span>
<a name="l00017"></a>00017 <span class="preprocessor"></span>                printf(<span class="stringliteral">"\t%ld: removing rn_route to %d! \n"</span>, lp-&gt;id, curr-&gt;b.entry);
<a name="l00018"></a>00018 <span class="preprocessor">#endif</span>
<a name="l00019"></a>00019 <span class="preprocessor"></span>
<a name="l00020"></a>00020                 <a class="code" href="rn-extern_8h.html#2071d019422a8152e6d4e70cb9151f64">rn_route_change</a>(state-&gt;m, curr-&gt;b.entry, -1);
<a name="l00021"></a>00021                 state-&gt;m-&gt;nhop[curr-&gt;b.entry] = -1;
<a name="l00022"></a>00022                 <span class="keywordflow">return</span>;
<a name="l00023"></a>00023         }
<a name="l00024"></a>00024 
<a name="l00025"></a>00025         lsa = <a class="code" href="ospf-extern_8h.html#9608d8ba29ae5cc559afe788cddade3f">getlsa</a>(state-&gt;m, curr-&gt;lsa, curr-&gt;b.entry);
<a name="l00026"></a>00026 
<a name="l00027"></a>00027         <span class="keywordflow">if</span>(lsa-&gt;adv_r == lp-&gt;id)
<a name="l00028"></a>00028         {
<a name="l00029"></a>00029                 <span class="keywordflow">for</span>(b = lsa-&gt;links.head; b; b = b-&gt;next)
<a name="l00030"></a>00030                 {
<a name="l00031"></a>00031                         l = tw_memory_data(b);
<a name="l00032"></a>00032 
<a name="l00033"></a>00033                         d = <a class="code" href="rn-extern_8h.html#8890679c55545bd36e770b118a920b57">rn_route</a>(state-&gt;m, l-&gt;dst);
<a name="l00034"></a>00034 
<a name="l00035"></a>00035                         <span class="keywordflow">if</span>(-1 == d)
<a name="l00036"></a>00036                                 <span class="keywordflow">continue</span>;
<a name="l00037"></a>00037 
<a name="l00038"></a>00038                         <a class="code" href="rn-extern_8h.html#2071d019422a8152e6d4e70cb9151f64">rn_route_change</a>(state-&gt;m, curr-&gt;b.entry, d);
<a name="l00039"></a>00039                         state-&gt;m-&gt;nhop[curr-&gt;b.entry] = 
<a name="l00040"></a>00040                                         state-&gt;m-&gt;nhop[lp-&gt;id - state-&gt;ar-&gt;low];
<a name="l00041"></a>00041                         <span class="keywordflow">break</span>;
<a name="l00042"></a>00042                 }
<a name="l00043"></a>00043 
<a name="l00044"></a>00044                 <span class="comment">// Could not find route.. </span>
<a name="l00045"></a>00045                 <span class="keywordflow">if</span>(-1 == d)
<a name="l00046"></a>00046                 {
<a name="l00047"></a>00047                         <a class="code" href="rn-extern_8h.html#2071d019422a8152e6d4e70cb9151f64">rn_route_change</a>(state-&gt;m, curr-&gt;b.entry, -1);
<a name="l00048"></a>00048                         state-&gt;m-&gt;nhop[curr-&gt;b.entry] = -1;
<a name="l00049"></a>00049                 }
<a name="l00050"></a>00050         } <span class="keywordflow">else</span>
<a name="l00051"></a>00051         {
<a name="l00052"></a>00052                 d = <a class="code" href="rn-extern_8h.html#8890679c55545bd36e770b118a920b57">rn_route</a>(state-&gt;m, lsa-&gt;adv_r);
<a name="l00053"></a>00053                 <a class="code" href="rn-extern_8h.html#2071d019422a8152e6d4e70cb9151f64">rn_route_change</a>(state-&gt;m, curr-&gt;b.entry, d);
<a name="l00054"></a>00054                 state-&gt;m-&gt;nhop[curr-&gt;b.entry] = 
<a name="l00055"></a>00055                                 state-&gt;m-&gt;nhop[lsa-&gt;adv_r - state-&gt;ar-&gt;low];
<a name="l00056"></a>00056         }
<a name="l00057"></a>00057 
<a name="l00058"></a>00058 <span class="preprocessor">#if VERIFY_DATABASE</span>
<a name="l00059"></a>00059 <span class="preprocessor"></span>        printf(<span class="stringliteral">"\t%ld: adding rn_route for DB entry %d: adv_r %d, nhi %d \n"</span>, 
<a name="l00060"></a>00060                 lp-&gt;id, curr-&gt;b.entry, lsa-&gt;adv_r, d);
<a name="l00061"></a>00061 <span class="preprocessor">#endif</span>
<a name="l00062"></a>00062 <span class="preprocessor"></span>}
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="8f5c6d88e688325839a72006fb09d45b"></a><!-- doxytag: member="ospf-extern.h::ospf_db_update" ref="8f5c6d88e688325839a72006fb09d45b" args="(ospf_state *, ospf_nbr *nbr, ospf_db_entry *, tw_lp *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf_db_update           </td>
          <td>(</td>
          <td class="paramtype">ospf_state *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ospf_nbr *&nbsp;</td>
          <td class="paramname"> <em>nbr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ospf_db_entry *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-database_8c-source.html#l00288">288</a> of file <a class="el" href="ospf-database_8c-source.html">ospf-database.c</a>.</p>

<p>References <a class="el" href="ospf-global_8c-source.html#l00014">g_route</a>, <a class="el" href="ospf-global_8c-source.html#l00015">g_route1</a>, <a class="el" href="ospf-lsa_8c-source.html#l00247">getlsa()</a>, <a class="el" href="ospf-global_8c-source.html#l00016">gr1</a>, <a class="el" href="ospf-global_8c-source.html#l00017">gr2</a>, <a class="el" href="ospf-timer-aging_8c-source.html#l00024">ospf_aging_timer_set()</a>, <a class="el" href="ospf-database_8c-source.html#l00006">ospf_db_route()</a>, <a class="el" href="ospf-lsa_8c-source.html#l00231">ospf_lsa_age()</a>, <a class="el" href="ospf-global_8c-source.html#l00021">OSPF_LSA_MAX_AGE</a>, and <a class="el" href="ospf-routing_8c-source.html#l00004">ospf_rt_build()</a>.</p>

<p>Referenced by <a class="el" href="ospf-ls_8c-source.html#l00026">process_lsa_recv()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00289"></a>00289 {
<a name="l00290"></a>00290 <span class="preprocessor">#if VERIFY_OSPF_CONVERGENCE</span>
<a name="l00291"></a>00291 <span class="preprocessor"></span>        ospf_lsa        *lsa;
<a name="l00292"></a>00292 <span class="preprocessor">#endif</span>
<a name="l00293"></a>00293 <span class="preprocessor"></span>        ospf_db_entry   *curr;
<a name="l00294"></a>00294 
<a name="l00295"></a>00295         <span class="keywordtype">int</span>              last_lsa;
<a name="l00296"></a>00296         <span class="keywordtype">int</span>              curr_age;
<a name="l00297"></a>00297 
<a name="l00298"></a>00298         curr = &amp;state-&gt;db[new_dbe-&gt;b.entry];
<a name="l00299"></a>00299 
<a name="l00300"></a>00300         <span class="comment">//curr_age = new_dbe-&gt;b.age;</span>
<a name="l00301"></a>00301         <span class="keywordflow">if</span>(curr-&gt;b.free != 1)
<a name="l00302"></a>00302                 curr_age = <a class="code" href="ospf-extern_8h.html#f2ab0671b22732e9743355c30ea903a4">ospf_lsa_age</a>(state, curr, lp);
<a name="l00303"></a>00303         <span class="keywordflow">else</span>
<a name="l00304"></a>00304                 curr_age = <a class="code" href="ospf-extern_8h.html#354846699ca7e45e6f42d17268d8fac2">OSPF_LSA_MAX_AGE</a>;
<a name="l00305"></a>00305 
<a name="l00306"></a>00306         last_lsa = curr-&gt;lsa;
<a name="l00307"></a>00307 
<a name="l00308"></a>00308         curr-&gt;lsa = new_dbe-&gt;lsa;
<a name="l00309"></a>00309         curr-&gt;b.free = 0;
<a name="l00310"></a>00310         curr-&gt;seqnum = new_dbe-&gt;seqnum;
<a name="l00311"></a>00311         <a class="code" href="ospf-database_8c.html#9ad2afaaa16ce23be59af9c6b159f321">ospf_db_route</a>(state, curr, lp);
<a name="l00312"></a>00312         <a class="code" href="ospf-extern_8h.html#0ff2c1e877d460d2950c2228447c2a4d">ospf_aging_timer_set</a>(state, curr, new_dbe-&gt;b.age, lp);
<a name="l00313"></a>00313 
<a name="l00314"></a>00314         <span class="keywordflow">if</span>((new_dbe-&gt;b.age == <a class="code" href="ospf-extern_8h.html#354846699ca7e45e6f42d17268d8fac2">OSPF_LSA_MAX_AGE</a> &amp;&amp;
<a name="l00315"></a>00315             curr_age != <a class="code" href="ospf-extern_8h.html#354846699ca7e45e6f42d17268d8fac2">OSPF_LSA_MAX_AGE</a>) ||
<a name="l00316"></a>00316            (new_dbe-&gt;b.age != <a class="code" href="ospf-extern_8h.html#354846699ca7e45e6f42d17268d8fac2">OSPF_LSA_MAX_AGE</a> &amp;&amp;
<a name="l00317"></a>00317             curr_age == <a class="code" href="ospf-extern_8h.html#354846699ca7e45e6f42d17268d8fac2">OSPF_LSA_MAX_AGE</a>) ||
<a name="l00318"></a>00318            (new_dbe-&gt;lsa != last_lsa))
<a name="l00319"></a>00319         {
<a name="l00320"></a>00320                 <a class="code" href="ospf-extern_8h.html#8e91da94f0927f20f1b2962a45bcb5b9">ospf_rt_build</a>(state, lp-&gt;id);
<a name="l00321"></a>00321 
<a name="l00322"></a>00322 <span class="preprocessor">#if VERIFY_OSPF_CONVERGENCE</span>
<a name="l00323"></a>00323 <span class="preprocessor"></span>                lsa = <a class="code" href="ospf-extern_8h.html#9608d8ba29ae5cc559afe788cddade3f">getlsa</a>(state-&gt;m, new_dbe-&gt;lsa, new_dbe-&gt;b.entry);
<a name="l00324"></a>00324                 lsa-&gt;count--;
<a name="l00325"></a>00325 
<a name="l00326"></a>00326                 <span class="keywordflow">if</span>(lsa-&gt;count == 0)
<a name="l00327"></a>00327                 {
<a name="l00328"></a>00328                         <span class="keywordflow">if</span>(lsa-&gt;adv_r == 0)
<a name="l00329"></a>00329                         {
<a name="l00330"></a>00330                                 <a class="code" href="ospf-extern_8h.html#9f9f956462ca43b7fd2caa89db98c5a9">g_route</a>[0] = lp-&gt;id;
<a name="l00331"></a>00331                                 <a class="code" href="ospf-extern_8h.html#9f9f956462ca43b7fd2caa89db98c5a9">g_route</a>[1] = nbr-&gt;id;
<a name="l00332"></a>00332                                 <a class="code" href="ospf-extern_8h.html#432a4c78ffc399e9fb0d8070289f47e1">gr1</a> = 1;
<a name="l00333"></a>00333                         } <span class="keywordflow">else</span>
<a name="l00334"></a>00334                         {
<a name="l00335"></a>00335                                 <a class="code" href="ospf-extern_8h.html#097cad055eec1bd215ad822a813dc62e">g_route1</a>[0] = lp-&gt;id;
<a name="l00336"></a>00336                                 <a class="code" href="ospf-extern_8h.html#097cad055eec1bd215ad822a813dc62e">g_route1</a>[1] = nbr-&gt;id;
<a name="l00337"></a>00337                                 <a class="code" href="ospf-extern_8h.html#fb99688fe29cd99a5a48c77bfee16629">gr2</a> = 1;
<a name="l00338"></a>00338                         }
<a name="l00339"></a>00339 
<a name="l00340"></a>00340                         printf(<span class="stringliteral">"%ld: Convergence time for lsa %d: %f - %f = %f seconds\n"</span>,
<a name="l00341"></a>00341                                 lp-&gt;id, lsa-&gt;adv_r, 
<a name="l00342"></a>00342                                 tw_now(lp), lsa-&gt;start,
<a name="l00343"></a>00343                                 tw_now(lp) - lsa-&gt;start);
<a name="l00344"></a>00344 <span class="comment">/*</span>
<a name="l00345"></a>00345 <span class="comment">                        printf("%ld: link down at %f, time now %f \n",</span>
<a name="l00346"></a>00346 <span class="comment">                                lp-&gt;id, lsa-&gt;start, tw_now(lp));</span>
<a name="l00347"></a>00347 <span class="comment">*/</span>
<a name="l00348"></a>00348                         state-&gt;c_time = tw_now(lp) - 
<a name="l00349"></a>00349                                         lsa-&gt;start + 
<a name="l00350"></a>00350                                         state-&gt;gstate-&gt;rt_interval;
<a name="l00351"></a>00351                 } 
<a name="l00352"></a>00352 <span class="comment">/*</span>
<a name="l00353"></a>00353 <span class="comment">                else</span>
<a name="l00354"></a>00354 <span class="comment">                        printf("%d: lsa %d remaining: %d \n",</span>
<a name="l00355"></a>00355 <span class="comment">                                lp-&gt;id, lsa-&gt;adv_r, lsa-&gt;count);</span>
<a name="l00356"></a>00356 <span class="comment">*/</span>
<a name="l00357"></a>00357 
<a name="l00358"></a>00358 <span class="preprocessor">#endif</span>
<a name="l00359"></a>00359 <span class="preprocessor"></span>        }
<a name="l00360"></a>00360 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="8302f79c5782344981c84e75bdcc4e68"></a><!-- doxytag: member="ospf-extern.h::ospf_dd_compare" ref="8302f79c5782344981c84e75bdcc4e68" args="(ospf_dd_pkt *h1, ospf_dd_pkt *h2)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ospf_dd_compare           </td>
          <td>(</td>
          <td class="paramtype">ospf_dd_pkt *&nbsp;</td>
          <td class="paramname"> <em>h1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ospf_dd_pkt *&nbsp;</td>
          <td class="paramname"> <em>h2</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-dd_8c-source.html#l00417">417</a> of file <a class="el" href="ospf-dd_8c-source.html">ospf-dd.c</a>.</p>

<p>Referenced by <a class="el" href="ospf-dd_8c-source.html#l00280">ospf_dd_event_handler()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00418"></a>00418 {
<a name="l00419"></a>00419         <span class="keywordflow">if</span> (h1-&gt;b.init == h2-&gt;b.init &amp;&amp;
<a name="l00420"></a>00420             h1-&gt;b.more == h2-&gt;b.more &amp;&amp;
<a name="l00421"></a>00421             h1-&gt;b.master == h2-&gt;b.master &amp;&amp;
<a name="l00422"></a>00422             h1-&gt;seqnum == h2-&gt;seqnum+1)
<a name="l00423"></a>00423         {
<a name="l00424"></a>00424                 <span class="keywordflow">return</span> 1;
<a name="l00425"></a>00425         }
<a name="l00426"></a>00426 
<a name="l00427"></a>00427         <span class="keywordflow">return</span> 0;
<a name="l00428"></a>00428 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="fda0e2596f0abb694cedc7244745151e"></a><!-- doxytag: member="ospf-extern.h::ospf_dd_copy" ref="fda0e2596f0abb694cedc7244745151e" args="(tw_memory *b2, tw_lp *lp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tw_memory* ospf_dd_copy           </td>
          <td>(</td>
          <td class="paramtype">tw_memory *&nbsp;</td>
          <td class="paramname"> <em>b2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-dd_8c-source.html#l00200">200</a> of file <a class="el" href="ospf-dd_8c-source.html">ospf-dd.c</a>.</p>

<p>References <a class="el" href="ospf-global_8c-source.html#l00009">g_ospf_dd_fd</a>, and <a class="el" href="ospf-global_8c-source.html#l00007">g_ospf_fd</a>.</p>

<p>Referenced by <a class="el" href="ospf-dd_8c-source.html#l00280">ospf_dd_event_handler()</a>, <a class="el" href="ospf-dd_8c-source.html#l00255">ospf_dd_retransmit()</a>, <a class="el" href="ospf-neighbor-state_8c-source.html#l00407">ospf_nbr_neg_done()</a>, and <a class="el" href="ospf-neighbor-state_8c-source.html#l00334">ospf_nbr_two_way_recv()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00201"></a>00201 {
<a name="l00202"></a>00202         tw_memory       *b;
<a name="l00203"></a>00203         tw_memory       *head;
<a name="l00204"></a>00204         tw_memory       *last;
<a name="l00205"></a>00205         tw_memory       *next_b;
<a name="l00206"></a>00206 
<a name="l00207"></a>00207         ospf_dd_pkt     *h1;
<a name="l00208"></a>00208         ospf_dd_pkt     *h2;
<a name="l00209"></a>00209         ospf_db_entry   *dbe;
<a name="l00210"></a>00210         ospf_db_entry   *h2_dbe;
<a name="l00211"></a>00211 
<a name="l00212"></a>00212         <span class="keywordtype">int</span>     i;
<a name="l00213"></a>00213 
<a name="l00214"></a>00214         b = tw_memory_alloc(lp, <a class="code" href="ospf-extern_8h.html#6172717590c1e9795cb6db7baeb1bf4a">g_ospf_dd_fd</a>);
<a name="l00215"></a>00215         h1 = tw_memory_data(b);
<a name="l00216"></a>00216         h2 = tw_memory_data(b2);
<a name="l00217"></a>00217 
<a name="l00218"></a>00218         h1-&gt;b.init = h2-&gt;b.init;
<a name="l00219"></a>00219         h1-&gt;b.more = h2-&gt;b.more;
<a name="l00220"></a>00220         h1-&gt;b.master = h2-&gt;b.master;
<a name="l00221"></a>00221         h1-&gt;seqnum = h2-&gt;seqnum;
<a name="l00222"></a>00222         h1-&gt;nlsas = h2-&gt;nlsas;
<a name="l00223"></a>00223 
<a name="l00224"></a>00224         head = last = b;
<a name="l00225"></a>00225         next_b = b2-&gt;next;
<a name="l00226"></a>00226         <span class="keywordflow">for</span>(i = 0; i &lt; h2-&gt;nlsas; i++, next_b = next_b-&gt;next)
<a name="l00227"></a>00227         {
<a name="l00228"></a>00228                 b = tw_memory_alloc(lp, <a class="code" href="ospf-extern_8h.html#884d66f70a693353a1894758d71deb99">g_ospf_fd</a>);
<a name="l00229"></a>00229 
<a name="l00230"></a>00230                 dbe = tw_memory_data(b);
<a name="l00231"></a>00231                 h2_dbe = tw_memory_data(next_b);
<a name="l00232"></a>00232 
<a name="l00233"></a>00233                 dbe-&gt;b = h2_dbe-&gt;b;
<a name="l00234"></a>00234                 dbe-&gt;lsa = h2_dbe-&gt;lsa;
<a name="l00235"></a>00235                 dbe-&gt;seqnum = h2_dbe-&gt;seqnum;
<a name="l00236"></a>00236 
<a name="l00237"></a>00237                 last-&gt;next = b;
<a name="l00238"></a>00238                 last = b;
<a name="l00239"></a>00239         }
<a name="l00240"></a>00240 
<a name="l00241"></a>00241         <span class="keywordflow">return</span> head;
<a name="l00242"></a>00242 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="7957a55965bc236c7fc18bdce945c51f"></a><!-- doxytag: member="ospf-extern.h::ospf_dd_event_handler" ref="7957a55965bc236c7fc18bdce945c51f" args="(ospf_state *, ospf_nbr *, tw_bf *, tw_lp *lp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf_dd_event_handler           </td>
          <td>(</td>
          <td class="paramtype">ospf_state *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ospf_nbr *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_bf *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>
if master 
<p>Definition at line <a class="el" href="ospf-dd_8c-source.html#l00280">280</a> of file <a class="el" href="ospf-dd_8c-source.html">ospf-dd.c</a>.</p>

<p>References <a class="el" href="ospf-dd_8c-source.html#l00062">dd_exchange()</a>, <a class="el" href="ospf-dd_8c-source.html#l00004">dd_process()</a>, <a class="el" href="ospf-global_8c-source.html#l00009">g_ospf_dd_fd</a>, <a class="el" href="ospf-dd_8c-source.html#l00417">ospf_dd_compare()</a>, <a class="el" href="ospf-dd_8c-source.html#l00200">ospf_dd_copy()</a>, <a class="el" href="ospf-data-types_8h-source.html#l00009">OSPF_DD_HEADER</a>, <a class="el" href="ospf-dd_8c-source.html#l00255">ospf_dd_retransmit()</a>, <a class="el" href="ospf-util_8c-source.html#l00004">ospf_event_new()</a>, <a class="el" href="ospf-util_8c-source.html#l00024">ospf_event_send()</a>, <a class="el" href="ospf-data-types_8h-source.html#l00012">OSPF_LSA_UPDATE_HEADER</a>, and <a class="el" href="ospf-neighbor-state_8c-source.html#l00544">ospf_nbr_event_handler()</a>.</p>

<p>Referenced by <a class="el" href="ospf-router_8c-source.html#l00037">ospf_event_handler()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00281"></a>00281 {
<a name="l00282"></a>00282         tw_event        *e;
<a name="l00283"></a>00283         tw_memory       *b;
<a name="l00284"></a>00284         tw_memory       *send;
<a name="l00285"></a>00285 
<a name="l00286"></a>00286         ospf_dd_pkt     *in_dd;
<a name="l00287"></a>00287         ospf_dd_pkt     *out_dd;
<a name="l00288"></a>00288 
<a name="l00289"></a>00289         b = lp-&gt;pe-&gt;cur_event-&gt;memory; <span class="comment">//tw_event_memory_get(lp);</span>
<a name="l00290"></a>00290         lp-&gt;pe-&gt;cur_event-&gt;memory = NULL;
<a name="l00291"></a>00291         in_dd = tw_memory_data(b);
<a name="l00292"></a>00292 
<a name="l00293"></a>00293         printf(<span class="stringliteral">"%lld OSPF: DD from %d, ts %lf, state %d, I %d, M %d, Master %d \n"</span>,
<a name="l00294"></a>00294                 lp-&gt;id, nbr-&gt;id, tw_now(lp), nbr-&gt;state, in_dd-&gt;b.init, in_dd-&gt;b.more,
<a name="l00295"></a>00295                 in_dd-&gt;b.master);
<a name="l00296"></a>00296 
<a name="l00297"></a>00297         <span class="keywordflow">switch</span>(nbr-&gt;state)
<a name="l00298"></a>00298         {
<a name="l00299"></a>00299                 <span class="keywordflow">case</span> ospf_nbr_down_st:
<a name="l00300"></a>00300                         state-&gt;stats-&gt;s_drop_dd++;
<a name="l00301"></a>00301                         <span class="keywordflow">break</span>;
<a name="l00302"></a>00302                 <span class="keywordflow">case</span> ospf_nbr_attempt_st:
<a name="l00303"></a>00303                         state-&gt;stats-&gt;s_drop_dd++;
<a name="l00304"></a>00304                         <span class="keywordflow">break</span>;
<a name="l00305"></a>00305                 <span class="keywordflow">case</span> ospf_nbr_init_st:
<a name="l00306"></a>00306                         printf(<span class="stringliteral">"%lld OSPF: DD sending nbr %d 2-way recv event \n"</span>,
<a name="l00307"></a>00307                                                 lp-&gt;id, nbr-&gt;id);
<a name="l00308"></a>00308 
<a name="l00309"></a>00309                         <a class="code" href="ospf-extern_8h.html#1a0d7bfac4f79c936b7940887971c1ec">ospf_nbr_event_handler</a>(state, nbr, ospf_nbr_two_way_recv_ev, lp);
<a name="l00310"></a>00310 
<a name="l00311"></a>00311                         <span class="keywordflow">if</span>(nbr-&gt;state != ospf_nbr_exstart_st)
<a name="l00312"></a>00312                                 <span class="keywordflow">break</span>;
<a name="l00313"></a>00313                 <span class="keywordflow">case</span> ospf_nbr_exstart_st:
<a name="l00314"></a>00314                         <span class="keywordflow">if</span>(in_dd-&gt;b.init &amp;&amp; in_dd-&gt;b.more &amp;&amp; in_dd-&gt;b.master &amp;&amp;
<a name="l00315"></a>00315                            in_dd-&gt;nlsas == 0 &amp;&amp; nbr-&gt;id &gt; lp-&gt;id)
<a name="l00316"></a>00316                         {
<a name="l00317"></a>00317                                 nbr-&gt;master = 1;
<a name="l00318"></a>00318                                 nbr-&gt;dd_seqnum = in_dd-&gt;seqnum;
<a name="l00319"></a>00319                         } <span class="keywordflow">else</span> 
<a name="l00320"></a>00320                                 nbr-&gt;master = 0;
<a name="l00321"></a>00321 
<a name="l00322"></a>00322                         state-&gt;stats-&gt;s_proc_dd++;
<a name="l00323"></a>00323                         nbr-&gt;last_recv_dd = <a class="code" href="ospf-dd_8c.html#fda0e2596f0abb694cedc7244745151e">ospf_dd_copy</a>(b, lp);
<a name="l00324"></a>00324                         <a class="code" href="ospf-extern_8h.html#1a0d7bfac4f79c936b7940887971c1ec">ospf_nbr_event_handler</a>(state, nbr, ospf_nbr_neg_done_ev, lp);
<a name="l00325"></a>00325                         <span class="keywordflow">break</span>;
<a name="l00326"></a>00326                 <span class="keywordflow">case</span> ospf_nbr_two_way_st:
<a name="l00327"></a>00327                         state-&gt;stats-&gt;s_drop_dd++;
<a name="l00328"></a>00328                         <span class="keywordflow">break</span>;
<a name="l00329"></a>00329                 <span class="keywordflow">case</span> ospf_nbr_exchange_st:
<a name="l00330"></a>00330                         state-&gt;stats-&gt;s_proc_dd++;
<a name="l00331"></a>00331 
<a name="l00332"></a>00332                         <span class="comment">/*</span>
<a name="l00333"></a>00333 <span class="comment">                         * Verify DD packet received is in proper format</span>
<a name="l00334"></a>00334 <span class="comment">                         */</span>
<a name="l00335"></a>00335                         <span class="keywordflow">if</span>(in_dd-&gt;b.init)
<a name="l00336"></a>00336                         {
<a name="l00337"></a>00337                                 <a class="code" href="ospf-extern_8h.html#1a0d7bfac4f79c936b7940887971c1ec">ospf_nbr_event_handler</a>(state,nbr, 
<a name="l00338"></a>00338                                                 ospf_nbr_seqnum_mismatch_ev, lp);
<a name="l00339"></a>00339 
<a name="l00340"></a>00340                                 <span class="keywordflow">break</span>;
<a name="l00341"></a>00341                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(in_dd-&gt;b.master != nbr-&gt;master)
<a name="l00342"></a>00342                         {
<a name="l00343"></a>00343                                 <a class="code" href="ospf-extern_8h.html#1a0d7bfac4f79c936b7940887971c1ec">ospf_nbr_event_handler</a>(state,nbr, 
<a name="l00344"></a>00344                                                 ospf_nbr_seqnum_mismatch_ev, lp);
<a name="l00345"></a>00345 
<a name="l00346"></a>00346                                 <span class="keywordflow">break</span>;
<a name="l00347"></a>00347                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span>((nbr-&gt;master &amp;&amp; in_dd-&gt;seqnum != nbr-&gt;dd_seqnum+1) ||
<a name="l00348"></a>00348                                   (!nbr-&gt;master &amp;&amp; in_dd-&gt;seqnum != nbr-&gt;dd_seqnum))
<a name="l00349"></a>00349                         {
<a name="l00350"></a>00350                                 <a class="code" href="ospf-extern_8h.html#1a0d7bfac4f79c936b7940887971c1ec">ospf_nbr_event_handler</a>(state,nbr, 
<a name="l00351"></a>00351                                                 ospf_nbr_seqnum_mismatch_ev, lp);
<a name="l00352"></a>00352 
<a name="l00353"></a>00353                                 <span class="keywordflow">break</span>;
<a name="l00354"></a>00354                         }
<a name="l00355"></a>00355 
<a name="l00356"></a>00356                         <span class="comment">/*</span>
<a name="l00357"></a>00357 <span class="comment">                         * If the slave recvs a duplicate, it resends it</span>
<a name="l00358"></a>00358 <span class="comment">                         */</span>
<a name="l00359"></a>00359                         <span class="keywordflow">if</span>(nbr-&gt;master &amp;&amp;
<a name="l00360"></a>00360                            <a class="code" href="ospf-dd_8c.html#8302f79c5782344981c84e75bdcc4e68">ospf_dd_compare</a>(in_dd, tw_memory_data(nbr-&gt;last_recv_dd)))
<a name="l00361"></a>00361                         {
<a name="l00362"></a>00362                                 <a class="code" href="ospf-dd_8c.html#f20e4567a62674a867f580c9c9e3b6a6">ospf_dd_retransmit</a>(state, nbr, bf, lp);
<a name="l00363"></a>00363                                 
<a name="l00364"></a>00364                                 <span class="keywordflow">break</span>;
<a name="l00365"></a>00365                         }
<a name="l00366"></a>00366 
<a name="l00367"></a>00367 printf(<span class="stringliteral">"%lld: got valid DD in exchange from %d, more = %d \n"</span>, lp-&gt;id, nbr-&gt;id, in_dd-&gt;b.more);
<a name="l00368"></a>00368 
<a name="l00369"></a>00369                         nbr-&gt;last_recv_dd = <a class="code" href="ospf-dd_8c.html#fda0e2596f0abb694cedc7244745151e">ospf_dd_copy</a>(b, lp);
<a name="l00370"></a>00370                         <a class="code" href="ospf-dd_8c.html#e02ba8dfabdbc99c4beb093e0cfa1ba5">dd_process</a>(state, nbr, b, lp);
<a name="l00371"></a>00371                         <a class="code" href="ospf-dd_8c.html#a14be0c4f78426215b4b0af4870e3d8b">dd_exchange</a>(state, nbr, lp);
<a name="l00372"></a>00372 
<a name="l00373"></a>00373                         <span class="keywordflow">if</span>(in_dd-&gt;b.more == 0)
<a name="l00374"></a>00374                                 <a class="code" href="ospf-extern_8h.html#1a0d7bfac4f79c936b7940887971c1ec">ospf_nbr_event_handler</a>(state, nbr, 
<a name="l00375"></a>00375                                         ospf_nbr_exchange_done_ev, lp);
<a name="l00376"></a>00376 
<a name="l00377"></a>00377                         <span class="keywordflow">break</span>;
<a name="l00378"></a>00378                 <span class="keywordflow">case</span> ospf_nbr_loading_st:
<a name="l00379"></a>00379                 <span class="keywordflow">case</span> ospf_nbr_full_st:
<a name="l00380"></a>00380 
<a name="l00381"></a>00381                         <span class="keywordflow">if</span>(<a class="code" href="ospf-dd_8c.html#8302f79c5782344981c84e75bdcc4e68">ospf_dd_compare</a>(in_dd, tw_memory_data(nbr-&gt;last_recv_dd)))
<a name="l00382"></a>00382                         {
<a name="l00384"></a>00384                                 <span class="keywordflow">if</span>(!nbr-&gt;master)
<a name="l00385"></a>00385                                 {
<a name="l00386"></a>00386                                         send = <a class="code" href="ospf-dd_8c.html#fda0e2596f0abb694cedc7244745151e">ospf_dd_copy</a>(nbr-&gt;retrans_dd, lp);
<a name="l00387"></a>00387                                         out_dd = tw_memory_data(send);
<a name="l00388"></a>00388 
<a name="l00389"></a>00389                                         out_dd-&gt;b.master = 0;
<a name="l00390"></a>00390                                         out_dd-&gt;b.init = 0;
<a name="l00391"></a>00391                                         out_dd-&gt;b.more = 0;
<a name="l00392"></a>00392 
<a name="l00393"></a>00393                                         e = <a class="code" href="ospf-extern_8h.html#a6ee00330aee5b151785a47a706cf226">ospf_event_new</a>(state, tw_getlp(nbr-&gt;id),
<a name="l00394"></a>00394                                                            0.0, lp);
<a name="l00395"></a>00395 
<a name="l00396"></a>00396                                         <a class="code" href="ospf-extern_8h.html#506873294c07e25082f4e8d2f631b522">ospf_event_send</a>(state, e,
<a name="l00397"></a>00397                                                 OSPF_DD_MSG, lp, 
<a name="l00398"></a>00398                                                 <a class="code" href="ospf-data-types_8h.html#05c3c6b89fa76c5f4f6f8e76981f9d49">OSPF_DD_HEADER</a> + 
<a name="l00399"></a>00399                                                         (out_dd-&gt;nlsas * 
<a name="l00400"></a>00400                                                          <a class="code" href="ospf-data-types_8h.html#bb42796d55aff837291811e19fbf63c1">OSPF_LSA_UPDATE_HEADER</a>),
<a name="l00401"></a>00401                                                 send, state-&gt;ar-&gt;id);
<a name="l00402"></a>00402 
<a name="l00403"></a>00403                                         state-&gt;stats-&gt;s_sent_dds++;
<a name="l00404"></a>00404                                 }
<a name="l00405"></a>00405                         } <span class="keywordflow">else</span>
<a name="l00406"></a>00406                                 <a class="code" href="ospf-extern_8h.html#1a0d7bfac4f79c936b7940887971c1ec">ospf_nbr_event_handler</a>(state,nbr, 
<a name="l00407"></a>00407                                         ospf_nbr_seqnum_mismatch_ev, lp);
<a name="l00408"></a>00408                         <span class="keywordflow">break</span>;
<a name="l00409"></a>00409                 <span class="keywordflow">default</span>:
<a name="l00410"></a>00410                         printf(<span class="stringliteral">"%lld: Received DD with unknown type\n"</span>, lp-&gt;id);
<a name="l00411"></a>00411         }
<a name="l00412"></a>00412 
<a name="l00413"></a>00413         tw_memory_free(lp, b, <a class="code" href="ospf-extern_8h.html#6172717590c1e9795cb6db7baeb1bf4a">g_ospf_dd_fd</a>);
<a name="l00414"></a>00414 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="73abd30e3f402591726493698a318452"></a><!-- doxytag: member="ospf-extern.h::ospf_dd_exchange" ref="73abd30e3f402591726493698a318452" args="(ospf_state *state, tw_lp *lp, ospf_message *m, int)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf_dd_exchange           </td>
          <td>(</td>
          <td class="paramtype">ospf_state *&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ospf_message *&nbsp;</td>
          <td class="paramname"> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="581d7d832f36b139dc5605c7ded7e645"></a><!-- doxytag: member="ospf-extern.h::ospf_dd_fill_hdrs" ref="581d7d832f36b139dc5605c7ded7e645" args="(ospf_nbr *nbr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf_dd_fill_hdrs           </td>
          <td>(</td>
          <td class="paramtype">ospf_nbr *&nbsp;</td>
          <td class="paramname"> <em>nbr</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="59924a888d975fc330fac606513592e5"></a><!-- doxytag: member="ospf-extern.h::ospf_dd_fill_header" ref="59924a888d975fc330fac606513592e5" args="(ospf_nbr *nbr, int index)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf_dd_fill_header           </td>
          <td>(</td>
          <td class="paramtype">ospf_nbr *&nbsp;</td>
          <td class="paramname"> <em>nbr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>index</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="f20e4567a62674a867f580c9c9e3b6a6"></a><!-- doxytag: member="ospf-extern.h::ospf_dd_retransmit" ref="f20e4567a62674a867f580c9c9e3b6a6" args="(ospf_state *state, ospf_nbr *nbr, tw_bf *bf, tw_lp *lp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf_dd_retransmit           </td>
          <td>(</td>
          <td class="paramtype">ospf_state *&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ospf_nbr *&nbsp;</td>
          <td class="paramname"> <em>nbr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_bf *&nbsp;</td>
          <td class="paramname"> <em>bf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-dd_8c-source.html#l00255">255</a> of file <a class="el" href="ospf-dd_8c-source.html">ospf-dd.c</a>.</p>

<p>References <a class="el" href="ospf-dd_8c-source.html#l00200">ospf_dd_copy()</a>, <a class="el" href="ospf-data-types_8h-source.html#l00009">OSPF_DD_HEADER</a>, <a class="el" href="ospf-util_8c-source.html#l00004">ospf_event_new()</a>, <a class="el" href="ospf-util_8c-source.html#l00024">ospf_event_send()</a>, <a class="el" href="ospf-data-types_8h-source.html#l00012">OSPF_LSA_UPDATE_HEADER</a>, <a class="el" href="ospf-neighbor-types_8h-source.html#l00008">OSPF_RETRANS_INTERVAL</a>, and <a class="el" href="ospf-timer_8c-source.html#l00029">ospf_timer_start()</a>.</p>

<p>Referenced by <a class="el" href="ospf-dd_8c-source.html#l00280">ospf_dd_event_handler()</a>, and <a class="el" href="ospf-router_8c-source.html#l00037">ospf_event_handler()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00256"></a>00256 {
<a name="l00257"></a>00257         tw_event        *e;
<a name="l00258"></a>00258         tw_memory       *b;
<a name="l00259"></a>00259         ospf_dd_pkt     *dd;
<a name="l00260"></a>00260 
<a name="l00261"></a>00261         b = <a class="code" href="ospf-dd_8c.html#fda0e2596f0abb694cedc7244745151e">ospf_dd_copy</a>(nbr-&gt;retrans_dd, lp);
<a name="l00262"></a>00262         dd = tw_memory_data(b);
<a name="l00263"></a>00263 
<a name="l00264"></a>00264         printf(<span class="stringliteral">"%lld OSPF: retransmit DD to %d, ts %lf \n"</span>,
<a name="l00265"></a>00265                 lp-&gt;id, nbr-&gt;id, tw_now(lp) + <a class="code" href="ospf-neighbor-types_8h.html#bafc366bfbfa370cb063b32c11092d5d">OSPF_RETRANS_INTERVAL</a>);
<a name="l00266"></a>00266 
<a name="l00267"></a>00267         e = <a class="code" href="ospf-extern_8h.html#a6ee00330aee5b151785a47a706cf226">ospf_event_new</a>(state, tw_getlp(nbr-&gt;id), 0.0, lp);
<a name="l00268"></a>00268         <a class="code" href="ospf-extern_8h.html#506873294c07e25082f4e8d2f631b522">ospf_event_send</a>(nbr-&gt;router, e, OSPF_DD_MSG, lp,
<a name="l00269"></a>00269                         <a class="code" href="ospf-data-types_8h.html#05c3c6b89fa76c5f4f6f8e76981f9d49">OSPF_DD_HEADER</a> + (dd-&gt;nlsas * <a class="code" href="ospf-data-types_8h.html#bb42796d55aff837291811e19fbf63c1">OSPF_LSA_UPDATE_HEADER</a>), 
<a name="l00270"></a>00270                         b, nbr-&gt;router-&gt;ar-&gt;id);
<a name="l00271"></a>00271         
<a name="l00272"></a>00272         nbr-&gt;retrans_timer =
<a name="l00273"></a>00273                 <a class="code" href="ospf-extern_8h.html#75e3fe5d4b90cd1e2ca417ac3d9518c7">ospf_timer_start</a>(nbr, nbr-&gt;retrans_timer,
<a name="l00274"></a>00274                                         <a class="code" href="ospf-neighbor-types_8h.html#bafc366bfbfa370cb063b32c11092d5d">OSPF_RETRANS_INTERVAL</a>, 
<a name="l00275"></a>00275                                         OSPF_RETRANS_TIMEOUT, 
<a name="l00276"></a>00276                                         lp);
<a name="l00277"></a>00277 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="3a8011d3fa8ad0d6ea7eba6cb3a48552"></a><!-- doxytag: member="ospf-extern.h::ospf_event_handler" ref="3a8011d3fa8ad0d6ea7eba6cb3a48552" args="(ospf_state *, tw_bf *bf, rn_message *m, tw_lp *lp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf_event_handler           </td>
          <td>(</td>
          <td class="paramtype">ospf_state *&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_bf *&nbsp;</td>
          <td class="paramname"> <em>bf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">rn_message *&nbsp;</td>
          <td class="paramname"> <em>rn_msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
OSPF model event handler function.<p>
This is the OSPF model event handler function. This function is a simple switch statement which determine what kind of event was recieved and passes control to the appropriate function. 
<p>Definition at line <a class="el" href="ospf-router_8c-source.html#l00037">37</a> of file <a class="el" href="ospf-router_8c-source.html">ospf-router.c</a>.</p>

<p>References <a class="el" href="ospf-global_8c-source.html#l00007">g_ospf_fd</a>, <a class="el" href="ospf-ack_8c-source.html#l00075">ospf_ack_process()</a>, <a class="el" href="ospf-ack_8c-source.html#l00025">ospf_ack_timed_out()</a>, <a class="el" href="ospf-timer-aging_8c-source.html#l00147">ospf_aging_timer()</a>, <a class="el" href="ospf-dd_8c-source.html#l00280">ospf_dd_event_handler()</a>, <a class="el" href="ospf-dd_8c-source.html#l00255">ospf_dd_retransmit()</a>, <a class="el" href="ospf-experiments_8c-source.html#l00041">ospf_experiment_weights()</a>, <a class="el" href="ospf-hello_8c-source.html#l00115">ospf_hello_packet()</a>, <a class="el" href="ospf-hello_8c-source.html#l00101">ospf_hello_send()</a>, <a class="el" href="ospf-router_8c-source.html#l00016">ospf_int_getinterface()</a>, <a class="el" href="ospf-ls-request_8c-source.html#l00004">ospf_ls_request_recv()</a>, <a class="el" href="ospf-ls_8c-source.html#l00274">ospf_ls_update_recv()</a>, <a class="el" href="ospf-neighbor-state_8c-source.html#l00544">ospf_nbr_event_handler()</a>, <a class="el" href="ospf-routing_8c-source.html#l00029">ospf_rt_timer()</a>, <a class="el" href="rn-machine_8c-source.html#l00028">rn_getas()</a>, and <a class="el" href="rn-types_8h-source.html#l00056">TIMER</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00038"></a>00038 {
<a name="l00039"></a>00039         tw_memory       *b;
<a name="l00040"></a>00040         ospf_nbr        *nbr;
<a name="l00041"></a>00041         ospf_message    *msg;
<a name="l00042"></a>00042 
<a name="l00043"></a>00043         <span class="comment">// get the OSPF message header</span>
<a name="l00044"></a>00044         b = tw_event_memory_get(lp);
<a name="l00045"></a>00045 
<a name="l00046"></a>00046         <span class="keywordflow">if</span>(!b)
<a name="l00047"></a>00047                 tw_error(TW_LOC, <span class="stringliteral">"No membuf on event!"</span>);
<a name="l00048"></a>00048 
<a name="l00049"></a>00049         msg = tw_memory_data(b);
<a name="l00050"></a>00050 
<a name="l00051"></a>00051         nbr = <a class="code" href="ospf-extern_8h.html#a28c766dd7f8f5caa136fa2dc1bbb4e5">ospf_int_getinterface</a>(state, rn_msg-&gt;src);
<a name="l00052"></a>00052 
<a name="l00053"></a>00053         <span class="keywordflow">if</span>(!nbr)
<a name="l00054"></a>00054                 nbr = msg-&gt;data;
<a name="l00055"></a>00055 
<a name="l00056"></a>00056         <span class="keywordflow">if</span>(rn_msg-&gt;type != <a class="code" href="rn-types_8h.html#3fc738f2924cae2b2d04a9a133c3ef0217ba9bae1b8d7e8d6c12d46ec58e0769">TIMER</a> &amp;&amp; <a class="code" href="rn-extern_8h.html#d3b2637627bbb86acf01b38d07495042">rn_getas</a>(state-&gt;m) != <a class="code" href="rn-extern_8h.html#d3b2637627bbb86acf01b38d07495042">rn_getas</a>(nbr-&gt;m))
<a name="l00057"></a>00057                 printf(<span class="stringliteral">"Got event from nbr outside my AS! \n"</span>);
<a name="l00058"></a>00058 
<a name="l00059"></a>00059 
<a name="l00060"></a>00060 <span class="comment">/*</span>
<a name="l00061"></a>00061 <span class="comment">        //printf("%d: got message  %d at %g\n", lp-&gt;id, rn_msg-&gt;src, tw_now(lp));</span>
<a name="l00062"></a>00062 <span class="comment"></span>
<a name="l00063"></a>00063 <span class="comment">        if(g_route[gr1] == lp-&gt;id)</span>
<a name="l00064"></a>00064 <span class="comment">        {</span>
<a name="l00065"></a>00065 <span class="comment">                gr1++;</span>
<a name="l00066"></a>00066 <span class="comment">                g_route[gr1] = state-&gt;from;</span>
<a name="l00067"></a>00067 <span class="comment">        } </span>
<a name="l00068"></a>00068 <span class="comment"></span>
<a name="l00069"></a>00069 <span class="comment">        if(g_route1[gr2] == lp-&gt;id)</span>
<a name="l00070"></a>00070 <span class="comment">        {</span>
<a name="l00071"></a>00071 <span class="comment">                gr2++;</span>
<a name="l00072"></a>00072 <span class="comment">                g_route1[gr2] = state-&gt;from1;</span>
<a name="l00073"></a>00073 <span class="comment">        }</span>
<a name="l00074"></a>00074 <span class="comment">*/</span>
<a name="l00075"></a>00075 
<a name="l00076"></a>00076         <span class="keywordflow">if</span>(rn_msg-&gt;port != 23)
<a name="l00077"></a>00077                 tw_error(TW_LOC, <span class="stringliteral">"%ld: recv non-ospf message from %d!"</span>, lp-&gt;id, nbr-&gt;id);
<a name="l00078"></a>00078 
<a name="l00079"></a>00079         <span class="keywordflow">switch</span> (msg-&gt;type)
<a name="l00080"></a>00080         {
<a name="l00081"></a>00081         <span class="keywordflow">case</span> OSPF_HELLO_MSG:
<a name="l00082"></a>00082 <span class="preprocessor">#if VERIFY_HELLO || 1</span>
<a name="l00083"></a>00083 <span class="preprocessor"></span>        <span class="keywordflow">if</span>(1 == lp-&gt;id)
<a name="l00084"></a>00084                 printf(<span class="stringliteral">"%lld OSPF: recv HELLO_MSG (%ld) from %lld, ts %f\n"</span>, 
<a name="l00085"></a>00085                         lp-&gt;id, (<span class="keywordtype">long</span> <span class="keywordtype">int</span>) lp-&gt;pe-&gt;cur_event, rn_msg-&gt;src, tw_now(lp));
<a name="l00086"></a>00086 <span class="preprocessor">#endif</span>
<a name="l00087"></a>00087 <span class="preprocessor"></span>
<a name="l00088"></a>00088                 <a class="code" href="ospf-extern_8h.html#c517556bf6d7725174df1e5dc931bf4f">ospf_hello_packet</a>(state, nbr, msg-&gt;data, bf, lp);
<a name="l00089"></a>00089                 state-&gt;stats-&gt;s_e_hello_in++;
<a name="l00090"></a>00090                 <span class="keywordflow">break</span>;
<a name="l00091"></a>00091 
<a name="l00092"></a>00092         <span class="keywordflow">case</span> OSPF_HELLO_SEND:
<a name="l00093"></a>00093 <span class="preprocessor">#if VERIFY_HELLO || 1</span>
<a name="l00094"></a>00094 <span class="preprocessor"></span>        <span class="keywordflow">if</span>(1 == lp-&gt;id)
<a name="l00095"></a>00095                 printf(<span class="stringliteral">"%lld OSPF: recv HELLO_SEND timer from %lld, ts %lf \n"</span>, 
<a name="l00096"></a>00096                                 lp-&gt;id, rn_msg-&gt;src, tw_now(lp));
<a name="l00097"></a>00097 <span class="preprocessor">#endif</span>
<a name="l00098"></a>00098 <span class="preprocessor"></span>
<a name="l00099"></a>00099                 <a class="code" href="ospf-extern_8h.html#bc4b7f40002d6ef94e990d8b3394db65">ospf_hello_send</a>(state, nbr, bf, lp);
<a name="l00100"></a>00100                 <span class="keywordflow">break</span>;
<a name="l00101"></a>00101 
<a name="l00102"></a>00102         <span class="keywordflow">case</span> OSPF_DD_MSG:
<a name="l00103"></a>00103 <span class="preprocessor">#if VERIFY_DD || 1</span>
<a name="l00104"></a>00104 <span class="preprocessor"></span>        <span class="keywordflow">if</span>(1 == lp-&gt;id)
<a name="l00105"></a>00105                 printf(<span class="stringliteral">"\n%lld OSPF: got DD packet from %lld\n"</span>, lp-&gt;id, rn_msg-&gt;src);
<a name="l00106"></a>00106 <span class="preprocessor">#endif</span>
<a name="l00107"></a>00107 <span class="preprocessor"></span>
<a name="l00108"></a>00108                 <a class="code" href="ospf-dd_8c.html#dd428afe490ee1cc0190ace6fac0ab71">ospf_dd_event_handler</a>(state, nbr, bf, lp);
<a name="l00109"></a>00109                 state-&gt;stats-&gt;s_e_dd_msgs++;
<a name="l00110"></a>00110                 <span class="keywordflow">break</span>;
<a name="l00111"></a>00111 
<a name="l00112"></a>00112         <span class="keywordflow">case</span> OSPF_LS_REQUEST:
<a name="l00113"></a>00113 <span class="preprocessor">#if VERIFY_LS || 1</span>
<a name="l00114"></a>00114 <span class="preprocessor"></span>        <span class="keywordflow">if</span>(1 == lp-&gt;id)
<a name="l00115"></a>00115                 printf(<span class="stringliteral">"\n%lld: got LS_Request from %lld at %f\n"</span>, 
<a name="l00116"></a>00116                         lp-&gt;id, rn_msg-&gt;src, tw_now(lp));
<a name="l00117"></a>00117 <span class="preprocessor">#endif</span>
<a name="l00118"></a>00118 <span class="preprocessor"></span>
<a name="l00119"></a>00119                 <a class="code" href="ospf-extern_8h.html#8a8a0d0321d6cf2313d44d24f4367651">ospf_ls_request_recv</a>(state, bf, nbr, lp);
<a name="l00120"></a>00120                 state-&gt;stats-&gt;s_e_ls_requests++;
<a name="l00121"></a>00121                 <span class="keywordflow">break</span>;
<a name="l00122"></a>00122 
<a name="l00123"></a>00123         <span class="keywordflow">case</span> OSPF_LS_UPDATE:
<a name="l00124"></a>00124 <span class="preprocessor">#if VERIFY_LS || 1</span>
<a name="l00125"></a>00125 <span class="preprocessor"></span>        <span class="keywordflow">if</span>(1 == lp-&gt;id)
<a name="l00126"></a>00126                 printf(<span class="stringliteral">"\n%lld: got LS Update from %lld at %f\n"</span>,
<a name="l00127"></a>00127                         lp-&gt;id, rn_msg-&gt;src, tw_now(lp));
<a name="l00128"></a>00128 <span class="preprocessor">#endif</span>
<a name="l00129"></a>00129 <span class="preprocessor"></span>                <a class="code" href="ospf-extern_8h.html#df9d36c7dc21c44e40a6c1a4dc9302ba">ospf_ls_update_recv</a>(state, bf, nbr, lp);
<a name="l00130"></a>00130                 state-&gt;stats-&gt;s_e_ls_updates++;
<a name="l00131"></a>00131                 <span class="keywordflow">break</span>;
<a name="l00132"></a>00132 
<a name="l00133"></a>00133         <span class="keywordflow">case</span> OSPF_FLOOD_TIMEOUT:
<a name="l00134"></a>00134                 tw_error(TW_LOC, <span class="stringliteral">"Should not be here!!"</span>);
<a name="l00135"></a>00135 
<a name="l00136"></a>00136                 <span class="comment">//ospf_flood_recv(state, nbr, bf, lp);</span>
<a name="l00137"></a>00137                 <span class="keywordflow">break</span>;
<a name="l00138"></a>00138 
<a name="l00139"></a>00139         <span class="keywordflow">case</span> OSPF_LS_ACK:
<a name="l00140"></a>00140 <span class="preprocessor">#if VERIFY_LS || 1</span>
<a name="l00141"></a>00141 <span class="preprocessor"></span>        <span class="keywordflow">if</span>(1 == lp-&gt;id)
<a name="l00142"></a>00142                 printf(<span class="stringliteral">"\n%lld: got LS_ACK from %lld %f\n"</span>,
<a name="l00143"></a>00143                                 lp-&gt;id, rn_msg-&gt;src, tw_now(lp));
<a name="l00144"></a>00144 <span class="preprocessor">#endif</span>
<a name="l00145"></a>00145 <span class="preprocessor"></span>
<a name="l00146"></a>00146                 <a class="code" href="ospf-ack_8c.html#31935383e7c5ef42f4d2b91297dbad6f">ospf_ack_process</a>(nbr, bf, lp);
<a name="l00147"></a>00147                 state-&gt;stats-&gt;s_e_ls_acks++;
<a name="l00148"></a>00148 
<a name="l00149"></a>00149                 <span class="keywordflow">break</span>;
<a name="l00150"></a>00150 
<a name="l00151"></a>00151         <span class="keywordflow">case</span> OSPF_AGING_TIMER:
<a name="l00152"></a>00152 <span class="preprocessor">#if VERIFY_AGING || 1</span>
<a name="l00153"></a>00153 <span class="preprocessor"></span>        <span class="keywordflow">if</span>(1 == lp-&gt;id)
<a name="l00154"></a>00154                 printf(<span class="stringliteral">"%lld: got AGING_TIMER at %f\n"</span>, lp-&gt;id, tw_now(lp));
<a name="l00155"></a>00155 <span class="preprocessor">#endif</span>
<a name="l00156"></a>00156 <span class="preprocessor"></span>                <a class="code" href="ospf-extern_8h.html#1c68a2e5cdbbb0044932c3f3d2e1be34">ospf_aging_timer</a>(state, bf, lp);
<a name="l00157"></a>00157                 state-&gt;stats-&gt;s_e_aging_timeouts++;
<a name="l00158"></a>00158                 <span class="keywordflow">break</span>;
<a name="l00159"></a>00159 
<a name="l00160"></a>00160         <span class="keywordflow">case</span> OSPF_RT_TIMER:
<a name="l00161"></a>00161 <span class="preprocessor">#if 1</span>
<a name="l00162"></a>00162 <span class="preprocessor"></span>                printf(<span class="stringliteral">"\n%lld: rt timer fired! \n"</span>, lp-&gt;id);
<a name="l00163"></a>00163 <span class="preprocessor">#endif</span>
<a name="l00164"></a>00164 <span class="preprocessor"></span>                tw_event_memory_get(lp);
<a name="l00165"></a>00165                 <a class="code" href="ospf-extern_8h.html#fde0ede536714d6ad9959f7c80ebf026">ospf_rt_timer</a>(state, lp-&gt;id);
<a name="l00166"></a>00166 
<a name="l00167"></a>00167                 <span class="keywordflow">break</span>;
<a name="l00168"></a>00168         <span class="keywordflow">case</span> OSPF_RETRANS_TIMEOUT:
<a name="l00169"></a>00169 <span class="preprocessor">#if VERIFY_DD || 1</span>
<a name="l00170"></a>00170 <span class="preprocessor"></span>        <span class="keywordflow">if</span>(1 == lp-&gt;id)
<a name="l00171"></a>00171                 printf(<span class="stringliteral">"%lld: got RETRANS_TIMEOUT\n"</span>, lp-&gt;id);
<a name="l00172"></a>00172 <span class="preprocessor">#endif</span>
<a name="l00173"></a>00173 <span class="preprocessor"></span>
<a name="l00174"></a>00174                 tw_error(TW_LOC, <span class="stringliteral">"should not be here!"</span>);
<a name="l00175"></a>00175 
<a name="l00176"></a>00176                 <a class="code" href="ospf-dd_8c.html#f20e4567a62674a867f580c9c9e3b6a6">ospf_dd_retransmit</a>(state, nbr, bf, lp);
<a name="l00177"></a>00177                 <span class="keywordflow">break</span>;
<a name="l00178"></a>00178 
<a name="l00179"></a>00179         <span class="keywordflow">case</span> OSPF_ACK_TIMEOUT:
<a name="l00180"></a>00180 <span class="preprocessor">#if VERIFY_LS || 1</span>
<a name="l00181"></a>00181 <span class="preprocessor"></span>        <span class="keywordflow">if</span>(1 == lp-&gt;id)
<a name="l00182"></a>00182                 printf(<span class="stringliteral">"%lld: got Ack Timer \n"</span>, lp-&gt;id);
<a name="l00183"></a>00183 <span class="preprocessor">#endif</span>
<a name="l00184"></a>00184 <span class="preprocessor"></span>                <a class="code" href="ospf-ack_8c.html#c20116feb875452548060b0fc6048e1b">ospf_ack_timed_out</a>(nbr, bf, lp);
<a name="l00185"></a>00185                 state-&gt;stats-&gt;s_e_ack_timeouts++;
<a name="l00186"></a>00186                 <span class="keywordflow">break</span>;
<a name="l00187"></a>00187 
<a name="l00188"></a>00188         <span class="keywordflow">case</span> OSPF_HELLO_TIMEOUT:
<a name="l00189"></a>00189 <span class="preprocessor">#if VERIFY_HELLO || 1</span>
<a name="l00190"></a>00190 <span class="preprocessor"></span>        <span class="keywordflow">if</span>(1 == lp-&gt;id)
<a name="l00191"></a>00191                 printf(<span class="stringliteral">"%lld: recv HELLO_TIMEOUT for nbr %d, ts %lf \n"</span>, 
<a name="l00192"></a>00192                                                 lp-&gt;id, nbr-&gt;id, tw_now(lp));
<a name="l00193"></a>00193 <span class="preprocessor">#endif</span>
<a name="l00194"></a>00194 <span class="preprocessor"></span>
<a name="l00195"></a>00195                 state-&gt;stats-&gt;s_e_hello_timeouts++;
<a name="l00196"></a>00196 
<a name="l00197"></a>00197                 <a class="code" href="ospf-extern_8h.html#1a0d7bfac4f79c936b7940887971c1ec">ospf_nbr_event_handler</a>(state, nbr,
<a name="l00198"></a>00198                                         ospf_nbr_inactivity_timer_ev, lp);
<a name="l00199"></a>00199                 <span class="keywordflow">break</span>;
<a name="l00200"></a>00200         <span class="keywordflow">case</span> OSPF_WEIGHT_CHANGE:
<a name="l00201"></a>00201 <span class="preprocessor">#if VERIFY_OSPF_EXPERIMENT</span>
<a name="l00202"></a>00202 <span class="preprocessor"></span>                printf(<span class="stringliteral">"%lld: recv WEIGHT CHANGE for link %ld, ts %lf \n"</span>, 
<a name="l00203"></a>00203                         lp-&gt;id, (<span class="keywordtype">long</span> <span class="keywordtype">int</span>) msg-&gt;data, tw_now(lp));
<a name="l00204"></a>00204 <span class="preprocessor">#endif</span>
<a name="l00205"></a>00205 <span class="preprocessor"></span>                <a class="code" href="ospf-experiments_8c.html#cd5973380a161924211634a9006bed4d">ospf_experiment_weights</a>(state, (<span class="keywordtype">long</span> <span class="keywordtype">int</span>) msg-&gt;data, lp);
<a name="l00206"></a>00206                 <span class="keywordflow">break</span>;
<a name="l00207"></a>00207         <span class="keywordflow">default</span>:
<a name="l00208"></a>00208                 tw_error(TW_LOC, <span class="stringliteral">"%lld: Invalid packet type: %d at %f"</span>,
<a name="l00209"></a>00209                                  lp-&gt;id, msg-&gt;type, tw_now(lp));
<a name="l00210"></a>00210         }
<a name="l00211"></a>00211 
<a name="l00212"></a>00212         <span class="comment">// Free the OSPF message header membuf</span>
<a name="l00213"></a>00213         tw_memory_free(lp, b, <a class="code" href="ospf-extern_8h.html#884d66f70a693353a1894758d71deb99">g_ospf_fd</a>);
<a name="l00214"></a>00214 
<a name="l00215"></a>00215         <span class="keywordflow">if</span>(lp-&gt;pe-&gt;cur_event-&gt;memory)
<a name="l00216"></a>00216                 tw_error(TW_LOC, <span class="stringliteral">"Left memory buffer on event!"</span>);
<a name="l00217"></a>00217 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="a6ee00330aee5b151785a47a706cf226"></a><!-- doxytag: member="ospf-extern.h::ospf_event_new" ref="a6ee00330aee5b151785a47a706cf226" args="(ospf_state *, tw_lp *, tw_stime, tw_lp *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tw_event* ospf_event_new           </td>
          <td>(</td>
          <td class="paramtype">ospf_state *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_stime&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-util_8c-source.html#l00004">4</a> of file <a class="el" href="ospf-util_8c-source.html">ospf-util.c</a>.</p>

<p>References <a class="el" href="rn-types_8h-source.html#l00055">DOWNSTREAM</a>, and <a class="el" href="rn-event_8c-source.html#l00058">rn_event_new()</a>.</p>

<p>Referenced by <a class="el" href="ospf-dd_8c-source.html#l00062">dd_exchange()</a>, <a class="el" href="ospf-ack_8c-source.html#l00049">ospf_ack_direct()</a>, <a class="el" href="ospf-ack_8c-source.html#l00025">ospf_ack_timed_out()</a>, <a class="el" href="ospf-dd_8c-source.html#l00280">ospf_dd_event_handler()</a>, <a class="el" href="ospf-dd_8c-source.html#l00255">ospf_dd_retransmit()</a>, <a class="el" href="ospf-hello_8c-source.html#l00010">ospf_h_send()</a>, <a class="el" href="ospf-ip_8c-source.html#l00005">ospf_ip_route()</a>, <a class="el" href="ospf-ls_8c-source.html#l00335">ospf_ls_request()</a>, <a class="el" href="ospf-ls_8c-source.html#l00400">ospf_ls_request_recv()</a>, <a class="el" href="ospf-lsa_8c-source.html#l00646">ospf_lsa_start_flood()</a>, <a class="el" href="ospf-neighbor-state_8c-source.html#l00407">ospf_nbr_neg_done()</a>, <a class="el" href="ospf-neighbor-state_8c-source.html#l00334">ospf_nbr_two_way_recv()</a>, and <a class="el" href="ospf-ls_8c-source.html#l00026">process_lsa_recv()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00005"></a>00005 {
<a name="l00006"></a>00006         tw_event       *<span class="keyword">event</span> = NULL;
<a name="l00007"></a>00007 
<a name="l00008"></a>00008         <span class="keyword">event</span> = <a class="code" href="rn-event_8c.html#5508bcf53c1fbeb71e6055021634a726">rn_event_new</a>(dest-&gt;gid, ts, src, <a class="code" href="rn-types_8h.html#3fc738f2924cae2b2d04a9a133c3ef02193085e792a05c4538ec2bc24c845652">DOWNSTREAM</a>, 0);
<a name="l00009"></a>00009 
<a name="l00010"></a>00010         <span class="keywordflow">if</span>(src-&gt;pe-&gt;abort_event)
<a name="l00011"></a>00011         {
<a name="l00012"></a>00012                 state-&gt;stats-&gt;s_sent_lost++;
<a name="l00013"></a>00013 
<a name="l00014"></a>00014 <span class="preprocessor">#if VERIFY_HELLO</span>
<a name="l00015"></a>00015 <span class="preprocessor"></span>                printf(<span class="stringliteral">"%ld OSPF: Dropped event to dst %lld \n"</span>, 
<a name="l00016"></a>00016                            src-&gt;id, dest-&gt;gid);
<a name="l00017"></a>00017 <span class="preprocessor">#endif</span>
<a name="l00018"></a>00018 <span class="preprocessor"></span>        }
<a name="l00019"></a>00019 
<a name="l00020"></a>00020         <span class="keywordflow">return</span> event;
<a name="l00021"></a>00021 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="506873294c07e25082f4e8d2f631b522"></a><!-- doxytag: member="ospf-extern.h::ospf_event_send" ref="506873294c07e25082f4e8d2f631b522" args="(ospf_state *state, tw_event *event, int type, tw_lp *, int size, tw_memory *mem, int area)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tw_event* ospf_event_send           </td>
          <td>(</td>
          <td class="paramtype">ospf_state *&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_event *&nbsp;</td>
          <td class="paramname"> <em>event</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_memory *&nbsp;</td>
          <td class="paramname"> <em>mem</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>area</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-util_8c-source.html#l00024">24</a> of file <a class="el" href="ospf-util_8c-source.html">ospf-util.c</a>.</p>

<p>References <a class="el" href="ospf-global_8c-source.html#l00007">g_ospf_fd</a>, <a class="el" href="ospf-data-types_8h-source.html#l00008">OSPF_HEADER</a>, <a class="el" href="rn-event_8c-source.html#l00173">rn_event_send()</a>, and <a class="el" href="rn-message_8c-source.html#l00004">rn_message_setsize()</a>.</p>

<p>Referenced by <a class="el" href="ospf-dd_8c-source.html#l00062">dd_exchange()</a>, <a class="el" href="ospf-ack_8c-source.html#l00049">ospf_ack_direct()</a>, <a class="el" href="ospf-ack_8c-source.html#l00025">ospf_ack_timed_out()</a>, <a class="el" href="ospf-dd_8c-source.html#l00280">ospf_dd_event_handler()</a>, <a class="el" href="ospf-dd_8c-source.html#l00255">ospf_dd_retransmit()</a>, <a class="el" href="ospf-hello_8c-source.html#l00010">ospf_h_send()</a>, <a class="el" href="ospf-ip_8c-source.html#l00005">ospf_ip_route()</a>, <a class="el" href="ospf-ls_8c-source.html#l00335">ospf_ls_request()</a>, <a class="el" href="ospf-ls-request_8c-source.html#l00004">ospf_ls_request_recv()</a>, <a class="el" href="ospf-lsa_8c-source.html#l00646">ospf_lsa_start_flood()</a>, <a class="el" href="ospf-neighbor-state_8c-source.html#l00407">ospf_nbr_neg_done()</a>, <a class="el" href="ospf-neighbor-state_8c-source.html#l00334">ospf_nbr_two_way_recv()</a>, and <a class="el" href="ospf-ls_8c-source.html#l00026">process_lsa_recv()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00026"></a>00026 {
<a name="l00027"></a>00027         tw_memory       *b;
<a name="l00028"></a>00028 
<a name="l00029"></a>00029         ospf_message   *msg;
<a name="l00030"></a>00030 
<a name="l00031"></a>00031         <span class="comment">// packet data</span>
<a name="l00032"></a>00032         <span class="keywordflow">if</span>(mem)
<a name="l00033"></a>00033                 tw_event_memory_set(event, mem, <a class="code" href="ospf-extern_8h.html#884d66f70a693353a1894758d71deb99">g_ospf_fd</a>);
<a name="l00034"></a>00034 
<a name="l00035"></a>00035         <span class="comment">// packet header</span>
<a name="l00036"></a>00036         b = tw_memory_alloc(src, <a class="code" href="ospf-extern_8h.html#884d66f70a693353a1894758d71deb99">g_ospf_fd</a>);
<a name="l00037"></a>00037         msg = tw_memory_data(b);
<a name="l00038"></a>00038         msg-&gt;type = type;
<a name="l00039"></a>00039         msg-&gt;area = 0;
<a name="l00040"></a>00040 
<a name="l00041"></a>00041         tw_event_memory_set(event, b, <a class="code" href="ospf-extern_8h.html#884d66f70a693353a1894758d71deb99">g_ospf_fd</a>);
<a name="l00042"></a>00042         <a class="code" href="rn-extern_8h.html#31389041e3d04f5bb4efd6f7543bf7cb">rn_message_setsize</a>(tw_event_data(event), size + <a class="code" href="ospf-data-types_8h.html#0c4925cf967f3b302c24ce28570ca895">OSPF_HEADER</a>);
<a name="l00043"></a>00043 
<a name="l00044"></a>00044         <a class="code" href="rn-event_8c.html#8c3496e774b118a7e411ea5bcd23d49a">rn_event_send</a>(event);
<a name="l00045"></a>00045 
<a name="l00046"></a>00046 <span class="preprocessor">#if VERIFY_HELLO</span>
<a name="l00047"></a>00047 <span class="preprocessor"></span>        printf(<span class="stringliteral">"%ld OSPF: sent type %d, dst %ld, ts = %lf \n"</span>, 
<a name="l00048"></a>00048                    src-&gt;id, type, event-&gt;dest_lp-&gt;id, event-&gt;recv_ts);
<a name="l00049"></a>00049 <span class="preprocessor">#endif</span>
<a name="l00050"></a>00050 <span class="preprocessor"></span>
<a name="l00051"></a>00051         <span class="keywordflow">switch</span> (type)
<a name="l00052"></a>00052         {
<a name="l00053"></a>00053                 <span class="keywordflow">case</span> OSPF_HELLO_MSG:
<a name="l00054"></a>00054                         state-&gt;stats-&gt;s_sent_hellos++;
<a name="l00055"></a>00055                         <span class="keywordflow">break</span>;
<a name="l00056"></a>00056                 <span class="keywordflow">case</span> OSPF_DD_MSG:
<a name="l00057"></a>00057                         state-&gt;stats-&gt;s_sent_dds++;
<a name="l00058"></a>00058                         <span class="keywordflow">break</span>;
<a name="l00059"></a>00059                 <span class="keywordflow">case</span> OSPF_LS_REQUEST:
<a name="l00060"></a>00060                         state-&gt;stats-&gt;s_sent_ls_requests++;
<a name="l00061"></a>00061                         <span class="keywordflow">break</span>;
<a name="l00062"></a>00062                 <span class="keywordflow">case</span> OSPF_LS_UPDATE:
<a name="l00063"></a>00063                         state-&gt;stats-&gt;s_sent_ls_updates++;
<a name="l00064"></a>00064                         <span class="keywordflow">break</span>;
<a name="l00065"></a>00065                 <span class="keywordflow">case</span> OSPF_LS_ACK:
<a name="l00066"></a>00066                         state-&gt;stats-&gt;s_sent_ls_acks++;
<a name="l00067"></a>00067                         <span class="keywordflow">break</span>;
<a name="l00068"></a>00068                 <span class="keywordflow">default</span>:
<a name="l00069"></a>00069                         state-&gt;stats-&gt;s_sent_unknown++;
<a name="l00070"></a>00070         }
<a name="l00071"></a>00071 
<a name="l00072"></a>00072         <span class="keywordflow">return</span> event;
<a name="l00073"></a>00073 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="cd5973380a161924211634a9006bed4d"></a><!-- doxytag: member="ospf-extern.h::ospf_experiment_weights" ref="cd5973380a161924211634a9006bed4d" args="(ospf_state *state, long int i, tw_lp *lp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf_experiment_weights           </td>
          <td>(</td>
          <td class="paramtype">ospf_state *&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long int&nbsp;</td>
          <td class="paramname"> <em>i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-experiments_8c-source.html#l00041">41</a> of file <a class="el" href="ospf-experiments_8c-source.html">ospf-experiments.c</a>.</p>

<p>References <a class="el" href="ospf-global_8c-source.html#l00003">g_ospf_link_weight</a>, <a class="el" href="ospf-lsa_8c-source.html#l00076">ospf_lsa_find()</a>, <a class="el" href="ospf-lsa_8c-source.html#l00481">ospf_lsa_refresh()</a>, and <a class="el" href="ospf-routing_8c-source.html#l00004">ospf_rt_build()</a>.</p>

<p>Referenced by <a class="el" href="ospf-router_8c-source.html#l00037">ospf_event_handler()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00042"></a>00042 {
<a name="l00043"></a>00043         ospf_db_entry   *dbe;
<a name="l00044"></a>00044 
<a name="l00045"></a>00045         <span class="keywordtype">int</span>              metric;
<a name="l00046"></a>00046         <span class="keywordtype">int</span>              low;
<a name="l00047"></a>00047         <span class="keywordtype">int</span>              high;
<a name="l00048"></a>00048 
<a name="l00049"></a>00049         low = 50 - <a class="code" href="ospf-extern_8h.html#6c4827dc86376bc6eeba9589e6506ea9">g_ospf_link_weight</a>;
<a name="l00050"></a>00050         high = 50 + <a class="code" href="ospf-extern_8h.html#6c4827dc86376bc6eeba9589e6506ea9">g_ospf_link_weight</a>;
<a name="l00051"></a>00051 
<a name="l00052"></a>00052         <span class="keywordflow">if</span>(low &lt;= 0)
<a name="l00053"></a>00053                 low = 1;
<a name="l00054"></a>00054 
<a name="l00055"></a>00055         metric = tw_rand_integer(lp-&gt;rng, low, high);
<a name="l00056"></a>00056 
<a name="l00057"></a>00057         <span class="keywordflow">if</span>(metric == state-&gt;m-&gt;link[i].cost)
<a name="l00058"></a>00058                 <span class="keywordflow">return</span>;
<a name="l00059"></a>00059 
<a name="l00060"></a>00060 <span class="preprocessor">#if VERIFY_OSPF_EXPERIMENT</span>
<a name="l00061"></a>00061 <span class="preprocessor"></span>        printf(<span class="stringliteral">"%ld: updating link %ld-%d metric: %d -&gt; %d \n"</span>, 
<a name="l00062"></a>00062                 lp-&gt;id, state-&gt;m-&gt;id, state-&gt;m-&gt;link[i].addr, 
<a name="l00063"></a>00063                 state-&gt;m-&gt;link[i].cost, metric);
<a name="l00064"></a>00064 <span class="preprocessor">#endif</span>
<a name="l00065"></a>00065 <span class="preprocessor"></span>
<a name="l00066"></a>00066         state-&gt;m-&gt;link[i].cost = metric;
<a name="l00067"></a>00067         dbe = &amp;state-&gt;db[lp-&gt;id - state-&gt;ar-&gt;low];
<a name="l00068"></a>00068 
<a name="l00069"></a>00069         dbe-&gt;lsa = <a class="code" href="ospf-extern_8h.html#4b5eb3d01fff0994efd88f1f1a305c6f">ospf_lsa_find</a>(state, NULL, lp-&gt;id - state-&gt;ar-&gt;low, lp);
<a name="l00070"></a>00070         dbe-&gt;cause_ospf = 1;
<a name="l00071"></a>00071         dbe-&gt;cause_bgp = 0;
<a name="l00072"></a>00072 
<a name="l00073"></a>00073         <a class="code" href="ospf-extern_8h.html#8e91da94f0927f20f1b2962a45bcb5b9">ospf_rt_build</a>(state, lp-&gt;id);
<a name="l00074"></a>00074         <a class="code" href="ospf-extern_8h.html#9b306ecc8339fcb31d7c8e5448f60722">ospf_lsa_refresh</a>(state, dbe, lp);
<a name="l00075"></a>00075 
<a name="l00076"></a>00076         dbe-&gt;cause_ospf = 0;
<a name="l00077"></a>00077 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="71a8db07bf3a2da1fab6560e634180a7"></a><!-- doxytag: member="ospf-extern.h::ospf_get_neighbor" ref="71a8db07bf3a2da1fab6560e634180a7" args="(ospf_state *state, int id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ospf_nbr* ospf_get_neighbor           </td>
          <td>(</td>
          <td class="paramtype">ospf_state *&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>id</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-neighbor_8c-source.html#l00094">94</a> of file <a class="el" href="ospf-neighbor_8c-source.html">ospf-neighbor.c</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00095"></a>00095 {
<a name="l00096"></a>00096         <span class="keywordtype">int</span> i;
<a name="l00097"></a>00097 
<a name="l00098"></a>00098         <span class="keywordflow">for</span>(i = 0; i &lt; state-&gt;n_interfaces; i++)
<a name="l00099"></a>00099                 <span class="keywordflow">if</span>(<span class="keywordtype">id</span> == state-&gt;nbr[i].id)
<a name="l00100"></a>00100                         <span class="keywordflow">return</span> &amp;state-&gt;nbr[i];
<a name="l00101"></a>00101 
<a name="l00102"></a>00102         tw_error(TW_LOC, <span class="stringliteral">"Unable to find neighbor %d!!"</span>, <span class="keywordtype">id</span>);
<a name="l00103"></a>00103 
<a name="l00104"></a>00104         <span class="keywordflow">return</span> NULL;
<a name="l00105"></a>00105 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="e1d40f1eb2223baa1a8b3d7d7b7b3d46"></a><!-- doxytag: member="ospf-extern.h::ospf_getnbr" ref="e1d40f1eb2223baa1a8b3d7d7b7b3d46" args="(ospf_state *state, int id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ospf_nbr* ospf_getnbr           </td>
          <td>(</td>
          <td class="paramtype">ospf_state *&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>id</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-neighbor_8c-source.html#l00004">4</a> of file <a class="el" href="ospf-neighbor_8c-source.html">ospf-neighbor.c</a>.</p>

<p>Referenced by <a class="el" href="ospf-lsa_8c-source.html#l00278">lsa_create()</a>, and <a class="el" href="ospf-lsa_8c-source.html#l00076">ospf_lsa_find()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00005"></a>00005 {
<a name="l00006"></a>00006         <span class="keywordtype">int</span>      i;
<a name="l00007"></a>00007 
<a name="l00008"></a>00008         <span class="keywordflow">for</span>(i = 0; i &lt; state-&gt;n_interfaces; i++)
<a name="l00009"></a>00009                 <span class="keywordflow">if</span>(state-&gt;nbr[i].id == <span class="keywordtype">id</span>)
<a name="l00010"></a>00010                         <span class="keywordflow">return</span> &amp;state-&gt;nbr[i];
<a name="l00011"></a>00011 
<a name="l00012"></a>00012         <span class="comment">//tw_error(TW_LOC, "Unable to find neighbor!");</span>
<a name="l00013"></a>00013 
<a name="l00014"></a>00014         <span class="keywordflow">return</span> NULL;
<a name="l00015"></a>00015 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="c517556bf6d7725174df1e5dc931bf4f"></a><!-- doxytag: member="ospf-extern.h::ospf_hello_packet" ref="c517556bf6d7725174df1e5dc931bf4f" args="(ospf_state *, ospf_nbr *, ospf_hello *, tw_bf *, tw_lp *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf_hello_packet           </td>
          <td>(</td>
          <td class="paramtype">ospf_state *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ospf_nbr *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ospf_hello *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_bf *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-hello_8c-source.html#l00115">115</a> of file <a class="el" href="ospf-hello_8c-source.html">ospf-hello.c</a>.</p>

<p>References <a class="el" href="ospf-global_8c-source.html#l00007">g_ospf_fd</a>, <a class="el" href="ospf-interface_8c-source.html#l00348">ospf_interface_event_handler()</a>, and <a class="el" href="ospf-neighbor-state_8c-source.html#l00544">ospf_nbr_event_handler()</a>.</p>

<p>Referenced by <a class="el" href="ospf-router_8c-source.html#l00037">ospf_event_handler()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00117"></a>00117 {
<a name="l00118"></a>00118         tw_memory       *b;
<a name="l00119"></a>00119 
<a name="l00120"></a>00120         ospf_message    *m;
<a name="l00121"></a>00121         <span class="keywordtype">int</span>              i;
<a name="l00122"></a>00122         <span class="keywordtype">int</span>              priority;
<a name="l00123"></a>00123 
<a name="l00124"></a>00124         <span class="keywordflow">if</span>(NULL == nbr)
<a name="l00125"></a>00125         {
<a name="l00126"></a>00126                 tw_error(TW_LOC, <span class="stringliteral">"Do not have nbr!"</span>);
<a name="l00127"></a>00127                 state-&gt;stats-&gt;s_drop_hello_int++;
<a name="l00128"></a>00128                 bf-&gt;c1 = 1;
<a name="l00129"></a>00129 <span class="preprocessor">#if VERIFY_HELLO</span>
<a name="l00130"></a>00130 <span class="preprocessor"></span>                printf(<span class="stringliteral">"%ld: Dropping nbr HELLO since I have no state for it! "</span>
<a name="l00131"></a>00131                         <span class="stringliteral">"(%f)\n"</span>, lp-&gt;id, tw_now(lp));
<a name="l00132"></a>00132 <span class="preprocessor">#endif</span>
<a name="l00133"></a>00133 <span class="preprocessor"></span>                <span class="keywordflow">return</span>;
<a name="l00134"></a>00134         }
<a name="l00135"></a>00135 
<a name="l00136"></a>00136         b = tw_event_memory_get(lp);
<a name="l00137"></a>00137         m = tw_memory_data(b);
<a name="l00138"></a>00138         r = m-&gt;data;
<a name="l00139"></a>00139 
<a name="l00140"></a>00140         <span class="keywordflow">if</span>(!r)
<a name="l00141"></a>00141                 tw_error(TW_LOC, <span class="stringliteral">"Unable to read HELLO message!"</span>);
<a name="l00142"></a>00142 
<a name="l00143"></a>00143         <span class="comment">/*</span>
<a name="l00144"></a>00144 <span class="comment">         * Check the packet integrity</span>
<a name="l00145"></a>00145 <span class="comment">         */</span>
<a name="l00146"></a>00146         <span class="keywordflow">if</span> (r-&gt;hello_interval != state-&gt;gstate-&gt;hello_sendnext)
<a name="l00147"></a>00147         {
<a name="l00148"></a>00148                 state-&gt;stats-&gt;s_drop_hello_int++;
<a name="l00149"></a>00149                 bf-&gt;c1 = 1;
<a name="l00150"></a>00150 
<a name="l00151"></a>00151 <span class="preprocessor">#if VERIFY_HELLO</span>
<a name="l00152"></a>00152 <span class="preprocessor"></span>                printf(<span class="stringliteral">"%ld: dropped hello due to hello interval! %g != %g \n"</span>,
<a name="l00153"></a>00153                                 lp-&gt;id, r-&gt;hello_interval, 
<a name="l00154"></a>00154                                 state-&gt;gstate-&gt;hello_sendnext);
<a name="l00155"></a>00155 <span class="preprocessor">#endif</span>
<a name="l00156"></a>00156 <span class="preprocessor"></span>                <span class="keywordflow">return</span>;
<a name="l00157"></a>00157         }
<a name="l00158"></a>00158 
<a name="l00159"></a>00159         <span class="keywordflow">if</span> (r-&gt;poll_interval != state-&gt;gstate-&gt;poll_interval)
<a name="l00160"></a>00160         {
<a name="l00161"></a>00161                 state-&gt;stats-&gt;s_drop_poll_int++;
<a name="l00162"></a>00162                 bf-&gt;c2 = 1;
<a name="l00163"></a>00163 
<a name="l00164"></a>00164                 tw_memory_free(lp, b, <a class="code" href="ospf-extern_8h.html#884d66f70a693353a1894758d71deb99">g_ospf_fd</a>);
<a name="l00165"></a>00165 
<a name="l00166"></a>00166 <span class="preprocessor">#if VERIFY_HELLO</span>
<a name="l00167"></a>00167 <span class="preprocessor"></span>                printf(<span class="stringliteral">"%ld: dropped hello due to poll interval! %g != %g \n"</span>,
<a name="l00168"></a>00168                                 lp-&gt;id, r-&gt;poll_interval, state-&gt;gstate-&gt;poll_interval);
<a name="l00169"></a>00169 <span class="preprocessor">#endif</span>
<a name="l00170"></a>00170 <span class="preprocessor"></span>                <span class="keywordflow">return</span>;
<a name="l00171"></a>00171         }
<a name="l00172"></a>00172 
<a name="l00173"></a>00173         nbr-&gt;priority = r-&gt;priority;
<a name="l00174"></a>00174         nbr-&gt;designated_r = r-&gt;designated_r;
<a name="l00175"></a>00175         nbr-&gt;b_designated_r = r-&gt;b_designated_r;
<a name="l00176"></a>00176 
<a name="l00177"></a>00177         <a class="code" href="ospf-extern_8h.html#1a0d7bfac4f79c936b7940887971c1ec">ospf_nbr_event_handler</a>(state, nbr, ospf_nbr_hello_recv_ev, lp);
<a name="l00178"></a>00178 
<a name="l00179"></a>00179         <span class="comment">/*</span>
<a name="l00180"></a>00180 <span class="comment">         * If I am in the list of neighbors of the sending router,</span>
<a name="l00181"></a>00181 <span class="comment">         * then send a two_way_recv event</span>
<a name="l00182"></a>00182 <span class="comment">         */</span>
<a name="l00183"></a>00183         <span class="keywordflow">for</span> (i = r-&gt;offset; i &lt; r-&gt;end; i++)
<a name="l00184"></a>00184         {
<a name="l00185"></a>00185                 <span class="keywordflow">if</span>(r-&gt;neighbors[i] == lp-&gt;id)
<a name="l00186"></a>00186                 {
<a name="l00187"></a>00187 <span class="preprocessor">#if VERIFY_HELLO &amp;&amp; 0</span>
<a name="l00188"></a>00188 <span class="preprocessor"></span>                        printf(<span class="stringliteral">"%d: found myself in HELLO message! \n"</span>, lp-&gt;id);
<a name="l00189"></a>00189 <span class="preprocessor">#endif</span>
<a name="l00190"></a>00190 <span class="preprocessor"></span>
<a name="l00191"></a>00191                         priority = nbr-&gt;priority;
<a name="l00192"></a>00192                         <a class="code" href="ospf-extern_8h.html#1a0d7bfac4f79c936b7940887971c1ec">ospf_nbr_event_handler</a>(state, nbr, ospf_nbr_two_way_recv_ev, lp);
<a name="l00193"></a>00193 
<a name="l00194"></a>00194                         <span class="keywordflow">if</span> (priority != nbr-&gt;priority)
<a name="l00195"></a>00195                                 <a class="code" href="ospf-extern_8h.html#bd79355ae67c2a061b02a7cde07e0997">ospf_interface_event_handler</a>(nbr, ospf_int_nbrchange_ev, lp);
<a name="l00196"></a>00196 
<a name="l00197"></a>00197                         <span class="keywordflow">if</span> (r-&gt;designated_r == nbr-&gt;id &amp;&amp;
<a name="l00198"></a>00198                                 r-&gt;b_designated_r == 0xffffffff &amp;&amp; 
<a name="l00199"></a>00199                                 nbr-&gt;istate == ospf_int_waiting_st)
<a name="l00200"></a>00200                         {
<a name="l00201"></a>00201                                 <a class="code" href="ospf-extern_8h.html#bd79355ae67c2a061b02a7cde07e0997">ospf_interface_event_handler</a>(nbr, ospf_int_backupseen_ev, lp);
<a name="l00202"></a>00202                         } <span class="keywordflow">else</span>
<a name="l00203"></a>00203                         {
<a name="l00204"></a>00204 <span class="comment">/*</span>
<a name="l00205"></a>00205 <span class="comment">            Otherwise, if the</span>
<a name="l00206"></a>00206 <span class="comment">            neighbor is declaring itself to be Designated Router and it</span>
<a name="l00207"></a>00207 <span class="comment">            had not previously, or the neighbor is not declaring itself</span>
<a name="l00208"></a>00208 <span class="comment">            Designated Router where it had previously, the receiving</span>
<a name="l00209"></a>00209 <span class="comment">            interface's state machine is scheduled with the event</span>
<a name="l00210"></a>00210 <span class="comment">            NeighborChange.</span>
<a name="l00211"></a>00211 <span class="comment">*/</span>
<a name="l00212"></a>00212                                 <span class="keywordflow">if</span>((r-&gt;designated_r == nbr-&gt;id &amp;&amp;
<a name="l00213"></a>00213                                         r-&gt;designated_r != state-&gt;designated_r) ||
<a name="l00214"></a>00214                                    (r-&gt;designated_r != nbr-&gt;id &amp;&amp;
<a name="l00215"></a>00215                                         r-&gt;designated_r == state-&gt;designated_r))
<a name="l00216"></a>00216                                 {
<a name="l00217"></a>00217                                         <a class="code" href="ospf-extern_8h.html#bd79355ae67c2a061b02a7cde07e0997">ospf_interface_event_handler</a>(nbr, 
<a name="l00218"></a>00218                                                         ospf_int_nbrchange_ev, lp);
<a name="l00219"></a>00219                                 }
<a name="l00220"></a>00220                         }
<a name="l00221"></a>00221 
<a name="l00222"></a>00222                         <span class="keywordflow">if</span> (r-&gt;b_designated_r == nbr-&gt;id &amp;&amp;
<a name="l00223"></a>00223                                 nbr-&gt;istate == ospf_int_waiting_st)
<a name="l00224"></a>00224                         {
<a name="l00225"></a>00225                                 <a class="code" href="ospf-extern_8h.html#bd79355ae67c2a061b02a7cde07e0997">ospf_interface_event_handler</a>(nbr, ospf_int_backupseen_ev, lp);
<a name="l00226"></a>00226                         } <span class="keywordflow">else</span>
<a name="l00227"></a>00227                         {
<a name="l00228"></a>00228 <span class="comment">/*</span>
<a name="l00229"></a>00229 <span class="comment">            Otherwise, if the</span>
<a name="l00230"></a>00230 <span class="comment">            neighbor is declaring itself to be Backup Designated Router and it</span>
<a name="l00231"></a>00231 <span class="comment">            had not previously, or the neighbor is not declaring itself Backup</span>
<a name="l00232"></a>00232 <span class="comment">            Designated Router where it had previously, the receiving</span>
<a name="l00233"></a>00233 <span class="comment">            interface's state machine is scheduled with the event</span>
<a name="l00234"></a>00234 <span class="comment">            NeighborChange.</span>
<a name="l00235"></a>00235 <span class="comment">*/</span>
<a name="l00236"></a>00236                                 <span class="keywordflow">if</span>((r-&gt;b_designated_r == nbr-&gt;id &amp;&amp;
<a name="l00237"></a>00237                                         r-&gt;b_designated_r != state-&gt;b_designated_r) ||
<a name="l00238"></a>00238                                    (r-&gt;b_designated_r != nbr-&gt;id &amp;&amp;
<a name="l00239"></a>00239                                         r-&gt;b_designated_r == state-&gt;b_designated_r))
<a name="l00240"></a>00240                                 {
<a name="l00241"></a>00241                                         <a class="code" href="ospf-extern_8h.html#bd79355ae67c2a061b02a7cde07e0997">ospf_interface_event_handler</a>(nbr, 
<a name="l00242"></a>00242                                                         ospf_int_nbrchange_ev, lp);
<a name="l00243"></a>00243                                 }
<a name="l00244"></a>00244                         }
<a name="l00245"></a>00245 
<a name="l00246"></a>00246                         tw_memory_free(lp, b, <a class="code" href="ospf-extern_8h.html#884d66f70a693353a1894758d71deb99">g_ospf_fd</a>);
<a name="l00247"></a>00247 
<a name="l00248"></a>00248                         <span class="keywordflow">return</span>;
<a name="l00249"></a>00249                 }
<a name="l00250"></a>00250         }
<a name="l00251"></a>00251 
<a name="l00252"></a>00252         <span class="comment">/*</span>
<a name="l00253"></a>00253 <span class="comment">         * Start one-way event with neighbor which sent this message</span>
<a name="l00254"></a>00254 <span class="comment">         */</span>
<a name="l00255"></a>00255         <a class="code" href="ospf-extern_8h.html#1a0d7bfac4f79c936b7940887971c1ec">ospf_nbr_event_handler</a>(state, nbr, ospf_nbr_one_way_ev, lp);
<a name="l00256"></a>00256         tw_memory_free(lp, b, <a class="code" href="ospf-extern_8h.html#884d66f70a693353a1894758d71deb99">g_ospf_fd</a>);
<a name="l00257"></a>00257 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="bc4b7f40002d6ef94e990d8b3394db65"></a><!-- doxytag: member="ospf-extern.h::ospf_hello_send" ref="bc4b7f40002d6ef94e990d8b3394db65" args="(ospf_state *state, ospf_nbr *nbr, tw_bf *bf, tw_lp *lp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf_hello_send           </td>
          <td>(</td>
          <td class="paramtype">ospf_state *&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ospf_nbr *&nbsp;</td>
          <td class="paramname"> <em>nbr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_bf *&nbsp;</td>
          <td class="paramname"> <em>bf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-hello_8c-source.html#l00101">101</a> of file <a class="el" href="ospf-hello_8c-source.html">ospf-hello.c</a>.</p>

<p>References <a class="el" href="ospf-hello_8c-source.html#l00010">ospf_h_send()</a>, and <a class="el" href="ospf-timer_8c-source.html#l00029">ospf_timer_start()</a>.</p>

<p>Referenced by <a class="el" href="ospf-router_8c-source.html#l00037">ospf_event_handler()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00102"></a>00102 {
<a name="l00103"></a>00103         nbr-&gt;hello_timer = <a class="code" href="ospf-extern_8h.html#75e3fe5d4b90cd1e2ca417ac3d9518c7">ospf_timer_start</a>(nbr, nbr-&gt;hello_timer,
<a name="l00104"></a>00104                                             nbr-&gt;hello_interval,
<a name="l00105"></a>00105                                             OSPF_HELLO_SEND, lp);
<a name="l00106"></a>00106 
<a name="l00107"></a>00107         <span class="keywordflow">if</span>(nbr-&gt;istate &gt;= ospf_int_loopback_st)
<a name="l00108"></a>00108                 <a class="code" href="ospf-hello_8c.html#179f7dceff82965d342a8bd9f24be340">ospf_h_send</a>(state, nbr, lp, tw_getlp(nbr-&gt;id));
<a name="l00109"></a>00109 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="a28c766dd7f8f5caa136fa2dc1bbb4e5"></a><!-- doxytag: member="ospf-extern.h::ospf_int_getinterface" ref="a28c766dd7f8f5caa136fa2dc1bbb4e5" args="(ospf_state *state, int id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ospf_nbr* ospf_int_getinterface           </td>
          <td>(</td>
          <td class="paramtype">ospf_state *&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>id</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-router_8c-source.html#l00016">16</a> of file <a class="el" href="ospf-router_8c-source.html">ospf-router.c</a>.</p>

<p>Referenced by <a class="el" href="ospf-router_8c-source.html#l00037">ospf_event_handler()</a>, and <a class="el" href="ospf-router-rc_8c-source.html#l00004">ospf_rc_event_handler()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00017"></a>00017 {
<a name="l00018"></a>00018         <span class="keywordtype">int</span>     i;
<a name="l00019"></a>00019 
<a name="l00020"></a>00020         <span class="keywordflow">for</span> (i=0; i &lt; state-&gt;n_interfaces; i++)
<a name="l00021"></a>00021         {
<a name="l00022"></a>00022                 <span class="keywordflow">if</span> (state-&gt;nbr[i].id == <span class="keywordtype">id</span>)
<a name="l00023"></a>00023                         <span class="keywordflow">return</span> &amp;state-&gt;nbr[i];
<a name="l00024"></a>00024         }
<a name="l00025"></a>00025 
<a name="l00026"></a>00026         <span class="keywordflow">return</span> NULL;
<a name="l00027"></a>00027 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="bd79355ae67c2a061b02a7cde07e0997"></a><!-- doxytag: member="ospf-extern.h::ospf_interface_event_handler" ref="bd79355ae67c2a061b02a7cde07e0997" args="(ospf_nbr *nbr, ospf_int_event event, tw_lp *lp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf_interface_event_handler           </td>
          <td>(</td>
          <td class="paramtype">ospf_nbr *&nbsp;</td>
          <td class="paramname"> <em>nbr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ospf_int_event&nbsp;</td>
          <td class="paramname"> <em>event</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-interface_8c-source.html#l00348">348</a> of file <a class="el" href="ospf-interface_8c-source.html">ospf-interface.c</a>.</p>

<p>References <a class="el" href="ospf-interface_8c-source.html#l00263">ospf_interface_backupseen()</a>, <a class="el" href="ospf-interface_8c-source.html#l00338">ospf_interface_down()</a>, <a class="el" href="ospf-interface_8c-source.html#l00283">ospf_interface_nbrchange()</a>, <a class="el" href="ospf-interface_8c-source.html#l00317">ospf_interface_unloopind()</a>, <a class="el" href="ospf-interface_8c-source.html#l00214">ospf_interface_up()</a>, and <a class="el" href="ospf-interface_8c-source.html#l00243">ospf_interface_waittimer()</a>.</p>

<p>Referenced by <a class="el" href="ospf-hello_8c-source.html#l00115">ospf_hello_packet()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00349"></a>00349 {
<a name="l00350"></a>00350         <span class="keywordflow">switch</span>(event)
<a name="l00351"></a>00351         {
<a name="l00352"></a>00352                 <span class="keywordflow">case</span> ospf_int_up_ev:
<a name="l00353"></a>00353                         <span class="keywordflow">if</span>(nbr-&gt;istate == ospf_int_down_st)
<a name="l00354"></a>00354                                 <a class="code" href="ospf-interface_8c.html#eb5de79866e5f6dddc8dfcb9fc4b72b3">ospf_interface_up</a>(nbr, lp);
<a name="l00355"></a>00355                         <span class="keywordflow">break</span>;
<a name="l00356"></a>00356                 <span class="keywordflow">case</span> ospf_int_waittimer_ev:
<a name="l00357"></a>00357                         <span class="keywordflow">if</span>(nbr-&gt;istate == ospf_int_waiting_st)
<a name="l00358"></a>00358                                 <a class="code" href="ospf-interface_8c.html#cf1e42727be460c2144c1eeb763adc33">ospf_interface_waittimer</a>(nbr, lp);
<a name="l00359"></a>00359                         <span class="keywordflow">break</span>;
<a name="l00360"></a>00360                 <span class="keywordflow">case</span> ospf_int_backupseen_ev:
<a name="l00361"></a>00361                         <span class="keywordflow">if</span>(nbr-&gt;istate == ospf_int_waiting_st)
<a name="l00362"></a>00362                                 <a class="code" href="ospf-interface_8c.html#e6bc47322b43f5ae9d22089ae301d73b">ospf_interface_backupseen</a>(nbr, lp);
<a name="l00363"></a>00363                         <span class="keywordflow">break</span>;
<a name="l00364"></a>00364                 <span class="keywordflow">case</span> ospf_int_nbrchange_ev:
<a name="l00365"></a>00365                         <span class="keywordflow">if</span>(nbr-&gt;istate == ospf_int_dr_other_st ||
<a name="l00366"></a>00366                            nbr-&gt;istate == ospf_int_backup_st ||
<a name="l00367"></a>00367                            nbr-&gt;istate == ospf_int_dr_st)
<a name="l00368"></a>00368                                 <a class="code" href="ospf-interface_8c.html#5fe238062737d6617009d6071936a10f">ospf_interface_nbrchange</a>(nbr, lp);
<a name="l00369"></a>00369                         <span class="keywordflow">break</span>;
<a name="l00370"></a>00370                 <span class="keywordflow">case</span> ospf_int_loopind_ev:
<a name="l00371"></a>00371                         <a class="code" href="ospf-interface_8c.html#9352ba9822c1aba14470e990ac415ae9">ospf_interface_down</a>(nbr, lp);
<a name="l00372"></a>00372                         nbr-&gt;istate = ospf_int_loopback_st;
<a name="l00373"></a>00373                         <span class="keywordflow">break</span>;
<a name="l00374"></a>00374                 <span class="keywordflow">case</span> ospf_int_unloopind_ev:
<a name="l00375"></a>00375                         <span class="keywordflow">if</span>(nbr-&gt;istate == ospf_int_loopback_st)
<a name="l00376"></a>00376                                 <a class="code" href="ospf-interface_8c.html#d0596714efcf0a095231f237dd50f2cc">ospf_interface_unloopind</a>(nbr, lp);
<a name="l00377"></a>00377                         <span class="keywordflow">break</span>;
<a name="l00378"></a>00378                 <span class="keywordflow">case</span> ospf_int_down_ev:
<a name="l00379"></a>00379                         <a class="code" href="ospf-interface_8c.html#9352ba9822c1aba14470e990ac415ae9">ospf_interface_down</a>(nbr, lp);
<a name="l00380"></a>00380                         <span class="keywordflow">break</span>;
<a name="l00381"></a>00381 
<a name="l00382"></a>00382                 <span class="keywordflow">default</span>:
<a name="l00383"></a>00383                         tw_error(TW_LOC, <span class="stringliteral">"Unknown interface event: %d"</span>, event);
<a name="l00384"></a>00384         }
<a name="l00385"></a>00385 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="7516be363c55e3a4ce1c3ec37456b1d9"></a><!-- doxytag: member="ospf-extern.h::ospf_ip_route" ref="7516be363c55e3a4ce1c3ec37456b1d9" args="(ospf_state *state, tw_bf *bf, rn_message *rn_msg, tw_lp *lp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf_ip_route           </td>
          <td>(</td>
          <td class="paramtype">ospf_state *&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_bf *&nbsp;</td>
          <td class="paramname"> <em>bf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">rn_message *&nbsp;</td>
          <td class="paramname"> <em>rn_msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-ip_8c-source.html#l00005">5</a> of file <a class="el" href="ospf-ip_8c-source.html">ospf-ip.c</a>.</p>

<p>References <a class="el" href="rn-types_8h-source.html#l00045">c_host</a>, <a class="el" href="save_2ip-routing_8c-source.html#l00104">d</a>, <a class="el" href="rn-global_8c-source.html#l00052">g_rn_nrouters</a>, <a class="el" href="ospf-util_8c-source.html#l00004">ospf_event_new()</a>, <a class="el" href="ospf-util_8c-source.html#l00024">ospf_event_send()</a>, <a class="el" href="rn-event_8c-source.html#l00167">rn_event_data()</a>, <a class="el" href="rn-machine_8c-source.html#l00004">rn_getmachine()</a>, <a class="el" href="rn-message_8c-source.html#l00016">rn_message_data()</a>, <a class="el" href="rn-message_8c-source.html#l00010">rn_message_getsize()</a>, and <a class="el" href="rn-routing_8c-source.html#l00007">rn_route()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00006"></a>00006 {
<a name="l00007"></a>00007         tw_event        *e;
<a name="l00008"></a>00008 
<a name="l00009"></a>00009 <span class="comment">/*</span>
<a name="l00010"></a>00010 <span class="comment">        rn_message      *m;</span>
<a name="l00011"></a>00011 <span class="comment"></span>
<a name="l00012"></a>00012 <span class="comment">        ospf_message    *ospf;</span>
<a name="l00013"></a>00013 <span class="comment">        ospf_message    *msg;</span>
<a name="l00014"></a>00014 <span class="comment"></span>
<a name="l00015"></a>00015 <span class="comment">        tcp_message     *tcp_in;</span>
<a name="l00016"></a>00016 <span class="comment">        tcp_message     *tcp_out;</span>
<a name="l00017"></a>00017 <span class="comment">*/</span>
<a name="l00018"></a>00018         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>     dest;
<a name="l00019"></a>00019         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>     <a class="code" href="save_2ip-routing_8c.html#0ddbf789cfd814565dd88748311c1c36">d</a>;
<a name="l00020"></a>00020 
<a name="l00021"></a>00021         tw_error(TW_LOC, <span class="stringliteral">"Should not be getting IP packets.. "</span>);
<a name="l00022"></a>00022 
<a name="l00023"></a>00023         <span class="comment">//msg = rn_message_data(rn_msg);</span>
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 <span class="preprocessor">#if PLEASE_FIX_ME</span>
<a name="l00026"></a>00026 <span class="preprocessor"></span>        d = (rn_msg-&gt;final_dest / 1) - (<a class="code" href="rn-extern_8h.html#415a115c34def079d8a050c69167e80b">g_rn_nrouters</a> / 1) + (<a class="code" href="rn-extern_8h.html#415a115c34def079d8a050c69167e80b">g_rn_nrouters</a> - g_rn_npops);
<a name="l00027"></a>00027 <span class="preprocessor">#endif</span>
<a name="l00028"></a>00028 <span class="preprocessor"></span>        dest = <a class="code" href="rn-extern_8h.html#8890679c55545bd36e770b118a920b57">rn_route</a>(state-&gt;m, d);
<a name="l00029"></a>00029 
<a name="l00030"></a>00030         <span class="keywordflow">if</span>(0 &amp;&amp; dest == 0xff || dest == -1)
<a name="l00031"></a>00031         {
<a name="l00032"></a>00032 <span class="preprocessor">#if PLEASE_FIX_ME</span>
<a name="l00033"></a>00033 <span class="preprocessor"></span>                dest = rn_msg-&gt;final_dest;
<a name="l00034"></a>00034 <span class="preprocessor">#endif</span>
<a name="l00035"></a>00035 <span class="preprocessor"></span>
<a name="l00036"></a>00036                 e = <a class="code" href="ospf-extern_8h.html#a6ee00330aee5b151785a47a706cf226">ospf_event_new</a>(state, tw_getlp(dest), lp);
<a name="l00037"></a>00037 
<a name="l00038"></a>00038                 <span class="comment">// I think this size is correct, probably not though</span>
<a name="l00039"></a>00039                 tw_printf(TW_LOC, <span class="stringliteral">"Check OSPF ip pkt size! \n"</span>);
<a name="l00040"></a>00040                 <a class="code" href="ospf-extern_8h.html#506873294c07e25082f4e8d2f631b522">ospf_event_send</a>(state, e, OSPF_IP, lp, 
<a name="l00041"></a>00041                                 <a class="code" href="rn-extern_8h.html#b5b97cf3985f38a87dcd07911d371a4a">rn_message_getsize</a>(tw_event_data(lp-&gt;cur_event)), 
<a name="l00042"></a>00042                                 NULL, state-&gt;area);
<a name="l00043"></a>00043 
<a name="l00044"></a>00044 <span class="comment">/*</span>
<a name="l00045"></a>00045 <span class="comment">                e = ospf_event_send(state, tw_getlp(dest), </span>
<a name="l00046"></a>00046 <span class="comment">                                OSPF_IP, lp, LINK_TIME, NULL, state-&gt;area);</span>
<a name="l00047"></a>00047 <span class="comment">*/</span>
<a name="l00048"></a>00048 
<a name="l00049"></a>00049 <span class="preprocessor">#if 0</span>
<a name="l00050"></a>00050 <span class="preprocessor"></span>                tcp_in = ospf_util_data(msg);
<a name="l00051"></a>00051 
<a name="l00052"></a>00052                 tcp = <a class="code" href="rn-event_8c.html#3a6eb517cf4b083af531872ed92d4872">rn_event_data</a>(e);
<a name="l00053"></a>00053 
<a name="l00054"></a>00054                 tcp-&gt;MethodName = tcp_in-&gt;MethodName;
<a name="l00055"></a>00055                 tcp-&gt;ack = tcp_in-&gt;ack;
<a name="l00056"></a>00056                 tcp-&gt;source = tcp_in-&gt;source;
<a name="l00057"></a>00057                 tcp-&gt;dest = tcp_in-&gt;dest;
<a name="l00058"></a>00058                 tcp-&gt;seq_num = tcp_in-&gt;seq_num;
<a name="l00059"></a>00059 <span class="preprocessor">#endif</span>
<a name="l00060"></a>00060 <span class="preprocessor"></span>
<a name="l00061"></a>00061 <span class="preprocessor">#if 0</span>
<a name="l00062"></a>00062 <span class="preprocessor"></span>                <span class="keywordflow">if</span>(rn_msg-&gt;final_dest == 1010)
<a name="l00063"></a>00063                 {
<a name="l00064"></a>00064                         printf(<span class="stringliteral">"%d: tcp_in src = %d, tcp_in dst = %f\n"</span>,
<a name="l00065"></a>00065                                 lp-&gt;id,
<a name="l00066"></a>00066                                 tcp_in-&gt;source,
<a name="l00067"></a>00067                                 tcp_in-&gt;dest);
<a name="l00068"></a>00068                         printf(<span class="stringliteral">"%d: tcp src = %d, tcp dst = %f\n"</span>,
<a name="l00069"></a>00069                                 lp-&gt;id,
<a name="l00070"></a>00070                                 tcp-&gt;source,
<a name="l00071"></a>00071                                 tcp-&gt;dest);
<a name="l00072"></a>00072                         printf(<span class="stringliteral">"%d: %d \n"</span>, lp-&gt;id, rn_msg-&gt;final_dest);
<a name="l00073"></a>00073                 }
<a name="l00074"></a>00074 <span class="preprocessor">#endif</span>
<a name="l00075"></a>00075 <span class="preprocessor"></span>
<a name="l00076"></a>00076                 <span class="keywordflow">return</span>;
<a name="l00077"></a>00077         } <span class="keywordflow">else</span>
<a name="l00078"></a>00078         {
<a name="l00079"></a>00079                 dest = state-&gt;nbr[dest].id;
<a name="l00080"></a>00080         }
<a name="l00081"></a>00081 
<a name="l00082"></a>00082         <span class="comment">// transfer all membufs from inbound IP to outbound</span>
<a name="l00083"></a>00083         e-&gt;memory = lp-&gt;cur_event-&gt;memory;
<a name="l00084"></a>00084         lp-&gt;cur_event-&gt;memory = NULL;
<a name="l00085"></a>00085 
<a name="l00086"></a>00086         e = <a class="code" href="ospf-extern_8h.html#a6ee00330aee5b151785a47a706cf226">ospf_event_new</a>(state, tw_getlp(dest), lp);
<a name="l00087"></a>00087 
<a name="l00088"></a>00088         tw_printf(TW_LOC, <span class="stringliteral">"Check my OSPF ip pkt size 2! \n"</span>);
<a name="l00089"></a>00089         e = <a class="code" href="ospf-extern_8h.html#506873294c07e25082f4e8d2f631b522">ospf_event_send</a>(state, e, OSPF_IP, lp, 
<a name="l00090"></a>00090                                 <a class="code" href="rn-extern_8h.html#b5b97cf3985f38a87dcd07911d371a4a">rn_message_getsize</a>(tw_event_data(lp-&gt;cur_event)), 
<a name="l00091"></a>00091                                 NULL, state-&gt;area);
<a name="l00092"></a>00092 
<a name="l00093"></a>00093 <span class="preprocessor">#if 0</span>
<a name="l00094"></a>00094 <span class="preprocessor"></span>        m = tw_event_data(e);
<a name="l00095"></a>00095 
<a name="l00096"></a>00096         <span class="keywordflow">if</span>(<a class="code" href="rn-extern_8h.html#b586ebafc20ad652dd538635f5c816b0">rn_getmachine</a>(rn_msg-&gt;src)-&gt;type == <a class="code" href="rn-types_8h.html#c37ecf88c448feb116c70fd006409a84c617d746aac95241491603aa946adccc">c_host</a>)
<a name="l00097"></a>00097                 tcp_in = <a class="code" href="rn-extern_8h.html#86476e44643558d9a2008c976220a0a3">rn_message_data</a>(rn_msg);
<a name="l00098"></a>00098         <span class="keywordflow">else</span>
<a name="l00099"></a>00099                 tcp_in = ospf_util_data(msg);
<a name="l00100"></a>00100 
<a name="l00101"></a>00101         tcp = ospf_util_data(<a class="code" href="rn-extern_8h.html#86476e44643558d9a2008c976220a0a3">rn_message_data</a>(m));
<a name="l00102"></a>00102 
<a name="l00103"></a>00103         tcp-&gt;MethodName = tcp_in-&gt;MethodName;
<a name="l00104"></a>00104         tcp-&gt;ack = tcp_in-&gt;ack;
<a name="l00105"></a>00105         tcp-&gt;source = tcp_in-&gt;source;
<a name="l00106"></a>00106         tcp-&gt;dest = tcp_in-&gt;dest;
<a name="l00107"></a>00107         tcp-&gt;seq_num = tcp_in-&gt;seq_num;
<a name="l00108"></a>00108 <span class="preprocessor">#endif</span>
<a name="l00109"></a>00109 <span class="preprocessor"></span>
<a name="l00110"></a>00110 <span class="preprocessor">#if 0</span>
<a name="l00111"></a>00111 <span class="preprocessor"></span>        <span class="keywordflow">if</span>(rn_msg-&gt;final_dest == 1010)
<a name="l00112"></a>00112         {
<a name="l00113"></a>00113                 printf(<span class="stringliteral">"%d: tcp_in src = %d, tcp_in dst = %f\n"</span>,
<a name="l00114"></a>00114                                 lp-&gt;id, tcp_in-&gt;source, tcp_in-&gt;dest);
<a name="l00115"></a>00115                 printf(<span class="stringliteral">"%d: tcp src = %d, tcp dst = %f\n"</span>,
<a name="l00116"></a>00116                                 lp-&gt;id, tcp-&gt;source, tcp-&gt;dest);
<a name="l00117"></a>00117         }
<a name="l00118"></a>00118 <span class="preprocessor">#endif</span>
<a name="l00119"></a>00119 <span class="preprocessor"></span>
<a name="l00120"></a>00120         <span class="keywordflow">return</span>;
<a name="l00121"></a>00121 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="633eaa19a8d9455a45c44a1cfdb7144b"></a><!-- doxytag: member="ospf-extern.h::ospf_list_contains" ref="633eaa19a8d9455a45c44a1cfdb7144b" args="(char *list, int index)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ospf_list_contains           </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>list</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>index</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-neighbor-list_8c-source.html#l00022">22</a> of file <a class="el" href="ospf-neighbor-list_8c-source.html">ospf-neighbor-list.c</a>.</p>

<p>Referenced by <a class="el" href="ospf-ls_8c-source.html#l00243">ls_update_process()</a>, and <a class="el" href="ospf-ls_8c-source.html#l00026">process_lsa_recv()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00023"></a>00023 {
<a name="l00024"></a>00024         <span class="keywordflow">if</span>(list[index] == 1)
<a name="l00025"></a>00025                 <span class="keywordflow">return</span> TW_TRUE;
<a name="l00026"></a>00026 
<a name="l00027"></a>00027         <span class="keywordflow">return</span> TW_FALSE;
<a name="l00028"></a>00028 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="410670d4a1bcb8eb81f4f5e3a64f2447"></a><!-- doxytag: member="ospf-extern.h::ospf_list_free" ref="410670d4a1bcb8eb81f4f5e3a64f2447" args="(char *list, unsigned int *size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf_list_free           </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>list</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int *&nbsp;</td>
          <td class="paramname"> <em>size</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-neighbor-list_8c-source.html#l00004">4</a> of file <a class="el" href="ospf-neighbor-list_8c-source.html">ospf-neighbor-list.c</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00005"></a>00005 {
<a name="l00006"></a>00006         <span class="keywordtype">int</span>     i;
<a name="l00007"></a>00007 
<a name="l00008"></a>00008         <span class="keywordflow">for</span>(i = 0; i &lt; *size; i++)
<a name="l00009"></a>00009                 list[i] = 0;
<a name="l00010"></a>00010 
<a name="l00011"></a>00011         *size = 0;
<a name="l00012"></a>00012 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="b830c897232093436fa7594fa7b29db0"></a><!-- doxytag: member="ospf-extern.h::ospf_list_link" ref="b830c897232093436fa7594fa7b29db0" args="(char *list, int index, unsigned int *size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf_list_link           </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>list</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int *&nbsp;</td>
          <td class="paramname"> <em>size</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-neighbor-list_8c-source.html#l00031">31</a> of file <a class="el" href="ospf-neighbor-list_8c-source.html">ospf-neighbor-list.c</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00032"></a>00032 {
<a name="l00033"></a>00033         list[index] = 1;
<a name="l00034"></a>00034         (*size)++;
<a name="l00035"></a>00035 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="c0fa228f737ef79c5cabd264c61b2252"></a><!-- doxytag: member="ospf-extern.h::ospf_list_unlink" ref="c0fa228f737ef79c5cabd264c61b2252" args="(char *list, int index, unsigned int *size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf_list_unlink           </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>list</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int *&nbsp;</td>
          <td class="paramname"> <em>size</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-neighbor-list_8c-source.html#l00015">15</a> of file <a class="el" href="ospf-neighbor-list_8c-source.html">ospf-neighbor-list.c</a>.</p>

<p>Referenced by <a class="el" href="ospf-ls_8c-source.html#l00243">ls_update_process()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00016"></a>00016 {
<a name="l00017"></a>00017         list[index] = 0;
<a name="l00018"></a>00018         (*size)--;
<a name="l00019"></a>00019 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="097224ed856a311b649344949fe3a3d6"></a><!-- doxytag: member="ospf-extern.h::ospf_ls_request" ref="097224ed856a311b649344949fe3a3d6" args="(ospf_state *state, ospf_nbr *nbr, tw_lp *lp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf_ls_request           </td>
          <td>(</td>
          <td class="paramtype">ospf_state *&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ospf_nbr *&nbsp;</td>
          <td class="paramname"> <em>nbr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-ls_8c-source.html#l00335">335</a> of file <a class="el" href="ospf-ls_8c-source.html">ospf-ls.c</a>.</p>

<p>References <a class="el" href="ospf-global_8c-source.html#l00007">g_ospf_fd</a>, <a class="el" href="ospf-lsa_8c-source.html#l00247">getlsa()</a>, <a class="el" href="ospf-util_8c-source.html#l00004">ospf_event_new()</a>, <a class="el" href="ospf-util_8c-source.html#l00024">ospf_event_send()</a>, <a class="el" href="ospf-data-types_8h-source.html#l00008">OSPF_HEADER</a>, <a class="el" href="ospf-lsa_8c-source.html#l00231">ospf_lsa_age()</a>, <a class="el" href="ospf-data-types_8h-source.html#l00012">OSPF_LSA_UPDATE_HEADER</a>, <a class="el" href="ospf-neighbor-types_8h-source.html#l00008">OSPF_RETRANS_INTERVAL</a>, and <a class="el" href="ospf-timer_8c-source.html#l00029">ospf_timer_start()</a>.</p>

<p>Referenced by <a class="el" href="ospf-neighbor-state_8c-source.html#l00114">ospf_nbr_exchange_done()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00336"></a>00336 {
<a name="l00337"></a>00337         tw_event        *e;
<a name="l00338"></a>00338         tw_memory       *b;
<a name="l00339"></a>00339 
<a name="l00340"></a>00340         ospf_db_entry   *dbe;
<a name="l00341"></a>00341         ospf_db_entry   *out_dbe;
<a name="l00342"></a>00342         ospf_lsa        *lsa;
<a name="l00343"></a>00343 
<a name="l00344"></a>00344         <span class="keywordtype">int</span>      accum;
<a name="l00345"></a>00345         <span class="keywordtype">int</span>      i;
<a name="l00346"></a>00346 
<a name="l00347"></a>00347         <span class="keywordflow">if</span>(0 == nbr-&gt;nrequests)
<a name="l00348"></a>00348                 <span class="keywordflow">return</span>;
<a name="l00349"></a>00349 
<a name="l00350"></a>00350         e = <a class="code" href="ospf-extern_8h.html#a6ee00330aee5b151785a47a706cf226">ospf_event_new</a>(state, tw_getlp(nbr-&gt;id), 0.0, lp);
<a name="l00351"></a>00351 
<a name="l00352"></a>00352         accum = state-&gt;gstate-&gt;mtu - <a class="code" href="ospf-data-types_8h.html#0c4925cf967f3b302c24ce28570ca895">OSPF_HEADER</a>;
<a name="l00353"></a>00353 
<a name="l00354"></a>00354         <span class="keywordflow">for</span>(i = 0; accum &gt;= <a class="code" href="ospf-data-types_8h.html#bb42796d55aff837291811e19fbf63c1">OSPF_LSA_UPDATE_HEADER</a> &amp;&amp; i &lt; state-&gt;ar-&gt;nmachines; i++)
<a name="l00355"></a>00355         {
<a name="l00356"></a>00356                 <span class="keywordflow">if</span>(!nbr-&gt;requests[i])
<a name="l00357"></a>00357                         <span class="keywordflow">continue</span>;
<a name="l00358"></a>00358 
<a name="l00359"></a>00359                 printf(<span class="stringliteral">"%lld: Adding LSA %d to LS_REQUEST \n"</span>, lp-&gt;id, i);
<a name="l00360"></a>00360                 accum -= <a class="code" href="ospf-data-types_8h.html#bb42796d55aff837291811e19fbf63c1">OSPF_LSA_UPDATE_HEADER</a>;
<a name="l00361"></a>00361 
<a name="l00362"></a>00362                 dbe = &amp;nbr-&gt;router-&gt;db[i];
<a name="l00363"></a>00363                 lsa = <a class="code" href="ospf-extern_8h.html#9608d8ba29ae5cc559afe788cddade3f">getlsa</a>(state-&gt;m, dbe-&gt;lsa, i);
<a name="l00364"></a>00364 
<a name="l00365"></a>00365                 b = tw_memory_alloc(lp, <a class="code" href="ospf-extern_8h.html#884d66f70a693353a1894758d71deb99">g_ospf_fd</a>);
<a name="l00366"></a>00366                 out_dbe = tw_memory_data(b);
<a name="l00367"></a>00367 
<a name="l00368"></a>00368                 out_dbe-&gt;lsa = dbe-&gt;lsa;
<a name="l00369"></a>00369                 out_dbe-&gt;b.age = <a class="code" href="ospf-extern_8h.html#f2ab0671b22732e9743355c30ea903a4">ospf_lsa_age</a>(nbr-&gt;router, dbe, lp);
<a name="l00370"></a>00370                 out_dbe-&gt;b.entry = dbe-&gt;b.entry;
<a name="l00371"></a>00371 
<a name="l00372"></a>00372                 tw_event_memory_setfifo(e, b, <a class="code" href="ospf-extern_8h.html#884d66f70a693353a1894758d71deb99">g_ospf_fd</a>);
<a name="l00373"></a>00373         }
<a name="l00374"></a>00374 
<a name="l00375"></a>00375         <a class="code" href="ospf-extern_8h.html#506873294c07e25082f4e8d2f631b522">ospf_event_send</a>(nbr-&gt;router, e, OSPF_LS_REQUEST, lp, 
<a name="l00376"></a>00376                         state-&gt;gstate-&gt;mtu - accum - <a class="code" href="ospf-data-types_8h.html#0c4925cf967f3b302c24ce28570ca895">OSPF_HEADER</a>, 
<a name="l00377"></a>00377                         NULL, nbr-&gt;router-&gt;ar-&gt;id);
<a name="l00378"></a>00378 
<a name="l00379"></a>00379         printf(<span class="stringliteral">"%lld: sent LS_REQUEST to %d, ts %lf \n"</span>, 
<a name="l00380"></a>00380                 lp-&gt;id, nbr-&gt;id, e-&gt;recv_ts);
<a name="l00381"></a>00381 
<a name="l00382"></a>00382         <span class="comment">// cannot remember how I was going to eliminate this timer.</span>
<a name="l00383"></a>00383         <span class="comment">//nbr-&gt;next_retransmit = tw_now(lp) + OSPF_RETRANS_TIMEOUT;</span>
<a name="l00384"></a>00384 
<a name="l00385"></a>00385         nbr-&gt;retrans_timer = <a class="code" href="ospf-extern_8h.html#75e3fe5d4b90cd1e2ca417ac3d9518c7">ospf_timer_start</a>(nbr, 
<a name="l00386"></a>00386                                 nbr-&gt;retrans_timer, <a class="code" href="ospf-neighbor-types_8h.html#bafc366bfbfa370cb063b32c11092d5d">OSPF_RETRANS_INTERVAL</a>, 
<a name="l00387"></a>00387                                 OSPF_RETRANS_TIMEOUT, lp);
<a name="l00388"></a>00388 
<a name="l00389"></a>00389         <span class="keywordflow">if</span>(nbr-&gt;retrans_timer)
<a name="l00390"></a>00390                 printf(<span class="stringliteral">"%lld: Setting retransmit timer for %d at %lf \n"</span>,
<a name="l00391"></a>00391                         lp-&gt;id, nbr-&gt;id, nbr-&gt;retrans_timer-&gt;recv_ts);
<a name="l00392"></a>00392 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="8a8a0d0321d6cf2313d44d24f4367651"></a><!-- doxytag: member="ospf-extern.h::ospf_ls_request_recv" ref="8a8a0d0321d6cf2313d44d24f4367651" args="(ospf_state *, tw_bf *, ospf_nbr *, tw_lp *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf_ls_request_recv           </td>
          <td>(</td>
          <td class="paramtype">ospf_state *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_bf *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ospf_nbr *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-ls-request_8c-source.html#l00004">4</a> of file <a class="el" href="ospf-ls-request_8c-source.html">ospf-ls-request.c</a>.</p>

<p>References <a class="el" href="ospf-global_8c-source.html#l00007">g_ospf_fd</a>, <a class="el" href="ospf-lsa_8c-source.html#l00247">getlsa()</a>, <a class="el" href="ospf-util_8c-source.html#l00004">ospf_event_new()</a>, <a class="el" href="ospf-util_8c-source.html#l00024">ospf_event_send()</a>, <a class="el" href="ospf-data-types_8h-source.html#l00008">OSPF_HEADER</a>, and <a class="el" href="ospf-lsa_8c-source.html#l00231">ospf_lsa_age()</a>.</p>

<p>Referenced by <a class="el" href="ospf-router_8c-source.html#l00037">ospf_event_handler()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00005"></a>00005 {
<a name="l00006"></a>00006         tw_stime         ts;
<a name="l00007"></a>00007 
<a name="l00008"></a>00008         ospf_db_entry   *dbe;
<a name="l00009"></a>00009         ospf_db_entry   *in_dbe;
<a name="l00010"></a>00010         ospf_db_entry   *out_dbe;
<a name="l00011"></a>00011         ospf_lsa        *lsa;
<a name="l00012"></a>00012 
<a name="l00013"></a>00013         tw_memory               *buf;
<a name="l00014"></a>00014         tw_memory               *recv;
<a name="l00015"></a>00015         tw_memory               *send;
<a name="l00016"></a>00016 
<a name="l00017"></a>00017         <span class="keywordtype">int</span>              accum;
<a name="l00018"></a>00018 
<a name="l00019"></a>00019         <span class="keywordflow">if</span>(nbr-&gt;state &lt; ospf_nbr_exchange_st)
<a name="l00020"></a>00020                 <span class="keywordflow">return</span>;
<a name="l00021"></a>00021 
<a name="l00022"></a>00022         send = buf = NULL;
<a name="l00023"></a>00023         accum = <a class="code" href="ospf-data-types_8h.html#0c4925cf967f3b302c24ce28570ca895">OSPF_HEADER</a>;
<a name="l00024"></a>00024         recv = tw_event_memory_get(lp);
<a name="l00025"></a>00025         dbe = NULL;
<a name="l00026"></a>00026         ts = 0;
<a name="l00027"></a>00027 
<a name="l00028"></a>00028         <span class="keywordflow">while</span>(recv)
<a name="l00029"></a>00029         {
<a name="l00030"></a>00030                 in_dbe = tw_memory_data(recv);
<a name="l00031"></a>00031                 lsa = <a class="code" href="ospf-extern_8h.html#9608d8ba29ae5cc559afe788cddade3f">getlsa</a>(in_dbe-&gt;lsa, nbr-&gt;id);
<a name="l00032"></a>00032 
<a name="l00033"></a>00033                 dbe = &amp;state-&gt;db[lsa-&gt;adv_r];
<a name="l00034"></a>00034                 <span class="comment">//dbe = &amp;state-&gt;db[request-&gt;lsa[i].lsa-&gt;adv_r];</span>
<a name="l00035"></a>00035 
<a name="l00036"></a>00036                 accum +=  lsa-&gt;length;
<a name="l00037"></a>00037 
<a name="l00038"></a>00038                 <span class="keywordflow">if</span>(accum &gt; state-&gt;gstate-&gt;mtu || recv-&gt;next == NULL)
<a name="l00039"></a>00039                 {
<a name="l00040"></a>00040                         ts += LINK_TIME;
<a name="l00041"></a>00041                         <a class="code" href="ospf-extern_8h.html#506873294c07e25082f4e8d2f631b522">ospf_event_send</a>(state,
<a name="l00042"></a>00042                                         tw_getlp(nbr-&gt;id),
<a name="l00043"></a>00043                                         OSPF_LS_UPDATE,
<a name="l00044"></a>00044                                         lp,
<a name="l00045"></a>00045                                         ts,
<a name="l00046"></a>00046                                         send,
<a name="l00047"></a>00047                                         nbr-&gt;router-&gt;area);
<a name="l00048"></a>00048 
<a name="l00049"></a>00049                         accum = <a class="code" href="ospf-data-types_8h.html#0c4925cf967f3b302c24ce28570ca895">OSPF_HEADER</a>;
<a name="l00050"></a>00050                         send = NULL;
<a name="l00051"></a>00051                 }
<a name="l00052"></a>00052 
<a name="l00053"></a>00053                 <span class="keywordflow">if</span>(NULL == send)
<a name="l00054"></a>00054                         send = buf = tw_memory_alloc(lp, <a class="code" href="ospf-extern_8h.html#884d66f70a693353a1894758d71deb99">g_ospf_fd</a>);
<a name="l00055"></a>00055                 <span class="keywordflow">else</span>
<a name="l00056"></a>00056                         buf-&gt;next = tw_memory_alloc(lp, <a class="code" href="ospf-extern_8h.html#884d66f70a693353a1894758d71deb99">g_ospf_fd</a>);
<a name="l00057"></a>00057 
<a name="l00058"></a>00058                 out_dbe = buf-&gt;data;
<a name="l00059"></a>00059                 out_dbe-&gt;lsa = dbe-&gt;lsa;
<a name="l00060"></a>00060                 out_dbe-&gt;b.age = <a class="code" href="ospf-extern_8h.html#f2ab0671b22732e9743355c30ea903a4">ospf_lsa_age</a>(state, dbe, lp);
<a name="l00061"></a>00061 
<a name="l00062"></a>00062                 printf(<span class="stringliteral">"Sending LSA ages: old %d, new %d \n"</span>, dbe-&gt;b.age,
<a name="l00063"></a>00063                                         out_dbe-&gt;b.age);
<a name="l00064"></a>00064 
<a name="l00065"></a>00065                 buf = buf-&gt;next;
<a name="l00066"></a>00066                 tw_memory_free(lp, recv, <a class="code" href="ospf-extern_8h.html#884d66f70a693353a1894758d71deb99">g_ospf_fd</a>);
<a name="l00067"></a>00067                 recv = tw_event_memory_get(lp);
<a name="l00068"></a>00068         }
<a name="l00069"></a>00069 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="df9d36c7dc21c44e40a6c1a4dc9302ba"></a><!-- doxytag: member="ospf-extern.h::ospf_ls_update_recv" ref="df9d36c7dc21c44e40a6c1a4dc9302ba" args="(ospf_state *, tw_bf *, ospf_nbr *, tw_lp *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf_ls_update_recv           </td>
          <td>(</td>
          <td class="paramtype">ospf_state *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_bf *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ospf_nbr *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-ls_8c-source.html#l00274">274</a> of file <a class="el" href="ospf-ls_8c-source.html">ospf-ls.c</a>.</p>

<p>References <a class="el" href="ospf-global_8c-source.html#l00007">g_ospf_fd</a>, <a class="el" href="ospf-ls_8c-source.html#l00243">ls_update_process()</a>, <a class="el" href="ospf-lsa_8c-source.html#l00076">ospf_lsa_find()</a>, and <a class="el" href="ospf-ls_8c-source.html#l00026">process_lsa_recv()</a>.</p>

<p>Referenced by <a class="el" href="ospf-router_8c-source.html#l00037">ospf_event_handler()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00275"></a>00275 {
<a name="l00276"></a>00276         tw_memory       *b;
<a name="l00277"></a>00277 
<a name="l00278"></a>00278         ospf_db_entry   *dbe;
<a name="l00279"></a>00279 
<a name="l00280"></a>00280         <span class="keywordflow">if</span>(nbr-&gt;state == ospf_nbr_exchange_st || nbr-&gt;state == ospf_nbr_loading_st)
<a name="l00281"></a>00281         {
<a name="l00282"></a>00282                 <a class="code" href="ospf-ls_8c.html#7692f1d9f213ed733eebbb5384c5f8da">ls_update_process</a>(state, nbr, lp);
<a name="l00283"></a>00283                 <span class="keywordflow">return</span>;
<a name="l00284"></a>00284         }
<a name="l00285"></a>00285 
<a name="l00286"></a>00286         <span class="keywordflow">if</span> (nbr-&gt;state != ospf_nbr_full_st)
<a name="l00287"></a>00287         {
<a name="l00288"></a>00288                 printf(<span class="stringliteral">"%lld: dropping LS update, nbr is %d (down=%d) \n"</span>,
<a name="l00289"></a>00289                         lp-&gt;id, nbr-&gt;state, ospf_nbr_down_st);
<a name="l00290"></a>00290 
<a name="l00291"></a>00291                 
<a name="l00292"></a>00292                 <span class="keywordflow">while</span>(NULL != (b = tw_event_memory_get(lp)))
<a name="l00293"></a>00293                         tw_memory_free(lp, b, <a class="code" href="ospf-extern_8h.html#884d66f70a693353a1894758d71deb99">g_ospf_fd</a>);
<a name="l00294"></a>00294 
<a name="l00295"></a>00295                 <span class="keywordflow">return</span>;
<a name="l00296"></a>00296                 <span class="comment">//tw_error(TW_LOC, "Unhandled neigbor state!");</span>
<a name="l00297"></a>00297         }
<a name="l00298"></a>00298 
<a name="l00299"></a>00299         <span class="keywordflow">while</span>(NULL != (b = tw_event_memory_get(lp)))
<a name="l00300"></a>00300         {
<a name="l00301"></a>00301                 dbe = tw_memory_data(b);
<a name="l00302"></a>00302 
<a name="l00303"></a>00303                 <span class="comment">// normal flood, LSA correctly set already</span>
<a name="l00304"></a>00304                 <span class="keywordflow">if</span>(state-&gt;ar == nbr-&gt;ar)
<a name="l00305"></a>00305                 {
<a name="l00306"></a>00306                         <span class="comment">//lsa = getlsa(state-&gt;m, dbe-&gt;lsa, dbe-&gt;b.entry);</span>
<a name="l00307"></a>00307                 } <span class="keywordflow">else</span>
<a name="l00308"></a>00308                 {
<a name="l00309"></a>00309                         <span class="comment">// re-point dbe for my AREA</span>
<a name="l00310"></a>00310                         dbe-&gt;b.entry = dbe-&gt;b.entry - nbr-&gt;ar-&gt;nmachines + 
<a name="l00311"></a>00311                                                         state-&gt;ar-&gt;nmachines;
<a name="l00312"></a>00312                         dbe-&gt;lsa = <a class="code" href="ospf-extern_8h.html#4b5eb3d01fff0994efd88f1f1a305c6f">ospf_lsa_find</a>(state, nbr, dbe-&gt;b.entry, lp);
<a name="l00313"></a>00313                 }
<a name="l00314"></a>00314 
<a name="l00315"></a>00315 <span class="preprocessor">#if VERIFY_LS</span>
<a name="l00316"></a>00316 <span class="preprocessor"></span>                printf(<span class="stringliteral">"\tprocess LSA %d from nbr %d \n"</span>, 
<a name="l00317"></a>00317                         dbe-&gt;b.entry - state-&gt;ar-&gt;nmachines, nbr-&gt;id);
<a name="l00318"></a>00318 <span class="preprocessor">#endif</span>
<a name="l00319"></a>00319 <span class="preprocessor"></span>
<a name="l00320"></a>00320                 <a class="code" href="ospf-ls_8c.html#a4a1ab5a817f8b3a1fb97f385b7ea456">process_lsa_recv</a>(state, nbr, dbe, lp);
<a name="l00321"></a>00321                 tw_memory_free(lp, b, <a class="code" href="ospf-extern_8h.html#884d66f70a693353a1894758d71deb99">g_ospf_fd</a>);
<a name="l00322"></a>00322         }
<a name="l00323"></a>00323 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="f2ab0671b22732e9743355c30ea903a4"></a><!-- doxytag: member="ospf-extern.h::ospf_lsa_age" ref="f2ab0671b22732e9743355c30ea903a4" args="(ospf_state *, ospf_db_entry *dbe, tw_lp *lp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int ospf_lsa_age           </td>
          <td>(</td>
          <td class="paramtype">ospf_state *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ospf_db_entry *&nbsp;</td>
          <td class="paramname"> <em>dbe</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-lsa_8c-source.html#l00231">231</a> of file <a class="el" href="ospf-lsa_8c-source.html">ospf-lsa.c</a>.</p>

<p>References <a class="el" href="ospf-global_8c-source.html#l00021">OSPF_LSA_MAX_AGE</a>, and <a class="el" href="ospf-router-debug_8c-source.html#l00027">x</a>.</p>

<p>Referenced by <a class="el" href="ospf-dd_8c-source.html#l00062">dd_exchange()</a>, <a class="el" href="ospf-timer-aging_8c-source.html#l00024">ospf_aging_timer_set()</a>, <a class="el" href="ospf-database_8c-source.html#l00288">ospf_db_update()</a>, <a class="el" href="ospf-ls_8c-source.html#l00335">ospf_ls_request()</a>, <a class="el" href="ospf-ls-request_8c-source.html#l00004">ospf_ls_request_recv()</a>, <a class="el" href="ospf-lsa_8c-source.html#l00793">ospf_lsa_isnewer()</a>, <a class="el" href="ospf-lsa_8c-source.html#l00646">ospf_lsa_start_flood()</a>, and <a class="el" href="ospf-ls_8c-source.html#l00026">process_lsa_recv()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00232"></a>00232 {
<a name="l00233"></a>00233         <span class="keywordtype">int</span>     <a class="code" href="ospf-router-debug_8c.html#6150e0515f7202e2fb518f7206ed97dc">x</a>;
<a name="l00234"></a>00234 
<a name="l00235"></a>00235         <span class="keywordflow">if</span>(dbe-&gt;b.free || dbe-&gt;b.age == <a class="code" href="ospf-extern_8h.html#354846699ca7e45e6f42d17268d8fac2">OSPF_LSA_MAX_AGE</a>)
<a name="l00236"></a>00236                 <span class="keywordflow">return</span> <a class="code" href="ospf-extern_8h.html#354846699ca7e45e6f42d17268d8fac2">OSPF_LSA_MAX_AGE</a>;
<a name="l00237"></a>00237 
<a name="l00238"></a>00238         <span class="keywordflow">if</span>((tw_now(lp) - state-&gt;db_last_ts) &lt; 4)
<a name="l00239"></a>00239                 <span class="keywordflow">return</span> dbe-&gt;b.age;
<a name="l00240"></a>00240 
<a name="l00241"></a>00241         x = (floor((tw_now(lp) - state-&gt;db_last_ts) / 4) * 4) + dbe-&gt;b.age;
<a name="l00242"></a>00242 
<a name="l00243"></a>00243         return (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>) x;
<a name="l00244"></a>00244 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="5e8fbd3b9d041de4eb34b5beb7b19221"></a><!-- doxytag: member="ospf-extern.h::ospf_lsa_allocate" ref="5e8fbd3b9d041de4eb34b5beb7b19221" args="(tw_lp *lp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tw_memory* ospf_lsa_allocate           </td>
          <td>(</td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-lsa_8c-source.html#l00387">387</a> of file <a class="el" href="ospf-lsa_8c-source.html">ospf-lsa.c</a>.</p>

<p>References <a class="el" href="ospf-global_8c-source.html#l00008">g_ospf_lsa_fd</a>.</p>

<p>Referenced by <a class="el" href="bgp-ospf_8c-source.html#l00203">bgp_lsa_find()</a>, <a class="el" href="ospf-lsa_8c-source.html#l00278">lsa_create()</a>, and <a class="el" href="ospf-lsa_8c-source.html#l00076">ospf_lsa_find()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00388"></a>00388 {
<a name="l00389"></a>00389         tw_memory       *b;
<a name="l00390"></a>00390 
<a name="l00391"></a>00391         ospf_lsa        *lsa;
<a name="l00392"></a>00392 
<a name="l00393"></a>00393         <span class="comment">//tw_printf(TW_LOC, "%d: Allocating a new LSA! \n", lp-&gt;id);</span>
<a name="l00394"></a>00394 
<a name="l00395"></a>00395         b = tw_memory_alloc(lp, <a class="code" href="ospf-extern_8h.html#76d058140af721aad20439b05b18e172">g_ospf_lsa_fd</a>);
<a name="l00396"></a>00396 
<a name="l00397"></a>00397         <span class="keywordflow">if</span>(!b) 
<a name="l00398"></a>00398                 tw_error(TW_LOC, <span class="stringliteral">"Could not dynamically allocate any new LSAs! \n"</span>);
<a name="l00399"></a>00399 
<a name="l00400"></a>00400         lsa = tw_memory_data(b);
<a name="l00401"></a>00401 
<a name="l00402"></a>00402         <span class="keywordflow">return</span>  b;
<a name="l00403"></a>00403 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="5cbd06df0703e6d22521d26dd0b53f29"></a><!-- doxytag: member="ospf-extern.h::ospf_lsa_compare" ref="5cbd06df0703e6d22521d26dd0b53f29" args="(ospf_nbr *n, ospf_lsa *lsa)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ospf_lsa* ospf_lsa_compare           </td>
          <td>(</td>
          <td class="paramtype">ospf_nbr *&nbsp;</td>
          <td class="paramname"> <em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ospf_lsa *&nbsp;</td>
          <td class="paramname"> <em>lsa</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="90f786d8f758711eb5797ff19ca0097b"></a><!-- doxytag: member="ospf-extern.h::ospf_lsa_create" ref="90f786d8f758711eb5797ff19ca0097b" args="(ospf_state *state, ospf_nbr *, int lsa_index, tw_lp *lp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf_lsa_create           </td>
          <td>(</td>
          <td class="paramtype">ospf_state *&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ospf_nbr *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>lsa_index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-lsa_8c-source.html#l00527">527</a> of file <a class="el" href="ospf-lsa_8c-source.html">ospf-lsa.c</a>.</p>

<p>References <a class="el" href="ospf-lsa_8c-source.html#l00247">getlsa()</a>, <a class="el" href="ospf-timer-aging_8c-source.html#l00024">ospf_aging_timer_set()</a>, <a class="el" href="ospf-database_8c-source.html#l00366">ospf_db_insert()</a>, <a class="el" href="ospf-database_8c-source.html#l00380">ospf_db_remove()</a>, <a class="el" href="ospf-lsa_8c-source.html#l00030">ospf_lsa_equals()</a>, <a class="el" href="ospf-lsa_8c-source.html#l00076">ospf_lsa_find()</a>, <a class="el" href="ospf-lsa_8c-source.html#l00731">ospf_lsa_flood()</a>, <a class="el" href="ospf-global_8c-source.html#l00021">OSPF_LSA_MAX_AGE</a>, <a class="el" href="ospf-data-types_8h-source.html#l00017">OSPF_MAX_LSA_SEQNUM</a>, <a class="el" href="rn-machine_8c-source.html#l00022">rn_getarea()</a>, <a class="el" href="rn-link_8c-source.html#l00017">rn_getlink()</a>, <a class="el" href="rn-machine_8c-source.html#l00004">rn_getmachine()</a>, and <a class="el" href="rn-routing_8c-source.html#l00007">rn_route()</a>.</p>

<p>Referenced by <a class="el" href="bgp-ospf_8c-source.html#l00070">bgp_ospf_update()</a>, <a class="el" href="ospf-lsa_8c-source.html#l00850">ospf_lsa_flush()</a>, <a class="el" href="ospf-neighbor-state_8c-source.html#l00114">ospf_nbr_exchange_done()</a>, <a class="el" href="ospf-neighbor-state_8c-source.html#l00178">ospf_nbr_inactivity_timer()</a>, and <a class="el" href="ospf-ls_8c-source.html#l00026">process_lsa_recv()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00528"></a>00528 {
<a name="l00529"></a>00529         rn_link *l = NULL;
<a name="l00530"></a>00530 
<a name="l00531"></a>00531         ospf_lsa        *old_lsa;
<a name="l00532"></a>00532         ospf_lsa        *lsa;
<a name="l00533"></a>00533         ospf_db_entry   *dbe;
<a name="l00534"></a>00534         <span class="keywordtype">int</span>              wrapping = 0;
<a name="l00535"></a>00535         <span class="keywordtype">int</span>              index;
<a name="l00536"></a>00536 
<a name="l00537"></a>00537 <span class="preprocessor">#if VERIFY_OSPF_CONVERGENCE</span>
<a name="l00538"></a>00538 <span class="preprocessor"></span>        <span class="keywordtype">int</span>              i;
<a name="l00539"></a>00539 <span class="preprocessor">#endif</span>
<a name="l00540"></a>00540 <span class="preprocessor"></span>
<a name="l00541"></a>00541         index = <a class="code" href="ospf-extern_8h.html#4b5eb3d01fff0994efd88f1f1a305c6f">ospf_lsa_find</a>(state, nbr, entry, lp);
<a name="l00542"></a>00542 
<a name="l00543"></a>00543         dbe = &amp;state-&gt;db[entry];
<a name="l00544"></a>00544         lsa = <a class="code" href="ospf-extern_8h.html#9608d8ba29ae5cc559afe788cddade3f">getlsa</a>(state-&gt;m, index, entry);
<a name="l00545"></a>00545         old_lsa = <a class="code" href="ospf-extern_8h.html#9608d8ba29ae5cc559afe788cddade3f">getlsa</a>(state-&gt;m, dbe-&gt;lsa, entry);
<a name="l00546"></a>00546 
<a name="l00547"></a>00547         <span class="comment">// If LSA links drops to zero, flush LSA from network</span>
<a name="l00548"></a>00548         <span class="keywordflow">if</span>(lsa-&gt;links.size == 0)
<a name="l00549"></a>00549         {
<a name="l00550"></a>00550                 <span class="keywordflow">if</span>(dbe-&gt;b.free || <a class="code" href="ospf-lsa_8c.html#2d9cdd72d335c75ab536de1da2898b5a">ospf_lsa_equals</a>(old_lsa, lsa) == TW_TRUE)
<a name="l00551"></a>00551                         <span class="keywordflow">return</span>;
<a name="l00552"></a>00552 
<a name="l00553"></a>00553 <span class="preprocessor">#if VERIFY_LS</span>
<a name="l00554"></a>00554 <span class="preprocessor"></span>                printf(<span class="stringliteral">"%ld: flushing LSA %d: no links \n"</span>,
<a name="l00555"></a>00555                         lp-&gt;id, lsa-&gt;id);
<a name="l00556"></a>00556 <span class="preprocessor">#endif</span>
<a name="l00557"></a>00557 <span class="preprocessor"></span>
<a name="l00558"></a>00558                 dbe-&gt;lsa = index;
<a name="l00559"></a>00559                 <a class="code" href="ospf-database_8c.html#32f38a24ced7e66d2a7c106ae0c7cbf6">ospf_db_remove</a>(state, entry, lp);
<a name="l00560"></a>00560 
<a name="l00561"></a>00561                 <a class="code" href="ospf-extern_8h.html#51de1d77d40f0604d5a65e902ceda57b">ospf_lsa_flood</a>(state, dbe, nbr-&gt;id, lp); 
<a name="l00562"></a>00562 
<a name="l00563"></a>00563                 <span class="keywordflow">return</span>;
<a name="l00564"></a>00564         }
<a name="l00565"></a>00565 
<a name="l00566"></a>00566         <span class="comment">// Highest adv_r creates LSAs</span>
<a name="l00567"></a>00567         <span class="keywordflow">if</span>(old_lsa-&gt;adv_r != 0xffffffff &amp;&amp; 
<a name="l00568"></a>00568            old_lsa-&gt;adv_r &gt; lsa-&gt;adv_r &amp;&amp;
<a name="l00569"></a>00569            <a class="code" href="rn-extern_8h.html#d45bc39e5a89bce656786b571acb1ae8">rn_getarea</a>(<a class="code" href="rn-extern_8h.html#b586ebafc20ad652dd538635f5c816b0">rn_getmachine</a>(old_lsa-&gt;adv_r)) != <a class="code" href="rn-extern_8h.html#d45bc39e5a89bce656786b571acb1ae8">rn_getarea</a>(<a class="code" href="rn-extern_8h.html#b586ebafc20ad652dd538635f5c816b0">rn_getmachine</a>(lsa-&gt;adv_r)))
<a name="l00570"></a>00570                 <span class="keywordflow">return</span>;
<a name="l00571"></a>00571 
<a name="l00572"></a>00572         <span class="keywordflow">if</span>(state-&gt;lsa_seqnum == <a class="code" href="ospf-data-types_8h.html#c21137f66cab7f101c674b10fb13bdd0">OSPF_MAX_LSA_SEQNUM</a>)
<a name="l00573"></a>00573         {
<a name="l00574"></a>00574                 <span class="keywordflow">if</span>(state-&gt;lsa_wrapping)
<a name="l00575"></a>00575                 {
<a name="l00576"></a>00576                         tw_error(TW_LOC, <span class="stringliteral">"Not sure what to do here now!"</span>);
<a name="l00577"></a>00577                         <span class="keywordflow">return</span>;
<a name="l00578"></a>00578                 } <span class="keywordflow">else</span>
<a name="l00579"></a>00579                 {
<a name="l00580"></a>00580                         dbe-&gt;seqnum = <a class="code" href="ospf-data-types_8h.html#c21137f66cab7f101c674b10fb13bdd0">OSPF_MAX_LSA_SEQNUM</a>;
<a name="l00581"></a>00581                         wrapping = 1;
<a name="l00582"></a>00582                 }
<a name="l00583"></a>00583         } <span class="keywordflow">else</span>
<a name="l00584"></a>00584         {
<a name="l00585"></a>00585                 <span class="keywordflow">if</span>(dbe-&gt;b.entry &lt; state-&gt;ar-&gt;nmachines)
<a name="l00586"></a>00586                         dbe-&gt;seqnum = ++state-&gt;lsa_seqnum;
<a name="l00587"></a>00587         }
<a name="l00588"></a>00588 
<a name="l00589"></a>00589         dbe-&gt;cause_bgp = 0;
<a name="l00590"></a>00590         <span class="comment">//dbe-&gt;cause_ospf = 1;</span>
<a name="l00591"></a>00591         <span class="comment">//state-&gt;stats-&gt;s_cause_bgp++;</span>
<a name="l00592"></a>00592 
<a name="l00593"></a>00593         <span class="keywordflow">if</span>(dbe-&gt;b.free || TW_FALSE == <a class="code" href="ospf-lsa_8c.html#2d9cdd72d335c75ab536de1da2898b5a">ospf_lsa_equals</a>(old_lsa,lsa) || 
<a name="l00594"></a>00594            state-&gt;lsa_seqnum &gt; <a class="code" href="ospf-data-types_8h.html#c21137f66cab7f101c674b10fb13bdd0">OSPF_MAX_LSA_SEQNUM</a>)
<a name="l00595"></a>00595         {
<a name="l00596"></a>00596                 <span class="keywordflow">if</span>(!lsa-&gt;links.size)
<a name="l00597"></a>00597                         tw_error(TW_LOC, <span class="stringliteral">"Insert LSA with no links into DB!"</span>);
<a name="l00598"></a>00598 
<a name="l00599"></a>00599                 dbe = <a class="code" href="ospf-database_8c.html#5447c8aa90db3e869dd09f043e9bfe6f">ospf_db_insert</a>(state, index, dbe, lp);
<a name="l00600"></a>00600                 l = <a class="code" href="rn-extern_8h.html#d7173e076af48912ba761e8ef0cc1b22">rn_getlink</a>(<a class="code" href="rn-extern_8h.html#b586ebafc20ad652dd538635f5c816b0">rn_getmachine</a>(lp-&gt;id), nbr-&gt;id);
<a name="l00601"></a>00601 
<a name="l00602"></a>00602 <span class="preprocessor">#if VERIFY_OSPF_CONVERGENCE</span>
<a name="l00603"></a>00603 <span class="preprocessor"></span>                lsa-&gt;count = 0;
<a name="l00604"></a>00604                 <span class="keywordflow">for</span>(i = 0; i &lt; state-&gt;ar-&gt;nmachines; i++)
<a name="l00605"></a>00605                 {
<a name="l00606"></a>00606                         <span class="keywordflow">if</span>(<a class="code" href="rn-extern_8h.html#8890679c55545bd36e770b118a920b57">rn_route</a>(state-&gt;m, i) == -1)
<a name="l00607"></a>00607                                 <span class="keywordflow">continue</span>;
<a name="l00608"></a>00608 
<a name="l00609"></a>00609                         <span class="keywordtype">int</span> int_id = state-&gt;nbr[<a class="code" href="rn-extern_8h.html#8890679c55545bd36e770b118a920b57">rn_route</a>(state-&gt;m, i)].id;
<a name="l00610"></a>00610 
<a name="l00611"></a>00611                         <span class="keywordflow">if</span>(int_id != -1 &amp;&amp;
<a name="l00612"></a>00612                                 int_id != l-&gt;wire-&gt;id &amp;&amp;
<a name="l00613"></a>00613                                 i != lp-&gt;id)
<a name="l00614"></a>00614                         {
<a name="l00615"></a>00615                                 lsa-&gt;count++;
<a name="l00616"></a>00616                         }
<a name="l00617"></a>00617                 }
<a name="l00618"></a>00618 
<a name="l00619"></a>00619                 lsa-&gt;start = l-&gt;last_status;
<a name="l00620"></a>00620 
<a name="l00621"></a>00621                 printf(<span class="stringliteral">"%ld: lsa start time: %f hop count %d \n"</span>, 
<a name="l00622"></a>00622                         lp-&gt;id, lsa-&gt;start, lsa-&gt;count);
<a name="l00623"></a>00623 <span class="preprocessor">#endif</span>
<a name="l00624"></a>00624 <span class="preprocessor"></span>        }
<a name="l00625"></a>00625 
<a name="l00626"></a>00626         <span class="keywordflow">if</span> (wrapping)
<a name="l00627"></a>00627         {
<a name="l00628"></a>00628                 tw_error(TW_LOC, <span class="stringliteral">"I did not expect to be here!"</span>);
<a name="l00629"></a>00629 
<a name="l00630"></a>00630                 <span class="comment">/*</span>
<a name="l00631"></a>00631 <span class="comment">                 * Prematurely age the LSA -- have to reset the aging timer</span>
<a name="l00632"></a>00632 <span class="comment">                 * so that this LSA can be handled at the next LSA timer</span>
<a name="l00633"></a>00633 <span class="comment">                 * interval</span>
<a name="l00634"></a>00634 <span class="comment">                 */</span>
<a name="l00635"></a>00635                 <a class="code" href="ospf-extern_8h.html#0ff2c1e877d460d2950c2228447c2a4d">ospf_aging_timer_set</a>(state, &amp;state-&gt;db[lsa-&gt;id], 
<a name="l00636"></a>00636                                                         <a class="code" href="ospf-extern_8h.html#354846699ca7e45e6f42d17268d8fac2">OSPF_LSA_MAX_AGE</a>, lp);
<a name="l00637"></a>00637                 <a class="code" href="ospf-extern_8h.html#51de1d77d40f0604d5a65e902ceda57b">ospf_lsa_flood</a>(state, dbe, lp-&gt;id, lp);
<a name="l00638"></a>00638                 state-&gt;lsa_wrapping = 1;
<a name="l00639"></a>00639         } <span class="keywordflow">else</span>
<a name="l00640"></a>00640         {
<a name="l00641"></a>00641                 <a class="code" href="ospf-extern_8h.html#51de1d77d40f0604d5a65e902ceda57b">ospf_lsa_flood</a>(state, dbe, nbr-&gt;id, lp); 
<a name="l00642"></a>00642         }
<a name="l00643"></a>00643 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="4b5eb3d01fff0994efd88f1f1a305c6f"></a><!-- doxytag: member="ospf-extern.h::ospf_lsa_find" ref="4b5eb3d01fff0994efd88f1f1a305c6f" args="(ospf_state *state, ospf_nbr *, int id, tw_lp *lp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ospf_lsa_find           </td>
          <td>(</td>
          <td class="paramtype">ospf_state *&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ospf_nbr *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-lsa_8c-source.html#l00076">76</a> of file <a class="el" href="ospf-lsa_8c-source.html">ospf-lsa.c</a>.</p>

<p>References <a class="el" href="ospf-global_8c-source.html#l00010">g_ospf_ll_fd</a>, <a class="el" href="ospf-neighbor_8c-source.html#l00004">ospf_getnbr()</a>, <a class="el" href="ospf-lsa_8c-source.html#l00387">ospf_lsa_allocate()</a>, <a class="el" href="ospf-lsa_8c-source.html#l00406">ospf_lsa_link_allocate()</a>, and <a class="el" href="rn-link_8c-source.html#l00017">rn_getlink()</a>.</p>

<p>Referenced by <a class="el" href="ospf-database_8c-source.html#l00393">ospf_db_init()</a>, <a class="el" href="ospf-experiments_8c-source.html#l00041">ospf_experiment_weights()</a>, <a class="el" href="ospf-ls_8c-source.html#l00274">ospf_ls_update_recv()</a>, and <a class="el" href="ospf-lsa_8c-source.html#l00527">ospf_lsa_create()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00077"></a>00077 {
<a name="l00078"></a>00078         tw_memory       *b;
<a name="l00079"></a>00079         tw_memory       *b1;
<a name="l00080"></a>00080 
<a name="l00081"></a>00081         ospf_lsa_link   *ll;
<a name="l00082"></a>00082         ospf_lsa        *lsa;
<a name="l00083"></a>00083         ospf_nbr        *nbr;
<a name="l00084"></a>00084 
<a name="l00085"></a>00085         <span class="keywordtype">int</span>              index;
<a name="l00086"></a>00086         <span class="keywordtype">int</span>              nlinks;
<a name="l00087"></a>00087         <span class="keywordtype">int</span>              x_id;
<a name="l00088"></a>00088         <span class="keywordtype">int</span>              i;
<a name="l00089"></a>00089 
<a name="l00090"></a>00090         nlinks = 0;
<a name="l00091"></a>00091         nbr = NULL;
<a name="l00092"></a>00092 
<a name="l00093"></a>00093         <span class="keywordflow">if</span>(id &lt; state-&gt;ar-&gt;nmachines)
<a name="l00094"></a>00094                 x_id = state-&gt;ar-&gt;id;
<a name="l00095"></a>00095         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(id &lt; state-&gt;ar-&gt;nmachines + state-&gt;ar-&gt;as-&gt;nareas)
<a name="l00096"></a>00096         {
<a name="l00097"></a>00097                 x_id = <span class="keywordtype">id</span> - state-&gt;ar-&gt;nmachines + state-&gt;ar-&gt;as-&gt;low;
<a name="l00098"></a>00098 
<a name="l00099"></a>00099                 <span class="keywordflow">if</span>(n-&gt;ar-&gt;id != x_id)
<a name="l00100"></a>00100                         nlinks = 1;
<a name="l00101"></a>00101         } <span class="keywordflow">else</span>
<a name="l00102"></a>00102                 x_id = <span class="keywordtype">id</span> - state-&gt;ar-&gt;nmachines - state-&gt;ar-&gt;as-&gt;nareas;
<a name="l00103"></a>00103 
<a name="l00104"></a>00104         <span class="comment">// Need to get nlinks FIRST, since # LSA links can be &lt; # current</span>
<a name="l00105"></a>00105         <span class="comment">// go by neighbor states, not topology, unless AS external LSA</span>
<a name="l00106"></a>00106         <span class="keywordflow">for</span>(i = 0; i &lt; state-&gt;n_interfaces; i++)
<a name="l00107"></a>00107         {
<a name="l00108"></a>00108                 nbr = &amp;state-&gt;nbr[i];
<a name="l00109"></a>00109 
<a name="l00110"></a>00110                 <span class="keywordflow">if</span>(nbr-&gt;state != ospf_nbr_full_st || 
<a name="l00111"></a>00111                    nbr-&gt;istate != ospf_int_point_to_point_st)
<a name="l00112"></a>00112                         <span class="keywordflow">continue</span>;
<a name="l00113"></a>00113 
<a name="l00114"></a>00114                 <span class="comment">// If router_lsa, only count links within my area</span>
<a name="l00115"></a>00115                 <span class="keywordflow">if</span>(id &lt; state-&gt;ar-&gt;nmachines)
<a name="l00116"></a>00116                 {
<a name="l00117"></a>00117                         <span class="keywordflow">if</span>(nbr-&gt;ar != state-&gt;ar)
<a name="l00118"></a>00118                                 nlinks++;
<a name="l00119"></a>00119                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<span class="keywordtype">id</span> &gt;= state-&gt;ar-&gt;nmachines + state-&gt;ar-&gt;as-&gt;nareas)
<a name="l00120"></a>00120                 {
<a name="l00121"></a>00121                         <span class="comment">// AS ext LSA, count link if to nbr AS == id's AS</span>
<a name="l00122"></a>00122 
<a name="l00123"></a>00123                         <span class="comment">// If AS ext LSA, only thing I can do is count the</span>
<a name="l00124"></a>00124                         <span class="comment">// nbr which sent me the LSA</span>
<a name="l00125"></a>00125                         nlinks = 1;
<a name="l00126"></a>00126                         <span class="keywordflow">break</span>;
<a name="l00127"></a>00127 
<a name="l00128"></a>00128                         <span class="keywordflow">if</span>(nbr-&gt;ar-&gt;as-&gt;id == x_id)
<a name="l00129"></a>00129                                 nlinks++;
<a name="l00130"></a>00130                 } <span class="keywordflow">else</span>
<a name="l00131"></a>00131                 {
<a name="l00132"></a>00132 <span class="comment">/*</span>
<a name="l00133"></a>00133 <span class="comment">                        if(nbr-&gt;ar-&gt;id == x_id)</span>
<a name="l00134"></a>00134 <span class="comment">                        {</span>
<a name="l00135"></a>00135 <span class="comment">                                nlinks = 1;</span>
<a name="l00136"></a>00136 <span class="comment">                                break;</span>
<a name="l00137"></a>00137 <span class="comment">                        }</span>
<a name="l00138"></a>00138 <span class="comment">*/</span>
<a name="l00139"></a>00139                         <span class="comment">// Summary LSA, count link if to nbr Area == id's Area</span>
<a name="l00140"></a>00140                         <span class="keywordflow">if</span>(nbr-&gt;ar-&gt;id == x_id)
<a name="l00141"></a>00141                                 nlinks++;
<a name="l00142"></a>00142                 }
<a name="l00143"></a>00143         }
<a name="l00144"></a>00144 
<a name="l00145"></a>00145         b = state-&gt;ar-&gt;g_ospf_lsa[id]; 
<a name="l00146"></a>00146         lsa = tw_memory_data(b);
<a name="l00147"></a>00147         <span class="keywordflow">for</span>(index = 0; NULL != lsa; index++)
<a name="l00148"></a>00148         {
<a name="l00149"></a>00149                 <span class="keywordflow">if</span>(lsa-&gt;links.size == nlinks &amp;&amp; lsa-&gt;adv_r == lp-&gt;id)
<a name="l00150"></a>00150                 {
<a name="l00151"></a>00151                         <span class="keywordflow">if</span>(nlinks == 0)
<a name="l00152"></a>00152                         {
<a name="l00153"></a>00153                                 i = nlinks;
<a name="l00154"></a>00154                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<span class="keywordtype">id</span> &gt;= state-&gt;ar-&gt;nmachines + state-&gt;ar-&gt;as-&gt;nareas)
<a name="l00155"></a>00155                         {
<a name="l00156"></a>00156                                 ll = tw_memory_data(lsa-&gt;links.head);
<a name="l00157"></a>00157 
<a name="l00158"></a>00158                                 <span class="keywordflow">if</span>(n-&gt;id == ll-&gt;dst)
<a name="l00159"></a>00159                                         i = nlinks;
<a name="l00160"></a>00160                         } <span class="keywordflow">else</span>
<a name="l00161"></a>00161                         {
<a name="l00162"></a>00162                                 <span class="comment">// foreach LSA link: if is up, good, otherwise, not the LSA!</span>
<a name="l00163"></a>00163                                 b1 = lsa-&gt;links.head;
<a name="l00164"></a>00164                                 <span class="keywordflow">for</span>(i = 0; i &lt; lsa-&gt;links.size; i++, b1 = b1-&gt;next)
<a name="l00165"></a>00165                                 {
<a name="l00166"></a>00166                                         ll = tw_memory_data(b1);
<a name="l00167"></a>00167                                         nbr = <a class="code" href="ospf-extern_8h.html#e1d40f1eb2223baa1a8b3d7d7b7b3d46">ospf_getnbr</a>(state, ll-&gt;dst);
<a name="l00168"></a>00168         
<a name="l00169"></a>00169                                         <span class="keywordflow">if</span>(nbr-&gt;state != ospf_nbr_full_st)
<a name="l00170"></a>00170                                                 <span class="keywordflow">break</span>;
<a name="l00171"></a>00171                                 }
<a name="l00172"></a>00172                         }
<a name="l00173"></a>00173 
<a name="l00174"></a>00174                         <span class="keywordflow">if</span>(i == nlinks)
<a name="l00175"></a>00175                                 <span class="keywordflow">return</span> index;
<a name="l00176"></a>00176                 }
<a name="l00177"></a>00177 
<a name="l00178"></a>00178                 <span class="keywordflow">if</span>(lsa-&gt;next == NULL)
<a name="l00179"></a>00179                         <span class="keywordflow">break</span>;
<a name="l00180"></a>00180 
<a name="l00181"></a>00181                 b = lsa-&gt;next;
<a name="l00182"></a>00182                 lsa = tw_memory_data(b);
<a name="l00183"></a>00183         }
<a name="l00184"></a>00184 
<a name="l00185"></a>00185         <span class="keywordflow">if</span>(lsa-&gt;next != NULL)
<a name="l00186"></a>00186                 tw_error(TW_LOC, <span class="stringliteral">"Not at end of LSA list!"</span>);
<a name="l00187"></a>00187 
<a name="l00188"></a>00188         index++;
<a name="l00189"></a>00189         lsa-&gt;next = <a class="code" href="ospf-extern_8h.html#5e8fbd3b9d041de4eb34b5beb7b19221">ospf_lsa_allocate</a>(lp);
<a name="l00190"></a>00190         lsa = tw_memory_data(lsa-&gt;next);
<a name="l00191"></a>00191 
<a name="l00192"></a>00192         lsa-&gt;id = id;
<a name="l00193"></a>00193         lsa-&gt;adv_r = lp-&gt;id;
<a name="l00194"></a>00194 
<a name="l00195"></a>00195         <span class="keywordflow">if</span>(id &lt; state-&gt;ar-&gt;nmachines)
<a name="l00196"></a>00196         {
<a name="l00197"></a>00197                 lsa-&gt;type = ospf_lsa_router;
<a name="l00198"></a>00198                 <a class="code" href="ospf-extern_8h.html#3eb1ae7a66c4c936b5971afb65492d09">ospf_lsa_link_allocate</a>(state, lsa, lp);
<a name="l00199"></a>00199 
<a name="l00200"></a>00200                 <span class="keywordflow">return</span> index;
<a name="l00201"></a>00201         } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(id &lt; state-&gt;ar-&gt;nmachines + state-&gt;ar-&gt;as-&gt;nareas)
<a name="l00202"></a>00202         {
<a name="l00203"></a>00203                 lsa-&gt;type = ospf_lsa_summary3;
<a name="l00204"></a>00204                 <a class="code" href="ospf-extern_8h.html#3eb1ae7a66c4c936b5971afb65492d09">ospf_lsa_link_allocate</a>(state, lsa, lp);
<a name="l00205"></a>00205         
<a name="l00206"></a>00206                 <span class="comment">// Only add nbr to LSA if it does NOT match x_id, because</span>
<a name="l00207"></a>00207                 <span class="comment">// that is the case where we are originating an LSA for</span>
<a name="l00208"></a>00208                 <span class="comment">// an AS/area more than 1 hop away</span>
<a name="l00209"></a>00209                 <span class="keywordflow">if</span>(n-&gt;ar-&gt;id == x_id)
<a name="l00210"></a>00210                         <span class="keywordflow">return</span> index;
<a name="l00211"></a>00211         } <span class="keywordflow">else</span>
<a name="l00212"></a>00212                 lsa-&gt;type = ospf_lsa_as_ext;
<a name="l00213"></a>00213 
<a name="l00214"></a>00214 
<a name="l00215"></a>00215         b = tw_memory_alloc(lp, <a class="code" href="ospf-extern_8h.html#a0aabde3f0073b72fe5cbb892a014316">g_ospf_ll_fd</a>);
<a name="l00216"></a>00216         tw_memoryq_push(&amp;lsa-&gt;links, b);
<a name="l00217"></a>00217 
<a name="l00218"></a>00218         ll = tw_memory_data(b);
<a name="l00219"></a>00219         ll-&gt;dst = n-&gt;id;
<a name="l00220"></a>00220         ll-&gt;metric = <a class="code" href="rn-extern_8h.html#d7173e076af48912ba761e8ef0cc1b22">rn_getlink</a>(state-&gt;m, n-&gt;id)-&gt;cost;
<a name="l00221"></a>00221 
<a name="l00222"></a>00222 <span class="comment">/*</span>
<a name="l00223"></a>00223 <span class="comment">        printf("%ld: Creating LSA: %d, advr %d, %lf \n",</span>
<a name="l00224"></a>00224 <span class="comment">                lp-&gt;id, lsa-&gt;id, lsa-&gt;adv_r, lp-&gt;cur_event-&gt;recv_ts);</span>
<a name="l00225"></a>00225 <span class="comment">*/</span>
<a name="l00226"></a>00226 
<a name="l00227"></a>00227         <span class="keywordflow">return</span> index;
<a name="l00228"></a>00228 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="51de1d77d40f0604d5a65e902ceda57b"></a><!-- doxytag: member="ospf-extern.h::ospf_lsa_flood" ref="51de1d77d40f0604d5a65e902ceda57b" args="(ospf_state *s, ospf_db_entry *d, int f, tw_lp *lp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf_lsa_flood           </td>
          <td>(</td>
          <td class="paramtype">ospf_state *&nbsp;</td>
          <td class="paramname"> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ospf_db_entry *&nbsp;</td>
          <td class="paramname"> <em>d</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>f</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-lsa_8c-source.html#l00731">731</a> of file <a class="el" href="ospf-lsa_8c-source.html">ospf-lsa.c</a>.</p>

<p>References <a class="el" href="ospf-lsa_8c-source.html#l00247">getlsa()</a>, <a class="el" href="ospf-lsa_8c-source.html#l00004">ospf_lsa_print()</a>, and <a class="el" href="ospf-lsa_8c-source.html#l00646">ospf_lsa_start_flood()</a>.</p>

<p>Referenced by <a class="el" href="ospf-timer-aging_8c-source.html#l00147">ospf_aging_timer()</a>, <a class="el" href="ospf-lsa_8c-source.html#l00527">ospf_lsa_create()</a>, <a class="el" href="ospf-lsa_8c-source.html#l00850">ospf_lsa_flush()</a>, <a class="el" href="ospf-lsa_8c-source.html#l00481">ospf_lsa_refresh()</a>, and <a class="el" href="ospf-ls_8c-source.html#l00026">process_lsa_recv()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00732"></a>00732 {
<a name="l00733"></a>00733         ospf_nbr *nbr;
<a name="l00734"></a>00734         <span class="keywordtype">int</span>       i;
<a name="l00735"></a>00735 
<a name="l00736"></a>00736         <span class="keywordflow">for</span> (i = 0; i &lt; state-&gt;n_interfaces; i++)
<a name="l00737"></a>00737         {
<a name="l00738"></a>00738                 nbr = &amp;state-&gt;nbr[i];
<a name="l00739"></a>00739 
<a name="l00740"></a>00740                 <span class="keywordflow">if</span> (nbr-&gt;state &lt; ospf_nbr_exchange_st)
<a name="l00741"></a>00741                         <span class="keywordflow">continue</span>;
<a name="l00742"></a>00742 
<a name="l00743"></a>00743                 <span class="comment">/* Don't send it to myself, or the neighbor who sent it to me */</span>
<a name="l00744"></a>00744                 <span class="keywordflow">if</span> ((from != -1 || from != lp-&gt;id) &amp;&amp; nbr-&gt;id == from)
<a name="l00745"></a>00745                         <span class="keywordflow">continue</span>;
<a name="l00746"></a>00746 
<a name="l00747"></a>00747                 <span class="comment">/* Don't send router LSAs to neighbors in other areas */</span>
<a name="l00748"></a>00748                 <span class="keywordflow">if</span>(state-&gt;ar != nbr-&gt;ar &amp;&amp; dbe-&gt;b.entry &lt; state-&gt;ar-&gt;nmachines)
<a name="l00749"></a>00749                         <span class="keywordflow">continue</span>;
<a name="l00750"></a>00750 
<a name="l00751"></a>00751                 <span class="comment">/* Don't send LSAs to neighbors in other ASes, ever */</span>
<a name="l00752"></a>00752                 <span class="keywordflow">if</span>(state-&gt;ar-&gt;as != nbr-&gt;ar-&gt;as)
<a name="l00753"></a>00753                         <span class="keywordflow">continue</span>;
<a name="l00754"></a>00754 
<a name="l00755"></a>00755                 <span class="comment">// Don't send LSA for nbr's area to nbr</span>
<a name="l00756"></a>00756                 <span class="keywordflow">if</span>(nbr-&gt;ar-&gt;id == dbe-&gt;b.entry - state-&gt;ar-&gt;nmachines)
<a name="l00757"></a>00757                         <span class="keywordflow">continue</span>;
<a name="l00758"></a>00758 
<a name="l00759"></a>00759                 <span class="comment">// Don't send my area LSA to nbr, should already have it!</span>
<a name="l00760"></a>00760                 <span class="keywordflow">if</span>(state-&gt;ar-&gt;id == dbe-&gt;b.entry - state-&gt;ar-&gt;nmachines)
<a name="l00761"></a>00761                         <span class="keywordflow">continue</span>;
<a name="l00762"></a>00762 
<a name="l00763"></a>00763                 <span class="keywordflow">if</span>(nbr-&gt;state == ospf_nbr_exchange_st ||
<a name="l00764"></a>00764                    nbr-&gt;state == ospf_nbr_loading_st)
<a name="l00765"></a>00765                 {
<a name="l00766"></a>00766 <span class="comment">/*</span>
<a name="l00767"></a>00767 <span class="comment">Here we are not supposed to start flooding if the LSA in the request list</span>
<a name="l00768"></a>00768 <span class="comment">is newer than this one.. </span>
<a name="l00769"></a>00769 <span class="comment"></span>
<a name="l00770"></a>00770 <span class="comment"> This case shouldn't really come up, where the outstanding LSA is newer</span>
<a name="l00771"></a>00771 <span class="comment"> than the one we want to flood.. </span>
<a name="l00772"></a>00772 <span class="comment"></span>
<a name="l00773"></a>00773 <span class="comment">                        if(dbe-&gt;state.b.updated = </span>
<a name="l00774"></a>00774 <span class="comment">                                continue;</span>
<a name="l00775"></a>00775 <span class="comment">*/</span>
<a name="l00776"></a>00776 
<a name="l00777"></a>00777                         tw_error(TW_LOC, <span class="stringliteral">"Unhandled ospf flooding case!"</span>);
<a name="l00778"></a>00778                 }
<a name="l00779"></a>00779 
<a name="l00780"></a>00780 <span class="preprocessor">#if VERIFY_LS</span>
<a name="l00781"></a>00781 <span class="preprocessor"></span>                printf(<span class="stringliteral">"\t\tstarting flood LSA %d to %d: \n"</span>, dbe-&gt;b.entry, nbr-&gt;id);
<a name="l00782"></a>00782                 printf(<span class="stringliteral">"\t\t\tsn: %d "</span>, dbe-&gt;seqnum);
<a name="l00783"></a>00783                 <a class="code" href="ospf-extern_8h.html#a04cd2fd7a2636e7fab480a9647fac91">ospf_lsa_print</a>(state-&gt;log, <a class="code" href="ospf-extern_8h.html#9608d8ba29ae5cc559afe788cddade3f">getlsa</a>(state-&gt;m, dbe-&gt;lsa, dbe-&gt;b.entry));
<a name="l00784"></a>00784 <span class="preprocessor">#endif</span>
<a name="l00785"></a>00785 <span class="preprocessor"></span>
<a name="l00786"></a>00786                 <a class="code" href="ospf-extern_8h.html#e70e8cf27e43c0e4d95dc254bd083a29">ospf_lsa_start_flood</a>(nbr, dbe, lp);
<a name="l00787"></a>00787         }
<a name="l00788"></a>00788 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="f6538df19ba8760571cfa528f769f0d4"></a><!-- doxytag: member="ospf-extern.h::ospf_lsa_flush" ref="f6538df19ba8760571cfa528f769f0d4" args="(ospf_state *, ospf_nbr *, ospf_db_entry *, tw_lp *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf_lsa_flush           </td>
          <td>(</td>
          <td class="paramtype">ospf_state *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ospf_nbr *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ospf_db_entry *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-lsa_8c-source.html#l00850">850</a> of file <a class="el" href="ospf-lsa_8c-source.html">ospf-lsa.c</a>.</p>

<p>References <a class="el" href="ospf-global_8c-source.html#l00007">g_ospf_fd</a>, <a class="el" href="ospf-lsa_8c-source.html#l00247">getlsa()</a>, <a class="el" href="ospf-ack_8c-source.html#l00049">ospf_ack_direct()</a>, <a class="el" href="ospf-database_8c-source.html#l00380">ospf_db_remove()</a>, <a class="el" href="ospf-lsa_8c-source.html#l00527">ospf_lsa_create()</a>, <a class="el" href="ospf-lsa_8c-source.html#l00731">ospf_lsa_flood()</a>, and <a class="el" href="ospf-global_8c-source.html#l00021">OSPF_LSA_MAX_AGE</a>.</p>

<p>Referenced by <a class="el" href="ospf-neighbor-state_8c-source.html#l00011">ospf_nbr_reset()</a>, and <a class="el" href="ospf-ls_8c-source.html#l00026">process_lsa_recv()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00851"></a>00851 {
<a name="l00852"></a>00852         tw_memory       *send;
<a name="l00853"></a>00853 
<a name="l00854"></a>00854         ospf_lsa        *r_lsa;
<a name="l00855"></a>00855         ospf_db_entry   *dbe;
<a name="l00856"></a>00856         ospf_db_entry   *out_dbe;
<a name="l00857"></a>00857 
<a name="l00858"></a>00858         <span class="keywordtype">int</span>              originator;
<a name="l00859"></a>00859         <span class="keywordtype">int</span>              x_id = -1;
<a name="l00860"></a>00860         <span class="keywordtype">int</span>              i = -1;
<a name="l00861"></a>00861 
<a name="l00862"></a>00862         dbe = &amp;state-&gt;db[r_dbe-&gt;b.entry];
<a name="l00863"></a>00863         r_lsa = <a class="code" href="ospf-extern_8h.html#9608d8ba29ae5cc559afe788cddade3f">getlsa</a>(state-&gt;m, r_dbe-&gt;lsa, r_dbe-&gt;b.entry);
<a name="l00864"></a>00864 
<a name="l00865"></a>00865         originator = 0;
<a name="l00866"></a>00866         <span class="keywordflow">if</span>(r_lsa-&gt;adv_r == lp-&gt;id)
<a name="l00867"></a>00867         {
<a name="l00868"></a>00868                 <span class="keywordflow">if</span>(r_lsa-&gt;type == ospf_lsa_router)
<a name="l00869"></a>00869                 {
<a name="l00870"></a>00870                         originator = 1;
<a name="l00871"></a>00871                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(r_lsa-&gt;type == ospf_lsa_summary3)
<a name="l00872"></a>00872                 {
<a name="l00873"></a>00873                         x_id = r_dbe-&gt;b.entry - state-&gt;ar-&gt;nmachines;
<a name="l00874"></a>00874                         <span class="keywordflow">for</span>(i = 0; i &lt; state-&gt;n_interfaces; i++)
<a name="l00875"></a>00875                         {
<a name="l00876"></a>00876                                 <span class="keywordflow">if</span>(state-&gt;nbr[i].ar-&gt;id == x_id &amp;&amp;
<a name="l00877"></a>00877                                    state-&gt;nbr[i].state == ospf_nbr_full_st)
<a name="l00878"></a>00878                                 {
<a name="l00879"></a>00879                                         originator = i;
<a name="l00880"></a>00880                                         <span class="keywordflow">break</span>;
<a name="l00881"></a>00881                                 }
<a name="l00882"></a>00882                         }
<a name="l00883"></a>00883                 }
<a name="l00884"></a>00884 
<a name="l00885"></a>00885                 <span class="comment">// if AS ext, do nothing, we do not originate them ever,</span>
<a name="l00886"></a>00886                 <span class="comment">// the BGP layer/model does</span>
<a name="l00887"></a>00887         }
<a name="l00888"></a>00888 
<a name="l00889"></a>00889         <span class="keywordflow">if</span>(-1 == originator)
<a name="l00890"></a>00890         {
<a name="l00891"></a>00891                 <span class="keywordflow">if</span>(dbe-&gt;b.free)
<a name="l00892"></a>00892                         <span class="keywordflow">return</span>;
<a name="l00893"></a>00893 
<a name="l00894"></a>00894 <span class="preprocessor">#if VERIFY_LS</span>
<a name="l00895"></a>00895 <span class="preprocessor"></span>                printf(<span class="stringliteral">"\tflushing LSA %d \n"</span>, r_dbe-&gt;b.entry);
<a name="l00896"></a>00896 <span class="preprocessor">#endif</span>
<a name="l00897"></a>00897 <span class="preprocessor"></span>
<a name="l00898"></a>00898                 r_dbe-&gt;b.age--;
<a name="l00899"></a>00899                 <a class="code" href="ospf-database_8c.html#32f38a24ced7e66d2a7c106ae0c7cbf6">ospf_db_remove</a>(state, dbe-&gt;b.entry, lp);
<a name="l00900"></a>00900                 <a class="code" href="ospf-extern_8h.html#51de1d77d40f0604d5a65e902ceda57b">ospf_lsa_flood</a>(state, r_dbe, nbr-&gt;id, lp);
<a name="l00901"></a>00901         
<a name="l00902"></a>00902                 send = tw_memory_alloc(lp, <a class="code" href="ospf-extern_8h.html#884d66f70a693353a1894758d71deb99">g_ospf_fd</a>);
<a name="l00903"></a>00903                 out_dbe = tw_memory_data(send);
<a name="l00904"></a>00904         
<a name="l00905"></a>00905                 out_dbe-&gt;lsa = r_dbe-&gt;lsa;
<a name="l00906"></a>00906                 out_dbe-&gt;b.age = <a class="code" href="ospf-extern_8h.html#354846699ca7e45e6f42d17268d8fac2">OSPF_LSA_MAX_AGE</a>;
<a name="l00907"></a>00907                 out_dbe-&gt;b.entry = r_dbe-&gt;b.entry;
<a name="l00908"></a>00908         
<a name="l00909"></a>00909                 <a class="code" href="ospf-ack_8c.html#58b61e7221b1dae7c1af7da41e1790bb">ospf_ack_direct</a>(nbr, send, r_lsa-&gt;length, lp);
<a name="l00910"></a>00910         } <span class="keywordflow">else</span>
<a name="l00911"></a>00911                 <a class="code" href="ospf-extern_8h.html#90f786d8f758711eb5797ff19ca0097b">ospf_lsa_create</a>(state, &amp;state-&gt;nbr[originator], r_dbe-&gt;b.entry, lp);
<a name="l00912"></a>00912 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="b9d32c845d06ecdfdaf3b12e89297ab4"></a><!-- doxytag: member="ospf-extern.h::ospf_lsa_isnewer" ref="b9d32c845d06ecdfdaf3b12e89297ab4" args="(ospf_state *, ospf_db_entry *, ospf_db_entry *, tw_lp *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ospf_lsa_isnewer           </td>
          <td>(</td>
          <td class="paramtype">ospf_state *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ospf_db_entry *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ospf_db_entry *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-lsa_8c-source.html#l00793">793</a> of file <a class="el" href="ospf-lsa_8c-source.html">ospf-lsa.c</a>.</p>

<p>References <a class="el" href="ospf-lsa_8c-source.html#l00231">ospf_lsa_age()</a>, <a class="el" href="ospf-global_8c-source.html#l00021">OSPF_LSA_MAX_AGE</a>, and <a class="el" href="ospf-data-types_8h-source.html#l00006">OSPF_LSA_MAX_AGE_DIFF</a>.</p>

<p>Referenced by <a class="el" href="ospf-dd_8c-source.html#l00004">dd_process()</a>, and <a class="el" href="ospf-ls_8c-source.html#l00026">process_lsa_recv()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00795"></a>00795 {
<a name="l00796"></a>00796         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> old_age;
<a name="l00797"></a>00797 
<a name="l00798"></a>00798         old_age = <a class="code" href="ospf-extern_8h.html#f2ab0671b22732e9743355c30ea903a4">ospf_lsa_age</a>(state, old, lp);
<a name="l00799"></a>00799 
<a name="l00800"></a>00800         <span class="keywordflow">if</span>(old-&gt;b.free || old_age == <a class="code" href="ospf-extern_8h.html#354846699ca7e45e6f42d17268d8fac2">OSPF_LSA_MAX_AGE</a>)
<a name="l00801"></a>00801         {
<a name="l00802"></a>00802 <span class="preprocessor">#if VERIFY_LS</span>
<a name="l00803"></a>00803 <span class="preprocessor"></span>        printf(<span class="stringliteral">"\tis_newer: old NONE new (%d %d)\n"</span>, new-&gt;b.age, new-&gt;seqnum);
<a name="l00804"></a>00804 <span class="preprocessor">#endif</span>
<a name="l00805"></a>00805 <span class="preprocessor"></span>
<a name="l00806"></a>00806                 <span class="keywordflow">return</span> 1;
<a name="l00807"></a>00807         }
<a name="l00808"></a>00808 
<a name="l00809"></a>00809 
<a name="l00810"></a>00810 <span class="preprocessor">#if VERIFY_LS</span>
<a name="l00811"></a>00811 <span class="preprocessor"></span>        printf(<span class="stringliteral">"\tis_newer: old (%d %d) new (%d %d)\n"</span>,
<a name="l00812"></a>00812                         old_age, old-&gt;seqnum, new-&gt;b.age, new-&gt;seqnum);
<a name="l00813"></a>00813 <span class="preprocessor">#endif</span>
<a name="l00814"></a>00814 <span class="preprocessor"></span>
<a name="l00815"></a>00815         <span class="comment">/*</span>
<a name="l00816"></a>00816 <span class="comment">         * Make sure we are in the right packet sequence</span>
<a name="l00817"></a>00817 <span class="comment">         */</span>
<a name="l00818"></a>00818         <span class="keywordflow">if</span>(new-&gt;seqnum &gt; old-&gt;seqnum)
<a name="l00819"></a>00819         {
<a name="l00820"></a>00820                 <span class="keywordflow">return</span> 1;
<a name="l00821"></a>00821         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (old-&gt;seqnum &gt; new-&gt;seqnum)
<a name="l00822"></a>00822         {
<a name="l00823"></a>00823                 <span class="keywordflow">return</span> -1;
<a name="l00824"></a>00824         } <span class="keywordflow">else</span>
<a name="l00825"></a>00825         {
<a name="l00826"></a>00826                 <span class="comment">// I am going into my old age writing this function..</span>
<a name="l00827"></a>00827                 <span class="keywordflow">if</span>(new-&gt;b.age == <a class="code" href="ospf-extern_8h.html#354846699ca7e45e6f42d17268d8fac2">OSPF_LSA_MAX_AGE</a> &amp;&amp; old_age != <a class="code" href="ospf-extern_8h.html#354846699ca7e45e6f42d17268d8fac2">OSPF_LSA_MAX_AGE</a>)
<a name="l00828"></a>00828                 {
<a name="l00829"></a>00829                         <span class="keywordflow">return</span> 1;
<a name="l00830"></a>00830                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(old_age == <a class="code" href="ospf-extern_8h.html#354846699ca7e45e6f42d17268d8fac2">OSPF_LSA_MAX_AGE</a> &amp;&amp; 
<a name="l00831"></a>00831                         new-&gt;b.age != <a class="code" href="ospf-extern_8h.html#354846699ca7e45e6f42d17268d8fac2">OSPF_LSA_MAX_AGE</a>)
<a name="l00832"></a>00832                 {
<a name="l00833"></a>00833                         <span class="keywordflow">return</span> -1;
<a name="l00834"></a>00834                 } <span class="keywordflow">else</span>
<a name="l00835"></a>00835                 {
<a name="l00836"></a>00836                         <span class="keywordflow">if</span>(abs(old_age - new-&gt;b.age) &gt; <a class="code" href="ospf-data-types_8h.html#ef5e48b0654006b47912e832199593e7">OSPF_LSA_MAX_AGE_DIFF</a>)
<a name="l00837"></a>00837                         {
<a name="l00838"></a>00838                                 <span class="keywordflow">if</span> (new-&gt;b.age &lt; old_age)
<a name="l00839"></a>00839                                         <span class="keywordflow">return</span> 1;
<a name="l00840"></a>00840                                 <span class="keywordflow">else</span>
<a name="l00841"></a>00841                                         <span class="keywordflow">return</span> -1;
<a name="l00842"></a>00842                         }
<a name="l00843"></a>00843                 }
<a name="l00844"></a>00844         }
<a name="l00845"></a>00845 
<a name="l00846"></a>00846         <span class="keywordflow">return</span> 0;
<a name="l00847"></a>00847 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="3eb1ae7a66c4c936b5971afb65492d09"></a><!-- doxytag: member="ospf-extern.h::ospf_lsa_link_allocate" ref="3eb1ae7a66c4c936b5971afb65492d09" args="(ospf_state *state, ospf_lsa *lsa, tw_lp *lp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf_lsa_link_allocate           </td>
          <td>(</td>
          <td class="paramtype">ospf_state *&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ospf_lsa *&nbsp;</td>
          <td class="paramname"> <em>lsa</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-lsa_8c-source.html#l00406">406</a> of file <a class="el" href="ospf-lsa_8c-source.html">ospf-lsa.c</a>.</p>

<p>References <a class="el" href="ospf-global_8c-source.html#l00010">g_ospf_ll_fd</a>, <a class="el" href="ospf-data-types_8h-source.html#l00013">OSPF_LSA_LINK_LENGTH</a>, and <a class="el" href="ospf-data-types_8h-source.html#l00012">OSPF_LSA_UPDATE_HEADER</a>.</p>

<p>Referenced by <a class="el" href="ospf-lsa_8c-source.html#l00278">lsa_create()</a>, and <a class="el" href="ospf-lsa_8c-source.html#l00076">ospf_lsa_find()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00407"></a>00407 {
<a name="l00408"></a>00408         tw_memory       *b;
<a name="l00409"></a>00409 
<a name="l00410"></a>00410         ospf_lsa_link   *l;
<a name="l00411"></a>00411         ospf_nbr        *nbr;
<a name="l00412"></a>00412 
<a name="l00413"></a>00413         <span class="keywordtype">int</span>              <span class="keyword">add</span>;
<a name="l00414"></a>00414         <span class="keywordtype">int</span>              x_id;
<a name="l00415"></a>00415         <span class="keywordtype">int</span>              i;
<a name="l00416"></a>00416 
<a name="l00417"></a>00417 <span class="preprocessor">#if VERIFY_OSPF_CONVERGENCE</span>
<a name="l00418"></a>00418 <span class="preprocessor"></span>        lsa-&gt;count = state-&gt;ar-&gt;nmachines;
<a name="l00419"></a>00419 <span class="preprocessor">#endif</span>
<a name="l00420"></a>00420 <span class="preprocessor"></span>
<a name="l00421"></a>00421         <span class="keywordflow">if</span>(lsa-&gt;id &lt; state-&gt;ar-&gt;nmachines)
<a name="l00422"></a>00422                 x_id = lsa-&gt;id;
<a name="l00423"></a>00423         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(lsa-&gt;id &gt; state-&gt;ar-&gt;nmachines + state-&gt;ar-&gt;as-&gt;nareas)
<a name="l00424"></a>00424                 x_id = lsa-&gt;id - state-&gt;ar-&gt;nmachines - state-&gt;ar-&gt;as-&gt;nareas;
<a name="l00425"></a>00425         <span class="keywordflow">else</span>
<a name="l00426"></a>00426                 x_id = lsa-&gt;id - state-&gt;ar-&gt;nmachines + state-&gt;ar-&gt;as-&gt;low;
<a name="l00427"></a>00427 
<a name="l00428"></a>00428         <span class="comment">// go by neighbor states, not topology, unless AS external LSA</span>
<a name="l00429"></a>00429         <span class="keywordflow">for</span>(i = 0; i &lt; state-&gt;n_interfaces; i++)
<a name="l00430"></a>00430         {
<a name="l00431"></a>00431                 nbr = &amp;state-&gt;nbr[i];
<a name="l00432"></a>00432 
<a name="l00433"></a>00433                 <span class="keywordflow">if</span>(nbr-&gt;state != ospf_nbr_full_st || 
<a name="l00434"></a>00434                    nbr-&gt;istate != ospf_int_point_to_point_st)
<a name="l00435"></a>00435                         <span class="keywordflow">continue</span>;
<a name="l00436"></a>00436 
<a name="l00437"></a>00437                 <span class="keyword">add</span> = 0;
<a name="l00438"></a>00438 
<a name="l00439"></a>00439                 <span class="comment">// If router_lsa, only count links within my area</span>
<a name="l00440"></a>00440                 <span class="keywordflow">if</span>(lsa-&gt;id &lt; state-&gt;ar-&gt;nmachines)
<a name="l00441"></a>00441                 {
<a name="l00442"></a>00442                         <span class="comment">// router LSA, count if nbr area == my area</span>
<a name="l00443"></a>00443                         <span class="keywordflow">if</span>(nbr-&gt;ar == state-&gt;ar)
<a name="l00444"></a>00444                         {
<a name="l00445"></a>00445                                 b = tw_memory_alloc(lp, <a class="code" href="ospf-extern_8h.html#a0aabde3f0073b72fe5cbb892a014316">g_ospf_ll_fd</a>);
<a name="l00446"></a>00446                                 tw_memoryq_push(&amp;lsa-&gt;links, b);
<a name="l00447"></a>00447 
<a name="l00448"></a>00448                                 l = tw_memory_data(b);
<a name="l00449"></a>00449                                 l-&gt;dst = nbr-&gt;id;
<a name="l00450"></a>00450 
<a name="l00451"></a>00451                                 l-&gt;metric = state-&gt;m-&gt;link[i].cost;
<a name="l00452"></a>00452                         }
<a name="l00453"></a>00453                 } <span class="keywordflow">else</span>
<a name="l00454"></a>00454                 {
<a name="l00455"></a>00455                         <span class="comment">// summary LSA, count if nbr area == LSA area</span>
<a name="l00456"></a>00456                         <span class="keywordflow">if</span>(nbr-&gt;ar-&gt;id == x_id)
<a name="l00457"></a>00457                         {
<a name="l00458"></a>00458                                 b = tw_memory_alloc(lp, <a class="code" href="ospf-extern_8h.html#a0aabde3f0073b72fe5cbb892a014316">g_ospf_ll_fd</a>);
<a name="l00459"></a>00459                                 tw_memoryq_push(&amp;lsa-&gt;links, b);
<a name="l00460"></a>00460 
<a name="l00461"></a>00461                                 l = tw_memory_data(b);
<a name="l00462"></a>00462                                 l-&gt;dst = nbr-&gt;id;
<a name="l00463"></a>00463 
<a name="l00464"></a>00464                                 l-&gt;metric = state-&gt;m-&gt;link[i].cost;
<a name="l00465"></a>00465                         }
<a name="l00466"></a>00466                 }
<a name="l00467"></a>00467         }
<a name="l00468"></a>00468 
<a name="l00469"></a>00469         lsa-&gt;length = <a class="code" href="ospf-data-types_8h.html#bb42796d55aff837291811e19fbf63c1">OSPF_LSA_UPDATE_HEADER</a> + 
<a name="l00470"></a>00470                         (lsa-&gt;links.size * <a class="code" href="ospf-data-types_8h.html#0f677ced1c708377452aaa070eaf6441">OSPF_LSA_LINK_LENGTH</a>);
<a name="l00471"></a>00471 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="593a9576faedb8507895bd493785fdd9"></a><!-- doxytag: member="ospf-extern.h::ospf_lsa_premature_age" ref="593a9576faedb8507895bd493785fdd9" args="(ospf_state *state, ospf_db_entry *, tw_lp *lp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf_lsa_premature_age           </td>
          <td>(</td>
          <td class="paramtype">ospf_state *&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ospf_db_entry *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="a04cd2fd7a2636e7fab480a9647fac91"></a><!-- doxytag: member="ospf-extern.h::ospf_lsa_print" ref="a04cd2fd7a2636e7fab480a9647fac91" args="(FILE *log, ospf_lsa *lsa)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf_lsa_print           </td>
          <td>(</td>
          <td class="paramtype">FILE *&nbsp;</td>
          <td class="paramname"> <em>log</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ospf_lsa *&nbsp;</td>
          <td class="paramname"> <em>lsa</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-lsa_8c-source.html#l00004">4</a> of file <a class="el" href="ospf-lsa_8c-source.html">ospf-lsa.c</a>.</p>

<p>Referenced by <a class="el" href="ospf-database_8c-source.html#l00518">flood_summary()</a>, <a class="el" href="ospf-main_8c-source.html#l00120">main_setup_areas()</a>, <a class="el" href="ospf-database_8c-source.html#l00193">ospf_db_print()</a>, <a class="el" href="ospf-database_8c-source.html#l00083">ospf_db_read()</a>, <a class="el" href="ospf-lsa_8c-source.html#l00731">ospf_lsa_flood()</a>, and <a class="el" href="ospf-stats_8c-source.html#l00008">ospf_statistics_collection()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00005"></a>00005 {
<a name="l00006"></a>00006 <span class="preprocessor">#if OSPF_LOG &amp;&amp; 0</span>
<a name="l00007"></a>00007 <span class="preprocessor"></span>        tw_memory       *b;
<a name="l00008"></a>00008         ospf_lsa_link   *l;
<a name="l00009"></a>00009 
<a name="l00010"></a>00010 <span class="comment">/*</span>
<a name="l00011"></a>00011 <span class="comment">        fprintf(log, </span>
<a name="l00012"></a>00012 <span class="comment">                "adv: %d id: %d nlinks: %d ", </span>
<a name="l00013"></a>00013 <span class="comment">                lsa-&gt;adv_r, lsa-&gt;id, lsa-&gt;links.size);</span>
<a name="l00014"></a>00014 <span class="comment">*/</span>
<a name="l00015"></a>00015 
<a name="l00016"></a>00016         fprintf(log, <span class="stringliteral">"%-10d %-10d %-5d "</span>, 
<a name="l00017"></a>00017                 lsa-&gt;id, lsa-&gt;adv_r, lsa-&gt;links.size);
<a name="l00018"></a>00018 
<a name="l00019"></a>00019         <span class="keywordflow">for</span>(b = lsa-&gt;links.head; b; b = b-&gt;next)
<a name="l00020"></a>00020         {
<a name="l00021"></a>00021                 l = tw_memory_data(b);
<a name="l00022"></a>00022                 fprintf(log, <span class="stringliteral">"%d %d "</span>, l-&gt;dst, l-&gt;metric);
<a name="l00023"></a>00023         }
<a name="l00024"></a>00024 
<a name="l00025"></a>00025         fprintf(log, <span class="stringliteral">"\n"</span>);
<a name="l00026"></a>00026 <span class="preprocessor">#endif</span>
<a name="l00027"></a>00027 <span class="preprocessor"></span>}
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="e05d8b610f94370f9a2d4c5209c163d2"></a><!-- doxytag: member="ospf-extern.h::ospf_lsa_process" ref="e05d8b610f94370f9a2d4c5209c163d2" args="(ospf_state *state, ospf_message *m, int interface)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf_lsa_process           </td>
          <td>(</td>
          <td class="paramtype">ospf_state *&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ospf_message *&nbsp;</td>
          <td class="paramname"> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>interface</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="9b306ecc8339fcb31d7c8e5448f60722"></a><!-- doxytag: member="ospf-extern.h::ospf_lsa_refresh" ref="9b306ecc8339fcb31d7c8e5448f60722" args="(ospf_state *state, ospf_db_entry *dbe, tw_lp *lp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf_lsa_refresh           </td>
          <td>(</td>
          <td class="paramtype">ospf_state *&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ospf_db_entry *&nbsp;</td>
          <td class="paramname"> <em>dbe</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-lsa_8c-source.html#l00481">481</a> of file <a class="el" href="ospf-lsa_8c-source.html">ospf-lsa.c</a>.</p>

<p>References <a class="el" href="ospf-lsa_8c-source.html#l00247">getlsa()</a>, <a class="el" href="ospf-timer-aging_8c-source.html#l00024">ospf_aging_timer_set()</a>, <a class="el" href="ospf-lsa_8c-source.html#l00731">ospf_lsa_flood()</a>, <a class="el" href="ospf-global_8c-source.html#l00021">OSPF_LSA_MAX_AGE</a>, and <a class="el" href="ospf-data-types_8h-source.html#l00017">OSPF_MAX_LSA_SEQNUM</a>.</p>

<p>Referenced by <a class="el" href="ospf-timer-aging_8c-source.html#l00147">ospf_aging_timer()</a>, and <a class="el" href="ospf-experiments_8c-source.html#l00041">ospf_experiment_weights()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00482"></a>00482 {
<a name="l00483"></a>00483         <span class="keywordtype">int</span>             wrapping = 0;
<a name="l00484"></a>00484 
<a name="l00485"></a>00485         ospf_db_entry    temp_dbe;
<a name="l00486"></a>00486         ospf_lsa        *lsa;
<a name="l00487"></a>00487 
<a name="l00488"></a>00488         lsa = <a class="code" href="ospf-extern_8h.html#9608d8ba29ae5cc559afe788cddade3f">getlsa</a>(state-&gt;m, dbe-&gt;lsa, dbe-&gt;b.entry);
<a name="l00489"></a>00489 
<a name="l00490"></a>00490         <span class="keywordflow">if</span> (state-&gt;lsa_seqnum == <a class="code" href="ospf-data-types_8h.html#c21137f66cab7f101c674b10fb13bdd0">OSPF_MAX_LSA_SEQNUM</a>)
<a name="l00491"></a>00491         {
<a name="l00492"></a>00492                 <span class="keywordflow">if</span>(state-&gt;lsa_wrapping)
<a name="l00493"></a>00493                 {
<a name="l00494"></a>00494                         dbe-&gt;b.free = 1;
<a name="l00495"></a>00495                 } <span class="keywordflow">else</span>
<a name="l00496"></a>00496                 {
<a name="l00497"></a>00497                         dbe-&gt;seqnum = <a class="code" href="ospf-data-types_8h.html#c21137f66cab7f101c674b10fb13bdd0">OSPF_MAX_LSA_SEQNUM</a>;
<a name="l00498"></a>00498                         wrapping = 1;
<a name="l00499"></a>00499 
<a name="l00500"></a>00500                         <span class="comment">// Prematurely age the LSA</span>
<a name="l00501"></a>00501                         <a class="code" href="ospf-extern_8h.html#0ff2c1e877d460d2950c2228447c2a4d">ospf_aging_timer_set</a>(state, &amp;state-&gt;db[lsa-&gt;id],
<a name="l00502"></a>00502                                                         <a class="code" href="ospf-extern_8h.html#354846699ca7e45e6f42d17268d8fac2">OSPF_LSA_MAX_AGE</a>, lp);
<a name="l00503"></a>00503 
<a name="l00504"></a>00504                         <span class="comment">/* Make a copy for flooding with the correct AGE */</span>
<a name="l00505"></a>00505                         temp_dbe.b = dbe-&gt;b;
<a name="l00506"></a>00506                         temp_dbe.lsa = dbe-&gt;lsa;
<a name="l00507"></a>00507 
<a name="l00508"></a>00508                         <a class="code" href="ospf-extern_8h.html#51de1d77d40f0604d5a65e902ceda57b">ospf_lsa_flood</a>(state, &amp;temp_dbe, lp-&gt;id, lp);
<a name="l00509"></a>00509                         state-&gt;lsa_wrapping = 1;
<a name="l00510"></a>00510                 }
<a name="l00511"></a>00511 
<a name="l00512"></a>00512                 <span class="keywordflow">return</span>;
<a name="l00513"></a>00513         }
<a name="l00514"></a>00514 
<a name="l00515"></a>00515         <span class="comment">//printf("%d: old LSA %d seqnum: %d \n", lp-&gt;id, lp-&gt;id, dbe-&gt;seqnum);</span>
<a name="l00516"></a>00516         dbe-&gt;seqnum++;
<a name="l00517"></a>00517         <span class="comment">//printf("%d: new LSA %d seqnum: %d \n", lp-&gt;id, lp-&gt;id, dbe-&gt;seqnum);</span>
<a name="l00518"></a>00518         <a class="code" href="ospf-extern_8h.html#51de1d77d40f0604d5a65e902ceda57b">ospf_lsa_flood</a>(state, dbe, lp-&gt;id, lp);
<a name="l00519"></a>00519 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="e70e8cf27e43c0e4d95dc254bd083a29"></a><!-- doxytag: member="ospf-extern.h::ospf_lsa_start_flood" ref="e70e8cf27e43c0e4d95dc254bd083a29" args="(ospf_nbr *nbr, ospf_db_entry *dbe, tw_lp *lp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf_lsa_start_flood           </td>
          <td>(</td>
          <td class="paramtype">ospf_nbr *&nbsp;</td>
          <td class="paramname"> <em>nbr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ospf_db_entry *&nbsp;</td>
          <td class="paramname"> <em>dbe</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-lsa_8c-source.html#l00646">646</a> of file <a class="el" href="ospf-lsa_8c-source.html">ospf-lsa.c</a>.</p>

<p>References <a class="el" href="ospf-global_8c-source.html#l00007">g_ospf_fd</a>, <a class="el" href="ospf-lsa_8c-source.html#l00247">getlsa()</a>, <a class="el" href="ospf-timer-aging_8c-source.html#l00024">ospf_aging_timer_set()</a>, <a class="el" href="ospf-util_8c-source.html#l00004">ospf_event_new()</a>, <a class="el" href="ospf-util_8c-source.html#l00024">ospf_event_send()</a>, <a class="el" href="ospf-lsa_8c-source.html#l00231">ospf_lsa_age()</a>, and <a class="el" href="ospf-global_8c-source.html#l00021">OSPF_LSA_MAX_AGE</a>.</p>

<p>Referenced by <a class="el" href="ospf-database_8c-source.html#l00518">flood_summary()</a>, and <a class="el" href="ospf-lsa_8c-source.html#l00731">ospf_lsa_flood()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00647"></a>00647 {
<a name="l00648"></a>00648         tw_event        *e;
<a name="l00649"></a>00649         tw_memory       *send;
<a name="l00650"></a>00650 
<a name="l00651"></a>00651         ospf_db_entry   *out_dbe;
<a name="l00652"></a>00652         ospf_lsa        *lsa;
<a name="l00653"></a>00653 
<a name="l00654"></a>00654         <span class="keywordflow">if</span>(<a class="code" href="ospf-extern_8h.html#f2ab0671b22732e9743355c30ea903a4">ospf_lsa_age</a>(nbr-&gt;router, dbe, lp) + 1 &gt; <a class="code" href="ospf-extern_8h.html#354846699ca7e45e6f42d17268d8fac2">OSPF_LSA_MAX_AGE</a>)
<a name="l00655"></a>00655                 <a class="code" href="ospf-extern_8h.html#0ff2c1e877d460d2950c2228447c2a4d">ospf_aging_timer_set</a>(nbr-&gt;router, dbe, <a class="code" href="ospf-extern_8h.html#354846699ca7e45e6f42d17268d8fac2">OSPF_LSA_MAX_AGE</a>, lp);
<a name="l00656"></a>00656 
<a name="l00657"></a>00657         <span class="comment">/*</span>
<a name="l00658"></a>00658 <span class="comment">         * If the flood timer has already gone off, just send the LSA in a</span>
<a name="l00659"></a>00659 <span class="comment">         * single pkt.</span>
<a name="l00660"></a>00660 <span class="comment">         */</span>
<a name="l00661"></a>00661         <span class="keywordflow">if</span>(nbr-&gt;next_flood &gt; tw_now(lp))
<a name="l00662"></a>00662         {
<a name="l00663"></a>00663                 send = tw_memory_alloc(lp, <a class="code" href="ospf-extern_8h.html#884d66f70a693353a1894758d71deb99">g_ospf_fd</a>);
<a name="l00664"></a>00664 
<a name="l00665"></a>00665                 out_dbe = tw_memory_data(send);
<a name="l00666"></a>00666                 out_dbe-&gt;lsa = dbe-&gt;lsa;
<a name="l00667"></a>00667                 out_dbe-&gt;b.entry = dbe-&gt;b.entry;
<a name="l00668"></a>00668                 out_dbe-&gt;seqnum = dbe-&gt;seqnum;
<a name="l00669"></a>00669                 out_dbe-&gt;b.age = <a class="code" href="ospf-extern_8h.html#f2ab0671b22732e9743355c30ea903a4">ospf_lsa_age</a>(nbr-&gt;router, dbe, lp) + 1;
<a name="l00670"></a>00670                 out_dbe-&gt;b.free = 0;
<a name="l00671"></a>00671                 out_dbe-&gt;cause_bgp = dbe-&gt;cause_bgp;
<a name="l00672"></a>00672                 out_dbe-&gt;cause_ospf = dbe-&gt;cause_ospf;
<a name="l00673"></a>00673 
<a name="l00674"></a>00674                 lsa = <a class="code" href="ospf-extern_8h.html#9608d8ba29ae5cc559afe788cddade3f">getlsa</a>(nbr-&gt;router-&gt;m, out_dbe-&gt;lsa, out_dbe-&gt;b.entry);
<a name="l00675"></a>00675 
<a name="l00676"></a>00676                 e = <a class="code" href="ospf-extern_8h.html#a6ee00330aee5b151785a47a706cf226">ospf_event_new</a>(nbr-&gt;router, 
<a name="l00677"></a>00677                                 tw_getlp(nbr-&gt;id), nbr-&gt;next_flood - tw_now(lp), lp);
<a name="l00678"></a>00678                 <a class="code" href="ospf-extern_8h.html#506873294c07e25082f4e8d2f631b522">ospf_event_send</a>(nbr-&gt;router, e, OSPF_LS_UPDATE, lp, 
<a name="l00679"></a>00679                                 lsa-&gt;length, send, nbr-&gt;router-&gt;ar-&gt;id);
<a name="l00680"></a>00680 
<a name="l00681"></a>00681 <span class="preprocessor">#if VERIFY_LS</span>
<a name="l00682"></a>00682 <span class="preprocessor"></span>                printf(<span class="stringliteral">"\tflood adding LSA %d to %d: mine (%d %d) send (%d %d) at %lf\n"</span>,
<a name="l00683"></a>00683                                 dbe-&gt;b.entry, nbr-&gt;id, 
<a name="l00684"></a>00684                                 dbe-&gt;b.age, dbe-&gt;seqnum, 
<a name="l00685"></a>00685                                 out_dbe-&gt;b.age, out_dbe-&gt;seqnum, e-&gt;recv_ts);
<a name="l00686"></a>00686 <span class="preprocessor">#endif</span>
<a name="l00687"></a>00687 <span class="preprocessor"></span>        } <span class="keywordflow">else</span>
<a name="l00688"></a>00688         {
<a name="l00689"></a>00689                 <span class="comment">/*</span>
<a name="l00690"></a>00690 <span class="comment">                 * To start flood, and no flood has already started, set the flood</span>
<a name="l00691"></a>00691 <span class="comment">                 * timer and place all requests onto the retranmit list.  When</span>
<a name="l00692"></a>00692 <span class="comment">                 * the flood timer goes off, that is when you will send the pkts.</span>
<a name="l00693"></a>00693 <span class="comment">                 */</span>
<a name="l00694"></a>00694                 nbr-&gt;next_flood = nbr-&gt;router-&gt;gstate-&gt;flood_timer + tw_now(lp);
<a name="l00695"></a>00695         
<a name="l00696"></a>00696                 lsa = <a class="code" href="ospf-extern_8h.html#9608d8ba29ae5cc559afe788cddade3f">getlsa</a>(nbr-&gt;router-&gt;m, dbe-&gt;lsa, dbe-&gt;b.entry);
<a name="l00697"></a>00697 
<a name="l00698"></a>00698                 <span class="keywordflow">if</span>(!lsa)
<a name="l00699"></a>00699                 {
<a name="l00700"></a>00700                         printf(<span class="stringliteral">"%lld: aborting flood of LSA: %d \n"</span>,
<a name="l00701"></a>00701                                 lp-&gt;id, dbe-&gt;b.entry);
<a name="l00702"></a>00702                         <span class="keywordflow">return</span>;
<a name="l00703"></a>00703                 }
<a name="l00704"></a>00704 
<a name="l00705"></a>00705                 send = tw_memory_alloc(lp, <a class="code" href="ospf-extern_8h.html#884d66f70a693353a1894758d71deb99">g_ospf_fd</a>);
<a name="l00706"></a>00706                 out_dbe = tw_memory_data(send);
<a name="l00707"></a>00707         
<a name="l00708"></a>00708                 out_dbe-&gt;b.age = dbe-&gt;b.age + 1;
<a name="l00709"></a>00709                 out_dbe-&gt;b.entry = dbe-&gt;b.entry;
<a name="l00710"></a>00710                 out_dbe-&gt;b.free = 0;
<a name="l00711"></a>00711                 out_dbe-&gt;lsa = dbe-&gt;lsa;
<a name="l00712"></a>00712                 out_dbe-&gt;seqnum = dbe-&gt;seqnum;
<a name="l00713"></a>00713                 out_dbe-&gt;cause_bgp = dbe-&gt;cause_bgp;
<a name="l00714"></a>00714                 out_dbe-&gt;cause_ospf = dbe-&gt;cause_ospf;
<a name="l00715"></a>00715         
<a name="l00716"></a>00716                 e = <a class="code" href="ospf-extern_8h.html#a6ee00330aee5b151785a47a706cf226">ospf_event_new</a>(nbr-&gt;router, tw_getlp(nbr-&gt;id), 
<a name="l00717"></a>00717                                         nbr-&gt;router-&gt;gstate-&gt;flood_timer, lp);
<a name="l00718"></a>00718         
<a name="l00719"></a>00719                 nbr-&gt;flood = <a class="code" href="ospf-extern_8h.html#506873294c07e25082f4e8d2f631b522">ospf_event_send</a>(nbr-&gt;router, e, OSPF_LS_UPDATE, lp, 
<a name="l00720"></a>00720                                         lsa-&gt;length, send, nbr-&gt;router-&gt;ar-&gt;id);
<a name="l00721"></a>00721         
<a name="l00722"></a>00722 <span class="preprocessor">#if VERIFY_LS</span>
<a name="l00723"></a>00723 <span class="preprocessor"></span>                printf(<span class="stringliteral">"\t\t\tflood LSA %d to %d: send (%d %d) at %lf\n"</span>,
<a name="l00724"></a>00724                                 dbe-&gt;b.entry, nbr-&gt;id, 
<a name="l00725"></a>00725                                 out_dbe-&gt;b.age, out_dbe-&gt;seqnum, e-&gt;recv_ts);
<a name="l00726"></a>00726 <span class="preprocessor">#endif</span>
<a name="l00727"></a>00727 <span class="preprocessor"></span>        }
<a name="l00728"></a>00728 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="b24273470dfc60ba658a9a3a99344610"></a><!-- doxytag: member="ospf-extern.h::ospf_main" ref="b24273470dfc60ba658a9a3a99344610" args="(int argc, char **argv, char **env)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf_main           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&nbsp;</td>
          <td class="paramname"> <em>argv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&nbsp;</td>
          <td class="paramname"> <em>env</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-main_8c-source.html#l00281">281</a> of file <a class="el" href="ospf-main_8c-source.html">ospf-main.c</a>.</p>

<p>References <a class="el" href="rn-global_8c-source.html#l00091">ctxt</a>, <a class="el" href="ospf-global_8c-source.html#l00009">g_ospf_dd_fd</a>, <a class="el" href="ospf-global_8c-source.html#l00007">g_ospf_fd</a>, <a class="el" href="ospf-global_8c-source.html#l00010">g_ospf_ll_fd</a>, <a class="el" href="ospf-global_8c-source.html#l00008">g_ospf_lsa_fd</a>, <a class="el" href="ospf-global_8c-source.html#l00039">g_ospf_lsa_file</a>, <a class="el" href="ospf-global_8c-source.html#l00040">g_ospf_lsa_input</a>, <a class="el" href="ospf-global_8c-source.html#l00036">g_ospf_stats</a>, <a class="el" href="rn-global_8c-source.html#l00004">g_rn_converge_ospf</a>, <a class="el" href="rn-global_8c-source.html#l00085">g_rn_logs_dir</a>, <a class="el" href="rn-global_8c-source.html#l00084">g_rn_tools_dir</a>, <a class="el" href="ospf-main_8c-source.html#l00120">main_setup_areas()</a>, <a class="el" href="ospf-main_8c-source.html#l00009">ospf_setup_options()</a>, and <a class="el" href="xml-libxml_8c-source.html#l00068">xpath()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00282"></a>00282 {
<a name="l00283"></a>00283         <span class="keywordtype">char</span>             file[255];
<a name="l00284"></a>00284         <span class="keywordtype">int</span>              i;
<a name="l00285"></a>00285 
<a name="l00286"></a>00286         xmlXPathObjectPtr       l_obj;
<a name="l00287"></a>00287 
<a name="l00288"></a>00288         <a class="code" href="ospf-extern_8h.html#6ff92e91f0531f31567a8453d5b2b08b">g_ospf_stats</a> = tw_calloc(TW_LOC, <span class="stringliteral">""</span>, <span class="keyword">sizeof</span>(ospf_statistics), 1);
<a name="l00289"></a>00289 
<a name="l00290"></a>00290         <span class="comment">/*</span>
<a name="l00291"></a>00291 <span class="comment">         * Determine the number of LSAs to create in the global LSA array</span>
<a name="l00292"></a>00292 <span class="comment">         */</span>
<a name="l00293"></a>00293 
<a name="l00294"></a>00294         <span class="comment">// Need a better xpath expr to find only OSPF routers in my area!</span>
<a name="l00295"></a>00295         l_obj = <a class="code" href="rn-extern_8h.html#1ba6b31617e8e4f7346b7fb67c34d74a">xpath</a>(<span class="stringliteral">"//layer[@name=\'ospf\']"</span>, <a class="code" href="rn-extern_8h.html#be628a165ce36512670a0d77bda92693">ctxt</a>);
<a name="l00296"></a>00296 
<a name="l00297"></a>00297         <span class="keywordflow">if</span>(l_obj-&gt;nodesetval-&gt;nodeNr &lt; 1)
<a name="l00298"></a>00298                 <span class="keywordflow">return</span>; <span class="comment">//tw_error(TW_LOC, "Could not find any OSPF nodes!");</span>
<a name="l00299"></a>00299 
<a name="l00300"></a>00300         <span class="keywordflow">if</span>(<span class="keyword">sizeof</span>(ospf_dd_pkt) &lt; <span class="keyword">sizeof</span>(ospf_lsa_link))
<a name="l00301"></a>00301                 tw_error(TW_LOC, <span class="stringliteral">"Cannot use DD membufs for LSA links!"</span>);
<a name="l00302"></a>00302 
<a name="l00303"></a>00303         <span class="comment">/*</span>
<a name="l00304"></a>00304 <span class="comment">         * Init the memory queues needed by this model</span>
<a name="l00305"></a>00305 <span class="comment">         */</span>
<a name="l00306"></a>00306         <span class="keywordflow">for</span>(i = 0; i &lt; g_tw_nkp; i++)
<a name="l00307"></a>00307         {
<a name="l00308"></a>00308                 printf(<span class="stringliteral">"\nInitializing OSPF memory buffers... "</span>);
<a name="l00309"></a>00309                 tw_kp_memory_init(tw_getkp(i), 20000, <span class="keyword">sizeof</span>(ospf_db_entry), 1);
<a name="l00310"></a>00310 
<a name="l00311"></a>00311 <span class="comment">/*</span>
<a name="l00312"></a>00312 <span class="comment">                // Commented out for NCS</span>
<a name="l00313"></a>00313 <span class="comment">                g_ospf_fd = tw_kp_memory_init(tw_getkp(i), </span>
<a name="l00314"></a>00314 <span class="comment">                                        400 * l_obj-&gt;nodesetval-&gt;nodeNr, </span>
<a name="l00315"></a>00315 <span class="comment">                                        sizeof(ospf_db_entry), 1);</span>
<a name="l00316"></a>00316 <span class="comment">                g_ospf_lsa_fd = tw_kp_memory_init(tw_getkp(i), </span>
<a name="l00317"></a>00317 <span class="comment">                                        100 * l_obj-&gt;nodesetval-&gt;nodeNr, </span>
<a name="l00318"></a>00318 <span class="comment">                                        sizeof(ospf_lsa), 1);</span>
<a name="l00319"></a>00319 <span class="comment">                g_ospf_dd_fd = tw_kp_memory_init(tw_getkp(i), </span>
<a name="l00320"></a>00320 <span class="comment">                                        1 * l_obj-&gt;nodesetval-&gt;nodeNr, </span>
<a name="l00321"></a>00321 <span class="comment">                                        sizeof(ospf_dd_pkt), 1);</span>
<a name="l00322"></a>00322 <span class="comment">                g_ospf_ll_fd = tw_kp_memory_init(tw_getkp(i), </span>
<a name="l00323"></a>00323 <span class="comment">                                        100 * l_obj-&gt;nodesetval-&gt;nodeNr, </span>
<a name="l00324"></a>00324 <span class="comment">                                        sizeof(ospf_lsa_link), 1);</span>
<a name="l00325"></a>00325 <span class="comment">*/</span>
<a name="l00326"></a>00326                 <a class="code" href="ospf-extern_8h.html#884d66f70a693353a1894758d71deb99">g_ospf_fd</a> = tw_kp_memory_init(tw_getkp(i), 
<a name="l00327"></a>00327                                         2000000,
<a name="l00328"></a>00328                                         <span class="keyword">sizeof</span>(ospf_db_entry), 1);
<a name="l00329"></a>00329                 <a class="code" href="ospf-extern_8h.html#76d058140af721aad20439b05b18e172">g_ospf_lsa_fd</a> = tw_kp_memory_init(tw_getkp(i), 
<a name="l00330"></a>00330                                         2000000,
<a name="l00331"></a>00331                                         <span class="keyword">sizeof</span>(ospf_lsa), 1);
<a name="l00332"></a>00332                 <a class="code" href="ospf-extern_8h.html#6172717590c1e9795cb6db7baeb1bf4a">g_ospf_dd_fd</a> = tw_kp_memory_init(tw_getkp(i), 
<a name="l00333"></a>00333                                         100000,
<a name="l00334"></a>00334                                         <span class="keyword">sizeof</span>(ospf_dd_pkt), 1);
<a name="l00335"></a>00335                 <a class="code" href="ospf-extern_8h.html#a0aabde3f0073b72fe5cbb892a014316">g_ospf_ll_fd</a> = tw_kp_memory_init(tw_getkp(i), 
<a name="l00336"></a>00336                                         1000000,
<a name="l00337"></a>00337                                         <span class="keyword">sizeof</span>(ospf_lsa_link), 1);
<a name="l00338"></a>00338                 printf(<span class="stringliteral">"done!\n"</span>);
<a name="l00339"></a>00339 
<a name="l00340"></a>00340                 <span class="comment">//g_tw_kp[0].queues[g_ospf_fd].debug = 1;</span>
<a name="l00341"></a>00341                 <span class="comment">//g_tw_kp[0].queues[g_ospf_lsa_fd].debug = 1;</span>
<a name="l00342"></a>00342                 <span class="comment">//g_tw_kp[0].queues[g_ospf_dd_fd].debug = 1;</span>
<a name="l00343"></a>00343                 <span class="comment">//g_tw_kp[0].queues[g_ospf_ll_fd].debug = 1;</span>
<a name="l00344"></a>00344 
<a name="l00345"></a>00345 <span class="comment">/*</span>
<a name="l00346"></a>00346 <span class="comment">                printf("\tDB  q: %10.0f bufs %10ld fd\n",</span>
<a name="l00347"></a>00347 <span class="comment">                        (float) (100 * l_obj-&gt;nodesetval-&gt;nodeNr), g_ospf_fd);</span>
<a name="l00348"></a>00348 <span class="comment">                printf("\tLSA q: %10.0f bufs %10ld fd\n",</span>
<a name="l00349"></a>00349 <span class="comment">                        (float) (100 * l_obj-&gt;nodesetval-&gt;nodeNr), g_ospf_lsa_fd);</span>
<a name="l00350"></a>00350 <span class="comment">                printf("\tDD  q: %10.0f bufs %10ld fd\n",</span>
<a name="l00351"></a>00351 <span class="comment">                        (float) (1 * l_obj-&gt;nodesetval-&gt;nodeNr), g_ospf_dd_fd);</span>
<a name="l00352"></a>00352 <span class="comment">                printf("\tLL  q: %10.0f bufs %10ld fd\n",</span>
<a name="l00353"></a>00353 <span class="comment">                        (float) (100 * l_obj-&gt;nodesetval-&gt;nodeNr), g_ospf_ll_fd);</span>
<a name="l00354"></a>00354 <span class="comment">*/</span>
<a name="l00355"></a>00355                 printf(<span class="stringliteral">"\tDB  q: %10.0f bufs %10ld fd\n"</span>,
<a name="l00356"></a>00356                         (<span class="keywordtype">float</span>) 2000000.0, <a class="code" href="ospf-extern_8h.html#884d66f70a693353a1894758d71deb99">g_ospf_fd</a>);
<a name="l00357"></a>00357                 printf(<span class="stringliteral">"\tLSA q: %10.0f bufs %10ld fd\n"</span>,
<a name="l00358"></a>00358                         (<span class="keywordtype">float</span>) 2000000, <a class="code" href="ospf-extern_8h.html#76d058140af721aad20439b05b18e172">g_ospf_lsa_fd</a>);
<a name="l00359"></a>00359                 printf(<span class="stringliteral">"\tDD  q: %10.0f bufs %10ld fd\n"</span>,
<a name="l00360"></a>00360                         (<span class="keywordtype">float</span>) 100000, <a class="code" href="ospf-extern_8h.html#6172717590c1e9795cb6db7baeb1bf4a">g_ospf_dd_fd</a>);
<a name="l00361"></a>00361                 printf(<span class="stringliteral">"\tLL  q: %10.0f bufs %10ld fd\n"</span>,
<a name="l00362"></a>00362                         (<span class="keywordtype">float</span>) 1000000, <a class="code" href="ospf-extern_8h.html#a0aabde3f0073b72fe5cbb892a014316">g_ospf_ll_fd</a>);
<a name="l00363"></a>00363         }
<a name="l00364"></a>00364 
<a name="l00365"></a>00365         <a class="code" href="ospf-main_8c.html#64befb6673d1c6e5a2ce8e93f38cf1ed">ospf_setup_options</a>(argc, argv);
<a name="l00366"></a>00366 
<a name="l00367"></a>00367         <span class="keywordflow">if</span>(<a class="code" href="rn-extern_8h.html#1f8c72ceadd5707b682dc77968ffd6d5">g_rn_converge_ospf</a>)
<a name="l00368"></a>00368         {
<a name="l00369"></a>00369                 <a class="code" href="ospf-main_8c.html#98465ee77c3efc6b2ac550fbe14f9c76">main_setup_areas</a>(l_obj);
<a name="l00370"></a>00370         } <span class="keywordflow">else</span>
<a name="l00371"></a>00371         {
<a name="l00372"></a>00372                 sprintf(file, <span class="stringliteral">"tools/%s/ospf-lsa.file"</span>, <a class="code" href="rn-extern_8h.html#7199204689d83ed6e37695c3baaa2f85">g_rn_tools_dir</a>);
<a name="l00373"></a>00373                 <a class="code" href="ospf-extern_8h.html#7a318634977625460e285269c959269f">g_ospf_lsa_input</a> = fopen(file, <span class="stringliteral">"r"</span>);
<a name="l00374"></a>00374         }
<a name="l00375"></a>00375 
<a name="l00376"></a>00376         xmlXPathFreeObject(l_obj);
<a name="l00377"></a>00377 
<a name="l00378"></a>00378         sprintf(file, <span class="stringliteral">"%s/ospf-lsa.file"</span>, <a class="code" href="rn-extern_8h.html#a46f0adf0f6be6d672defc691800ce69">g_rn_logs_dir</a>);
<a name="l00379"></a>00379         <a class="code" href="ospf-extern_8h.html#49edbff370ec3a56723d1dc19e990d14">g_ospf_lsa_file</a> = fopen(file, <span class="stringliteral">"w"</span>);
<a name="l00380"></a>00380 
<a name="l00381"></a>00381         <span class="keywordflow">if</span>(!<a class="code" href="ospf-extern_8h.html#49edbff370ec3a56723d1dc19e990d14">g_ospf_lsa_file</a>)
<a name="l00382"></a>00382                 tw_error(TW_LOC, <span class="stringliteral">"Unable to open: %s"</span>, file);
<a name="l00383"></a>00383 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="7795809faa2d0a044f6be6014033e6f1"></a><!-- doxytag: member="ospf-extern.h::ospf_md_final" ref="7795809faa2d0a044f6be6014033e6f1" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf_md_final           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-main_8c-source.html#l00386">386</a> of file <a class="el" href="ospf-main_8c-source.html">ospf-main.c</a>.</p>

<p>References <a class="el" href="rn-types_8h-source.html#l00046">c_router</a>, <a class="el" href="ospf-global_8c-source.html#l00039">g_ospf_lsa_file</a>, <a class="el" href="ospf-global_8c-source.html#l00038">g_ospf_routing_file</a>, <a class="el" href="ospf-global_8c-source.html#l00036">g_ospf_stats</a>, <a class="el" href="rn-global_8c-source.html#l00058">g_rn_machines</a>, and <a class="el" href="rn-global_8c-source.html#l00057">g_rn_nmachines</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00387"></a>00387 {
<a name="l00388"></a>00388         rn_machine      *m;
<a name="l00389"></a>00389         rn_area         *ar;
<a name="l00390"></a>00390 
<a name="l00391"></a>00391         <span class="keywordtype">int</span>              i;
<a name="l00392"></a>00392         <span class="keywordtype">int</span>              j;
<a name="l00393"></a>00393 
<a name="l00394"></a>00394         printf(<span class="stringliteral">"\nOSPFv2 Model Statistics: \n\n"</span>);
<a name="l00395"></a>00395 
<a name="l00396"></a>00396         printf(<span class="stringliteral">"\t%-50s %11ld\n"</span>, <span class="stringliteral">"Hello Packets"</span>, <a class="code" href="ospf-extern_8h.html#6ff92e91f0531f31567a8453d5b2b08b">g_ospf_stats</a>-&gt;s_sent_hellos);
<a name="l00397"></a>00397         printf(<span class="stringliteral">"\t%-50s %11ld\n"</span>, <span class="stringliteral">"Hello: sent"</span>, <a class="code" href="ospf-extern_8h.html#6ff92e91f0531f31567a8453d5b2b08b">g_ospf_stats</a>-&gt;s_e_hello_out);
<a name="l00398"></a>00398         printf(<span class="stringliteral">"\t%-50s %11ld\n"</span>, <span class="stringliteral">"Hello: recv"</span>, <a class="code" href="ospf-extern_8h.html#6ff92e91f0531f31567a8453d5b2b08b">g_ospf_stats</a>-&gt;s_e_hello_in);
<a name="l00399"></a>00399         printf(<span class="stringliteral">"\n"</span>);
<a name="l00400"></a>00400         printf(<span class="stringliteral">"\t%-50s %11ld\n"</span>, <span class="stringliteral">"DD Packets"</span>, <a class="code" href="ospf-extern_8h.html#6ff92e91f0531f31567a8453d5b2b08b">g_ospf_stats</a>-&gt;s_sent_dds);
<a name="l00401"></a>00401         printf(<span class="stringliteral">"\t%-50s %11ld\n"</span>, <span class="stringliteral">"Dropped Packets"</span>, <a class="code" href="ospf-extern_8h.html#6ff92e91f0531f31567a8453d5b2b08b">g_ospf_stats</a>-&gt;dropped_packets);
<a name="l00402"></a>00402         printf(<span class="stringliteral">"\t%-50s %11ld\n"</span>, <span class="stringliteral">"Dropped DD Packets"</span>, <a class="code" href="ospf-extern_8h.html#6ff92e91f0531f31567a8453d5b2b08b">g_ospf_stats</a>-&gt;s_drop_dd);
<a name="l00403"></a>00403         printf(<span class="stringliteral">"\t%-50s %11ld\n"</span>, <span class="stringliteral">"LS Requests"</span>, <a class="code" href="ospf-extern_8h.html#6ff92e91f0531f31567a8453d5b2b08b">g_ospf_stats</a>-&gt;s_sent_ls_requests);
<a name="l00404"></a>00404         printf(<span class="stringliteral">"\t%-50s %11ld\n"</span>, <span class="stringliteral">"LS Updates"</span>, <a class="code" href="ospf-extern_8h.html#6ff92e91f0531f31567a8453d5b2b08b">g_ospf_stats</a>-&gt;s_sent_ls_updates);
<a name="l00405"></a>00405         printf(<span class="stringliteral">"\t%-50s %11ld\n"</span>, <span class="stringliteral">"LS Acks"</span>, <a class="code" href="ospf-extern_8h.html#6ff92e91f0531f31567a8453d5b2b08b">g_ospf_stats</a>-&gt;s_sent_ls_acks);
<a name="l00406"></a>00406         printf(<span class="stringliteral">"\t%-50s %11ld\n"</span>, <span class="stringliteral">"Unknown Packets"</span>, <a class="code" href="ospf-extern_8h.html#6ff92e91f0531f31567a8453d5b2b08b">g_ospf_stats</a>-&gt;s_sent_unknown);
<a name="l00407"></a>00407         printf(<span class="stringliteral">"\t%-50s %11ld\n"</span>, <span class="stringliteral">"Lost Packets"</span>, <a class="code" href="ospf-extern_8h.html#6ff92e91f0531f31567a8453d5b2b08b">g_ospf_stats</a>-&gt;s_sent_lost);
<a name="l00408"></a>00408         printf(<span class="stringliteral">"\n"</span>);
<a name="l00409"></a>00409         printf(<span class="stringliteral">"BGP Caused OSPF Updates: %ld\n"</span>, <a class="code" href="ospf-extern_8h.html#6ff92e91f0531f31567a8453d5b2b08b">g_ospf_stats</a>-&gt;s_cause_bgp);
<a name="l00410"></a>00410         printf(<span class="stringliteral">"OSPF Caused OSPF Updates: %ld\n"</span>, <a class="code" href="ospf-extern_8h.html#6ff92e91f0531f31567a8453d5b2b08b">g_ospf_stats</a>-&gt;s_cause_ospf);
<a name="l00411"></a>00411         printf(<span class="stringliteral">"\n"</span>);
<a name="l00412"></a>00412 
<a name="l00413"></a>00413         <span class="keywordflow">if</span>(!<a class="code" href="ospf-extern_8h.html#40c99b64349659459b09f91834346114">g_ospf_routing_file</a>)
<a name="l00414"></a>00414         {
<a name="l00415"></a>00415                 printf(<span class="stringliteral">"Unable to create routing file! \n"</span>);
<a name="l00416"></a>00416                 <span class="keywordflow">return</span>;
<a name="l00417"></a>00417         }
<a name="l00418"></a>00418 
<a name="l00419"></a>00419         <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="rn-extern_8h.html#7ca5dc0546d7333fe497cc998d7ba11a">g_rn_nmachines</a>; i++)
<a name="l00420"></a>00420         {
<a name="l00421"></a>00421                 m = &amp;<a class="code" href="rn-extern_8h.html#ee3d7ec53a8a3c8bff8efb090a32d5fd">g_rn_machines</a>[i];
<a name="l00422"></a>00422                 ar = m-&gt;subnet-&gt;area;
<a name="l00423"></a>00423 
<a name="l00424"></a>00424                 <span class="keywordflow">if</span>(m-&gt;type != <a class="code" href="rn-types_8h.html#c37ecf88c448feb116c70fd006409a84d9007e6048b3dba91dfc86f46dc919eb">c_router</a>)
<a name="l00425"></a>00425                         <span class="keywordflow">continue</span>;
<a name="l00426"></a>00426 
<a name="l00427"></a>00427                 <span class="comment">//write(g_ospf_routing_file, m-&gt;ft, ar-&gt;g_ospf_nlsa * sizeof(unsigned int));</span>
<a name="l00428"></a>00428                 <span class="keywordflow">for</span>(j = 0; j &lt; ar-&gt;g_ospf_nlsa; j++)
<a name="l00429"></a>00429                         fprintf(<a class="code" href="ospf-extern_8h.html#40c99b64349659459b09f91834346114">g_ospf_routing_file</a>, <span class="stringliteral">"%d "</span>, m-&gt;ft[j]);
<a name="l00430"></a>00430                 fprintf(<a class="code" href="ospf-extern_8h.html#40c99b64349659459b09f91834346114">g_ospf_routing_file</a>, <span class="stringliteral">"\n"</span>);
<a name="l00431"></a>00431         }
<a name="l00432"></a>00432 
<a name="l00433"></a>00433         <span class="comment">//fclose(g_ospf_routing_file);</span>
<a name="l00434"></a>00434 
<a name="l00435"></a>00435         <span class="keywordflow">if</span>(<a class="code" href="ospf-extern_8h.html#49edbff370ec3a56723d1dc19e990d14">g_ospf_lsa_file</a>)
<a name="l00436"></a>00436                 ; <span class="comment">// fclose(g_ospf_lsa_file);</span>
<a name="l00437"></a>00437 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="1a0d7bfac4f79c936b7940887971c1ec"></a><!-- doxytag: member="ospf-extern.h::ospf_nbr_event_handler" ref="1a0d7bfac4f79c936b7940887971c1ec" args="(ospf_state *state, ospf_nbr *nbr, ospf_nbr_event event, tw_lp *lp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf_nbr_event_handler           </td>
          <td>(</td>
          <td class="paramtype">ospf_state *&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ospf_nbr *&nbsp;</td>
          <td class="paramname"> <em>nbr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ospf_nbr_event&nbsp;</td>
          <td class="paramname"> <em>event</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-neighbor-state_8c-source.html#l00544">544</a> of file <a class="el" href="ospf-neighbor-state_8c-source.html">ospf-neighbor-state.c</a>.</p>

<p>References <a class="el" href="ospf-neighbor-state_8c-source.html#l00491">ospf_nbr_adj_ok()</a>, <a class="el" href="ospf-neighbor-state_8c-source.html#l00114">ospf_nbr_exchange_done()</a>, <a class="el" href="ospf-neighbor-state_8c-source.html#l00289">ospf_nbr_hello_recv()</a>, <a class="el" href="ospf-neighbor-state_8c-source.html#l00178">ospf_nbr_inactivity_timer()</a>, <a class="el" href="ospf-neighbor-state_8c-source.html#l00232">ospf_nbr_kill_nbr()</a>, <a class="el" href="ospf-neighbor-state_8c-source.html#l00271">ospf_nbr_ll_down()</a>, <a class="el" href="ospf-neighbor-state_8c-source.html#l00407">ospf_nbr_neg_done()</a>, <a class="el" href="ospf-neighbor-state_8c-source.html#l00252">ospf_nbr_one_way_recv()</a>, <a class="el" href="ospf-neighbor-state_8c-source.html#l00532">ospf_nbr_seqnum_mismatch()</a>, <a class="el" href="ospf-neighbor-state_8c-source.html#l00152">ospf_nbr_start()</a>, and <a class="el" href="ospf-neighbor-state_8c-source.html#l00334">ospf_nbr_two_way_recv()</a>.</p>

<p>Referenced by <a class="el" href="ospf-dd_8c-source.html#l00004">dd_process()</a>, <a class="el" href="ospf-ls_8c-source.html#l00243">ls_update_process()</a>, <a class="el" href="ospf-dd_8c-source.html#l00280">ospf_dd_event_handler()</a>, <a class="el" href="ospf-router_8c-source.html#l00037">ospf_event_handler()</a>, <a class="el" href="ospf-hello_8c-source.html#l00115">ospf_hello_packet()</a>, <a class="el" href="ospf-interface_8c-source.html#l00016">ospf_interface_calc_dr()</a>, <a class="el" href="ospf-interface_8c-source.html#l00338">ospf_interface_down()</a>, <a class="el" href="ospf-router-rc_8c-source.html#l00004">ospf_rc_event_handler()</a>, and <a class="el" href="ospf-routing_8c-source.html#l00404">ospf_routing_init()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00545"></a>00545 {
<a name="l00546"></a>00546         <span class="keywordflow">switch</span> (event)
<a name="l00547"></a>00547         {
<a name="l00548"></a>00548         <span class="keywordflow">case</span> ospf_nbr_hello_recv_ev:
<a name="l00549"></a>00549                 <a class="code" href="ospf-neighbor-state_8c.html#cc1c2540da5560fdaeabf89ca364e36f">ospf_nbr_hello_recv</a>(nbr, lp);
<a name="l00550"></a>00550                 <span class="keywordflow">break</span>;
<a name="l00551"></a>00551         <span class="keywordflow">case</span> ospf_nbr_start_ev:
<a name="l00552"></a>00552                 <a class="code" href="ospf-neighbor-state_8c.html#c0cf33562f32f5b69ee5fed9117cb093">ospf_nbr_start</a>(nbr, lp);
<a name="l00553"></a>00553                 <span class="keywordflow">break</span>;
<a name="l00554"></a>00554         <span class="keywordflow">case</span> ospf_nbr_one_way_ev:
<a name="l00555"></a>00555                 <a class="code" href="ospf-neighbor-state_8c.html#0f91660a3fde5be3225e117974d4080e">ospf_nbr_one_way_recv</a>(nbr, lp);
<a name="l00556"></a>00556                 <span class="keywordflow">break</span>;
<a name="l00557"></a>00557         <span class="keywordflow">case</span> ospf_nbr_two_way_recv_ev:
<a name="l00558"></a>00558                 <a class="code" href="ospf-neighbor-state_8c.html#3ff8ce84da0b278f507f06cf191df416">ospf_nbr_two_way_recv</a>(nbr, lp);
<a name="l00559"></a>00559                 <span class="keywordflow">break</span>;
<a name="l00560"></a>00560         <span class="keywordflow">case</span> ospf_nbr_neg_done_ev:
<a name="l00561"></a>00561                 <a class="code" href="ospf-neighbor-state_8c.html#e96ffdffc78e7644401b423cad880fb7">ospf_nbr_neg_done</a>(state, nbr, lp);
<a name="l00562"></a>00562                 <span class="keywordflow">break</span>;
<a name="l00563"></a>00563         <span class="keywordflow">case</span> ospf_nbr_exchange_done_ev:
<a name="l00564"></a>00564                 <a class="code" href="ospf-neighbor-state_8c.html#492ecde4cb28da36229c89b0577754fd">ospf_nbr_exchange_done</a>(state, nbr, lp);
<a name="l00565"></a>00565                 <span class="keywordflow">break</span>;
<a name="l00566"></a>00566         <span class="keywordflow">case</span> ospf_nbr_bad_ls_request_ev:
<a name="l00567"></a>00567                 <span class="keywordflow">if</span> (nbr-&gt;state &gt;= ospf_nbr_exchange_st)
<a name="l00568"></a>00568                         <a class="code" href="ospf-neighbor-state_8c.html#5726a5d528b19997ed2a399ec8db34e1">ospf_nbr_seqnum_mismatch</a>(nbr, lp);
<a name="l00569"></a>00569                 <span class="keywordflow">break</span>;
<a name="l00570"></a>00570         <span class="keywordflow">case</span> ospf_nbr_load_done_ev:
<a name="l00571"></a>00571                 <span class="keywordflow">if</span> (nbr-&gt;state == ospf_nbr_loading_st)
<a name="l00572"></a>00572                         nbr-&gt;state = ospf_nbr_full_st;
<a name="l00573"></a>00573 
<a name="l00574"></a>00574                 printf(<span class="stringliteral">"%lld: new neighbor at full_st: %d \n"</span>, lp-&gt;id, nbr-&gt;id);
<a name="l00575"></a>00575                 <span class="keywordflow">break</span>;
<a name="l00576"></a>00576         <span class="keywordflow">case</span> ospf_nbr_adj_ok_ev:
<a name="l00577"></a>00577                 <a class="code" href="ospf-neighbor-state_8c.html#c68ea7bcff52f984773f41933e8110ba">ospf_nbr_adj_ok</a>(nbr, lp);
<a name="l00578"></a>00578                 <span class="keywordflow">break</span>;
<a name="l00579"></a>00579         <span class="keywordflow">case</span> ospf_nbr_seqnum_mismatch_ev:
<a name="l00580"></a>00580                 <a class="code" href="ospf-neighbor-state_8c.html#5726a5d528b19997ed2a399ec8db34e1">ospf_nbr_seqnum_mismatch</a>(nbr, lp);
<a name="l00581"></a>00581                 <span class="keywordflow">break</span>;
<a name="l00582"></a>00582         <span class="keywordflow">case</span> ospf_nbr_kill_nbr_ev:
<a name="l00583"></a>00583                 <a class="code" href="ospf-neighbor-state_8c.html#3d8a5692eeb8f5f2e744043439f4351b">ospf_nbr_kill_nbr</a>(nbr, lp);
<a name="l00584"></a>00584                 <span class="keywordflow">break</span>;
<a name="l00585"></a>00585         <span class="keywordflow">case</span> ospf_nbr_inactivity_timer_ev:
<a name="l00586"></a>00586                 <a class="code" href="ospf-neighbor-state_8c.html#fd433c9eb0a9e2410bf20b37e053aa21">ospf_nbr_inactivity_timer</a>(nbr, lp);
<a name="l00587"></a>00587                 <span class="keywordflow">break</span>;
<a name="l00588"></a>00588         <span class="keywordflow">case</span> rc_ospf_nbr_inactivity_timer_ev:
<a name="l00589"></a>00589                 <a class="code" href="ospf-neighbor-state_8c.html#fd433c9eb0a9e2410bf20b37e053aa21">ospf_nbr_inactivity_timer</a>(nbr, lp);
<a name="l00590"></a>00590                 <span class="keywordflow">break</span>;
<a name="l00591"></a>00591         <span class="keywordflow">case</span> ospf_nbr_ll_down_ev:
<a name="l00592"></a>00592                 <a class="code" href="ospf-neighbor-state_8c.html#ccdbe4d936c36964f97019f998794151">ospf_nbr_ll_down</a>(nbr, lp);
<a name="l00593"></a>00593                 <span class="keywordflow">break</span>;
<a name="l00594"></a>00594         <span class="keywordflow">default</span>:
<a name="l00595"></a>00595                 tw_error(TW_LOC, <span class="stringliteral">"Unknown nbr event: %d"</span>, event);
<a name="l00596"></a>00596         }
<a name="l00597"></a>00597 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="05c4d9902736734864c528052070d101"></a><!-- doxytag: member="ospf-extern.h::ospf_neighbor_init" ref="05c4d9902736734864c528052070d101" args="(ospf_state *state, tw_lp *lp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf_neighbor_init           </td>
          <td>(</td>
          <td class="paramtype">ospf_state *&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-neighbor_8c-source.html#l00082">82</a> of file <a class="el" href="ospf-neighbor_8c-source.html">ospf-neighbor.c</a>.</p>

<p>References <a class="el" href="ospf-neighbor_8c-source.html#l00018">neighbor_init()</a>.</p>

<p>Referenced by <a class="el" href="ospf-router_8c-source.html#l00237">ospf_startup()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00083"></a>00083 {
<a name="l00084"></a>00084         <span class="keywordtype">int</span>              i;
<a name="l00085"></a>00085 
<a name="l00086"></a>00086         <span class="keywordflow">for</span>(i = 0; i &lt; state-&gt;n_interfaces; i++)
<a name="l00087"></a>00087                 <a class="code" href="ospf-neighbor_8c.html#877ecfd0b00750f211018df3d3b0234d">neighbor_init</a>(state, &amp;state-&gt;nbr[i], lp);
<a name="l00088"></a>00088 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="5c4172f703019d7ea68ed34370d7120f"></a><!-- doxytag: member="ospf-extern.h::ospf_random_weights" ref="5c4172f703019d7ea68ed34370d7120f" args="(ospf_state *state, tw_lp *lp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf_random_weights           </td>
          <td>(</td>
          <td class="paramtype">ospf_state *&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-experiments_8c-source.html#l00004">4</a> of file <a class="el" href="ospf-experiments_8c-source.html">ospf-experiments.c</a>.</p>

<p>References <a class="el" href="ospf-global_8c-source.html#l00007">g_ospf_fd</a>, and <a class="el" href="rn-timer_8c-source.html#l00004">rn_timer_simple()</a>.</p>

<p>Referenced by <a class="el" href="ospf-router_8c-source.html#l00237">ospf_startup()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00005"></a>00005 {
<a name="l00006"></a>00006         tw_memory       *b;
<a name="l00007"></a>00007         tw_event        *e;
<a name="l00008"></a>00008         tw_stime         next_status;
<a name="l00009"></a>00009 
<a name="l00010"></a>00010         ospf_message    *m;
<a name="l00011"></a>00011 
<a name="l00012"></a>00012         <span class="keywordtype">int</span>              percent;
<a name="l00013"></a>00013         <span class="keywordtype">long</span> <span class="keywordtype">int</span>         i;
<a name="l00014"></a>00014 
<a name="l00015"></a>00015         <span class="keywordflow">for</span>(i = 0; i &lt; state-&gt;m-&gt;nlinks; i++)
<a name="l00016"></a>00016         {
<a name="l00017"></a>00017                 percent = tw_rand_integer(lp-&gt;rng, 0, 100);
<a name="l00018"></a>00018 
<a name="l00019"></a>00019                 <span class="keywordflow">if</span>(percent &gt; 10 + 1)
<a name="l00020"></a>00020                         <span class="keywordflow">return</span>;
<a name="l00021"></a>00021 
<a name="l00022"></a>00022                 next_status = tw_rand_integer(lp-&gt;rng, 1, g_tw_ts_end);
<a name="l00023"></a>00023 
<a name="l00024"></a>00024                 <span class="keywordflow">if</span>(next_status &gt;= g_tw_ts_end)
<a name="l00025"></a>00025                         <span class="keywordflow">continue</span>;
<a name="l00026"></a>00026 
<a name="l00027"></a>00027                 e = NULL;
<a name="l00028"></a>00028                 e = <a class="code" href="rn-extern_8h.html#1b018b2a83777582dde06961f4ef2b80">rn_timer_simple</a>(lp, next_status);
<a name="l00029"></a>00029 
<a name="l00030"></a>00030                 b = tw_memory_alloc(lp, <a class="code" href="ospf-extern_8h.html#884d66f70a693353a1894758d71deb99">g_ospf_fd</a>);
<a name="l00031"></a>00031                 m = tw_memory_data(b);
<a name="l00032"></a>00032 
<a name="l00033"></a>00033                 m-&gt;type = OSPF_WEIGHT_CHANGE;
<a name="l00034"></a>00034                 m-&gt;data = (<span class="keywordtype">void</span> *) i;
<a name="l00035"></a>00035 
<a name="l00036"></a>00036                 tw_event_memory_set(e, b, <a class="code" href="ospf-extern_8h.html#884d66f70a693353a1894758d71deb99">g_ospf_fd</a>);
<a name="l00037"></a>00037         }
<a name="l00038"></a>00038 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="12d56e24e160fc01f66e7972f06d7250"></a><!-- doxytag: member="ospf-extern.h::ospf_rc_event_handler" ref="12d56e24e160fc01f66e7972f06d7250" args="(ospf_state *, tw_bf *bf, rn_message *m, tw_lp *lp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf_rc_event_handler           </td>
          <td>(</td>
          <td class="paramtype">ospf_state *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_bf *&nbsp;</td>
          <td class="paramname"> <em>bf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">rn_message *&nbsp;</td>
          <td class="paramname"> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-router-rc_8c-source.html#l00004">4</a> of file <a class="el" href="ospf-router-rc_8c-source.html">ospf-router-rc.c</a>.</p>

<p>References <a class="el" href="ospf-hello-rc_8c-source.html#l00004">ospf_hello_packet_rc()</a>, <a class="el" href="ospf-router_8c-source.html#l00016">ospf_int_getinterface()</a>, <a class="el" href="ospf-neighbor-state_8c-source.html#l00544">ospf_nbr_event_handler()</a>, <a class="el" href="ospf-timer_8c-source.html#l00029">ospf_timer_start()</a>, and <a class="el" href="rn-message_8c-source.html#l00016">rn_message_data()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00005"></a>00005 {
<a name="l00006"></a>00006 <span class="preprocessor">#if 0</span>
<a name="l00007"></a>00007 <span class="preprocessor"></span>        ospf_message    *msg;
<a name="l00008"></a>00008         ospf_nbr        *nbr;
<a name="l00009"></a>00009 
<a name="l00010"></a>00010         msg = <a class="code" href="rn-extern_8h.html#86476e44643558d9a2008c976220a0a3">rn_message_data</a>(rn_msg);
<a name="l00011"></a>00011         nbr = <a class="code" href="ospf-extern_8h.html#a28c766dd7f8f5caa136fa2dc1bbb4e5">ospf_int_getinterface</a>(state, rn_msg-&gt;src);
<a name="l00012"></a>00012 
<a name="l00013"></a>00013         <span class="keywordflow">if</span>(!nbr)
<a name="l00014"></a>00014                 nbr = ospf_util_data(msg);
<a name="l00015"></a>00015 
<a name="l00016"></a>00016         <span class="keywordflow">if</span>(msg-&gt;type == OSPF_IP)
<a name="l00017"></a>00017                 tw_error(TW_LOC, <span class="stringliteral">"IP packet forwarding not reversible yet!"</span>);
<a name="l00018"></a>00018 
<a name="l00019"></a>00019         <span class="keywordflow">switch</span>(msg-&gt;type)
<a name="l00020"></a>00020         {
<a name="l00021"></a>00021                 <span class="keywordflow">case</span> OSPF_HELLO_MSG:
<a name="l00022"></a>00022                         <a class="code" href="ospf-extern-rc_8h.html#18c6ada491b352814b7e0a52f752d167">ospf_hello_packet_rc</a>(state, nbr, bf, msg, lp);
<a name="l00023"></a>00023                         state-&gt;stats-&gt;s_e_hello_in--;
<a name="l00024"></a>00024                         <span class="keywordflow">break</span>;
<a name="l00025"></a>00025                 <span class="keywordflow">case</span> OSPF_HELLO_SEND:
<a name="l00026"></a>00026                         <span class="comment">// need to restart timer</span>
<a name="l00027"></a>00027                         nbr-&gt;hello_timer =
<a name="l00028"></a>00028                                 <a class="code" href="ospf-extern_8h.html#75e3fe5d4b90cd1e2ca417ac3d9518c7">ospf_timer_start</a>(nbr, nbr-&gt;hello_timer,
<a name="l00029"></a>00029                                          nbr-&gt;hello_interval,
<a name="l00030"></a>00030                                          OSPF_HELLO_SEND, lp);
<a name="l00031"></a>00031                         <span class="keywordflow">break</span>;
<a name="l00032"></a>00032                 <span class="keywordflow">case</span> OSPF_HELLO_TIMEOUT:
<a name="l00033"></a>00033                         state-&gt;stats-&gt;s_e_hello_timeouts--;
<a name="l00034"></a>00034                         <a class="code" href="ospf-extern_8h.html#1a0d7bfac4f79c936b7940887971c1ec">ospf_nbr_event_handler</a>(state, nbr,
<a name="l00035"></a>00035                                         rc_ospf_nbr_inactivity_timer_ev, lp);
<a name="l00036"></a>00036                         <span class="keywordflow">break</span>;
<a name="l00037"></a>00037                 <span class="keywordflow">default</span>:
<a name="l00038"></a>00038                         tw_error(TW_LOC, <span class="stringliteral">"Unhandled event type (%d) in "</span>
<a name="l00039"></a>00039                                          <span class="stringliteral">"rc_event_handler!"</span>, msg-&gt;type);
<a name="l00040"></a>00040         }
<a name="l00041"></a>00041 <span class="preprocessor">#endif</span>
<a name="l00042"></a>00042 <span class="preprocessor"></span>}
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="e28c849cc83c152931edc92df421d4a8"></a><!-- doxytag: member="ospf-extern.h::ospf_router_debug_rate" ref="e28c849cc83c152931edc92df421d4a8" args="(tw_lp *lp, int *next)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf_router_debug_rate           </td>
          <td>(</td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>next</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-router-debug_8c-source.html#l00008">8</a> of file <a class="el" href="ospf-router-debug_8c-source.html">ospf-router-debug.c</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00009"></a>00009 {
<a name="l00010"></a>00010         <span class="keywordflow">if</span>(lp-&gt;id == 0 &amp;&amp; lp-&gt;kp-&gt;s_nevent_processed &gt; *next)
<a name="l00011"></a>00011         {
<a name="l00012"></a>00012                 tw_wall_now(&amp;g_tw_pe[0].end_time);
<a name="l00013"></a>00013                 tw_wall_sub(&amp;g_tw_pe[0].run_time, &amp;g_tw_pe[0].end_time,
<a name="l00014"></a>00014                                 &amp;g_tw_pe[0].start_time);
<a name="l00015"></a>00015 
<a name="l00016"></a>00016                 printf(<span class="stringliteral">"Events processed: %ld \n"</span>, 
<a name="l00017"></a>00017                                 lp-&gt;kp-&gt;s_nevent_processed);
<a name="l00018"></a>00018 
<a name="l00019"></a>00019                 printf(<span class="stringliteral">"Event rate: %11.2f (events/sec)\n"</span>, 
<a name="l00020"></a>00020                         (<span class="keywordtype">double</span>) lp-&gt;kp-&gt;s_nevent_processed / 
<a name="l00021"></a>00021                         tw_wall_to_double(&amp;g_tw_pe[0].run_time));
<a name="l00022"></a>00022 
<a name="l00023"></a>00023                 *next += 1000000;
<a name="l00024"></a>00024         }
<a name="l00025"></a>00025 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="383c2652c0d20a8040a24ff45dd1b63c"></a><!-- doxytag: member="ospf-extern.h::ospf_router_debug_routing" ref="383c2652c0d20a8040a24ff45dd1b63c" args="(ospf_state *state, int d, tw_lp *lp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf_router_debug_routing           </td>
          <td>(</td>
          <td class="paramtype">ospf_state *&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>d</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-router-debug_8c-source.html#l00030">30</a> of file <a class="el" href="ospf-router-debug_8c-source.html">ospf-router-debug.c</a>.</p>

<p>References <a class="el" href="save_2ip-routing_8c-source.html#l00103">f</a>, <a class="el" href="rn-global_8c-source.html#l00052">g_rn_nrouters</a>, and <a class="el" href="ospf-router-debug_8c-source.html#l00027">x</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00031"></a>00031 {
<a name="l00032"></a>00032 <span class="preprocessor">#if 0</span>
<a name="l00033"></a>00033 <span class="preprocessor"></span>        FILE    *<a class="code" href="save_2ip-routing_8c.html#e3285ac7f4cc9a400327c9efb5f535f7">f</a>;
<a name="l00034"></a>00034         <span class="keywordtype">char</span>     file[1024];
<a name="l00035"></a>00035 
<a name="l00036"></a>00036         sprintf(file, <span class="stringliteral">"ospf/logs/r%ld-%d.log"</span>, lp-&gt;id, <a class="code" href="ospf-router-debug_8c.html#6150e0515f7202e2fb518f7206ed97dc">x</a>++);
<a name="l00037"></a>00037         f = fopen(file, <span class="stringliteral">"w"</span>);
<a name="l00038"></a>00038 
<a name="l00039"></a>00039         fprintf(f, <span class="stringliteral">"src\t\tdst\n"</span>);
<a name="l00040"></a>00040         <span class="keywordflow">for</span>(<a class="code" href="save_2ip-routing_8c.html#0ddbf789cfd814565dd88748311c1c36">d</a> = 0; <a class="code" href="save_2ip-routing_8c.html#0ddbf789cfd814565dd88748311c1c36">d</a> &lt; <a class="code" href="rn-extern_8h.html#415a115c34def079d8a050c69167e80b">g_rn_nrouters</a>; <a class="code" href="save_2ip-routing_8c.html#0ddbf789cfd814565dd88748311c1c36">d</a>++)
<a name="l00041"></a>00041         {
<a name="l00042"></a>00042                 <span class="keywordflow">if</span>(state-&gt;ft[<a class="code" href="save_2ip-routing_8c.html#0ddbf789cfd814565dd88748311c1c36">d</a>] == 0xff)
<a name="l00043"></a>00043                         fprintf(f, <span class="stringliteral">"%d\t\tno route\n"</span>, <a class="code" href="save_2ip-routing_8c.html#0ddbf789cfd814565dd88748311c1c36">d</a>);
<a name="l00044"></a>00044                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>(lp-&gt;id == <a class="code" href="save_2ip-routing_8c.html#0ddbf789cfd814565dd88748311c1c36">d</a>)
<a name="l00045"></a>00045                         fprintf(f, <span class="stringliteral">"%d\t\t self d\n"</span>, <a class="code" href="save_2ip-routing_8c.html#0ddbf789cfd814565dd88748311c1c36">d</a>);
<a name="l00046"></a>00046                 <span class="keywordflow">else</span>
<a name="l00047"></a>00047                         fprintf(f, <span class="stringliteral">"%d\t\t%d\n"</span>, <a class="code" href="save_2ip-routing_8c.html#0ddbf789cfd814565dd88748311c1c36">d</a>, state-&gt;ft[<a class="code" href="save_2ip-routing_8c.html#0ddbf789cfd814565dd88748311c1c36">d</a>]);
<a name="l00048"></a>00048         }
<a name="l00049"></a>00049 
<a name="l00050"></a>00050         fclose(f);
<a name="l00051"></a>00051 <span class="preprocessor">#endif</span>
<a name="l00052"></a>00052 <span class="preprocessor"></span>}
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="c687d13222a7d0e3e67998e0d6f48fdc"></a><!-- doxytag: member="ospf-extern.h::ospf_routing_init" ref="c687d13222a7d0e3e67998e0d6f48fdc" args="(ospf_state *state, tw_lp *lp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf_routing_init           </td>
          <td>(</td>
          <td class="paramtype">ospf_state *&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-routing_8c-source.html#l00404">404</a> of file <a class="el" href="ospf-routing_8c-source.html">ospf-routing.c</a>.</p>

<p>References <a class="el" href="save_2ip-routing_8c-source.html#l00104">d</a>, <a class="el" href="save_2ip-routing_8c-source.html#l00103">f</a>, <a class="el" href="ospf-global_8c-source.html#l00028">front</a>, <a class="el" href="ospf-global_8c-source.html#l00038">g_ospf_routing_file</a>, <a class="el" href="ospf-global_8c-source.html#l00019">g_ospf_rt_write</a>, <a class="el" href="rn-global_8c-source.html#l00052">g_rn_nrouters</a>, <a class="el" href="ospf-neighbor-state_8c-source.html#l00544">ospf_nbr_event_handler()</a>, <a class="el" href="ospf-routing_8c-source.html#l00029">ospf_rt_timer()</a>, <a class="el" href="ospf-global_8c-source.html#l00027">p</a>, <a class="el" href="rn-machine_8c-source.html#l00004">rn_getmachine()</a>, <a class="el" href="rn-routing_8c-source.html#l00007">rn_route()</a>, and <a class="el" href="ospf-global_8c-source.html#l00030">s</a>.</p>

<p>Referenced by <a class="el" href="ospf-router_8c-source.html#l00237">ospf_startup()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00405"></a>00405 {
<a name="l00406"></a>00406         ospf_nbr        *nbr;
<a name="l00407"></a>00407 
<a name="l00408"></a>00408         <span class="keywordtype">int</span>              i;
<a name="l00409"></a>00409 
<a name="l00410"></a>00410         <span class="comment">// Init globals for Dijkstra's algorithm</span>
<a name="l00411"></a>00411         <span class="keywordflow">if</span>(!<a class="code" href="ospf-extern_8h.html#b836172141b14032d67fde057a072992">front</a>)
<a name="l00412"></a>00412         {
<a name="l00413"></a>00413                 <span class="comment">//int n = state-&gt;ar-&gt;g_ospf_nlsa;</span>
<a name="l00414"></a>00414                 <span class="keywordtype">int</span> n = <a class="code" href="rn-extern_8h.html#415a115c34def079d8a050c69167e80b">g_rn_nrouters</a>;
<a name="l00415"></a>00415 
<a name="l00416"></a>00416                 <a class="code" href="ospf-extern_8h.html#b836172141b14032d67fde057a072992">front</a> = calloc(n * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>), 1);
<a name="l00417"></a>00417                 <a class="code" href="ospf-extern_8h.html#61b0821c8ee2a2df1d8cf38ebe0f2b3c">p</a> = calloc(n * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>), 1); 
<a name="l00418"></a>00418                 <a class="code" href="save_2ip-routing_8c.html#e3285ac7f4cc9a400327c9efb5f535f7">f</a> = calloc(n * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>), 1); 
<a name="l00419"></a>00419                 <a class="code" href="ospf-extern_8h.html#b4c6c03359486e6fb0ac52a94493df1e">s</a> = calloc(n * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>), 1); 
<a name="l00420"></a>00420                 <a class="code" href="save_2ip-routing_8c.html#0ddbf789cfd814565dd88748311c1c36">d</a> = calloc(n * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>), 1); 
<a name="l00421"></a>00421         }
<a name="l00422"></a>00422 
<a name="l00423"></a>00423         <span class="keywordflow">if</span>(!state-&gt;m-&gt;nhop)
<a name="l00424"></a>00424                 state-&gt;m-&gt;nhop = tw_calloc(TW_LOC, <span class="stringliteral">""</span>, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>), state-&gt;ar-&gt;g_ospf_nlsa);
<a name="l00425"></a>00425 
<a name="l00426"></a>00426         <span class="keywordflow">if</span>(0 == <a class="code" href="ospf-extern_8h.html#c90b3ca848617e3fe636407eb372c5d5">g_ospf_rt_write</a>)
<a name="l00427"></a>00427         {
<a name="l00428"></a>00428                 rn_machine      *m = <a class="code" href="rn-extern_8h.html#b586ebafc20ad652dd538635f5c816b0">rn_getmachine</a>(lp-&gt;id);
<a name="l00429"></a>00429                 <span class="keywordtype">int</span>              i;
<a name="l00430"></a>00430 
<a name="l00431"></a>00431                 <span class="keywordflow">for</span>(i = 0; i &lt; state-&gt;ar-&gt;g_ospf_nlsa; i++)
<a name="l00432"></a>00432                         fscanf(<a class="code" href="ospf-extern_8h.html#40c99b64349659459b09f91834346114">g_ospf_routing_file</a>, <span class="stringliteral">"%d"</span>, &amp;m-&gt;ft[i]);
<a name="l00433"></a>00433 
<a name="l00434"></a>00434                 <span class="comment">//read(g_ospf_routing_file, rn_getmachine(lp-&gt;id)-&gt;ft, </span>
<a name="l00435"></a>00435                 <span class="comment">//      state-&gt;ar-&gt;g_ospf_nlsa * sizeof(int));</span>
<a name="l00436"></a>00436         } <span class="keywordflow">else</span>
<a name="l00437"></a>00437         {
<a name="l00438"></a>00438                 <a class="code" href="ospf-extern_8h.html#fde0ede536714d6ad9959f7c80ebf026">ospf_rt_timer</a>(state, lp-&gt;id);
<a name="l00439"></a>00439 <span class="preprocessor">#if 0</span>
<a name="l00440"></a>00440 <span class="preprocessor"></span>
<a name="l00441"></a>00441                 write(<a class="code" href="ospf-extern_8h.html#40c99b64349659459b09f91834346114">g_ospf_routing_file</a>, <a class="code" href="rn-extern_8h.html#b586ebafc20ad652dd538635f5c816b0">rn_getmachine</a>(lp-&gt;id)-&gt;ft, 
<a name="l00442"></a>00442                         (state-&gt;ar-&gt;g_ospf_nlsa) * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
<a name="l00443"></a>00443 <span class="preprocessor">#endif</span>
<a name="l00444"></a>00444 <span class="preprocessor"></span>        }
<a name="l00445"></a>00445 
<a name="l00446"></a>00446         <span class="keywordflow">return</span>;
<a name="l00447"></a>00447 
<a name="l00448"></a>00448         <span class="comment">/*</span>
<a name="l00449"></a>00449 <span class="comment">         * Take down adjacencies where there is no forwarding table entry</span>
<a name="l00450"></a>00450 <span class="comment">         */</span>
<a name="l00451"></a>00451         <span class="keywordflow">for</span>(i = 0, nbr = state-&gt;nbr; i &lt; state-&gt;n_interfaces; nbr = &amp;state-&gt;nbr[++i])
<a name="l00452"></a>00452         {
<a name="l00453"></a>00453                 <span class="keywordflow">if</span>(<a class="code" href="rn-extern_8h.html#8890679c55545bd36e770b118a920b57">rn_route</a>(state-&gt;m, nbr-&gt;id) == -1)
<a name="l00454"></a>00454                 {
<a name="l00455"></a>00455                         printf(<span class="stringliteral">"%lld: taking down neighbor %d \n"</span>, lp-&gt;id, nbr-&gt;id);
<a name="l00456"></a>00456 
<a name="l00457"></a>00457                         <a class="code" href="ospf-extern_8h.html#1a0d7bfac4f79c936b7940887971c1ec">ospf_nbr_event_handler</a>(state, nbr, ospf_nbr_kill_nbr_ev, lp);
<a name="l00458"></a>00458 <span class="preprocessor">#if 0</span>
<a name="l00459"></a>00459 <span class="preprocessor"></span>                        <span class="comment">// These are just OSPF AS X to OSPF AS Y nbrs</span>
<a name="l00460"></a>00460                         <span class="comment">// we are taking down!</span>
<a name="l00461"></a>00461 
<a name="l00462"></a>00462                         <span class="comment">// setup just what I need!</span>
<a name="l00463"></a>00463                         nbr-&gt;state = ospf_nbr_full_st;
<a name="l00464"></a>00464                         nbr-&gt;requests = (<span class="keywordtype">char</span> *) calloc(state-&gt;ar-&gt;g_ospf_nlsa, 1);
<a name="l00465"></a>00465 
<a name="l00466"></a>00466                         <span class="keywordflow">if</span>(!nbr-&gt;requests)
<a name="l00467"></a>00467                                 tw_error(TW_LOC, <span class="stringliteral">"Out of memory!"</span>);
<a name="l00468"></a>00468 <span class="preprocessor">#endif</span>
<a name="l00469"></a>00469 <span class="preprocessor"></span>                }
<a name="l00470"></a>00470         }
<a name="l00471"></a>00471 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="8e91da94f0927f20f1b2962a45bcb5b9"></a><!-- doxytag: member="ospf-extern.h::ospf_rt_build" ref="8e91da94f0927f20f1b2962a45bcb5b9" args="(ospf_state *state, int start_vertex)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf_rt_build           </td>
          <td>(</td>
          <td class="paramtype">ospf_state *&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>start_vertex</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-routing_8c-source.html#l00004">4</a> of file <a class="el" href="ospf-routing_8c-source.html">ospf-routing.c</a>.</p>

<p>References <a class="el" href="ospf-routing_8c-source.html#l00029">ospf_rt_timer()</a>, and <a class="el" href="ospf-timer_8c-source.html#l00029">ospf_timer_start()</a>.</p>

<p>Referenced by <a class="el" href="ospf-timer-aging_8c-source.html#l00147">ospf_aging_timer()</a>, <a class="el" href="ospf-database_8c-source.html#l00366">ospf_db_insert()</a>, <a class="el" href="ospf-database_8c-source.html#l00288">ospf_db_update()</a>, <a class="el" href="ospf-experiments_8c-source.html#l00041">ospf_experiment_weights()</a>, and <a class="el" href="ospf-neighbor-state_8c-source.html#l00011">ospf_nbr_reset()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00005"></a>00005 {
<a name="l00006"></a>00006         <span class="keywordflow">if</span>(!state-&gt;gstate-&gt;rt_interval)
<a name="l00007"></a>00007         {
<a name="l00008"></a>00008                 <a class="code" href="ospf-extern_8h.html#fde0ede536714d6ad9959f7c80ebf026">ospf_rt_timer</a>(state, start_vertex);
<a name="l00009"></a>00009                 <span class="keywordflow">return</span>;
<a name="l00010"></a>00010         }
<a name="l00011"></a>00011 
<a name="l00012"></a>00012         <span class="keywordflow">if</span>(NULL == state-&gt;rt_timer)
<a name="l00013"></a>00013         {
<a name="l00014"></a>00014                 state-&gt;rt_timer = <a class="code" href="ospf-extern_8h.html#75e3fe5d4b90cd1e2ca417ac3d9518c7">ospf_timer_start</a>(NULL,
<a name="l00015"></a>00015                                                 state-&gt;rt_timer,
<a name="l00016"></a>00016                                                 state-&gt;gstate-&gt;rt_interval,
<a name="l00017"></a>00017                                                 OSPF_RT_TIMER,
<a name="l00018"></a>00018                                                 tw_getlp(start_vertex));
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 <span class="preprocessor">#if VERIFY_ROUTING</span>
<a name="l00021"></a>00021 <span class="preprocessor"></span>                <span class="keywordflow">if</span>(state-&gt;rt_timer)
<a name="l00022"></a>00022                         printf(<span class="stringliteral">"%d: RT Timer set for %lf \n"</span>,
<a name="l00023"></a>00023                                 start_vertex, state-&gt;rt_timer-&gt;recv_ts);
<a name="l00024"></a>00024 <span class="preprocessor">#endif</span>
<a name="l00025"></a>00025 <span class="preprocessor"></span>        }
<a name="l00026"></a>00026 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="5420dafebccc3fbaf5939cab2c4fe46f"></a><!-- doxytag: member="ospf-extern.h::ospf_rt_print" ref="5420dafebccc3fbaf5939cab2c4fe46f" args="(ospf_state *state, tw_lp *lp, FILE *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf_rt_print           </td>
          <td>(</td>
          <td class="paramtype">ospf_state *&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FILE *&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-routing_8c-source.html#l00224">224</a> of file <a class="el" href="ospf-routing_8c-source.html">ospf-routing.c</a>.</p>

<p>References <a class="el" href="save_2ip-routing_8c-source.html#l00104">d</a>, <a class="el" href="rn-global_8c-source.html#l00043">g_rn_nas</a>, <a class="el" href="ospf-lsa_8c-source.html#l00247">getlsa()</a>, <a class="el" href="rn-machine_8c-source.html#l00022">rn_getarea()</a>, <a class="el" href="rn-machine_8c-source.html#l00004">rn_getmachine()</a>, and <a class="el" href="rn-routing_8c-source.html#l00007">rn_route()</a>.</p>

<p>Referenced by <a class="el" href="ospf-stats_8c-source.html#l00008">ospf_statistics_collection()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00225"></a>00225 {
<a name="l00226"></a>00226         rn_machine      *m;
<a name="l00227"></a>00227         rn_area         *ar;
<a name="l00228"></a>00228 
<a name="l00229"></a>00229         ospf_lsa        *lsa;
<a name="l00230"></a>00230         ospf_db_entry   *dbe;
<a name="l00231"></a>00231 
<a name="l00232"></a>00232         <span class="keywordtype">int</span>     <a class="code" href="save_2ip-routing_8c.html#0ddbf789cfd814565dd88748311c1c36">d</a>;
<a name="l00233"></a>00233         <span class="keywordtype">int</span>     i;
<a name="l00234"></a>00234         <span class="keywordtype">int</span>     q;
<a name="l00235"></a>00235 
<a name="l00236"></a>00236         m = state-&gt;m;
<a name="l00237"></a>00237         ar = <a class="code" href="rn-extern_8h.html#d45bc39e5a89bce656786b571acb1ae8">rn_getarea</a>(m);
<a name="l00238"></a>00238 
<a name="l00239"></a>00239         fprintf(log, <span class="stringliteral">"\nRouting table for %lld: \n\n"</span>
<a name="l00240"></a>00240                 <span class="stringliteral">"\t%-20s %-20s %-20s\n"</span>, lp-&gt;id, <span class="stringliteral">"Host id"</span>, 
<a name="l00241"></a>00241                 <span class="stringliteral">"next_hop_interface"</span>, <span class="stringliteral">"next_hop_node_id"</span>);
<a name="l00242"></a>00242 
<a name="l00243"></a>00243         <span class="keywordflow">for</span>(i = 0; i &lt; g_tw_nlp; i++)
<a name="l00244"></a>00244         {
<a name="l00245"></a>00245                 <span class="keywordflow">if</span>(i == lp-&gt;id)
<a name="l00246"></a>00246                 {
<a name="l00247"></a>00247                         fprintf(log, <span class="stringliteral">"\t%-20d %-20s\n"</span>, i, <span class="stringliteral">"self"</span>);
<a name="l00248"></a>00248                         <span class="keywordflow">continue</span>;
<a name="l00249"></a>00249                 }
<a name="l00250"></a>00250 
<a name="l00251"></a>00251                 <span class="keywordflow">if</span>(<a class="code" href="rn-extern_8h.html#8890679c55545bd36e770b118a920b57">rn_route</a>(m, i) == -1)
<a name="l00252"></a>00252                 {
<a name="l00253"></a>00253                         <span class="comment">// May be that I am the originator of this LSA,</span>
<a name="l00254"></a>00254                         <span class="comment">// which would have an FT of -1, so check LSA</span>
<a name="l00255"></a>00255                         <span class="comment">// Check LSA for route</span>
<a name="l00256"></a>00256                         rn_area *dst = <a class="code" href="rn-extern_8h.html#d45bc39e5a89bce656786b571acb1ae8">rn_getarea</a>(<a class="code" href="rn-extern_8h.html#b586ebafc20ad652dd538635f5c816b0">rn_getmachine</a>(i));
<a name="l00257"></a>00257                         dbe = &amp;state-&gt;db[i];
<a name="l00258"></a>00258 
<a name="l00259"></a>00259                         <span class="comment">// if in same area, the only use FT</span>
<a name="l00260"></a>00260                         <span class="keywordflow">if</span>(state-&gt;ar == dst)
<a name="l00261"></a>00261                         {
<a name="l00262"></a>00262                                 fprintf(log, <span class="stringliteral">"\t%-20d %-20s\n"</span>, i, <span class="stringliteral">"no route"</span>);
<a name="l00263"></a>00263                                 <span class="keywordflow">continue</span>;
<a name="l00264"></a>00264                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(state-&gt;ar-&gt;as == dst-&gt;as)
<a name="l00265"></a>00265                         {
<a name="l00266"></a>00266                                 dbe = &amp;state-&gt;db[state-&gt;ar-&gt;nmachines + 
<a name="l00267"></a>00267                                                  dst-&gt;id - dst-&gt;as-&gt;low];
<a name="l00268"></a>00268                         } <span class="keywordflow">else</span>
<a name="l00269"></a>00269                         {
<a name="l00270"></a>00270                                 dbe = &amp;state-&gt;db[state-&gt;ar-&gt;nmachines +
<a name="l00271"></a>00271                                         state-&gt;ar-&gt;as-&gt;nareas + dst-&gt;as-&gt;id];
<a name="l00272"></a>00272                         }
<a name="l00273"></a>00273 
<a name="l00274"></a>00274                         <span class="keywordflow">if</span>(dbe-&gt;b.free)
<a name="l00275"></a>00275                         {
<a name="l00276"></a>00276                                 fprintf(log, <span class="stringliteral">"\t%-20d %-20s\n"</span>, i, <span class="stringliteral">"no route"</span>);
<a name="l00277"></a>00277                                 <span class="keywordflow">continue</span>;
<a name="l00278"></a>00278                         }
<a name="l00279"></a>00279 
<a name="l00280"></a>00280                         lsa = <a class="code" href="ospf-extern_8h.html#9608d8ba29ae5cc559afe788cddade3f">getlsa</a>(state-&gt;m, dbe-&gt;lsa, dbe-&gt;b.entry);
<a name="l00281"></a>00281 
<a name="l00282"></a>00282                         <span class="keywordflow">if</span>(!lsa)
<a name="l00283"></a>00283                         {
<a name="l00284"></a>00284                                 fprintf(log, <span class="stringliteral">"\t%-20d %-20s\n"</span>, i, <span class="stringliteral">"no route (NO LSA)"</span>);
<a name="l00285"></a>00285                                 <span class="keywordflow">continue</span>;
<a name="l00286"></a>00286                         } <span class="keywordflow">else</span>
<a name="l00287"></a>00287                                 d = <a class="code" href="rn-extern_8h.html#8890679c55545bd36e770b118a920b57">rn_route</a>(state-&gt;m, lsa-&gt;adv_r);
<a name="l00288"></a>00288 
<a name="l00289"></a>00289                         <span class="keywordflow">if</span>(lsa-&gt;adv_r == lp-&gt;id)
<a name="l00290"></a>00290                         {
<a name="l00291"></a>00291                                 <span class="keywordflow">if</span>(lsa-&gt;links.size != 0)
<a name="l00292"></a>00292                                 {
<a name="l00293"></a>00293                                         ospf_lsa_link * l = 
<a name="l00294"></a>00294                                                 tw_memory_data(lsa-&gt;links.head);
<a name="l00295"></a>00295                                         fprintf(log, <span class="stringliteral">"\t%-20d %-20s %-20d\n"</span>, 
<a name="l00296"></a>00296                                                 i, <span class="stringliteral">"ORIGIN"</span>, l-&gt;dst);
<a name="l00297"></a>00297                                 } <span class="keywordflow">else</span>
<a name="l00298"></a>00298                                         fprintf(log, <span class="stringliteral">"\t%-20d %-20s \n"</span>, 
<a name="l00299"></a>00299                                                 i, <span class="stringliteral">"ORIGIN"</span>);
<a name="l00300"></a>00300                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(d == -1)
<a name="l00301"></a>00301                                 fprintf(log, <span class="stringliteral">"\t%-20d %-20s\n"</span>, i, <span class="stringliteral">"no route"</span>);
<a name="l00302"></a>00302                         <span class="keywordflow">else</span>
<a name="l00303"></a>00303                                 fprintf(log, <span class="stringliteral">"\t%-20d %-20d %-25lld\n"</span>, 
<a name="l00304"></a>00304                                         i, d,
<a name="l00305"></a>00305                                         state-&gt;m-&gt;link[d].addr);
<a name="l00306"></a>00306                         <span class="comment">//fprintf(log, "\t%-20d %-20s\n", i, "no route");</span>
<a name="l00307"></a>00307                 } <span class="keywordflow">else</span>
<a name="l00308"></a>00308                         fprintf(log, <span class="stringliteral">"\t%-20d %-20d %-25lld\n"</span>, 
<a name="l00309"></a>00309                                         i, <a class="code" href="rn-extern_8h.html#8890679c55545bd36e770b118a920b57">rn_route</a>(m, i), 
<a name="l00310"></a>00310                                         state-&gt;m-&gt;link[<a class="code" href="rn-extern_8h.html#8890679c55545bd36e770b118a920b57">rn_route</a>(m, i)].addr);
<a name="l00311"></a>00311         }
<a name="l00312"></a>00312 
<a name="l00313"></a>00313         q = ar-&gt;nmachines;
<a name="l00314"></a>00314 
<a name="l00315"></a>00315         fprintf(log, <span class="stringliteral">"\n\n\t%-20s %-20s %-20s\n"</span>, <span class="stringliteral">"Area id"</span>, 
<a name="l00316"></a>00316                 <span class="stringliteral">"next_hop_interface"</span>, <span class="stringliteral">"next_hop_node_id"</span>);
<a name="l00317"></a>00317 
<a name="l00318"></a>00318         <span class="keywordflow">for</span>(i = 0; q &lt; ar-&gt;nmachines + ar-&gt;as-&gt;nareas; q++, i++)
<a name="l00319"></a>00319         {
<a name="l00320"></a>00320                 <span class="keywordflow">if</span>(i + state-&gt;ar-&gt;as-&gt;low == state-&gt;ar-&gt;id)
<a name="l00321"></a>00321                 {
<a name="l00322"></a>00322                         fprintf(log, <span class="stringliteral">"\t%-20lld %-20s\n"</span>, i + ar-&gt;as-&gt;low, <span class="stringliteral">"self"</span>);
<a name="l00323"></a>00323                         <span class="keywordflow">continue</span>;
<a name="l00324"></a>00324                 }
<a name="l00325"></a>00325 
<a name="l00326"></a>00326                 dbe = &amp;state-&gt;db[q];
<a name="l00327"></a>00327                 <span class="keywordflow">if</span>(dbe-&gt;b.free)
<a name="l00328"></a>00328                 {
<a name="l00329"></a>00329                         d = <a class="code" href="rn-extern_8h.html#8890679c55545bd36e770b118a920b57">rn_route</a>(state-&gt;m, q);
<a name="l00330"></a>00330 
<a name="l00331"></a>00331                         <span class="keywordflow">if</span>(-1 == d)
<a name="l00332"></a>00332                                 fprintf(log, <span class="stringliteral">"\t%-20lld %-20s\n"</span>, 
<a name="l00333"></a>00333                                         i + ar-&gt;as-&gt;low, <span class="stringliteral">"no route"</span>);
<a name="l00334"></a>00334                         <span class="keywordflow">else</span>
<a name="l00335"></a>00335                                 fprintf(log, <span class="stringliteral">"\t%-20lld %-20d %-15lld (no lsa)\n"</span>, 
<a name="l00336"></a>00336                                         i + ar-&gt;as-&gt;low, state-&gt;m-&gt;ft[q],
<a name="l00337"></a>00337                                         state-&gt;m-&gt;link[state-&gt;m-&gt;ft[q]].addr);
<a name="l00338"></a>00338                         <span class="keywordflow">continue</span>;
<a name="l00339"></a>00339                 }
<a name="l00340"></a>00340                 
<a name="l00341"></a>00341                 <span class="comment">// Check LSA for route</span>
<a name="l00342"></a>00342                 lsa = <a class="code" href="ospf-extern_8h.html#9608d8ba29ae5cc559afe788cddade3f">getlsa</a>(state-&gt;m, dbe-&gt;lsa, dbe-&gt;b.entry);
<a name="l00343"></a>00343                 d = <a class="code" href="rn-extern_8h.html#8890679c55545bd36e770b118a920b57">rn_route</a>(state-&gt;m, lsa-&gt;adv_r);
<a name="l00344"></a>00344 
<a name="l00345"></a>00345                 <span class="keywordflow">if</span>(lsa-&gt;adv_r == lp-&gt;id)
<a name="l00346"></a>00346                 {
<a name="l00347"></a>00347                         <span class="keywordflow">if</span>(lsa-&gt;links.size)
<a name="l00348"></a>00348                         {
<a name="l00349"></a>00349                                 ospf_lsa_link * l = tw_memory_data(lsa-&gt;links.head);
<a name="l00350"></a>00350                                 fprintf(log, <span class="stringliteral">"\t%-20lld %-20s %-20d\n"</span>, 
<a name="l00351"></a>00351                                         i + ar-&gt;as-&gt;low, <span class="stringliteral">"ORIGIN"</span>, l-&gt;dst);
<a name="l00352"></a>00352                         } <span class="keywordflow">else</span>
<a name="l00353"></a>00353                                 fprintf(log, <span class="stringliteral">"\t%-20lld %-20s\n"</span>, 
<a name="l00354"></a>00354                                         i + ar-&gt;as-&gt;low, <span class="stringliteral">"ORIGIN"</span>);
<a name="l00355"></a>00355                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(d == -1)
<a name="l00356"></a>00356                         fprintf(log, <span class="stringliteral">"\t%-20d %-20s\n"</span>, i, <span class="stringliteral">"no route"</span>);
<a name="l00357"></a>00357                 <span class="keywordflow">else</span>
<a name="l00358"></a>00358                         fprintf(log, <span class="stringliteral">"\t%-20lld %-20d %-25lld\n"</span>, 
<a name="l00359"></a>00359                                 i + ar-&gt;as-&gt;low, state-&gt;m-&gt;ft[q],
<a name="l00360"></a>00360                                 state-&gt;m-&gt;link[state-&gt;m-&gt;ft[q]].addr);
<a name="l00361"></a>00361         }
<a name="l00362"></a>00362 
<a name="l00363"></a>00363         fprintf(log, <span class="stringliteral">"\n\n\t%-20s %-20s %-20s\n"</span>, <span class="stringliteral">"AS id"</span>, 
<a name="l00364"></a>00364                 <span class="stringliteral">"next_hop_interface"</span>, <span class="stringliteral">"next_hop_node_id"</span>);
<a name="l00365"></a>00365 
<a name="l00366"></a>00366         <span class="keywordflow">for</span>(i = 0; q &lt; ar-&gt;nmachines + ar-&gt;as-&gt;nareas + <a class="code" href="rn-extern_8h.html#353089f1049e9e0d5160683103c17e62">g_rn_nas</a>; q++, i++)
<a name="l00367"></a>00367         {
<a name="l00368"></a>00368                 <span class="keywordflow">if</span>(i == state-&gt;ar-&gt;as-&gt;id)
<a name="l00369"></a>00369                 {
<a name="l00370"></a>00370                         fprintf(log, <span class="stringliteral">"\t%-20d %-20s\n"</span>, i, <span class="stringliteral">"self"</span>);
<a name="l00371"></a>00371                         <span class="keywordflow">continue</span>;
<a name="l00372"></a>00372                 }
<a name="l00373"></a>00373 
<a name="l00374"></a>00374                 <span class="comment">// Check LSA for route</span>
<a name="l00375"></a>00375                 dbe = &amp;state-&gt;db[q];
<a name="l00376"></a>00376                 <span class="keywordflow">if</span>(dbe-&gt;b.free)
<a name="l00377"></a>00377                 {
<a name="l00378"></a>00378                         fprintf(log, <span class="stringliteral">"\t%-20d %-20s\n"</span>, i, <span class="stringliteral">"no route"</span>);
<a name="l00379"></a>00379                         <span class="keywordflow">continue</span>;
<a name="l00380"></a>00380                 }
<a name="l00381"></a>00381                 
<a name="l00382"></a>00382                 lsa = <a class="code" href="ospf-extern_8h.html#9608d8ba29ae5cc559afe788cddade3f">getlsa</a>(state-&gt;m, dbe-&gt;lsa, dbe-&gt;b.entry);
<a name="l00383"></a>00383                 d = <a class="code" href="rn-extern_8h.html#8890679c55545bd36e770b118a920b57">rn_route</a>(state-&gt;m, lsa-&gt;adv_r);
<a name="l00384"></a>00384 
<a name="l00385"></a>00385                 <span class="keywordflow">if</span>(lsa-&gt;adv_r == lp-&gt;id)
<a name="l00386"></a>00386                 {
<a name="l00387"></a>00387                         <span class="keywordflow">if</span>(lsa-&gt;links.size)
<a name="l00388"></a>00388                         {
<a name="l00389"></a>00389                                 ospf_lsa_link * l = tw_memory_data(lsa-&gt;links.head);
<a name="l00390"></a>00390                                 fprintf(log, <span class="stringliteral">"\t%-20d %-20s %-20d\n"</span>, 
<a name="l00391"></a>00391                                                 i, <span class="stringliteral">"ORIGIN"</span>, l-&gt;dst);
<a name="l00392"></a>00392                         } <span class="keywordflow">else</span>
<a name="l00393"></a>00393                                 fprintf(log, <span class="stringliteral">"\t%-20d %-20s\n"</span>, i, <span class="stringliteral">"ORIGIN"</span>);
<a name="l00394"></a>00394 
<a name="l00395"></a>00395                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(d == -1)
<a name="l00396"></a>00396                         fprintf(log, <span class="stringliteral">"\t%-20d %-20s\n"</span>, i, <span class="stringliteral">"no route"</span>);
<a name="l00397"></a>00397                 <span class="keywordflow">else</span>
<a name="l00398"></a>00398                         fprintf(log, <span class="stringliteral">"\t%-20d %-20d %-25lld\n"</span>, i, state-&gt;m-&gt;ft[q],
<a name="l00399"></a>00399                                 state-&gt;m-&gt;link[state-&gt;m-&gt;ft[q]].addr);
<a name="l00400"></a>00400         }
<a name="l00401"></a>00401 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="fde0ede536714d6ad9959f7c80ebf026"></a><!-- doxytag: member="ospf-extern.h::ospf_rt_timer" ref="fde0ede536714d6ad9959f7c80ebf026" args="(ospf_state *state, int start_vertex)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf_rt_timer           </td>
          <td>(</td>
          <td class="paramtype">ospf_state *&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>start_vertex</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-routing_8c-source.html#l00029">29</a> of file <a class="el" href="ospf-routing_8c-source.html">ospf-routing.c</a>.</p>

<p>References <a class="el" href="save_2ip-routing_8c-source.html#l00104">d</a>, <a class="el" href="save_2ip-routing_8c-source.html#l00103">f</a>, <a class="el" href="ospf-global_8c-source.html#l00028">front</a>, <a class="el" href="ospf-lsa_8c-source.html#l00247">getlsa()</a>, <a class="el" href="ospf-database_8c-source.html#l00006">ospf_db_route()</a>, <a class="el" href="ospf-global_8c-source.html#l00027">p</a>, <a class="el" href="save_2ip-routing_8c-source.html#l00098">parent</a>, <a class="el" href="rn-machine_8c-source.html#l00022">rn_getarea()</a>, <a class="el" href="rn-machine_8c-source.html#l00004">rn_getmachine()</a>, and <a class="el" href="ospf-global_8c-source.html#l00030">s</a>.</p>

<p>Referenced by <a class="el" href="ospf-router_8c-source.html#l00037">ospf_event_handler()</a>, <a class="el" href="ospf-routing_8c-source.html#l00404">ospf_routing_init()</a>, and <a class="el" href="ospf-routing_8c-source.html#l00004">ospf_rt_build()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00030"></a>00030 {
<a name="l00031"></a>00031         tw_memory       *b;
<a name="l00032"></a>00032 
<a name="l00033"></a>00033         rn_machine      *node;
<a name="l00034"></a>00034         rn_machine      *dst;
<a name="l00035"></a>00035         rn_area         *dst_ar;
<a name="l00036"></a>00036 
<a name="l00037"></a>00037         ospf_db_entry   *dbe;
<a name="l00038"></a>00038         ospf_lsa        *lsa;
<a name="l00039"></a>00039         ospf_lsa_link   *l;
<a name="l00040"></a>00040         ospf_nbr        *nbr;
<a name="l00041"></a>00041 
<a name="l00042"></a>00042         <span class="keywordtype">int</span>             i, j, q, v, w, low;
<a name="l00043"></a>00043         <span class="keywordtype">int</span>             nhop = 0;
<a name="l00044"></a>00044 
<a name="l00045"></a>00045         <span class="comment">/*</span>
<a name="l00046"></a>00046 <span class="comment">         * d[] - distance to vertices. * front[] - stores the index to vertices</span>
<a name="l00047"></a>00047 <span class="comment">         * that are in the frontier. * p[] - position of vertices in front[]</span>
<a name="l00048"></a>00048 <span class="comment">         * array. * f[] - boolean frontier set array. * s[] - boolean solution</span>
<a name="l00049"></a>00049 <span class="comment">         * set array. * * timing - timing results structure for returning the</span>
<a name="l00050"></a>00050 <span class="comment">         * time taken. * dist - used in distance computations. * vertices, n -</span>
<a name="l00051"></a>00051 <span class="comment">         * Graph details: vertices array, size. * out_n - Current vertex's OUT</span>
<a name="l00052"></a>00052 <span class="comment">         * set size. </span>
<a name="l00053"></a>00053 <span class="comment">         */</span>
<a name="l00054"></a>00054 
<a name="l00055"></a>00055         <span class="keywordtype">int</span>      dist;
<a name="l00056"></a>00056         <span class="keywordtype">int</span>     *<a class="code" href="save_2ip-routing_8c.html#3e0b6645fceba2e6802ed72dd57a57a4">parent</a>;
<a name="l00057"></a>00057 
<a name="l00058"></a>00058         w = 0;
<a name="l00059"></a>00059         low = state-&gt;ar-&gt;low;
<a name="l00060"></a>00060         parent = state-&gt;m-&gt;ft;
<a name="l00061"></a>00061 
<a name="l00062"></a>00062 <span class="preprocessor">#if VERIFY_ROUTING</span>
<a name="l00063"></a>00063 <span class="preprocessor"></span>        printf(<span class="stringliteral">"%d: Rebuilding routing table \n"</span>, start_vertex);
<a name="l00064"></a>00064 <span class="preprocessor">#endif</span>
<a name="l00065"></a>00065 <span class="preprocessor"></span>
<a name="l00066"></a>00066         <span class="keywordflow">if</span>(state-&gt;ar-&gt;nmachines == 0)
<a name="l00067"></a>00067                 tw_error(TW_LOC, <span class="stringliteral">"No forwarding table for %d!"</span>, start_vertex);
<a name="l00068"></a>00068 
<a name="l00069"></a>00069         <span class="keywordflow">for</span> (i = 0; i &lt; state-&gt;ar-&gt;nmachines; i++)
<a name="l00070"></a>00070         {
<a name="l00071"></a>00071                 parent[i] = -1;
<a name="l00072"></a>00072                 <a class="code" href="save_2ip-routing_8c.html#e3285ac7f4cc9a400327c9efb5f535f7">f</a>[i] = 0;
<a name="l00073"></a>00073                 <a class="code" href="ospf-extern_8h.html#b4c6c03359486e6fb0ac52a94493df1e">s</a>[i] = 0;
<a name="l00074"></a>00074         }
<a name="l00075"></a>00075 
<a name="l00076"></a>00076         <span class="comment">// The start vertex is part of the solutions set. </span>
<a name="l00077"></a>00077         start_vertex -= low;
<a name="l00078"></a>00078         <a class="code" href="ospf-extern_8h.html#b4c6c03359486e6fb0ac52a94493df1e">s</a>[start_vertex] = 1;
<a name="l00079"></a>00079         <a class="code" href="save_2ip-routing_8c.html#0ddbf789cfd814565dd88748311c1c36">d</a>[start_vertex] = 0;
<a name="l00080"></a>00080 
<a name="l00081"></a>00081         <span class="comment">// j is used as the size of the frontier set. </span>
<a name="l00082"></a>00082         j = 0;
<a name="l00083"></a>00083 
<a name="l00084"></a>00084         <span class="comment">// Put out set of the starting vertex into the frontier and update the</span>
<a name="l00085"></a>00085         <span class="comment">// distances to vertices in the out set.  k is the index for the out set.</span>
<a name="l00086"></a>00086         <span class="keywordflow">for</span>(i = 0; i &lt; state-&gt;n_interfaces; i++)
<a name="l00087"></a>00087         {
<a name="l00088"></a>00088                 nbr = &amp;state-&gt;nbr[i];
<a name="l00089"></a>00089 
<a name="l00090"></a>00090                 <span class="keywordflow">if</span>(nbr-&gt;state != ospf_nbr_full_st)
<a name="l00091"></a>00091                         <span class="keywordflow">continue</span>;
<a name="l00092"></a>00092 
<a name="l00093"></a>00093                 <span class="keywordflow">if</span>(nbr-&gt;id &gt;= state-&gt;ar-&gt;low &amp;&amp; nbr-&gt;id &lt;= state-&gt;ar-&gt;high)
<a name="l00094"></a>00094                 {
<a name="l00095"></a>00095                         w = nbr-&gt;id - low;
<a name="l00096"></a>00096                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(nbr-&gt;ar-&gt;id &gt;= state-&gt;ar-&gt;as-&gt;low &amp;&amp; 
<a name="l00097"></a>00097                         nbr-&gt;ar-&gt;id &lt;= state-&gt;ar-&gt;as-&gt;high)
<a name="l00098"></a>00098                 {
<a name="l00099"></a>00099                         w = state-&gt;ar-&gt;nmachines + nbr-&gt;ar-&gt;id - nbr-&gt;ar-&gt;as-&gt;low;
<a name="l00100"></a>00100                 } <span class="keywordflow">else</span>
<a name="l00101"></a>00101                         <span class="keywordflow">continue</span>;
<a name="l00102"></a>00102 
<a name="l00103"></a>00103                 dbe = &amp;state-&gt;db[w];
<a name="l00104"></a>00104 
<a name="l00105"></a>00105                 <span class="keywordflow">if</span>(dbe-&gt;b.free)
<a name="l00106"></a>00106                         <span class="keywordflow">continue</span>;
<a name="l00107"></a>00107 
<a name="l00108"></a>00108                 <span class="keywordflow">if</span>(<a class="code" href="save_2ip-routing_8c.html#e3285ac7f4cc9a400327c9efb5f535f7">f</a>[w])
<a name="l00109"></a>00109                         <span class="keywordflow">continue</span>;
<a name="l00110"></a>00110 
<a name="l00111"></a>00111                 lsa = <a class="code" href="ospf-extern_8h.html#9608d8ba29ae5cc559afe788cddade3f">getlsa</a>(state-&gt;m, dbe-&gt;lsa, dbe-&gt;b.entry);
<a name="l00112"></a>00112                 b = lsa-&gt;links.head;
<a name="l00113"></a>00113 
<a name="l00114"></a>00114                 <span class="keywordflow">if</span>(!b)
<a name="l00115"></a>00115                         <span class="keywordflow">continue</span>;
<a name="l00116"></a>00116 
<a name="l00117"></a>00117                 l = tw_memory_data(b);
<a name="l00118"></a>00118                 <a class="code" href="save_2ip-routing_8c.html#0ddbf789cfd814565dd88748311c1c36">d</a>[w] = l-&gt;metric;
<a name="l00119"></a>00119                 state-&gt;m-&gt;nhop[w] = 0;
<a name="l00120"></a>00120 
<a name="l00121"></a>00121                 <span class="comment">//printf("adding %d (w=%d), dist %d \n", nbr-&gt;id, w, l-&gt;metric);</span>
<a name="l00122"></a>00122 
<a name="l00123"></a>00123                 <a class="code" href="ospf-extern_8h.html#b836172141b14032d67fde057a072992">front</a>[j] = w;
<a name="l00124"></a>00124                 <a class="code" href="ospf-extern_8h.html#61b0821c8ee2a2df1d8cf38ebe0f2b3c">p</a>[w] = j;
<a name="l00125"></a>00125                 <a class="code" href="save_2ip-routing_8c.html#e3285ac7f4cc9a400327c9efb5f535f7">f</a>[w] = 1;
<a name="l00126"></a>00126                 parent[w] = i;
<a name="l00127"></a>00127                 j++;
<a name="l00128"></a>00128         }
<a name="l00129"></a>00129 
<a name="l00130"></a>00130         <span class="comment">// At this point we are assuming that all vertices are reachable from</span>
<a name="l00131"></a>00131         <span class="comment">// the starting vertex and N &gt; 1 so that j &gt; 0.</span>
<a name="l00132"></a>00132         <span class="keywordflow">while</span> (j &gt; 0)
<a name="l00133"></a>00133         {
<a name="l00134"></a>00134                 <span class="comment">// Find the vertex in frontier that has minimum distance. </span>
<a name="l00135"></a>00135                 v = <a class="code" href="ospf-extern_8h.html#b836172141b14032d67fde057a072992">front</a>[0];
<a name="l00136"></a>00136                 <span class="keywordflow">for</span> (q = 1; q &lt; j; q++)
<a name="l00137"></a>00137                         <span class="keywordflow">if</span> (<a class="code" href="save_2ip-routing_8c.html#0ddbf789cfd814565dd88748311c1c36">d</a>[<a class="code" href="ospf-extern_8h.html#b836172141b14032d67fde057a072992">front</a>[q]] &lt; <a class="code" href="save_2ip-routing_8c.html#0ddbf789cfd814565dd88748311c1c36">d</a>[v])
<a name="l00138"></a>00138                                 v = <a class="code" href="ospf-extern_8h.html#b836172141b14032d67fde057a072992">front</a>[q];
<a name="l00139"></a>00139 
<a name="l00140"></a>00140                 <span class="comment">// Move this vertex from the frontier to the solution set.  It's old</span>
<a name="l00141"></a>00141                 <span class="comment">// position in the frontier array becomes occupied by the element</span>
<a name="l00142"></a>00142                 <span class="comment">// previously at the end of the frontier.</span>
<a name="l00143"></a>00143 
<a name="l00144"></a>00144                 j--;
<a name="l00145"></a>00145                 <a class="code" href="ospf-extern_8h.html#b836172141b14032d67fde057a072992">front</a>[<a class="code" href="ospf-extern_8h.html#61b0821c8ee2a2df1d8cf38ebe0f2b3c">p</a>[v]] = <a class="code" href="ospf-extern_8h.html#b836172141b14032d67fde057a072992">front</a>[j];
<a name="l00146"></a>00146                 p[<a class="code" href="ospf-extern_8h.html#b836172141b14032d67fde057a072992">front</a>[j]] = p[v];
<a name="l00147"></a>00147                 <a class="code" href="ospf-extern_8h.html#b4c6c03359486e6fb0ac52a94493df1e">s</a>[v] = 1;
<a name="l00148"></a>00148                 <a class="code" href="save_2ip-routing_8c.html#e3285ac7f4cc9a400327c9efb5f535f7">f</a>[v] = 0;
<a name="l00149"></a>00149 
<a name="l00150"></a>00150                 <span class="comment">// Values in p[v] and front[j] no longer used, so are now meaningless</span>
<a name="l00151"></a>00151                 <span class="comment">// at this point.</span>
<a name="l00152"></a>00152 
<a name="l00153"></a>00153                 <span class="comment">// Update distances to vertices, w, in the out set of v.</span>
<a name="l00154"></a>00154                 dbe = &amp;state-&gt;db[v];
<a name="l00155"></a>00155                 lsa = <a class="code" href="ospf-extern_8h.html#9608d8ba29ae5cc559afe788cddade3f">getlsa</a>(state-&gt;m, dbe-&gt;lsa, dbe-&gt;b.entry);
<a name="l00156"></a>00156                 <span class="comment">//node = rn_getmachine(v + low);</span>
<a name="l00157"></a>00157                 node = <a class="code" href="rn-extern_8h.html#b586ebafc20ad652dd538635f5c816b0">rn_getmachine</a>(lsa-&gt;adv_r);
<a name="l00158"></a>00158                 state-&gt;m-&gt;nhop[lsa-&gt;adv_r - state-&gt;ar-&gt;low] = nhop;
<a name="l00159"></a>00159 
<a name="l00160"></a>00160                 <span class="comment">//printf("considering node: %d \n", node-&gt;id);</span>
<a name="l00161"></a>00161 
<a name="l00162"></a>00162                 b = lsa-&gt;links.head;
<a name="l00163"></a>00163                 <span class="keywordflow">for</span> (q = 0; q &lt; lsa-&gt;links.size; q++, b = b-&gt;next)
<a name="l00164"></a>00164                 {
<a name="l00165"></a>00165                         l = tw_memory_data(b);
<a name="l00166"></a>00166                         dst = <a class="code" href="rn-extern_8h.html#b586ebafc20ad652dd538635f5c816b0">rn_getmachine</a>(l-&gt;dst);
<a name="l00167"></a>00167                         dst_ar = <a class="code" href="rn-extern_8h.html#d45bc39e5a89bce656786b571acb1ae8">rn_getarea</a>(dst);
<a name="l00168"></a>00168 
<a name="l00169"></a>00169                         <span class="comment">// all w should be q</span>
<a name="l00170"></a>00170                         <span class="keywordflow">if</span>(l-&gt;dst &gt;= state-&gt;ar-&gt;low &amp;&amp; l-&gt;dst &lt;= state-&gt;ar-&gt;high)
<a name="l00171"></a>00171                                 w = l-&gt;dst - low;
<a name="l00172"></a>00172                         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(dst_ar-&gt;id &gt;= state-&gt;ar-&gt;as-&gt;low &amp;&amp; 
<a name="l00173"></a>00173                                 dst_ar-&gt;id &lt;= state-&gt;ar-&gt;as-&gt;high)
<a name="l00174"></a>00174                                 w = state-&gt;ar-&gt;nmachines + dst_ar-&gt;id - 
<a name="l00175"></a>00175                                         dst_ar-&gt;as-&gt;low;
<a name="l00176"></a>00176                         <span class="keywordflow">else</span>
<a name="l00177"></a>00177                                 <span class="keywordflow">continue</span>; <span class="comment">//tw_error(TW_LOC, "Unknown case!");</span>
<a name="l00178"></a>00178 
<a name="l00179"></a>00179                         <span class="comment">// Only update if w is not already in the solution set.</span>
<a name="l00180"></a>00180                         <span class="keywordflow">if</span> (<a class="code" href="ospf-extern_8h.html#b4c6c03359486e6fb0ac52a94493df1e">s</a>[w])
<a name="l00181"></a>00181                                 <span class="keywordflow">continue</span>;
<a name="l00182"></a>00182 
<a name="l00183"></a>00183                         <span class="comment">// If w is in the frontier the new distance to w </span>
<a name="l00184"></a>00184                         <span class="comment">// is the minimum of its current distance and the </span>
<a name="l00185"></a>00185                         <span class="comment">// distance to w via v.</span>
<a name="l00186"></a>00186                         dist = <a class="code" href="save_2ip-routing_8c.html#0ddbf789cfd814565dd88748311c1c36">d</a>[v] + l-&gt;metric;
<a name="l00187"></a>00187                         <span class="keywordflow">if</span> (<a class="code" href="save_2ip-routing_8c.html#e3285ac7f4cc9a400327c9efb5f535f7">f</a>[w] == 1)
<a name="l00188"></a>00188                         {
<a name="l00189"></a>00189                                 <span class="keywordflow">if</span> (dist &lt; <a class="code" href="save_2ip-routing_8c.html#0ddbf789cfd814565dd88748311c1c36">d</a>[w])
<a name="l00190"></a>00190                                 {
<a name="l00191"></a>00191                                         <span class="comment">//printf("up: dist to w %d: %d, nhop %d \n", w, dist, nhop);</span>
<a name="l00192"></a>00192                                         <a class="code" href="save_2ip-routing_8c.html#0ddbf789cfd814565dd88748311c1c36">d</a>[w] = dist;
<a name="l00193"></a>00193                                         parent[w] = parent[v];
<a name="l00194"></a>00194                                         state-&gt;m-&gt;nhop[w] = nhop+1;
<a name="l00195"></a>00195                                 }
<a name="l00196"></a>00196                         } <span class="keywordflow">else</span>
<a name="l00197"></a>00197                         {
<a name="l00198"></a>00198                                 <span class="comment">//printf("add: dist to w %d: %d, nhop %d \n", w, dist, nhop);</span>
<a name="l00199"></a>00199                                 parent[w] = parent[v];
<a name="l00200"></a>00200                                 state-&gt;m-&gt;nhop[w] = nhop++;
<a name="l00201"></a>00201                                 <a class="code" href="save_2ip-routing_8c.html#0ddbf789cfd814565dd88748311c1c36">d</a>[w] = dist;
<a name="l00202"></a>00202                                 front[j] = w;
<a name="l00203"></a>00203                                 p[w] = j;
<a name="l00204"></a>00204                                 <a class="code" href="save_2ip-routing_8c.html#e3285ac7f4cc9a400327c9efb5f535f7">f</a>[w] = 1;
<a name="l00205"></a>00205                                 j++;
<a name="l00206"></a>00206                         }
<a name="l00207"></a>00207                 }
<a name="l00208"></a>00208         }
<a name="l00209"></a>00209 
<a name="l00210"></a>00210         <span class="comment">// Correct the AS external LSA entries in the routing table</span>
<a name="l00211"></a>00211         <span class="keywordflow">for</span>(w = state-&gt;ar-&gt;nmachines; w &lt; state-&gt;ar-&gt;g_ospf_nlsa; w++)
<a name="l00212"></a>00212         {
<a name="l00213"></a>00213                 <span class="keywordflow">if</span>(state-&gt;db[w].b.free == 0)
<a name="l00214"></a>00214                 {
<a name="l00215"></a>00215                         <span class="comment">//printf("Attempting to update route to LSA %d \n", w);</span>
<a name="l00216"></a>00216                         <a class="code" href="ospf-database_8c.html#9ad2afaaa16ce23be59af9c6b159f321">ospf_db_route</a>(state, &amp;state-&gt;db[w], tw_getlp(state-&gt;m-&gt;id));
<a name="l00217"></a>00217                 }
<a name="l00218"></a>00218         }
<a name="l00219"></a>00219 
<a name="l00220"></a>00220         <span class="comment">//ospf_rt_print(state, tw_getlp(start_vertex + low), stdout);</span>
<a name="l00221"></a>00221 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="af27e1a36d89f4970d13e70c4a1073af"></a><!-- doxytag: member="ospf-extern.h::ospf_startup" ref="af27e1a36d89f4970d13e70c4a1073af" args="(ospf_state *state, tw_lp *lp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf_startup           </td>
          <td>(</td>
          <td class="paramtype">ospf_state *&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
OSPF model LP init function.<p>
This is the OSPF model LP initialization function. This function is responsible for initializing each OSPF LP. The main steps are: <ol>
<li>
Create and init the neighbor array </li>
<li>
Create and init the LP LSA database </li>
<li>
Create and init the LP forwarding table </li>
<li>
Start the aging timer for the oldest LSA </li>
</ol>
<p>
The order of steps 2 and 3 are dependant upon if the model is started in converged state or not. The determination is based on the fact that sometimes we build the forwarding table from the LSA database, and sometimes we read it in from file. 
<p>Definition at line <a class="el" href="ospf-router_8c-source.html#l00237">237</a> of file <a class="el" href="ospf-router_8c-source.html">ospf-router.c</a>.</p>

<p>References <a class="el" href="ospf-global_8c-source.html#l00019">g_ospf_rt_write</a>, <a class="el" href="ospf-global_8c-source.html#l00012">g_ospf_state</a>, <a class="el" href="rn-global_8c-source.html#l00005">g_rn_converge_bgp</a>, <a class="el" href="rn-global_8c-source.html#l00004">g_rn_converge_ospf</a>, <a class="el" href="rn-global_8c-source.html#l00085">g_rn_logs_dir</a>, <a class="el" href="ospf-global_8c-source.html#l00014">g_route</a>, <a class="el" href="ospf-global_8c-source.html#l00015">g_route1</a>, <a class="el" href="ospf-global_8c-source.html#l00016">gr1</a>, <a class="el" href="ospf-global_8c-source.html#l00017">gr2</a>, <a class="el" href="ospf-database_8c-source.html#l00393">ospf_db_init()</a>, <a class="el" href="ospf-database_8c-source.html#l00083">ospf_db_read()</a>, <a class="el" href="ospf-data-types_8h-source.html#l00016">OSPF_MIN_LSA_SEQNUM</a>, <a class="el" href="ospf-neighbor_8c-source.html#l00082">ospf_neighbor_init()</a>, <a class="el" href="ospf-experiments_8c-source.html#l00004">ospf_random_weights()</a>, <a class="el" href="ospf-routing_8c-source.html#l00404">ospf_routing_init()</a>, <a class="el" href="ospf-timer_8c-source.html#l00029">ospf_timer_start()</a>, <a class="el" href="rn-machine_8c-source.html#l00022">rn_getarea()</a>, and <a class="el" href="rn-machine_8c-source.html#l00004">rn_getmachine()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00238"></a>00238 {
<a name="l00239"></a>00239         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>    rv;
<a name="l00240"></a>00240         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>    next_timer;
<a name="l00241"></a>00241 
<a name="l00242"></a>00242 <span class="preprocessor">#if OSPF_LOG</span>
<a name="l00243"></a>00243 <span class="preprocessor"></span>        <span class="keywordtype">char</span>             name[255];
<a name="l00244"></a>00244 
<a name="l00245"></a>00245         sprintf(name, <span class="stringliteral">"%s/ospf-router-%ld.log"</span>, <a class="code" href="rn-extern_8h.html#a46f0adf0f6be6d672defc691800ce69">g_rn_logs_dir</a>, lp-&gt;id);
<a name="l00246"></a>00246         <span class="comment">//state-&gt;log = fopen(name, "w");</span>
<a name="l00247"></a>00247         state-&gt;log = stdout;
<a name="l00248"></a>00248 <span class="preprocessor">#endif</span>
<a name="l00249"></a>00249 <span class="preprocessor"></span>
<a name="l00250"></a>00250         state-&gt;from = -1;
<a name="l00251"></a>00251         state-&gt;from1 = -1;
<a name="l00252"></a>00252 
<a name="l00253"></a>00253         state-&gt;gstate = <a class="code" href="ospf-extern_8h.html#7f0b189fb4e0f9bde7b94669c36dc8d9">g_ospf_state</a>;
<a name="l00254"></a>00254         state-&gt;m = <a class="code" href="rn-extern_8h.html#b586ebafc20ad652dd538635f5c816b0">rn_getmachine</a>(lp-&gt;id);
<a name="l00255"></a>00255         state-&gt;ar = <a class="code" href="rn-extern_8h.html#d45bc39e5a89bce656786b571acb1ae8">rn_getarea</a>(state-&gt;m);
<a name="l00256"></a>00256         state-&gt;stats = tw_calloc(TW_LOC, <span class="stringliteral">""</span>, <span class="keyword">sizeof</span>(ospf_statistics), 1);
<a name="l00257"></a>00257 
<a name="l00258"></a>00258         <span class="keywordflow">if</span>(lp-&gt;id == 0)
<a name="l00259"></a>00259         {
<a name="l00260"></a>00260                 <span class="keywordflow">for</span>(rv = 0; rv &lt; 400; rv++)
<a name="l00261"></a>00261                         <a class="code" href="ospf-extern_8h.html#9f9f956462ca43b7fd2caa89db98c5a9">g_route</a>[rv] = <a class="code" href="ospf-extern_8h.html#097cad055eec1bd215ad822a813dc62e">g_route1</a>[rv] = -1;
<a name="l00262"></a>00262 
<a name="l00263"></a>00263                 <a class="code" href="ospf-extern_8h.html#432a4c78ffc399e9fb0d8070289f47e1">gr1</a> = <a class="code" href="ospf-extern_8h.html#fb99688fe29cd99a5a48c77bfee16629">gr2</a> = 0;
<a name="l00264"></a>00264 
<a name="l00265"></a>00265                 state-&gt;sn = .003;
<a name="l00266"></a>00266         }
<a name="l00267"></a>00267 
<a name="l00268"></a>00268         <span class="comment">//printf("Init OSPF router: %ld \n", lp-&gt;id);</span>
<a name="l00269"></a>00269 
<a name="l00270"></a>00270         <span class="comment">// Create the neighbor data structures</span>
<a name="l00271"></a>00271         <a class="code" href="ospf-extern_8h.html#05c4d9902736734864c528052070d101">ospf_neighbor_init</a>(state, lp);
<a name="l00272"></a>00272 
<a name="l00273"></a>00273         <span class="comment">// Create my router LSA links</span>
<a name="l00274"></a>00274         state-&gt;lsa_seqnum = <a class="code" href="ospf-data-types_8h.html#046cf2935a363d19e94b7ce7ffac27ed">OSPF_MIN_LSA_SEQNUM</a> + 1;
<a name="l00275"></a>00275 
<a name="l00276"></a>00276         <span class="keywordflow">if</span>(!<a class="code" href="rn-extern_8h.html#1f8c72ceadd5707b682dc77968ffd6d5">g_rn_converge_ospf</a>)
<a name="l00277"></a>00277         {
<a name="l00278"></a>00278                 <a class="code" href="ospf-database_8c.html#4de527f30006dfc66eb2e24684aba5f5">ospf_db_read</a>(state, lp);
<a name="l00279"></a>00279                 <a class="code" href="ospf-extern_8h.html#c687d13222a7d0e3e67998e0d6f48fdc">ospf_routing_init</a>(state, lp);
<a name="l00280"></a>00280         } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!<a class="code" href="rn-extern_8h.html#1f8c72ceadd5707b682dc77968ffd6d5">g_rn_converge_ospf</a>)
<a name="l00281"></a>00281         {
<a name="l00282"></a>00282                 <a class="code" href="ospf-extern_8h.html#c687d13222a7d0e3e67998e0d6f48fdc">ospf_routing_init</a>(state, lp);
<a name="l00283"></a>00283                 <a class="code" href="ospf-database_8c.html#4de527f30006dfc66eb2e24684aba5f5">ospf_db_read</a>(state, lp);
<a name="l00284"></a>00284         } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(0 == <a class="code" href="ospf-extern_8h.html#c90b3ca848617e3fe636407eb372c5d5">g_ospf_rt_write</a>)
<a name="l00285"></a>00285         {
<a name="l00286"></a>00286                 <span class="comment">// Setup the routing table for the first time</span>
<a name="l00287"></a>00287                 <a class="code" href="ospf-extern_8h.html#c687d13222a7d0e3e67998e0d6f48fdc">ospf_routing_init</a>(state, lp);
<a name="l00288"></a>00288 
<a name="l00289"></a>00289                 <span class="comment">// Setup the LSA database for the first time</span>
<a name="l00290"></a>00290                 next_timer = <a class="code" href="ospf-database_8c.html#01c993e7218639b1eb00314f4bfb2729">ospf_db_init</a>(state, lp);
<a name="l00291"></a>00291         } <span class="keywordflow">else</span>
<a name="l00292"></a>00292         {
<a name="l00293"></a>00293                 <span class="comment">// Setup the LSA database for the first time</span>
<a name="l00294"></a>00294                 next_timer = <a class="code" href="ospf-database_8c.html#01c993e7218639b1eb00314f4bfb2729">ospf_db_init</a>(state, lp);
<a name="l00295"></a>00295 
<a name="l00296"></a>00296                 <span class="comment">// Setup the routing table for the first time</span>
<a name="l00297"></a>00297                 <a class="code" href="ospf-extern_8h.html#c687d13222a7d0e3e67998e0d6f48fdc">ospf_routing_init</a>(state, lp);
<a name="l00298"></a>00298         }
<a name="l00299"></a>00299 
<a name="l00300"></a>00300         state-&gt;lsa = tw_memory_data(state-&gt;ar-&gt;g_ospf_lsa[lp-&gt;id - state-&gt;ar-&gt;low]);
<a name="l00301"></a>00301 
<a name="l00302"></a>00302         <span class="keywordflow">if</span>(!<a class="code" href="rn-extern_8h.html#1f8c72ceadd5707b682dc77968ffd6d5">g_rn_converge_ospf</a> &amp;&amp; !<a class="code" href="rn-extern_8h.html#b5f1b9e6a511e7afe74d971e088af5b4">g_rn_converge_bgp</a>)
<a name="l00303"></a>00303                 <a class="code" href="ospf-experiments_8c.html#5c4172f703019d7ea68ed34370d7120f">ospf_random_weights</a>(state, lp);
<a name="l00304"></a>00304 
<a name="l00305"></a>00305         <span class="comment">/*</span>
<a name="l00306"></a>00306 <span class="comment">         * This timer should only go off when the oldest LSA in my DB</span>
<a name="l00307"></a>00307 <span class="comment">         * gets to be the REFRESH age, so that I can make sure to request an</span>
<a name="l00308"></a>00308 <span class="comment">         * update for it</span>
<a name="l00309"></a>00309 <span class="comment">         */</span>
<a name="l00310"></a>00310         state-&gt;aging_timer = NULL;
<a name="l00311"></a>00311 
<a name="l00312"></a>00312 <span class="preprocessor">#if 0</span>
<a name="l00313"></a>00313 <span class="preprocessor"></span>        state-&gt;aging_timer =
<a name="l00314"></a>00314                 <a class="code" href="ospf-extern_8h.html#75e3fe5d4b90cd1e2ca417ac3d9518c7">ospf_timer_start</a>(NULL, state-&gt;aging_timer,
<a name="l00315"></a>00315                                  next_timer, OSPF_AGING_TIMER, lp);
<a name="l00316"></a>00316 <span class="preprocessor">#endif</span>
<a name="l00317"></a>00317 <span class="preprocessor"></span>
<a name="l00318"></a>00318 <span class="preprocessor">#if VERIFY_AGING</span>
<a name="l00319"></a>00319 <span class="preprocessor"></span>        printf(<span class="stringliteral">"%ld: setting aging timer finally: %lf \n"</span>, 
<a name="l00320"></a>00320                 lp-&gt;id, next_timer);
<a name="l00321"></a>00321 <span class="preprocessor">#endif</span>
<a name="l00322"></a>00322 <span class="preprocessor"></span>}
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="4c5211d9ed4ff3755621afdd64d71736"></a><!-- doxytag: member="ospf-extern.h::ospf_statistics_collection" ref="4c5211d9ed4ff3755621afdd64d71736" args="(ospf_state *state, tw_lp *lp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf_statistics_collection           </td>
          <td>(</td>
          <td class="paramtype">ospf_state *&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-stats_8c-source.html#l00008">8</a> of file <a class="el" href="ospf-stats_8c-source.html">ospf-stats.c</a>.</p>

<p>References <a class="el" href="ospf-stats_8c-source.html#l00005">c_time</a>, <a class="el" href="ospf-global_8c-source.html#l00039">g_ospf_lsa_file</a>, <a class="el" href="ospf-global_8c-source.html#l00036">g_ospf_stats</a>, <a class="el" href="rn-global_8c-source.html#l00005">g_rn_converge_bgp</a>, <a class="el" href="rn-global_8c-source.html#l00004">g_rn_converge_ospf</a>, <a class="el" href="rn-global_8c-source.html#l00085">g_rn_logs_dir</a>, <a class="el" href="ospf-global_8c-source.html#l00014">g_route</a>, <a class="el" href="ospf-global_8c-source.html#l00015">g_route1</a>, <a class="el" href="ospf-database_8c-source.html#l00193">ospf_db_print()</a>, <a class="el" href="ospf-database_8c-source.html#l00065">ospf_db_print_raw()</a>, <a class="el" href="ospf-lsa_8c-source.html#l00004">ospf_lsa_print()</a>, and <a class="el" href="ospf-routing_8c-source.html#l00224">ospf_rt_print()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00009"></a>00009 {
<a name="l00010"></a>00010 <span class="preprocessor">#if LOG_ROUTER || OSPF_LOG</span>
<a name="l00011"></a>00011 <span class="preprocessor"></span>        <span class="comment">//char           name[255];</span>
<a name="l00012"></a>00012 <span class="preprocessor">#endif</span>
<a name="l00013"></a>00013 <span class="preprocessor"></span>        tw_memory       *b;
<a name="l00014"></a>00014 
<a name="l00015"></a>00015         ospf_lsa        *lsa;
<a name="l00016"></a>00016 
<a name="l00017"></a>00017         <span class="keywordtype">int</span>              i;
<a name="l00018"></a>00018 
<a name="l00019"></a>00019         <a class="code" href="ospf-extern_8h.html#6ff92e91f0531f31567a8453d5b2b08b">g_ospf_stats</a>-&gt;s_e_hello_in += state-&gt;stats-&gt;s_e_hello_in;
<a name="l00020"></a>00020         <a class="code" href="ospf-extern_8h.html#6ff92e91f0531f31567a8453d5b2b08b">g_ospf_stats</a>-&gt;s_e_hello_out += state-&gt;stats-&gt;s_e_hello_out;
<a name="l00021"></a>00021 
<a name="l00022"></a>00022         <a class="code" href="ospf-extern_8h.html#6ff92e91f0531f31567a8453d5b2b08b">g_ospf_stats</a>-&gt;dropped_packets += state-&gt;stats-&gt;dropped_packets;
<a name="l00023"></a>00023         <a class="code" href="ospf-extern_8h.html#6ff92e91f0531f31567a8453d5b2b08b">g_ospf_stats</a>-&gt;s_drop_dd += state-&gt;stats-&gt;s_drop_dd;
<a name="l00024"></a>00024         <a class="code" href="ospf-extern_8h.html#6ff92e91f0531f31567a8453d5b2b08b">g_ospf_stats</a>-&gt;s_sent_hellos += state-&gt;stats-&gt;s_sent_hellos;
<a name="l00025"></a>00025         <a class="code" href="ospf-extern_8h.html#6ff92e91f0531f31567a8453d5b2b08b">g_ospf_stats</a>-&gt;s_sent_dds += state-&gt;stats-&gt;s_sent_dds;
<a name="l00026"></a>00026         <a class="code" href="ospf-extern_8h.html#6ff92e91f0531f31567a8453d5b2b08b">g_ospf_stats</a>-&gt;s_sent_ls_requests += state-&gt;stats-&gt;s_sent_ls_requests;
<a name="l00027"></a>00027         <a class="code" href="ospf-extern_8h.html#6ff92e91f0531f31567a8453d5b2b08b">g_ospf_stats</a>-&gt;s_sent_ls_updates += state-&gt;stats-&gt;s_sent_ls_updates;
<a name="l00028"></a>00028         <a class="code" href="ospf-extern_8h.html#6ff92e91f0531f31567a8453d5b2b08b">g_ospf_stats</a>-&gt;s_sent_ls_acks += state-&gt;stats-&gt;s_sent_ls_acks;
<a name="l00029"></a>00029         <a class="code" href="ospf-extern_8h.html#6ff92e91f0531f31567a8453d5b2b08b">g_ospf_stats</a>-&gt;s_sent_unknown += state-&gt;stats-&gt;s_sent_unknown;
<a name="l00030"></a>00030         <a class="code" href="ospf-extern_8h.html#6ff92e91f0531f31567a8453d5b2b08b">g_ospf_stats</a>-&gt;s_sent_lost += state-&gt;stats-&gt;s_sent_lost;
<a name="l00031"></a>00031 
<a name="l00032"></a>00032         <a class="code" href="ospf-extern_8h.html#6ff92e91f0531f31567a8453d5b2b08b">g_ospf_stats</a>-&gt;s_cause_bgp += state-&gt;stats-&gt;s_cause_bgp;
<a name="l00033"></a>00033         <a class="code" href="ospf-extern_8h.html#6ff92e91f0531f31567a8453d5b2b08b">g_ospf_stats</a>-&gt;s_cause_ospf += state-&gt;stats-&gt;s_cause_ospf;
<a name="l00034"></a>00034 
<a name="l00035"></a>00035         <span class="keywordflow">if</span>(lp-&gt;id &lt; 1000 &amp;&amp; 0)
<a name="l00036"></a>00036                 printf(<span class="stringliteral">"Finalizing OSPF lp %lld \n"</span>, lp-&gt;id);
<a name="l00037"></a>00037 
<a name="l00038"></a>00038         <a class="code" href="ospf-stats_8c.html#7722be93d04c3f2fdda645321fe9e74a">c_time</a> = max(<a class="code" href="ospf-stats_8c.html#7722be93d04c3f2fdda645321fe9e74a">c_time</a>, state-&gt;c_time);
<a name="l00039"></a>00039 
<a name="l00040"></a>00040 <span class="preprocessor">#if VERIFY_OSPF_CONVERGENCE</span>
<a name="l00041"></a>00041 <span class="preprocessor"></span>        <span class="keywordflow">if</span>(lp-&gt;id == 0)
<a name="l00042"></a>00042         {
<a name="l00043"></a>00043                 printf(<span class="stringliteral">"OSPFv2 Model Statistics: \n\n"</span>);
<a name="l00044"></a>00044                 printf(<span class="stringliteral">"\tRoute 0: "</span>);
<a name="l00045"></a>00045                 <span class="keywordflow">for</span>(i = 0; i &lt; 40000; i++)
<a name="l00046"></a>00046                 {
<a name="l00047"></a>00047                         <span class="keywordflow">if</span>(<a class="code" href="ospf-extern_8h.html#9f9f956462ca43b7fd2caa89db98c5a9">g_route</a>[i] == -1)
<a name="l00048"></a>00048                                 <span class="keywordflow">break</span>;
<a name="l00049"></a>00049 
<a name="l00050"></a>00050                         printf(<span class="stringliteral">" %d,"</span>, <a class="code" href="ospf-extern_8h.html#9f9f956462ca43b7fd2caa89db98c5a9">g_route</a>[i]);
<a name="l00051"></a>00051                 }
<a name="l00052"></a>00052                 printf(<span class="stringliteral">" (i = %d) \n"</span>, i);
<a name="l00053"></a>00053 
<a name="l00054"></a>00054                 printf(<span class="stringliteral">"\tRoute 1: "</span>);
<a name="l00055"></a>00055                 <span class="keywordflow">for</span>(i = 0; i &lt; 40000; i++)
<a name="l00056"></a>00056                 {
<a name="l00057"></a>00057                         <span class="keywordflow">if</span>(<a class="code" href="ospf-extern_8h.html#097cad055eec1bd215ad822a813dc62e">g_route1</a>[i] == -1)
<a name="l00058"></a>00058                                 <span class="keywordflow">break</span>;
<a name="l00059"></a>00059 
<a name="l00060"></a>00060                         printf(<span class="stringliteral">" %d"</span>, <a class="code" href="ospf-extern_8h.html#097cad055eec1bd215ad822a813dc62e">g_route1</a>[i]);
<a name="l00061"></a>00061                 }
<a name="l00062"></a>00062                 printf(<span class="stringliteral">" (i = %d) \n"</span>, i);
<a name="l00063"></a>00063                 
<a name="l00064"></a>00064                 printf(<span class="stringliteral">"\n\tTotal Network Convergence Time: %f \n"</span>, <a class="code" href="ospf-stats_8c.html#7722be93d04c3f2fdda645321fe9e74a">c_time</a>);
<a name="l00065"></a>00065         }
<a name="l00066"></a>00066 <span class="preprocessor">#endif</span>
<a name="l00067"></a>00067 <span class="preprocessor"></span>
<a name="l00068"></a>00068 <span class="preprocessor">#if OSPF_LOG &amp;&amp; 0</span>
<a name="l00069"></a>00069 <span class="preprocessor"></span>        <span class="keywordflow">if</span>(state-&gt;log &amp;&amp; state-&gt;log != stdout)
<a name="l00070"></a>00070                 fclose(state-&gt;log);
<a name="l00071"></a>00071 
<a name="l00072"></a>00072         sprintf(name, <span class="stringliteral">"%s/ospf-router-%ld.log"</span>, <a class="code" href="rn-extern_8h.html#a46f0adf0f6be6d672defc691800ce69">g_rn_logs_dir</a>, lp-&gt;id);
<a name="l00073"></a>00073         state-&gt;log = fopen(name, <span class="stringliteral">"w"</span>);
<a name="l00074"></a>00074 
<a name="l00075"></a>00075         <span class="keywordflow">if</span>(!state-&gt;log)
<a name="l00076"></a>00076                 <span class="keywordflow">return</span>;
<a name="l00077"></a>00077 
<a name="l00078"></a>00078         fprintf(state-&gt;log, <span class="stringliteral">"OSPFv2 Router %ld: Final Time: %f\n\n"</span>, lp-&gt;id, tw_now(lp));
<a name="l00079"></a>00079 
<a name="l00080"></a>00080         <a class="code" href="ospf-database_8c.html#98158bd3d15459f0111a7bc37d0e2c05">ospf_db_print</a>(state, state-&gt;log, lp);
<a name="l00081"></a>00081         <a class="code" href="ospf-extern_8h.html#5420dafebccc3fbaf5939cab2c4fe46f">ospf_rt_print</a>(state, lp, state-&gt;log);
<a name="l00082"></a>00082 
<a name="l00083"></a>00083 <span class="preprocessor">#endif</span>
<a name="l00084"></a>00084 <span class="preprocessor"></span><span class="preprocessor">#if LOG_ROUTER</span>
<a name="l00085"></a>00085 <span class="preprocessor"></span>        fprintf(state-&gt;log, <span class="stringliteral">"Events Received:\n"</span>);
<a name="l00086"></a>00086         fprintf(state-&gt;log, <span class="stringliteral">"\t%-50s %11ld\n"</span>, <span class="stringliteral">"HELLO msgs recvd"</span>,
<a name="l00087"></a>00087                                                 state-&gt;stats-&gt;s_e_hello_in);
<a name="l00088"></a>00088         fprintf(state-&gt;log, <span class="stringliteral">"\t%-50s %11ld\n"</span>, <span class="stringliteral">"HELLO send timers"</span>,
<a name="l00089"></a>00089                                                 state-&gt;stats-&gt;s_e_hello_out);
<a name="l00090"></a>00090         fprintf(state-&gt;log, <span class="stringliteral">"\t%-50s %11ld\n"</span>, <span class="stringliteral">"HELLO inactive timeouts"</span>, 
<a name="l00091"></a>00091                                                 state-&gt;stats-&gt;s_e_hello_timeouts);
<a name="l00092"></a>00092         fprintf(state-&gt;log, <span class="stringliteral">"\n"</span>);
<a name="l00093"></a>00093         fprintf(state-&gt;log, <span class="stringliteral">"\t%-50s %11ld\n"</span>, <span class="stringliteral">"DD msgs recvd"</span>, state-&gt;stats-&gt;s_e_dd_msgs);
<a name="l00094"></a>00094         fprintf(state-&gt;log, <span class="stringliteral">"\t%-50s %11ld\n"</span>, <span class="stringliteral">"DD pkts dropped"</span>, state-&gt;stats-&gt;s_drop_dd);
<a name="l00095"></a>00095         fprintf(state-&gt;log, <span class="stringliteral">"\n"</span>);
<a name="l00096"></a>00096         fprintf(state-&gt;log, <span class="stringliteral">"\t%-50s %11ld\n"</span>, <span class="stringliteral">"LS Requests recvd"</span>,
<a name="l00097"></a>00097                                                 state-&gt;stats-&gt;s_e_ls_requests);
<a name="l00098"></a>00098         fprintf(state-&gt;log, <span class="stringliteral">"\t%-50s %11ld\n"</span>, <span class="stringliteral">"ACK timeouts"</span>,
<a name="l00099"></a>00099                                                 state-&gt;stats-&gt;s_e_ack_timeouts);
<a name="l00100"></a>00100         fprintf(state-&gt;log, <span class="stringliteral">"\n"</span>);
<a name="l00101"></a>00101         fprintf(state-&gt;log, <span class="stringliteral">"\t%-50s %11ld\n"</span>, <span class="stringliteral">"Aging timer events"</span>,
<a name="l00102"></a>00102                                                 state-&gt;stats-&gt;s_e_aging_timeouts);
<a name="l00103"></a>00103         fprintf(state-&gt;log, <span class="stringliteral">"\t%-50s %11ld\n"</span>, <span class="stringliteral">"Unknown events!"</span>, state-&gt;stats-&gt;s_e_unknown);
<a name="l00104"></a>00104         fprintf(state-&gt;log, <span class="stringliteral">"\n"</span>);
<a name="l00105"></a>00105         fprintf(state-&gt;log, <span class="stringliteral">"Events Sent:\n"</span>);
<a name="l00106"></a>00106         fprintf(state-&gt;log, <span class="stringliteral">"\t%-50s %11ld\n"</span>, <span class="stringliteral">"HELLO msgs"</span>, state-&gt;stats-&gt;s_sent_hellos);
<a name="l00107"></a>00107         fprintf(state-&gt;log, <span class="stringliteral">"\t%-50s %11ld\n"</span>, <span class="stringliteral">"DD packets"</span>, state-&gt;stats-&gt;s_sent_dds);
<a name="l00108"></a>00108         fprintf(state-&gt;log, <span class="stringliteral">"\t%-50s %11ld\n"</span>, <span class="stringliteral">"LS Requests"</span>, state-&gt;stats-&gt;s_sent_ls_requests);
<a name="l00109"></a>00109         fprintf(state-&gt;log, <span class="stringliteral">"\t%-50s %11ld\n"</span>, <span class="stringliteral">"Dropped Packets"</span>, state-&gt;stats-&gt;s_sent_lost);
<a name="l00110"></a>00110         fprintf(state-&gt;log, <span class="stringliteral">"\t%-50s %11ld\n"</span>, <span class="stringliteral">"Unknown!"</span>, state-&gt;stats-&gt;s_sent_unknown);
<a name="l00111"></a>00111 
<a name="l00112"></a>00112 
<a name="l00113"></a>00113 
<a name="l00114"></a>00114         fprintf(state-&gt;log, <span class="stringliteral">"\n"</span>);
<a name="l00115"></a>00115         fprintf(state-&gt;log, <span class="stringliteral">"\t%-50s %11ld\n"</span>, <span class="stringliteral">"LS Updates sent "</span>, 
<a name="l00116"></a>00116                 state-&gt;stats-&gt;s_sent_ls_updates);
<a name="l00117"></a>00117         fprintf(state-&gt;log, <span class="stringliteral">"\t%-50s %11ld\n"</span>, <span class="stringliteral">"LS ACKS recvd"</span>, state-&gt;stats-&gt;s_e_ls_acks);
<a name="l00118"></a>00118 
<a name="l00119"></a>00119         fprintf(state-&gt;log, <span class="stringliteral">"\n"</span>);
<a name="l00120"></a>00120         fprintf(state-&gt;log, <span class="stringliteral">"\t%-50s %11ld\n"</span>, <span class="stringliteral">"LS Updates recvd"</span>,
<a name="l00121"></a>00121                 state-&gt;stats-&gt;s_e_ls_updates);
<a name="l00122"></a>00122         fprintf(state-&gt;log, <span class="stringliteral">"\t%-50s %11ld\n"</span>, <span class="stringliteral">"LS ACKs sent "</span>, 
<a name="l00123"></a>00123                 state-&gt;stats-&gt;s_sent_ls_acks);
<a name="l00124"></a>00124         fprintf(state-&gt;log, <span class="stringliteral">"\n"</span>);
<a name="l00125"></a>00125         fprintf(state-&gt;log, <span class="stringliteral">"%s %ld\n"</span>, <span class="stringliteral">"BGP Caused Updates"</span>, 
<a name="l00126"></a>00126                 state-&gt;stats-&gt;s_cause_bgp);
<a name="l00127"></a>00127         fprintf(state-&gt;log, <span class="stringliteral">"%s %ld\n"</span>, <span class="stringliteral">"OSPF Caused Updates"</span>, 
<a name="l00128"></a>00128                 state-&gt;stats-&gt;s_cause_ospf);
<a name="l00129"></a>00129 
<a name="l00130"></a>00130         <span class="keywordflow">if</span>(state-&gt;log &amp;&amp; state-&gt;log != stdout)
<a name="l00131"></a>00131                 fclose(state-&gt;log);
<a name="l00132"></a>00132 <span class="preprocessor">#endif</span>
<a name="l00133"></a>00133 <span class="preprocessor"></span>
<a name="l00134"></a>00134         <span class="comment">// Create the ospf-lsa.file</span>
<a name="l00135"></a>00135 
<a name="l00136"></a>00136         <span class="keywordflow">if</span>(!<a class="code" href="rn-extern_8h.html#1f8c72ceadd5707b682dc77968ffd6d5">g_rn_converge_ospf</a> &amp;&amp; !<a class="code" href="rn-extern_8h.html#b5f1b9e6a511e7afe74d971e088af5b4">g_rn_converge_bgp</a>)
<a name="l00137"></a>00137                 <span class="keywordflow">return</span>;
<a name="l00138"></a>00138 
<a name="l00139"></a>00139         <span class="comment">// Print out the LSAs for the area</span>
<a name="l00140"></a>00140 
<a name="l00141"></a>00141         <span class="keywordflow">if</span>(state-&gt;ar-&gt;low == lp-&gt;id)
<a name="l00142"></a>00142         {
<a name="l00143"></a>00143                 <span class="keywordflow">for</span>(i = 0; i &lt; state-&gt;ar-&gt;g_ospf_nlsa; i++)
<a name="l00144"></a>00144                 {
<a name="l00145"></a>00145                         b = state-&gt;ar-&gt;g_ospf_lsa[i];
<a name="l00146"></a>00146 
<a name="l00147"></a>00147                         <span class="keywordflow">while</span>(b &amp;&amp; NULL != (lsa = tw_memory_data(b)))
<a name="l00148"></a>00148                         {
<a name="l00149"></a>00149                                 <a class="code" href="ospf-extern_8h.html#a04cd2fd7a2636e7fab480a9647fac91">ospf_lsa_print</a>(<a class="code" href="ospf-extern_8h.html#49edbff370ec3a56723d1dc19e990d14">g_ospf_lsa_file</a>, lsa);
<a name="l00150"></a>00150 
<a name="l00151"></a>00151                                 b = lsa-&gt;next;
<a name="l00152"></a>00152                         }
<a name="l00153"></a>00153                 }
<a name="l00154"></a>00154 
<a name="l00155"></a>00155                 fprintf(<a class="code" href="ospf-extern_8h.html#49edbff370ec3a56723d1dc19e990d14">g_ospf_lsa_file</a>, <span class="stringliteral">"-1\n"</span>);
<a name="l00156"></a>00156         }
<a name="l00157"></a>00157 
<a name="l00158"></a>00158         <a class="code" href="ospf-database_8c.html#00045804159715e159464ad9d670e7d8">ospf_db_print_raw</a>(state, <a class="code" href="ospf-extern_8h.html#49edbff370ec3a56723d1dc19e990d14">g_ospf_lsa_file</a>, lp);
<a name="l00159"></a>00159 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="17ce6f44467d016ba9c7c24c98ba11cb"></a><!-- doxytag: member="ospf-extern.h::ospf_timer_cancel" ref="17ce6f44467d016ba9c7c24c98ba11cb" args="(tw_event *tmr, tw_lp *lp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tw_event* ospf_timer_cancel           </td>
          <td>(</td>
          <td class="paramtype">tw_event *&nbsp;</td>
          <td class="paramname"> <em>tmr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-timer_8c-source.html#l00004">4</a> of file <a class="el" href="ospf-timer_8c-source.html">ospf-timer.c</a>.</p>

<p>References <a class="el" href="ospf-global_8c-source.html#l00007">g_ospf_fd</a>, and <a class="el" href="rn-timer_8c-source.html#l00080">rn_timer_cancel()</a>.</p>

<p>Referenced by <a class="el" href="ospf-ack_8c-source.html#l00025">ospf_ack_timed_out()</a>, <a class="el" href="ospf-flood_8c-source.html#l00008">ospf_flood_recv()</a>, <a class="el" href="ospf-interface_8c-source.html#l00007">ospf_interface_reset()</a>, <a class="el" href="ospf-neighbor-state_8c-source.html#l00114">ospf_nbr_exchange_done()</a>, and <a class="el" href="ospf-neighbor-state_8c-source.html#l00011">ospf_nbr_reset()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00005"></a>00005 {
<a name="l00006"></a>00006         tw_memory       *b;
<a name="l00007"></a>00007 
<a name="l00008"></a>00008         <span class="keywordflow">if</span>(tmr &amp;&amp; NULL != tmr-&gt;memory)
<a name="l00009"></a>00009         {
<a name="l00010"></a>00010                 b = tmr-&gt;memory;
<a name="l00011"></a>00011                 tmr-&gt;memory = NULL;
<a name="l00012"></a>00012                 tw_memory_free(lp, b, <a class="code" href="ospf-extern_8h.html#884d66f70a693353a1894758d71deb99">g_ospf_fd</a>);
<a name="l00013"></a>00013         }
<a name="l00014"></a>00014 
<a name="l00015"></a>00015         <span class="keywordflow">if</span>(tmr &amp;&amp; tw_now(lp) == tmr-&gt;recv_ts)
<a name="l00016"></a>00016                 tmr = NULL;
<a name="l00017"></a>00017         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(tmr)
<a name="l00018"></a>00018         {
<a name="l00019"></a>00019                 <a class="code" href="rn-extern_8h.html#28a608317636d45bb278a081d3dea2d2">rn_timer_cancel</a>(lp, &amp;tmr);
<a name="l00020"></a>00020         }
<a name="l00021"></a>00021 
<a name="l00022"></a>00022         <span class="keywordflow">return</span> NULL;
<a name="l00023"></a>00023 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="75e3fe5d4b90cd1e2ca417ac3d9518c7"></a><!-- doxytag: member="ospf-extern.h::ospf_timer_start" ref="75e3fe5d4b90cd1e2ca417ac3d9518c7" args="(ospf_nbr *nbr, tw_event *tmr, tw_stime ts, int type, tw_lp *lp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tw_event* ospf_timer_start           </td>
          <td>(</td>
          <td class="paramtype">ospf_nbr *&nbsp;</td>
          <td class="paramname"> <em>nbr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_event *&nbsp;</td>
          <td class="paramname"> <em>tmr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_stime&nbsp;</td>
          <td class="paramname"> <em>ts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-timer_8c-source.html#l00029">29</a> of file <a class="el" href="ospf-timer_8c-source.html">ospf-timer.c</a>.</p>

<p>References <a class="el" href="ospf-global_8c-source.html#l00007">g_ospf_fd</a>, <a class="el" href="rn-timer_8c-source.html#l00030">rn_timer_init()</a>, and <a class="el" href="rn-timer_8c-source.html#l00058">rn_timer_reset()</a>.</p>

<p>Referenced by <a class="el" href="ospf-dd_8c-source.html#l00062">dd_exchange()</a>, <a class="el" href="ospf-neighbor_8c-source.html#l00018">neighbor_init()</a>, <a class="el" href="ospf-ack_8c-source.html#l00004">ospf_ack_delayed()</a>, <a class="el" href="ospf-timer-aging_8c-source.html#l00147">ospf_aging_timer()</a>, <a class="el" href="ospf-timer-aging_8c-source.html#l00024">ospf_aging_timer_set()</a>, <a class="el" href="ospf-dd_8c-source.html#l00255">ospf_dd_retransmit()</a>, <a class="el" href="ospf-flood_8c-source.html#l00008">ospf_flood_recv()</a>, <a class="el" href="ospf-hello_8c-source.html#l00101">ospf_hello_send()</a>, <a class="el" href="ospf-interface_8c-source.html#l00214">ospf_interface_up()</a>, <a class="el" href="ospf-ls_8c-source.html#l00335">ospf_ls_request()</a>, <a class="el" href="ospf-neighbor-state_8c-source.html#l00289">ospf_nbr_hello_recv()</a>, <a class="el" href="ospf-neighbor-state_8c-source.html#l00407">ospf_nbr_neg_done()</a>, <a class="el" href="ospf-neighbor-state_8c-source.html#l00152">ospf_nbr_start()</a>, <a class="el" href="ospf-neighbor-state_8c-source.html#l00334">ospf_nbr_two_way_recv()</a>, <a class="el" href="ospf-router-rc_8c-source.html#l00004">ospf_rc_event_handler()</a>, <a class="el" href="ospf-timer-retransmit_8c-source.html#l00009">ospf_retrans_timed_out()</a>, <a class="el" href="ospf-routing_8c-source.html#l00004">ospf_rt_build()</a>, and <a class="el" href="ospf-router_8c-source.html#l00237">ospf_startup()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00030"></a>00030 {
<a name="l00031"></a>00031         tw_memory       *b;
<a name="l00032"></a>00032         ospf_message    *m;
<a name="l00033"></a>00033 
<a name="l00034"></a>00034         ts = tw_now(lp) + ts;
<a name="l00035"></a>00035 
<a name="l00036"></a>00036 <span class="comment">/*</span>
<a name="l00037"></a>00037 <span class="comment">        if(tmr &amp;&amp; tmr-&gt;memory &amp;&amp; tmr-&gt;memory-&gt;next)</span>
<a name="l00038"></a>00038 <span class="comment">                tw_error(TW_LOC, "More than one membuf on timer!");</span>
<a name="l00039"></a>00039 <span class="comment">*/</span>
<a name="l00040"></a>00040 
<a name="l00041"></a>00041         <span class="comment">/* THIS CONDITIONAL IS NECESSARY!! */</span>
<a name="l00042"></a>00042         <span class="comment">/* Don't do anything if the timer is already set for this time! */</span>
<a name="l00043"></a>00043         <span class="keywordflow">if</span>(tmr &amp;&amp; tw_now(lp) &gt;= tmr-&gt;recv_ts)
<a name="l00044"></a>00044                 tmr = NULL;
<a name="l00045"></a>00045         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(tmr &amp;&amp; ts == tmr-&gt;recv_ts)
<a name="l00046"></a>00046                 <span class="keywordflow">return</span> tmr;
<a name="l00047"></a>00047 
<a name="l00048"></a>00048         <span class="keywordflow">if</span>(!tmr)
<a name="l00049"></a>00049                 tmr = <a class="code" href="rn-extern_8h.html#0ac1d7574bf764f8813b77b2ee72d79d">rn_timer_init</a>(lp, ts);
<a name="l00050"></a>00050         <span class="keywordflow">else</span>
<a name="l00051"></a>00051                 <a class="code" href="rn-extern_8h.html#5b99d884fbe86665c417897138aff8a6">rn_timer_reset</a>(lp, &amp;tmr, ts);
<a name="l00052"></a>00052 
<a name="l00053"></a>00053         <span class="comment">// Timer library will not allocate timers past end time!</span>
<a name="l00054"></a>00054         <span class="keywordflow">if</span>(!tmr)
<a name="l00055"></a>00055                 <span class="keywordflow">return</span> NULL;
<a name="l00056"></a>00056 
<a name="l00057"></a>00057 <span class="comment">/*</span>
<a name="l00058"></a>00058 <span class="comment">        if(nbr)</span>
<a name="l00059"></a>00059 <span class="comment">                printf("%ld OSPF: TIMER %d ev %d, type: %d, ts %lf \n", </span>
<a name="l00060"></a>00060 <span class="comment">                                        lp-&gt;id, (int) tmr, type, nbr-&gt;id, tmr-&gt;recv_ts);</span>
<a name="l00061"></a>00061 <span class="comment">*/</span>
<a name="l00062"></a>00062 
<a name="l00063"></a>00063         <span class="keywordflow">if</span>(NULL != tmr-&gt;memory)
<a name="l00064"></a>00064                 b = tmr-&gt;memory;
<a name="l00065"></a>00065         <span class="keywordflow">else</span>
<a name="l00066"></a>00066         {
<a name="l00067"></a>00067                 b = tw_memory_alloc(lp, <a class="code" href="ospf-extern_8h.html#884d66f70a693353a1894758d71deb99">g_ospf_fd</a>);
<a name="l00068"></a>00068                 tw_event_memory_set(tmr, b, <a class="code" href="ospf-extern_8h.html#884d66f70a693353a1894758d71deb99">g_ospf_fd</a>);
<a name="l00069"></a>00069         }
<a name="l00070"></a>00070 
<a name="l00071"></a>00071         m = tw_memory_data(b);
<a name="l00072"></a>00072 
<a name="l00073"></a>00073         m-&gt;type = type;
<a name="l00074"></a>00074         m-&gt;data = nbr;
<a name="l00075"></a>00075 
<a name="l00076"></a>00076         <span class="keywordflow">return</span> tmr;
<a name="l00077"></a>00077 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="9b7db701dd7b3ff09df640b0eccf57a8"></a><!-- doxytag: member="ospf-extern.h::ospf_xml" ref="9b7db701dd7b3ff09df640b0eccf57a8" args="(ospf_state *state, const xmlNodePtr my_node, tw_lp *lp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf_xml           </td>
          <td>(</td>
          <td class="paramtype">ospf_state *&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const xmlNodePtr&nbsp;</td>
          <td class="paramname"> <em>my_node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">tw_lp *&nbsp;</td>
          <td class="paramname"> <em>lp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-xml_8c-source.html#l00004">4</a> of file <a class="el" href="ospf-xml_8c-source.html">ospf-xml.c</a>.</p>

<p>References <a class="el" href="rn-machine_8c-source.html#l00022">rn_getarea()</a>, <a class="el" href="rn-machine_8c-source.html#l00028">rn_getas()</a>, <a class="el" href="rn-machine_8c-source.html#l00004">rn_getmachine()</a>, and <a class="el" href="xml-libxml_8c-source.html#l00207">xml_getprop()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00005"></a>00005 {
<a name="l00006"></a>00006         xmlNodePtr              interface;
<a name="l00007"></a>00007 
<a name="l00008"></a>00008         ospf_nbr                *nbr;
<a name="l00009"></a>00009 
<a name="l00010"></a>00010         <span class="keywordtype">int</span>                      addr;
<a name="l00011"></a>00011         <span class="keywordtype">int</span>                      i;
<a name="l00012"></a>00012 
<a name="l00013"></a>00013         state-&gt;m = <a class="code" href="rn-extern_8h.html#b586ebafc20ad652dd538635f5c816b0">rn_getmachine</a>(lp-&gt;id);
<a name="l00014"></a>00014         state-&gt;ar = <a class="code" href="rn-extern_8h.html#d45bc39e5a89bce656786b571acb1ae8">rn_getarea</a>(state-&gt;m);
<a name="l00015"></a>00015 
<a name="l00016"></a>00016         <span class="comment">/*</span>
<a name="l00017"></a>00017 <span class="comment">         * Now we need to set up the LSAs/interfaces for the OSPF neighbors</span>
<a name="l00018"></a>00018 <span class="comment">         */</span>
<a name="l00019"></a>00019         state-&gt;n_interfaces = 0;
<a name="l00020"></a>00020         <span class="keywordflow">for</span>(interface = node-&gt;children; interface; interface = interface-&gt;next)
<a name="l00021"></a>00021         {
<a name="l00022"></a>00022                 <span class="keywordflow">if</span>(0 != strcmp((<span class="keywordtype">char</span> *) interface-&gt;name, <span class="stringliteral">"interface"</span>))
<a name="l00023"></a>00023                         <span class="keywordflow">continue</span>;
<a name="l00024"></a>00024 
<a name="l00025"></a>00025                 addr = atoi(<a class="code" href="rn-extern_8h.html#7a1c29f5a0e60ab08e5593acf5a463ba">xml_getprop</a>(interface, <span class="stringliteral">"addr"</span>));
<a name="l00026"></a>00026 
<a name="l00027"></a>00027                 <span class="keywordflow">if</span>(state-&gt;ar-&gt;as == <a class="code" href="rn-extern_8h.html#d3b2637627bbb86acf01b38d07495042">rn_getas</a>(<a class="code" href="rn-extern_8h.html#b586ebafc20ad652dd538635f5c816b0">rn_getmachine</a>(addr)))
<a name="l00028"></a>00028                         state-&gt;n_interfaces++;
<a name="l00029"></a>00029         }
<a name="l00030"></a>00030 
<a name="l00031"></a>00031         <span class="keywordflow">if</span>(state-&gt;n_interfaces == 0)
<a name="l00032"></a>00032         {
<a name="l00033"></a>00033                 printf(<span class="stringliteral">"%lld: no neighbors! \n"</span>, lp-&gt;id);
<a name="l00034"></a>00034                 <span class="keywordflow">return</span>;
<a name="l00035"></a>00035         }
<a name="l00036"></a>00036 
<a name="l00037"></a>00037         state-&gt;nbr = (ospf_nbr *) calloc(<span class="keyword">sizeof</span>(ospf_nbr), state-&gt;n_interfaces);
<a name="l00038"></a>00038 
<a name="l00039"></a>00039         <span class="keywordflow">if</span>(!state-&gt;nbr)
<a name="l00040"></a>00040                 tw_error(TW_LOC, <span class="stringliteral">"Out of memory!"</span>);
<a name="l00041"></a>00041 
<a name="l00042"></a>00042         <span class="keywordflow">for</span>(i = 0, interface = node-&gt;children; interface; interface = interface-&gt;next)
<a name="l00043"></a>00043         {
<a name="l00044"></a>00044                 <span class="keywordflow">if</span>(0 != strcmp((<span class="keywordtype">char</span> *) interface-&gt;name, <span class="stringliteral">"interface"</span>))
<a name="l00045"></a>00045                         <span class="keywordflow">continue</span>;
<a name="l00046"></a>00046 
<a name="l00047"></a>00047                 nbr = &amp;state-&gt;nbr[i++];
<a name="l00048"></a>00048                 addr = atoi(<a class="code" href="rn-extern_8h.html#7a1c29f5a0e60ab08e5593acf5a463ba">xml_getprop</a>(interface, <span class="stringliteral">"addr"</span>));
<a name="l00049"></a>00049 
<a name="l00050"></a>00050                 <span class="keywordflow">if</span>(state-&gt;ar-&gt;as != <a class="code" href="rn-extern_8h.html#d3b2637627bbb86acf01b38d07495042">rn_getas</a>(<a class="code" href="rn-extern_8h.html#b586ebafc20ad652dd538635f5c816b0">rn_getmachine</a>(addr)))
<a name="l00051"></a>00051                         <span class="keywordflow">continue</span>;
<a name="l00052"></a>00052 
<a name="l00053"></a>00053                 nbr-&gt;id = addr;
<a name="l00054"></a>00054                 nbr-&gt;m = <a class="code" href="rn-extern_8h.html#b586ebafc20ad652dd538635f5c816b0">rn_getmachine</a>(addr);
<a name="l00055"></a>00055                 nbr-&gt;ar = <a class="code" href="rn-extern_8h.html#d45bc39e5a89bce656786b571acb1ae8">rn_getarea</a>(nbr-&gt;m);
<a name="l00056"></a>00056         }
<a name="l00057"></a>00057 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="60f74e3207b2cb2822ba863cfd3f066b"></a><!-- doxytag: member="ospf-extern.h::shouldRecalculateTable" ref="60f74e3207b2cb2822ba863cfd3f066b" args="(ospf_lsa *newLsa, ospf_lsa *oldLsa)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int shouldRecalculateTable           </td>
          <td>(</td>
          <td class="paramtype">ospf_lsa *&nbsp;</td>
          <td class="paramname"> <em>newLsa</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ospf_lsa *&nbsp;</td>
          <td class="paramname"> <em>oldLsa</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="0ddbf789cfd814565dd88748311c1c36"></a><!-- doxytag: member="ospf-extern.h::d" ref="0ddbf789cfd814565dd88748311c1c36" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int* <a class="el" href="ospf-global_8c.html#0ddbf789cfd814565dd88748311c1c36">d</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="save_2ip-routing_8c-source.html#l00104">104</a> of file <a class="el" href="save_2ip-routing_8c-source.html">save/ip-routing.c</a>.</p>

<p>Referenced by <a class="el" href="num-helper_8c-source.html#l00006">get_tod()</a>, <a class="el" href="ospf-database_8c-source.html#l00006">ospf_db_route()</a>, <a class="el" href="ospf-ip_8c-source.html#l00005">ospf_ip_route()</a>, <a class="el" href="ospf-routing_8c-source.html#l00404">ospf_routing_init()</a>, <a class="el" href="ospf-routing_8c-source.html#l00224">ospf_rt_print()</a>, <a class="el" href="ospf-routing_8c-source.html#l00029">ospf_rt_timer()</a>, and <a class="el" href="xml-libxml_8c-source.html#l00153">rn_xml_link_topology()</a>.</p>

</div>
</div><p>
<a class="anchor" name="44d2691741bf5a962646aca63243f118"></a><!-- doxytag: member="ospf-extern.h::db_sz" ref="44d2691741bf5a962646aca63243f118" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="ospf-global_8c.html#44d2691741bf5a962646aca63243f118">db_sz</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-global_8c-source.html#l00005">5</a> of file <a class="el" href="ospf-global_8c-source.html">ospf-global.c</a>.</p>

</div>
</div><p>
<a class="anchor" name="e3285ac7f4cc9a400327c9efb5f535f7"></a><!-- doxytag: member="ospf-extern.h::f" ref="e3285ac7f4cc9a400327c9efb5f535f7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int* <a class="el" href="ospf-global_8c.html#e3285ac7f4cc9a400327c9efb5f535f7">f</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="save_2ip-routing_8c-source.html#l00103">103</a> of file <a class="el" href="save_2ip-routing_8c-source.html">save/ip-routing.c</a>.</p>

<p>Referenced by <a class="el" href="epi-init_8c-source.html#l00038">init_ic_stages_from_file()</a>, <a class="el" href="num-init_8c-source.html#l00035">init_profiles_from_file()</a>, <a class="el" href="ospf-router-debug_8c-source.html#l00030">ospf_router_debug_routing()</a>, <a class="el" href="ospf-routing_8c-source.html#l00404">ospf_routing_init()</a>, and <a class="el" href="ospf-routing_8c-source.html#l00029">ospf_rt_timer()</a>.</p>

</div>
</div><p>
<a class="anchor" name="b836172141b14032d67fde057a072992"></a><!-- doxytag: member="ospf-extern.h::front" ref="b836172141b14032d67fde057a072992" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int* <a class="el" href="ospf-global_8c.html#b836172141b14032d67fde057a072992">front</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-global_8c-source.html#l00028">28</a> of file <a class="el" href="ospf-global_8c-source.html">ospf-global.c</a>.</p>

<p>Referenced by <a class="el" href="ospf-routing_8c-source.html#l00404">ospf_routing_init()</a>, and <a class="el" href="ospf-routing_8c-source.html#l00029">ospf_rt_timer()</a>.</p>

</div>
</div><p>
<a class="anchor" name="6f426e940000297dbd58e3967e65f9c9"></a><!-- doxytag: member="ospf-extern.h::g_max_updates" ref="6f426e940000297dbd58e3967e65f9c9" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="ospf-global_8c.html#6f426e940000297dbd58e3967e65f9c9">g_max_updates</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-global_8c-source.html#l00024">24</a> of file <a class="el" href="ospf-global_8c-source.html">ospf-global.c</a>.</p>

</div>
</div><p>
<a class="anchor" name="a602f5c7dfe578c80e262a82666f2a64"></a><!-- doxytag: member="ospf-extern.h::g_memory" ref="a602f5c7dfe578c80e262a82666f2a64" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int <a class="el" href="ospf-global_8c.html#a602f5c7dfe578c80e262a82666f2a64">g_memory</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-global_8c-source.html#l00025">25</a> of file <a class="el" href="ospf-global_8c-source.html">ospf-global.c</a>.</p>

</div>
</div><p>
<a class="anchor" name="6172717590c1e9795cb6db7baeb1bf4a"></a><!-- doxytag: member="ospf-extern.h::g_ospf_dd_fd" ref="6172717590c1e9795cb6db7baeb1bf4a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tw_fd <a class="el" href="ospf-global_8c.html#6172717590c1e9795cb6db7baeb1bf4a">g_ospf_dd_fd</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-global_8c-source.html#l00009">9</a> of file <a class="el" href="ospf-global_8c-source.html">ospf-global.c</a>.</p>

<p>Referenced by <a class="el" href="ospf-dd_8c-source.html#l00062">dd_exchange()</a>, <a class="el" href="ospf-dd_8c-source.html#l00200">ospf_dd_copy()</a>, <a class="el" href="ospf-dd_8c-source.html#l00280">ospf_dd_event_handler()</a>, <a class="el" href="ospf-main_8c-source.html#l00281">ospf_main()</a>, <a class="el" href="ospf-neighbor-state_8c-source.html#l00407">ospf_nbr_neg_done()</a>, and <a class="el" href="ospf-neighbor-state_8c-source.html#l00334">ospf_nbr_two_way_recv()</a>.</p>

</div>
</div><p>
<a class="anchor" name="884d66f70a693353a1894758d71deb99"></a><!-- doxytag: member="ospf-extern.h::g_ospf_fd" ref="884d66f70a693353a1894758d71deb99" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tw_fd <a class="el" href="ospf-global_8c.html#884d66f70a693353a1894758d71deb99">g_ospf_fd</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-global_8c-source.html#l00007">7</a> of file <a class="el" href="ospf-global_8c-source.html">ospf-global.c</a>.</p>

<p>Referenced by <a class="el" href="bgp-timer_8c-source.html#l00004">bgp_timer_cancel()</a>, <a class="el" href="bgp-timer_8c-source.html#l00029">bgp_timer_start()</a>, <a class="el" href="ospf-dd_8c-source.html#l00062">dd_exchange()</a>, <a class="el" href="ospf-dd_8c-source.html#l00004">dd_process()</a>, <a class="el" href="ospf-ls_8c-source.html#l00243">ls_update_process()</a>, <a class="el" href="ospf-ack_8c-source.html#l00075">ospf_ack_process()</a>, <a class="el" href="ospf-dd_8c-source.html#l00200">ospf_dd_copy()</a>, <a class="el" href="ospf-router_8c-source.html#l00037">ospf_event_handler()</a>, <a class="el" href="ospf-util_8c-source.html#l00024">ospf_event_send()</a>, <a class="el" href="ospf-hello_8c-source.html#l00010">ospf_h_send()</a>, <a class="el" href="ospf-hello_8c-source.html#l00115">ospf_hello_packet()</a>, <a class="el" href="ospf-ls_8c-source.html#l00335">ospf_ls_request()</a>, <a class="el" href="ospf-ls-request_8c-source.html#l00004">ospf_ls_request_recv()</a>, <a class="el" href="ospf-ls_8c-source.html#l00274">ospf_ls_update_recv()</a>, <a class="el" href="ospf-lsa_8c-source.html#l00850">ospf_lsa_flush()</a>, <a class="el" href="ospf-lsa_8c-source.html#l00646">ospf_lsa_start_flood()</a>, <a class="el" href="ospf-main_8c-source.html#l00281">ospf_main()</a>, <a class="el" href="ospf-experiments_8c-source.html#l00004">ospf_random_weights()</a>, <a class="el" href="ospf-timer_8c-source.html#l00004">ospf_timer_cancel()</a>, <a class="el" href="ospf-timer_8c-source.html#l00029">ospf_timer_start()</a>, and <a class="el" href="ospf-ls_8c-source.html#l00026">process_lsa_recv()</a>.</p>

</div>
</div><p>
<a class="anchor" name="8a75915660265dac4f44f3f3b1f3ffcf"></a><!-- doxytag: member="ospf-extern.h::g_ospf_init_file" ref="8a75915660265dac4f44f3f3b1f3ffcf" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* <a class="el" href="ospf-global_8c.html#8a75915660265dac4f44f3f3b1f3ffcf">g_ospf_init_file</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-global_8c-source.html#l00037">37</a> of file <a class="el" href="ospf-global_8c-source.html">ospf-global.c</a>.</p>

<p>Referenced by <a class="el" href="ospf-main_8c-source.html#l00009">ospf_setup_options()</a>.</p>

</div>
</div><p>
<a class="anchor" name="6c4827dc86376bc6eeba9589e6506ea9"></a><!-- doxytag: member="ospf-extern.h::g_ospf_link_weight" ref="6c4827dc86376bc6eeba9589e6506ea9" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="ospf-global_8c.html#6c4827dc86376bc6eeba9589e6506ea9">g_ospf_link_weight</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-global_8c-source.html#l00003">3</a> of file <a class="el" href="ospf-global_8c-source.html">ospf-global.c</a>.</p>

<p>Referenced by <a class="el" href="ospf-experiments_8c-source.html#l00041">ospf_experiment_weights()</a>, and <a class="el" href="ospf-main_8c-source.html#l00009">ospf_setup_options()</a>.</p>

</div>
</div><p>
<a class="anchor" name="a0aabde3f0073b72fe5cbb892a014316"></a><!-- doxytag: member="ospf-extern.h::g_ospf_ll_fd" ref="a0aabde3f0073b72fe5cbb892a014316" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tw_fd <a class="el" href="ospf-global_8c.html#a0aabde3f0073b72fe5cbb892a014316">g_ospf_ll_fd</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-global_8c-source.html#l00010">10</a> of file <a class="el" href="ospf-global_8c-source.html">ospf-global.c</a>.</p>

<p>Referenced by <a class="el" href="bgp-ospf_8c-source.html#l00203">bgp_lsa_find()</a>, <a class="el" href="bgp-ospf_8c-source.html#l00296">bgp_lsa_link_allocate()</a>, <a class="el" href="ospf-main_8c-source.html#l00120">main_setup_areas()</a>, <a class="el" href="ospf-database_8c-source.html#l00083">ospf_db_read()</a>, <a class="el" href="ospf-lsa_8c-source.html#l00076">ospf_lsa_find()</a>, <a class="el" href="ospf-lsa_8c-source.html#l00406">ospf_lsa_link_allocate()</a>, and <a class="el" href="ospf-main_8c-source.html#l00281">ospf_main()</a>.</p>

</div>
</div><p>
<a class="anchor" name="34b0e095c89f24ee59eaf77b52ad8f8a"></a><!-- doxytag: member="ospf-extern.h::g_ospf_lsa" ref="34b0e095c89f24ee59eaf77b52ad8f8a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tw_memory** <a class="el" href="ospf-extern_8h.html#34b0e095c89f24ee59eaf77b52ad8f8a">g_ospf_lsa</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Referenced by <a class="el" href="rn-types_8h-source.html#l00192">DEF()</a>, and <a class="el" href="ospf-lsa_8c-source.html#l00247">getlsa()</a>.</p>

</div>
</div><p>
<a class="anchor" name="76d058140af721aad20439b05b18e172"></a><!-- doxytag: member="ospf-extern.h::g_ospf_lsa_fd" ref="76d058140af721aad20439b05b18e172" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tw_fd <a class="el" href="ospf-global_8c.html#76d058140af721aad20439b05b18e172">g_ospf_lsa_fd</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-global_8c-source.html#l00008">8</a> of file <a class="el" href="ospf-global_8c-source.html">ospf-global.c</a>.</p>

<p>Referenced by <a class="el" href="ospf-database_8c-source.html#l00083">ospf_db_read()</a>, <a class="el" href="ospf-lsa_8c-source.html#l00387">ospf_lsa_allocate()</a>, and <a class="el" href="ospf-main_8c-source.html#l00281">ospf_main()</a>.</p>

</div>
</div><p>
<a class="anchor" name="49edbff370ec3a56723d1dc19e990d14"></a><!-- doxytag: member="ospf-extern.h::g_ospf_lsa_file" ref="49edbff370ec3a56723d1dc19e990d14" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">FILE* <a class="el" href="ospf-global_8c.html#49edbff370ec3a56723d1dc19e990d14">g_ospf_lsa_file</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-global_8c-source.html#l00039">39</a> of file <a class="el" href="ospf-global_8c-source.html">ospf-global.c</a>.</p>

<p>Referenced by <a class="el" href="ospf-main_8c-source.html#l00281">ospf_main()</a>, <a class="el" href="ospf-main_8c-source.html#l00386">ospf_md_final()</a>, and <a class="el" href="ospf-stats_8c-source.html#l00008">ospf_statistics_collection()</a>.</p>

</div>
</div><p>
<a class="anchor" name="7a318634977625460e285269c959269f"></a><!-- doxytag: member="ospf-extern.h::g_ospf_lsa_input" ref="7a318634977625460e285269c959269f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">FILE* <a class="el" href="ospf-global_8c.html#7a318634977625460e285269c959269f">g_ospf_lsa_input</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-global_8c-source.html#l00040">40</a> of file <a class="el" href="ospf-global_8c-source.html">ospf-global.c</a>.</p>

<p>Referenced by <a class="el" href="ospf-database_8c-source.html#l00083">ospf_db_read()</a>, and <a class="el" href="ospf-main_8c-source.html#l00281">ospf_main()</a>.</p>

</div>
</div><p>
<a class="anchor" name="40c99b64349659459b09f91834346114"></a><!-- doxytag: member="ospf-extern.h::g_ospf_routing_file" ref="40c99b64349659459b09f91834346114" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">FILE* <a class="el" href="ospf-global_8c.html#40c99b64349659459b09f91834346114">g_ospf_routing_file</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-global_8c-source.html#l00038">38</a> of file <a class="el" href="ospf-global_8c-source.html">ospf-global.c</a>.</p>

<p>Referenced by <a class="el" href="ospf-main_8c-source.html#l00386">ospf_md_final()</a>, <a class="el" href="ospf-routing_8c-source.html#l00404">ospf_routing_init()</a>, and <a class="el" href="ospf-main_8c-source.html#l00009">ospf_setup_options()</a>.</p>

</div>
</div><p>
<a class="anchor" name="c90b3ca848617e3fe636407eb372c5d5"></a><!-- doxytag: member="ospf-extern.h::g_ospf_rt_write" ref="c90b3ca848617e3fe636407eb372c5d5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="ospf-global_8c.html#c90b3ca848617e3fe636407eb372c5d5">g_ospf_rt_write</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-global_8c-source.html#l00019">19</a> of file <a class="el" href="ospf-global_8c-source.html">ospf-global.c</a>.</p>

<p>Referenced by <a class="el" href="ospf-database_8c-source.html#l00393">ospf_db_init()</a>, <a class="el" href="ospf-routing_8c-source.html#l00404">ospf_routing_init()</a>, <a class="el" href="ospf-main_8c-source.html#l00009">ospf_setup_options()</a>, and <a class="el" href="ospf-router_8c-source.html#l00237">ospf_startup()</a>.</p>

</div>
</div><p>
<a class="anchor" name="7f0b189fb4e0f9bde7b94669c36dc8d9"></a><!-- doxytag: member="ospf-extern.h::g_ospf_state" ref="7f0b189fb4e0f9bde7b94669c36dc8d9" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ospf_global_state* <a class="el" href="ospf-global_8c.html#7f0b189fb4e0f9bde7b94669c36dc8d9">g_ospf_state</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-global_8c-source.html#l00012">12</a> of file <a class="el" href="ospf-global_8c-source.html">ospf-global.c</a>.</p>

<p>Referenced by <a class="el" href="ospf-neighbor_8c-source.html#l00018">neighbor_init()</a>, <a class="el" href="ospf-main_8c-source.html#l00009">ospf_setup_options()</a>, and <a class="el" href="ospf-router_8c-source.html#l00237">ospf_startup()</a>.</p>

</div>
</div><p>
<a class="anchor" name="6ff92e91f0531f31567a8453d5b2b08b"></a><!-- doxytag: member="ospf-extern.h::g_ospf_stats" ref="6ff92e91f0531f31567a8453d5b2b08b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ospf_statistics* <a class="el" href="ospf-global_8c.html#6ff92e91f0531f31567a8453d5b2b08b">g_ospf_stats</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-global_8c-source.html#l00036">36</a> of file <a class="el" href="ospf-global_8c-source.html">ospf-global.c</a>.</p>

<p>Referenced by <a class="el" href="ospf-main_8c-source.html#l00281">ospf_main()</a>, <a class="el" href="ospf-main_8c-source.html#l00386">ospf_md_final()</a>, and <a class="el" href="ospf-stats_8c-source.html#l00008">ospf_statistics_collection()</a>.</p>

</div>
</div><p>
<a class="anchor" name="9f9f956462ca43b7fd2caa89db98c5a9"></a><!-- doxytag: member="ospf-extern.h::g_route" ref="9f9f956462ca43b7fd2caa89db98c5a9" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="ospf-global_8c.html#182685b7dac19904b7e2f3d748525c37">g_route</a>[]          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-global_8c-source.html#l00014">14</a> of file <a class="el" href="ospf-global_8c-source.html">ospf-global.c</a>.</p>

<p>Referenced by <a class="el" href="ospf-database_8c-source.html#l00288">ospf_db_update()</a>, <a class="el" href="ospf-router_8c-source.html#l00237">ospf_startup()</a>, and <a class="el" href="ospf-stats_8c-source.html#l00008">ospf_statistics_collection()</a>.</p>

</div>
</div><p>
<a class="anchor" name="097cad055eec1bd215ad822a813dc62e"></a><!-- doxytag: member="ospf-extern.h::g_route1" ref="097cad055eec1bd215ad822a813dc62e" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="ospf-global_8c.html#f392d99a27d80738eb6fbc9ba1db23d4">g_route1</a>[]          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-global_8c-source.html#l00015">15</a> of file <a class="el" href="ospf-global_8c-source.html">ospf-global.c</a>.</p>

<p>Referenced by <a class="el" href="ospf-database_8c-source.html#l00288">ospf_db_update()</a>, <a class="el" href="ospf-router_8c-source.html#l00237">ospf_startup()</a>, and <a class="el" href="ospf-stats_8c-source.html#l00008">ospf_statistics_collection()</a>.</p>

</div>
</div><p>
<a class="anchor" name="fb9d98c42d13a533e0359397955e932c"></a><!-- doxytag: member="ospf-extern.h::g_routers" ref="fb9d98c42d13a533e0359397955e932c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="ospf-extern_8h.html#fb9d98c42d13a533e0359397955e932c">g_routers</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="432a4c78ffc399e9fb0d8070289f47e1"></a><!-- doxytag: member="ospf-extern.h::gr1" ref="432a4c78ffc399e9fb0d8070289f47e1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="ospf-global_8c.html#432a4c78ffc399e9fb0d8070289f47e1">gr1</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-global_8c-source.html#l00016">16</a> of file <a class="el" href="ospf-global_8c-source.html">ospf-global.c</a>.</p>

<p>Referenced by <a class="el" href="ospf-database_8c-source.html#l00288">ospf_db_update()</a>, and <a class="el" href="ospf-router_8c-source.html#l00237">ospf_startup()</a>.</p>

</div>
</div><p>
<a class="anchor" name="fb99688fe29cd99a5a48c77bfee16629"></a><!-- doxytag: member="ospf-extern.h::gr2" ref="fb99688fe29cd99a5a48c77bfee16629" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="ospf-global_8c.html#fb99688fe29cd99a5a48c77bfee16629">gr2</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-global_8c-source.html#l00017">17</a> of file <a class="el" href="ospf-global_8c-source.html">ospf-global.c</a>.</p>

<p>Referenced by <a class="el" href="ospf-database_8c-source.html#l00288">ospf_db_update()</a>, and <a class="el" href="ospf-router_8c-source.html#l00237">ospf_startup()</a>.</p>

</div>
</div><p>
<a class="anchor" name="354846699ca7e45e6f42d17268d8fac2"></a><!-- doxytag: member="ospf-extern.h::OSPF_LSA_MAX_AGE" ref="354846699ca7e45e6f42d17268d8fac2" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int <a class="el" href="ospf-global_8c.html#354846699ca7e45e6f42d17268d8fac2">OSPF_LSA_MAX_AGE</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-global_8c-source.html#l00021">21</a> of file <a class="el" href="ospf-global_8c-source.html">ospf-global.c</a>.</p>

<p>Referenced by <a class="el" href="bgp-ospf_8c-source.html#l00070">bgp_ospf_update()</a>, <a class="el" href="ospf-timer-aging_8c-source.html#l00115">can_be_removed()</a>, <a class="el" href="ospf-timer-aging_8c-source.html#l00147">ospf_aging_timer()</a>, <a class="el" href="ospf-timer-aging_8c-source.html#l00024">ospf_aging_timer_set()</a>, <a class="el" href="ospf-database_8c-source.html#l00393">ospf_db_init()</a>, <a class="el" href="ospf-database_8c-source.html#l00380">ospf_db_remove()</a>, <a class="el" href="ospf-database_8c-source.html#l00288">ospf_db_update()</a>, <a class="el" href="ospf-lsa_8c-source.html#l00231">ospf_lsa_age()</a>, <a class="el" href="ospf-lsa_8c-source.html#l00527">ospf_lsa_create()</a>, <a class="el" href="ospf-lsa_8c-source.html#l00850">ospf_lsa_flush()</a>, <a class="el" href="ospf-lsa_8c-source.html#l00793">ospf_lsa_isnewer()</a>, <a class="el" href="ospf-lsa_8c-source.html#l00481">ospf_lsa_refresh()</a>, <a class="el" href="ospf-lsa_8c-source.html#l00646">ospf_lsa_start_flood()</a>, and <a class="el" href="ospf-ls_8c-source.html#l00026">process_lsa_recv()</a>.</p>

</div>
</div><p>
<a class="anchor" name="e536fe3d2be9c08e53d0e53d48046668"></a><!-- doxytag: member="ospf-extern.h::OSPF_LSA_REFRESH_AGE" ref="e536fe3d2be9c08e53d0e53d48046668" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int <a class="el" href="ospf-global_8c.html#e536fe3d2be9c08e53d0e53d48046668">OSPF_LSA_REFRESH_AGE</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-global_8c-source.html#l00022">22</a> of file <a class="el" href="ospf-global_8c-source.html">ospf-global.c</a>.</p>

<p>Referenced by <a class="el" href="ospf-timer-aging_8c-source.html#l00147">ospf_aging_timer()</a>, <a class="el" href="ospf-timer-aging_8c-source.html#l00024">ospf_aging_timer_set()</a>, and <a class="el" href="ospf-database_8c-source.html#l00393">ospf_db_init()</a>.</p>

</div>
</div><p>
<a class="anchor" name="61b0821c8ee2a2df1d8cf38ebe0f2b3c"></a><!-- doxytag: member="ospf-extern.h::p" ref="61b0821c8ee2a2df1d8cf38ebe0f2b3c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int* <a class="el" href="ospf-global_8c.html#61b0821c8ee2a2df1d8cf38ebe0f2b3c">p</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-global_8c-source.html#l00027">27</a> of file <a class="el" href="ospf-global_8c-source.html">ospf-global.c</a>.</p>

<p>Referenced by <a class="el" href="num-init_8c-source.html#l00004">init_default_profiles()</a>, <a class="el" href="num-init_8c-source.html#l00035">init_profiles_from_file()</a>, <a class="el" href="ospf-routing_8c-source.html#l00404">ospf_routing_init()</a>, <a class="el" href="ospf-routing_8c-source.html#l00029">ospf_rt_timer()</a>, and <a class="el" href="queue-heap_8c-source.html#l00105">percolate_up()</a>.</p>

</div>
</div><p>
<a class="anchor" name="b4c6c03359486e6fb0ac52a94493df1e"></a><!-- doxytag: member="ospf-extern.h::s" ref="b4c6c03359486e6fb0ac52a94493df1e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int* <a class="el" href="ospf-global_8c.html#b4c6c03359486e6fb0ac52a94493df1e">s</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ospf-global_8c-source.html#l00030">30</a> of file <a class="el" href="ospf-global_8c-source.html">ospf-global.c</a>.</p>

<p>Referenced by <a class="el" href="bgp-ospf_8c-source.html#l00008">bgp_ospf_init()</a>, <a class="el" href="bgp-ospf_8c-source.html#l00070">bgp_ospf_update()</a>, <a class="el" href="epi-agent_8c-source.html#l00020">epi_agent_stage_tran()</a>, <a class="el" href="epi-seir_8c-source.html#l00018">epi_seir_compute()</a>, <a class="el" href="epi-xml_8c-source.html#l00008">epi_xml()</a>, <a class="el" href="num-helper_8c-source.html#l00006">get_tod()</a>, <a class="el" href="epi-init_8c-source.html#l00007">init_default_ic_stages()</a>, <a class="el" href="epi-init_8c-source.html#l00038">init_ic_stages_from_file()</a>, <a class="el" href="ospf-routing_8c-source.html#l00404">ospf_routing_init()</a>, <a class="el" href="ospf-routing_8c-source.html#l00029">ospf_rt_timer()</a>, <a class="el" href="rn-event_8c-source.html#l00008">rn_event_direct()</a>, <a class="el" href="rn-event_8c-source.html#l00058">rn_event_new()</a>, <a class="el" href="rn-event_8c-source.html#l00173">rn_event_send()</a>, <a class="el" href="rn_8c-source.html#l00439">rn_final()</a>, <a class="el" href="rn-stream_8c-source.html#l00023">rn_getstream()</a>, <a class="el" href="rn-timer_8c-source.html#l00030">rn_timer_init()</a>, <a class="el" href="rn-timer_8c-source.html#l00004">rn_timer_simple()</a>, and <a class="el" href="xml-libxml_8c-source.html#l00153">rn_xml_link_topology()</a>.</p>

</div>
</div><p>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Tue Jan 27 09:38:29 2009 for ROSS.Net by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.5 </small></address>
</body>
</html>
